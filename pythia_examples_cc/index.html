<!DOCTYPE html>
<html lang="en">
  <head>
    <title>

PYTHIA8 *.cc examples

</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Bootstrap -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">
<!-- <link rel="stylesheet" href="../static/mp/css/docs.min.css"> -->
<!-- <link rel="stylesheet" href="../static/mp/css/bg.css"> -->
<!-- <link rel="stylesheet" href="../static/mp/css/_navbar.css"> -->
<!-- link href="http://portal.nersc.gov/project/alice/ploskon/static/static_extra/resources/mp/css/docs.min.css" rel="stylesheet"> -->
<!-- <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet"> -->
<!-- <link href="https://getbootstrap.com/assets/css/docs.min.css" rel="stylesheet"> -->
<link href="static/mp/css/bgfiti.css" rel="stylesheet">
<link href="static/mp/css/navbar.css" rel="stylesheet">
<link href="static/mp/css/sublevel-dropdown.css" rel="stylesheet">
<link href="static/mp/css/other.css" rel="stylesheet">
<link rel="stylesheet" href="../static/mp/css/pygments.css">
<!--<link href="http://portal.nersc.gov/project/alice/ploskon/static/static_extra/resources/mp/css/tomorrow-night.css" rel="stylesheet"> -->

  </head>
  <body>
    
	
<!-- Static navbar -->
<!-- <nav class="navbar navbar-default navbar-fixed-top navbar-inverse" id="nav-navbar"> -->
<nav class="navbar navbar-fixed-top navbar-inverse" id="nav-navbar">
	<div class="container-fluid">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="true" aria-controls="navbar">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" href="../index.html">home</a>
			<a class="navbar-brand" href="#">top</a>
		</div>
		<div id="navbar" class="navbar-collapse collapse">
			<ul class="nav navbar-nav navbar-left">
				<li class="dropdown">
					
						<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="true">pages<span class="caret"></span></a>
<ul class="dropdown-menu" role="menu">
	<li class="dropdown-header">Local links...</li>
	
	<li>
		<a href="../markdown/index.html"> Useful things on markdown
			<small>
				
				
				<span class="label label-default"> code </span>
				
				        
			</small>
		</a>
	</li>
	
	<li>
		<a href="../pythia_hand/index.html"> PYTHIA Handy
			<small>
				
				
				<span class="label label-default"> physics </span>
				
				        
			</small>
		</a>
	</li>
	
	<li>
		<a href="../muon_calo_ed/index.html"> ALICE Muon-Calo trigger event display
			<small>
				
				
				<span class="label label-default"> physics </span>
				
				<span class="label label-default"> alice </span>
				
				        
			</small>
		</a>
	</li>
	
	<li>
		<a href="../index/index.html"> MP Home page
			<small>
				
				
				<span class="label label-default"> general </span>
				
				        
			</small>
		</a>
	</li>
	
	<li>
		<a href="../students_hepsoft/index.html"> A custom HEP software installation
			<small>
				
				
				<span class="label label-default"> students </span>
				
				        
			</small>
		</a>
	</li>
	
	<li>
		<a href="../pyroot/index.html"> PyROOT
			<small>
				
				
				<span class="label label-default"> code </span>
				
				        
			</small>
		</a>
	</li>
	
	<li>
		<a href="../lhc_experiments/index.html"> LHC Experiments
			<small>
				
				
				<span class="label label-default"> physics </span>
				
				        
			</small>
		</a>
	</li>
	
	<li>
		<a href="../students_start_here/index.html"> Start Here
			<small>
				
				
				<span class="label label-default"> students </span>
				
				        
			</small>
		</a>
	</li>
	
	<li>
		<a href="../jet_notes/index.html"> Jet substructure
			<small>
				
				
				<span class="label label-default"> physics </span>
				
				        
			</small>
		</a>
	</li>
	
	<li>
		<a href="../tests/index.html"> All sorts of tests
			<small>
				
				
				<span class="label label-default"> misc </span>
				
				        
			</small>
		</a>
	</li>
	
	<li>
		<a href="../alice_sim_pdsf/index.html"> ALICE simulation on PDSF
			<small>
				
				
				<span class="label label-default"> alice </span>
				
				        
			</small>
		</a>
	</li>
	
	<li>
		<a href="../alice_file_transfer_pdsf/index.html"> ALICE data transfer to PDSF
			<small>
				
				
				<span class="label label-default"> alice </span>
				
				        
			</small>
		</a>
	</li>
	
	<li>
		<a href="index.html"> PYTHIA8 *.cc examples
			<small>
				
				
				<span class="label label-default"> physics </span>
				
				        
			</small>
		</a>
	</li>
	
	<li>
		<a href="../latex/index.html"> Latex things
			<small>
				
				
				<span class="label label-default"> code </span>
				
				<span class="label label-default"> tools </span>
				
				        
			</small>
		</a>
	</li>
	
	<li>
		<a href="../novel_hf/index.html"> Novel methods for heavy-flavor studies
			<small>
				
				
				<span class="label label-default"> physics </span>
				
				        
			</small>
		</a>
	</li>
	
	<li>
		<a href="../bootstrap/index.html"> Bootstrap
			<small>
				
				
				<span class="label label-default"> code </span>
				
				        
			</small>
		</a>
	</li>
	
	<li>
		<a href="../lbltb/index.html"> LBL Test Beam Graphed
			<small>
				
				
				<span class="label label-default"> code </span>
				
				        
			</small>
		</a>
	</li>
	
	<li>
		<a href="../eic/index.html"> Electron-Ion C.
			<small>
				
				
				<span class="label label-default"> physics </span>
				
				        
			</small>
		</a>
	</li>
	
	<li>
		<a href="../misc_refs/index.html"> Miscellaneous refs
			<small>
				
				
				<span class="label label-default"> physics </span>
				
				        
			</small>
		</a>
	</li>
	
</ul>
					
				</li>
				
					<li class="dropdown">
						
							<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="true">code<span class="caret"></span></a>
<ul class="dropdown-menu" role="menu">
	<li class="dropdown-header">Local links...</li>
	
	<li>
		<a href="../markdown/index.html"> Useful things on markdown
			<small>
				
					
						<span class="label label-default"> code </span>
					
				        
			</small>
		</a>
	</li>
	
	<li>
		<a href="../pyroot/index.html"> PyROOT
			<small>
				
					
						<span class="label label-default"> code </span>
					
				        
			</small>
		</a>
	</li>
	
	<li>
		<a href="../latex/index.html"> Latex things
			<small>
				
					
						<span class="label label-default"> code </span>
					
						<span class="label label-default"> tools </span>
					
				        
			</small>
		</a>
	</li>
	
	<li>
		<a href="../bootstrap/index.html"> Bootstrap
			<small>
				
					
						<span class="label label-default"> code </span>
					
				        
			</small>
		</a>
	</li>
	
	<li>
		<a href="../lbltb/index.html"> LBL Test Beam Graphed
			<small>
				
					
						<span class="label label-default"> code </span>
					
				        
			</small>
		</a>
	</li>
	
</ul>
						
					</li>
				
					<li class="dropdown">
						
							<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="true">physics<span class="caret"></span></a>
<ul class="dropdown-menu" role="menu">
	<li class="dropdown-header">Local links...</li>
	
	<li>
		<a href="../pythia_hand/index.html"> PYTHIA Handy
			<small>
				
					
						<span class="label label-default"> physics </span>
					
				        
			</small>
		</a>
	</li>
	
	<li>
		<a href="../muon_calo_ed/index.html"> ALICE Muon-Calo trigger event display
			<small>
				
					
						<span class="label label-default"> physics </span>
					
						<span class="label label-default"> alice </span>
					
				        
			</small>
		</a>
	</li>
	
	<li>
		<a href="../lhc_experiments/index.html"> LHC Experiments
			<small>
				
					
						<span class="label label-default"> physics </span>
					
				        
			</small>
		</a>
	</li>
	
	<li>
		<a href="../jet_notes/index.html"> Jet substructure
			<small>
				
					
						<span class="label label-default"> physics </span>
					
				        
			</small>
		</a>
	</li>
	
	<li>
		<a href="index.html"> PYTHIA8 *.cc examples
			<small>
				
					
						<span class="label label-default"> physics </span>
					
				        
			</small>
		</a>
	</li>
	
	<li>
		<a href="../novel_hf/index.html"> Novel methods for heavy-flavor studies
			<small>
				
					
						<span class="label label-default"> physics </span>
					
				        
			</small>
		</a>
	</li>
	
	<li>
		<a href="../eic/index.html"> Electron-Ion C.
			<small>
				
					
						<span class="label label-default"> physics </span>
					
				        
			</small>
		</a>
	</li>
	
	<li>
		<a href="../misc_refs/index.html"> Miscellaneous refs
			<small>
				
					
						<span class="label label-default"> physics </span>
					
				        
			</small>
		</a>
	</li>
	
</ul>
						
					</li>
				
					<li class="dropdown">
						
							<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="true">alice<span class="caret"></span></a>
<ul class="dropdown-menu" role="menu">
	<li class="dropdown-header">Local links...</li>
	
	<li>
		<a href="../muon_calo_ed/index.html"> ALICE Muon-Calo trigger event display
			<small>
				
					
						<span class="label label-default"> physics </span>
					
						<span class="label label-default"> alice </span>
					
				        
			</small>
		</a>
	</li>
	
	<li>
		<a href="../alice_sim_pdsf/index.html"> ALICE simulation on PDSF
			<small>
				
					
						<span class="label label-default"> alice </span>
					
				        
			</small>
		</a>
	</li>
	
	<li>
		<a href="../alice_file_transfer_pdsf/index.html"> ALICE data transfer to PDSF
			<small>
				
					
						<span class="label label-default"> alice </span>
					
				        
			</small>
		</a>
	</li>
	
</ul>
						
					</li>
				
					<li class="dropdown">
						
							<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="true">general<span class="caret"></span></a>
<ul class="dropdown-menu" role="menu">
	<li class="dropdown-header">Local links...</li>
	
	<li>
		<a href="../index/index.html"> MP Home page
			<small>
				
					
						<span class="label label-default"> general </span>
					
				        
			</small>
		</a>
	</li>
	
</ul>
						
					</li>
				
					<li class="dropdown">
						
							<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="true">students<span class="caret"></span></a>
<ul class="dropdown-menu" role="menu">
	<li class="dropdown-header">Local links...</li>
	
	<li>
		<a href="../students_hepsoft/index.html"> A custom HEP software installation
			<small>
				
					
						<span class="label label-default"> students </span>
					
				        
			</small>
		</a>
	</li>
	
	<li>
		<a href="../students_start_here/index.html"> Start Here
			<small>
				
					
						<span class="label label-default"> students </span>
					
				        
			</small>
		</a>
	</li>
	
</ul>
						
					</li>
				
					<li class="dropdown">
						
							<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="true">misc<span class="caret"></span></a>
<ul class="dropdown-menu" role="menu">
	<li class="dropdown-header">Local links...</li>
	
	<li>
		<a href="../tests/index.html"> All sorts of tests
			<small>
				
					
						<span class="label label-default"> misc </span>
					
				        
			</small>
		</a>
	</li>
	
</ul>
						
					</li>
				
					<li class="dropdown">
						
							<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="true">tools<span class="caret"></span></a>
<ul class="dropdown-menu" role="menu">
	<li class="dropdown-header">Local links...</li>
	
	<li>
		<a href="../latex/index.html"> Latex things
			<small>
				
					
						<span class="label label-default"> code </span>
					
						<span class="label label-default"> tools </span>
					
				        
			</small>
		</a>
	</li>
	
</ul>
						
					</li>
				
			</ul>
			</div><!--/.nav-collapse -->
		</div><!--/.container-fluid -->
	</nav>
	
	
<div id="wrap">
    <div class="container-fluid" id="main">
        <div class="row clearfix">
            <div class="col-md-12 column">
                <div class="well well-sm">
                    <div class="page-header">
                        
                        <div class="well well-sm">
                            <h1> PYTHIA8 *.cc examples <small> 2016-03-17 </small> </h1>
                            
                            
	
	<span class="label label-default"> <a href="../tag/physics/index.html"><span class="glyphicon glyphicon-tag"></span> physics </a> </span>
	

                            
                            
                            
                            
                            
<div class="btn-group">
	<button type="button" class="btn btn-primary btn-sm dropdown-toggle" data-toggle="dropdown">Contents...<span class="caret"></span></button>
	
	<ul class="dropdown-menu scrollable-menu" role="menu">

<li><a href="#main01cc">main01.cc</a></li>
<li><a href="#main02cc">main02.cc</a></li>
<li><a href="#main03cc">main03.cc</a></li>
<li><a href="#main04cc">main04.cc</a></li>
<li><a href="#main05cc">main05.cc</a></li>
<li><a href="#main06cc">main06.cc</a></li>
<li><a href="#main07cc">main07.cc</a></li>
<li><a href="#main08cc">main08.cc</a></li>
<li><a href="#main09cc">main09.cc</a></li>
<li><a href="#main10cc">main10.cc</a></li>
<li><a href="#main11cc">main11.cc</a></li>
<li><a href="#main12cc">main12.cc</a></li>
<li><a href="#main13cc">main13.cc</a></li>
<li><a href="#main14cc">main14.cc</a></li>
<li><a href="#main15cc">main15.cc</a></li>
<li><a href="#main16cc">main16.cc</a></li>
<li><a href="#main17cc">main17.cc</a></li>
<li><a href="#main18cc">main18.cc</a></li>
<li><a href="#main19cc">main19.cc</a></li>
<li><a href="#main20cc">main20.cc</a></li>
<li><a href="#main21cc">main21.cc</a></li>
<li><a href="#main22cc">main22.cc</a></li>
<li><a href="#main23cc">main23.cc</a></li>
<li><a href="#main24cc">main24.cc</a></li>
<li><a href="#main25cc">main25.cc</a></li>
<li><a href="#main26cc">main26.cc</a></li>
<li><a href="#main27cc">main27.cc</a></li>
<li><a href="#main28cc">main28.cc</a></li>
<li><a href="#main29cc">main29.cc</a></li>
<li><a href="#main30cc">main30.cc</a></li>
<li><a href="#main31cc">main31.cc</a></li>
<li><a href="#main32cc">main32.cc</a></li>
<li><a href="#main33cc">main33.cc</a></li>
<li><a href="#main34cc">main34.cc</a></li>
<li><a href="#main37cc">main37.cc</a></li>
<li><a href="#main38cc">main38.cc</a></li>
<li><a href="#main41cc">main41.cc</a></li>
<li><a href="#main42cc">main42.cc</a></li>
<li><a href="#main43cc">main43.cc</a></li>
<li><a href="#main46cc">main46.cc</a></li>
<li><a href="#main48cc">main48.cc</a></li>
<li><a href="#main51cc">main51.cc</a></li>
<li><a href="#main52cc">main52.cc</a></li>
<li><a href="#main53cc">main53.cc</a></li>
<li><a href="#main54cc">main54.cc</a></li>
<li><a href="#main61cc">main61.cc</a></li>
<li><a href="#main62cc">main62.cc</a></li>
<li><a href="#main63cc">main63.cc</a></li>
<li><a href="#main64cc">main64.cc</a></li>
<li><a href="#main71cc">main71.cc</a></li>
<li><a href="#main72cc">main72.cc</a></li>
<li><a href="#main73cc">main73.cc</a></li>
<li><a href="#main80cc">main80.cc</a></li>
<li><a href="#main81cc">main81.cc</a></li>
<li><a href="#main82cc">main82.cc</a></li>
<li><a href="#main83cc">main83.cc</a></li>
<li><a href="#main84cc">main84.cc</a></li>
<li><a href="#main85cc">main85.cc</a></li>
<li><a href="#main86cc">main86.cc</a></li>
<li><a href="#main87cc">main87.cc</a></li>
<li><a href="#main88cc">main88.cc</a></li>
<li><a href="#main89cc">main89.cc</a></li>
<li><a href="#main91cc">main91.cc</a></li>
<li><a href="#main92cc">main92.cc</a></li>

</ul>

	
</div>

                            
                            
                            <h3></h3>
                        </div>
                    </div>
                    <div>
                        
                        </div> <div class="well well-sm"> <h1 id="main01cc">main01.cc</h1><hr>
<div class="codehilite"><pre><span class="c1">// main01.cc is a part of the PYTHIA event generator.</span>
<span class="c1">// Copyright (C) 2016 Torbjorn Sjostrand.</span>
<span class="c1">// PYTHIA is licenced under the GNU GPL version 2, see COPYING for details.</span>
<span class="c1">// Please respect the MCnet Guidelines, see GUIDELINES for details.</span>
<span class="c1">// This is a simple test program. It fits on one slide in a talk.</span>
<span class="c1">// It studies the charged multiplicity distribution at the LHC.</span>
</pre></div>


<div class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" href="#fileid0">Rest of the main01.cc code</a>
    </h4>
  </div>
  <div id="fileid0" class="panel-collapse collapse">
    <div class="panel-body">
<div class="codehilite"><pre><span class="cp">#include</span> <span class="cpf">&quot;Pythia8/Pythia.h&quot;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">Pythia8</span><span class="p">;</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Generator. Process selection. LHC initialization. Histogram.</span>
  <span class="n">Pythia</span> <span class="n">pythia</span><span class="p">;</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Beams:eCM = 8000.&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;HardQCD:all = on&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;PhaseSpace:pTHatMin = 20.&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
  <span class="n">Hist</span> <span class="n">mult</span><span class="p">(</span><span class="s">&quot;charged multiplicity&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">799.5</span><span class="p">);</span>
  <span class="c1">// Begin event loop. Generate event. Skip if error. List first one.</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iEvent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iEvent</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">;</span> <span class="o">++</span><span class="n">iEvent</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">())</span> <span class="k">continue</span><span class="p">;</span>
    <span class="c1">// Find number of all final charged particles and fill histogram.</span>
    <span class="kt">int</span> <span class="n">nCharged</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">isFinal</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">isCharged</span><span class="p">())</span>
        <span class="o">++</span><span class="n">nCharged</span><span class="p">;</span>
    <span class="n">mult</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">nCharged</span> <span class="p">);</span>
  <span class="c1">// End of event loop. Statistics. Histogram. Done.</span>
  <span class="p">}</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">mult</span><span class="p">;</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
    </div>
  </div>
</div>

</div> <div class="well well-sm"> <h1 id="main02cc">main02.cc</h1><hr>
<div class="codehilite"><pre><span class="c1">// main02.cc is a part of the PYTHIA event generator.</span>
<span class="c1">// Copyright (C) 2016 Torbjorn Sjostrand.</span>
<span class="c1">// PYTHIA is licenced under the GNU GPL version 2, see COPYING for details.</span>
<span class="c1">// Please respect the MCnet Guidelines, see GUIDELINES for details.</span>
<span class="c1">// This is a simple test program. It fits on one slide in a talk.</span>
<span class="c1">// It studies the pT_Z spectrum at the Tevatron.</span>
</pre></div>


<div class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" href="#fileid1">Rest of the main02.cc code</a>
    </h4>
  </div>
  <div id="fileid1" class="panel-collapse collapse">
    <div class="panel-body">
<div class="codehilite"><pre><span class="cp">#include</span> <span class="cpf">&quot;Pythia8/Pythia.h&quot;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">Pythia8</span><span class="p">;</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Generator. Process selection. Tevatron initialization. Histogram.</span>
  <span class="n">Pythia</span> <span class="n">pythia</span><span class="p">;</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Beams:idB = -2212&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Beams:eCM = 1960.&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;WeakSingleBoson:ffbar2gmZ = on&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;PhaseSpace:mHatMin = 80.&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;PhaseSpace:mHatMax = 120.&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
  <span class="n">Hist</span> <span class="n">pTZ</span><span class="p">(</span><span class="s">&quot;dN/dpTZ&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">100.</span><span class="p">);</span>
  <span class="c1">// Begin event loop. Generate event. Skip if error. List first one.</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iEvent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iEvent</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">;</span> <span class="o">++</span><span class="n">iEvent</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">())</span> <span class="k">continue</span><span class="p">;</span>
    <span class="c1">// Loop over particles in event. Find last Z0 copy. Fill its pT.</span>
    <span class="kt">int</span> <span class="n">iZ</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">id</span><span class="p">()</span> <span class="o">==</span> <span class="mi">23</span><span class="p">)</span> <span class="n">iZ</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
    <span class="n">pTZ</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">iZ</span><span class="p">].</span><span class="n">pT</span><span class="p">()</span> <span class="p">);</span>
  <span class="c1">// End of event loop. Statistics. Histogram. Done.</span>
  <span class="p">}</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">pTZ</span><span class="p">;</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
    </div>
  </div>
</div>

</div> <div class="well well-sm"> <h1 id="main03cc">main03.cc</h1><hr>
<div class="codehilite"><pre><span class="c1">// main03.cc is a part of the PYTHIA event generator.</span>
<span class="c1">// Copyright (C) 2016 Torbjorn Sjostrand.</span>
<span class="c1">// PYTHIA is licenced under the GNU GPL version 2, see COPYING for details.</span>
<span class="c1">// Please respect the MCnet Guidelines, see GUIDELINES for details.</span>
<span class="c1">// This is a simple test program.</span>
<span class="c1">// It illustrates how different processes can be selected and studied.</span>
<span class="c1">// All input is specified in the main03.cmnd file.</span>
</pre></div>


<div class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" href="#fileid2">Rest of the main03.cc code</a>
    </h4>
  </div>
  <div id="fileid2" class="panel-collapse collapse">
    <div class="panel-body">
<div class="codehilite"><pre><span class="cp">#include</span> <span class="cpf">&quot;Pythia8/Pythia.h&quot;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">Pythia8</span><span class="p">;</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Generator.</span>
  <span class="n">Pythia</span> <span class="n">pythia</span><span class="p">;</span>
  <span class="c1">// Shorthand for the event record in pythia.</span>
  <span class="n">Event</span><span class="o">&amp;</span> <span class="n">event</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">;</span>
  <span class="c1">// Read in commands from external file.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readFile</span><span class="p">(</span><span class="s">&quot;main03.cmnd&quot;</span><span class="p">);</span>
  <span class="c1">// Extract settings to be used in the main program.</span>
  <span class="kt">int</span> <span class="n">nEvent</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Main:numberOfEvents&quot;</span><span class="p">);</span>
  <span class="kt">int</span> <span class="n">nAbort</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Main:timesAllowErrors&quot;</span><span class="p">);</span>
  <span class="c1">// Initialize.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
  <span class="c1">// Book histograms.</span>
  <span class="n">Hist</span> <span class="n">pThard</span><span class="p">(</span><span class="s">&quot;process pT scale&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">500.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">nFinal</span><span class="p">(</span><span class="s">&quot;final particle multiplicity&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1599.5</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">nCharged</span><span class="p">(</span><span class="s">&quot;charged particle multiplicity&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">799.5</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">dndy</span><span class="p">(</span><span class="s">&quot;dn/dy for charged particles&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.</span><span class="p">,</span> <span class="mf">10.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">dndeta</span><span class="p">(</span><span class="s">&quot;dn/d(eta) for charged particles&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.</span><span class="p">,</span> <span class="mf">10.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">dndpT</span><span class="p">(</span><span class="s">&quot;dn/dpT for charged particles&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">10.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">epCons</span><span class="p">(</span><span class="s">&quot;deviation from energy-momentum conservation&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1e-6</span><span class="p">);</span>
  <span class="c1">// Begin event loop.</span>
  <span class="kt">int</span> <span class="n">iAbort</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iEvent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iEvent</span> <span class="o">&lt;</span> <span class="n">nEvent</span><span class="p">;</span> <span class="o">++</span><span class="n">iEvent</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Generate events. Quit if many failures.</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">())</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">++</span><span class="n">iAbort</span> <span class="o">&lt;</span> <span class="n">nAbort</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; Event generation aborted prematurely, owing to error!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// Fill hard scale of event.</span>
    <span class="n">pThard</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">pTHat</span><span class="p">()</span> <span class="p">);</span>
    <span class="c1">// Loop over final particles in the event.</span>
    <span class="kt">int</span>  <span class="n">nFin</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span>  <span class="n">nChg</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">Vec4</span> <span class="n">pSum</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">event</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">isFinal</span><span class="p">())</span> <span class="p">{</span>
       <span class="c1">// Analyze all particles.</span>
      <span class="n">nFin</span><span class="o">++</span><span class="p">;</span>
      <span class="n">pSum</span> <span class="o">+=</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">p</span><span class="p">();</span>
      <span class="c1">// Analyze charged particles and fill histograms.</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">isCharged</span><span class="p">())</span> <span class="p">{</span>
        <span class="o">++</span><span class="n">nChg</span><span class="p">;</span>
        <span class="n">dndy</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">y</span><span class="p">()</span> <span class="p">);</span>
        <span class="n">dndeta</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">eta</span><span class="p">()</span> <span class="p">);</span>
        <span class="n">dndpT</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pT</span><span class="p">()</span> <span class="p">);</span>
      <span class="p">}</span>
    <span class="c1">// End of particle loop. Fill global properties.</span>
    <span class="p">}</span>
    <span class="n">nFinal</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">nFin</span> <span class="p">);</span>
    <span class="n">nCharged</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">nChg</span> <span class="p">);</span>
    <span class="n">pSum</span> <span class="o">/=</span> <span class="n">event</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">e</span><span class="p">();</span>
    <span class="kt">double</span> <span class="n">epDev</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">pSum</span><span class="p">.</span><span class="n">e</span><span class="p">()</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">+</span> <span class="n">abs</span><span class="p">(</span><span class="n">pSum</span><span class="p">.</span><span class="n">px</span><span class="p">())</span> <span class="o">+</span> <span class="n">abs</span><span class="p">(</span><span class="n">pSum</span><span class="p">.</span><span class="n">py</span><span class="p">())</span>
      <span class="o">+</span> <span class="n">abs</span><span class="p">(</span><span class="n">pSum</span><span class="p">.</span><span class="n">pz</span><span class="p">());</span>
    <span class="n">epCons</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span><span class="n">epDev</span><span class="p">);</span>
  <span class="c1">// End of event loop.</span>
  <span class="p">}</span>
  <span class="c1">// Final statistics. Normalize and output histograms.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
  <span class="n">dndy</span>   <span class="o">*=</span>  <span class="mf">5.</span> <span class="o">/</span> <span class="n">nEvent</span><span class="p">;</span>
  <span class="n">dndeta</span> <span class="o">*=</span>  <span class="mf">5.</span> <span class="o">/</span> <span class="n">nEvent</span><span class="p">;</span>
  <span class="n">dndpT</span>  <span class="o">*=</span> <span class="mf">10.</span> <span class="o">/</span> <span class="n">nEvent</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">pThard</span> <span class="o">&lt;&lt;</span> <span class="n">nFinal</span> <span class="o">&lt;&lt;</span> <span class="n">nCharged</span> <span class="o">&lt;&lt;</span> <span class="n">dndy</span> <span class="o">&lt;&lt;</span> <span class="n">dndeta</span> <span class="o">&lt;&lt;</span> <span class="n">dndpT</span> <span class="o">&lt;&lt;</span> <span class="n">epCons</span><span class="p">;</span>
  <span class="c1">// Done.</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
    </div>
  </div>
</div>

</div> <div class="well well-sm"> <h1 id="main04cc">main04.cc</h1><hr>
<div class="codehilite"><pre><span class="c1">// main04.cc is a part of the PYTHIA event generator.</span>
<span class="c1">// Copyright (C) 2016 Torbjorn Sjostrand.</span>
<span class="c1">// PYTHIA is licenced under the GNU GPL version 2, see COPYING for details.</span>
<span class="c1">// Please respect the MCnet Guidelines, see GUIDELINES for details.</span>
<span class="c1">// This is a simple test program.</span>
<span class="c1">// It illustrates how to generate and study &quot;total cross section&quot; processes,</span>
<span class="c1">// i.e. elastic, single and double diffractive, and the &quot;minimum-bias&quot; rest.</span>
<span class="c1">// All input is specified in the main06.cmnd file.</span>
<span class="c1">// Note that the &quot;total&quot; cross section does NOT include</span>
<span class="c1">// the Coulomb contribution to elastic scattering, as switched on here.</span>
</pre></div>


<div class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" href="#fileid3">Rest of the main04.cc code</a>
    </h4>
  </div>
  <div id="fileid3" class="panel-collapse collapse">
    <div class="panel-body">
<div class="codehilite"><pre><span class="cp">#include</span> <span class="cpf">&quot;Pythia8/Pythia.h&quot;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">Pythia8</span><span class="p">;</span>
<span class="c1">//==========================================================================</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Generator. Shorthand for the event.</span>
  <span class="n">Pythia</span> <span class="n">pythia</span><span class="p">;</span>
  <span class="n">Event</span><span class="o">&amp;</span> <span class="n">event</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">;</span>
  <span class="c1">// Read in commands from external file.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readFile</span><span class="p">(</span><span class="s">&quot;main04.cmnd&quot;</span><span class="p">);</span>
  <span class="c1">// Extract settings to be used in the main program.</span>
  <span class="kt">int</span>    <span class="n">nEvent</span>    <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Main:numberOfEvents&quot;</span><span class="p">);</span>
  <span class="kt">int</span>    <span class="n">nAbort</span>    <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Main:timesAllowErrors&quot;</span><span class="p">);</span>
  <span class="c1">// Initialize.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
  <span class="c1">// Book histograms: multiplicities and mean transverse momenta.</span>
  <span class="n">Hist</span> <span class="n">yChg</span><span class="p">(</span><span class="s">&quot;rapidity of charged particles; all&quot;</span><span class="p">,</span>      <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.</span><span class="p">,</span> <span class="mf">10.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">nChg</span><span class="p">(</span><span class="s">&quot;number of charged particles; all&quot;</span><span class="p">,</span>        <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">799.5</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">nChgSD</span><span class="p">(</span><span class="s">&quot;number of charged particles; single diffraction&quot;</span><span class="p">,</span>
                                                       <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">799.5</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">nChgDD</span><span class="p">(</span><span class="s">&quot;number of charged particles, double diffractive&quot;</span><span class="p">,</span>
                                                       <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">799.5</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">nChgCD</span><span class="p">(</span><span class="s">&quot;number of charged particles, central diffractive&quot;</span><span class="p">,</span>
                                                       <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">799.5</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">nChgND</span><span class="p">(</span><span class="s">&quot;number of charged particles, non-diffractive&quot;</span><span class="p">,</span>
                                                       <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">799.5</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">pTnChg</span><span class="p">(</span><span class="s">&quot;&lt;pt&gt;(n_charged) all&quot;</span><span class="p">,</span>                   <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">799.5</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">pTnChgSD</span><span class="p">(</span><span class="s">&quot;&lt;pt&gt;(n_charged) single diffraction&quot;</span><span class="p">,</span>  <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">799.5</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">pTnChgDD</span><span class="p">(</span><span class="s">&quot;&lt;pt&gt;(n_charged) double diffraction&quot;</span><span class="p">,</span>  <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">799.5</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">pTnChgCD</span><span class="p">(</span><span class="s">&quot;&lt;pt&gt;(n_charged) central diffraction&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">799.5</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">pTnChgND</span><span class="p">(</span><span class="s">&quot;&lt;pt&gt;(n_charged) non-diffractive   &quot;</span><span class="p">,</span>  <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">799.5</span><span class="p">);</span>
  <span class="c1">// Book histograms: ditto as function of separate subsystem mass.</span>
  <span class="n">Hist</span> <span class="n">mLogInel</span><span class="p">(</span><span class="s">&quot;log10(mass), by diffractive system&quot;</span><span class="p">,</span>  <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">5.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">nChgmLog</span><span class="p">(</span><span class="s">&quot;&lt;n_charged&gt;(log10(mass))&quot;</span><span class="p">,</span>            <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">5.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">pTmLog</span><span class="p">(</span><span class="s">&quot;&lt;pT&gt;_charged&gt;(log10(mass))&quot;</span><span class="p">,</span>            <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">5.</span><span class="p">);</span>
  <span class="c1">// Book histograms: elastic/diffractive.</span>
  <span class="n">Hist</span> <span class="n">tSpecEl</span><span class="p">(</span><span class="s">&quot;elastic |t| spectrum&quot;</span><span class="p">,</span>              <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">tSpecElLog</span><span class="p">(</span><span class="s">&quot;elastic log10(|t|) spectrum&quot;</span><span class="p">,</span>    <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">tSpecSD</span><span class="p">(</span><span class="s">&quot;single diffractive |t| spectrum&quot;</span><span class="p">,</span>   <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">tSpecDD</span><span class="p">(</span><span class="s">&quot;double diffractive |t| spectrum&quot;</span><span class="p">,</span>   <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">5.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">tSpecCD</span><span class="p">(</span><span class="s">&quot;central diffractive |t| spectrum&quot;</span><span class="p">,</span>  <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">5.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">mSpec</span><span class="p">(</span><span class="s">&quot;diffractive mass spectrum&quot;</span><span class="p">,</span>           <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">100.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">mLogSpec</span><span class="p">(</span><span class="s">&quot;log10(diffractive mass spectrum)&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">);</span>
  <span class="c1">// Book histograms: inelastic nondiffractive.</span>
  <span class="kt">double</span> <span class="n">pTmax</span> <span class="o">=</span> <span class="mf">20.</span><span class="p">;</span>
  <span class="kt">double</span> <span class="n">bMax</span>  <span class="o">=</span> <span class="mf">4.</span><span class="p">;</span>
  <span class="n">Hist</span> <span class="n">pTspec</span><span class="p">(</span><span class="s">&quot;total pT_hard spectrum&quot;</span><span class="p">,</span>             <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">pTmax</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">pTspecND</span><span class="p">(</span><span class="s">&quot;nondiffractive pT_hard spectrum&quot;</span><span class="p">,</span>  <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">pTmax</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">bSpec</span><span class="p">(</span><span class="s">&quot;b impact parameter spectrum&quot;</span><span class="p">,</span>         <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">bMax</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">enhanceSpec</span><span class="p">(</span><span class="s">&quot;b enhancement spectrum&quot;</span><span class="p">,</span>        <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">10.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">number</span><span class="p">(</span><span class="s">&quot;number of interactions&quot;</span><span class="p">,</span>             <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">99.5</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">pTb1</span><span class="p">(</span><span class="s">&quot;pT spectrum for b &lt; 0.5&quot;</span><span class="p">,</span>              <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">pTmax</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">pTb2</span><span class="p">(</span><span class="s">&quot;pT spectrum for 0.5 &lt; b &lt; 1&quot;</span><span class="p">,</span>          <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">pTmax</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">pTb3</span><span class="p">(</span><span class="s">&quot;pT spectrum for 1 &lt; b &lt; 1.5&quot;</span><span class="p">,</span>          <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">pTmax</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">pTb4</span><span class="p">(</span><span class="s">&quot;pT spectrum for 1.5 &lt; b&quot;</span><span class="p">,</span>              <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">pTmax</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">bpT1</span><span class="p">(</span><span class="s">&quot;b spectrum for pT &lt; 2&quot;</span><span class="p">,</span>                <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">bMax</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">bpT2</span><span class="p">(</span><span class="s">&quot;b spectrum for 2 &lt; pT &lt; 5&quot;</span><span class="p">,</span>            <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">bMax</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">bpT3</span><span class="p">(</span><span class="s">&quot;b spectrum for 5 &lt; pT &lt; 15&quot;</span><span class="p">,</span>           <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">bMax</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">bpT4</span><span class="p">(</span><span class="s">&quot;b spectrum for 15 &lt; pT&quot;</span><span class="p">,</span>               <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">bMax</span><span class="p">);</span>
  <span class="c1">// Begin event loop.</span>
  <span class="kt">int</span> <span class="n">iAbort</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iEvent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iEvent</span> <span class="o">&lt;</span> <span class="n">nEvent</span><span class="p">;</span> <span class="o">++</span><span class="n">iEvent</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Generate events. Quit if too many failures.</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">())</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">++</span><span class="n">iAbort</span> <span class="o">&lt;</span> <span class="n">nAbort</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; Event generation aborted prematurely, owing to error!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// Extract event classification.</span>
    <span class="kt">int</span> <span class="n">code</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">code</span><span class="p">();</span>
    <span class="c1">// Charged multiplicity and mean pT: all and by event class.</span>
    <span class="kt">int</span> <span class="n">nch</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">pTsum</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">event</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">isFinal</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">isCharged</span><span class="p">())</span> <span class="p">{</span>
      <span class="n">yChg</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">y</span><span class="p">()</span> <span class="p">);</span>
      <span class="o">++</span><span class="n">nch</span><span class="p">;</span>
      <span class="n">pTsum</span> <span class="o">+=</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pT</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="n">nChg</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">nch</span> <span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">nch</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="n">pTnChg</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">nch</span><span class="p">,</span> <span class="n">pTsum</span><span class="o">/</span><span class="n">nch</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">code</span> <span class="o">==</span> <span class="mi">103</span> <span class="o">||</span> <span class="n">code</span> <span class="o">==</span> <span class="mi">104</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">nChgSD</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">nch</span> <span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">nch</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="n">pTnChgSD</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">nch</span><span class="p">,</span> <span class="n">pTsum</span><span class="o">/</span><span class="n">nch</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">code</span> <span class="o">==</span> <span class="mi">105</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">nChgDD</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">nch</span> <span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">nch</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="n">pTnChgDD</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">nch</span><span class="p">,</span> <span class="n">pTsum</span><span class="o">/</span><span class="n">nch</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">code</span> <span class="o">==</span> <span class="mi">106</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">nChgCD</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">nch</span> <span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">nch</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="n">pTnChgCD</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">nch</span><span class="p">,</span> <span class="n">pTsum</span><span class="o">/</span><span class="n">nch</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">code</span> <span class="o">==</span> <span class="mi">101</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">nChgND</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">nch</span> <span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">nch</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="n">pTnChgND</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">nch</span><span class="p">,</span> <span class="n">pTsum</span><span class="o">/</span><span class="n">nch</span><span class="p">);</span>
      <span class="kt">double</span> <span class="n">mLog</span> <span class="o">=</span> <span class="n">log10</span><span class="p">(</span> <span class="n">event</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">m</span><span class="p">()</span> <span class="p">);</span>
      <span class="n">mLogInel</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">mLog</span> <span class="p">);</span>
      <span class="n">nChgmLog</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">mLog</span><span class="p">,</span> <span class="n">nch</span> <span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">nch</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="n">pTmLog</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">mLog</span><span class="p">,</span> <span class="n">pTsum</span> <span class="o">/</span> <span class="n">nch</span> <span class="p">);</span>
    <span class="p">}</span>
    <span class="c1">// Charged multiplicity and mean pT: per diffractive system.</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iDiff</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iDiff</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="o">++</span><span class="n">iDiff</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="n">iDiff</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">isDiffractiveA</span><span class="p">())</span>
      <span class="o">||</span> <span class="p">(</span><span class="n">iDiff</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">isDiffractiveB</span><span class="p">())</span>
      <span class="o">||</span> <span class="p">(</span><span class="n">iDiff</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">&amp;&amp;</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">isDiffractiveC</span><span class="p">())</span> <span class="p">)</span> <span class="p">{</span>
      <span class="kt">int</span> <span class="n">ndiff</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="kt">double</span> <span class="n">pTdiff</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">;</span>
      <span class="kt">int</span> <span class="n">nDoc</span> <span class="o">=</span> <span class="p">(</span><span class="n">iDiff</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">?</span> <span class="mi">4</span> <span class="o">:</span> <span class="mi">5</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">nDoc</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">event</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">isFinal</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">isCharged</span><span class="p">())</span> <span class="p">{</span>
        <span class="c1">// Trace back final particle to see which system it comes from.</span>
        <span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
        <span class="k">do</span> <span class="n">k</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">mother1</span><span class="p">();</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">k</span> <span class="o">&gt;</span> <span class="n">nDoc</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">==</span> <span class="n">iDiff</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
          <span class="o">++</span><span class="n">ndiff</span><span class="p">;</span>
          <span class="n">pTdiff</span> <span class="o">+=</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pT</span><span class="p">();</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="c1">// Study diffractive mass spectrum.</span>
      <span class="kt">double</span> <span class="n">mDiff</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="n">iDiff</span><span class="o">+</span><span class="mi">3</span><span class="p">].</span><span class="n">m</span><span class="p">();</span>
      <span class="kt">double</span> <span class="n">mLog</span>  <span class="o">=</span> <span class="n">log10</span><span class="p">(</span> <span class="n">mDiff</span><span class="p">);</span>
      <span class="n">mLogInel</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">mLog</span> <span class="p">);</span>
      <span class="n">nChgmLog</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">mLog</span><span class="p">,</span> <span class="n">ndiff</span> <span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">ndiff</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="n">pTmLog</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">mLog</span><span class="p">,</span> <span class="n">pTdiff</span> <span class="o">/</span> <span class="n">ndiff</span> <span class="p">);</span>
      <span class="n">mSpec</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">mDiff</span> <span class="p">);</span>
      <span class="n">mLogSpec</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">mLog</span> <span class="p">);</span>
    <span class="p">}</span>
    <span class="c1">// Study pT spectrum of all hard collisions, no distinction.</span>
    <span class="kt">double</span> <span class="n">pT</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">pTHat</span><span class="p">();</span>
    <span class="n">pTspec</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">pT</span> <span class="p">);</span>
    <span class="c1">// Study t distribution of elastic/diffractive events.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">code</span> <span class="o">&gt;</span> <span class="mi">101</span><span class="p">)</span> <span class="p">{</span>
      <span class="kt">double</span> <span class="n">tAbs</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">tHat</span><span class="p">());</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">code</span> <span class="o">==</span> <span class="mi">102</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">tSpecEl</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span><span class="n">tAbs</span><span class="p">);</span>
        <span class="n">tSpecElLog</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span><span class="n">log10</span><span class="p">(</span><span class="n">tAbs</span><span class="p">));</span>
      <span class="p">}</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">code</span> <span class="o">==</span> <span class="mi">103</span> <span class="o">||</span> <span class="n">code</span> <span class="o">==</span> <span class="mi">104</span><span class="p">)</span> <span class="n">tSpecSD</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span><span class="n">tAbs</span><span class="p">);</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">code</span> <span class="o">==</span> <span class="mi">105</span><span class="p">)</span> <span class="n">tSpecDD</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span><span class="n">tAbs</span><span class="p">);</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">code</span> <span class="o">==</span> <span class="mi">106</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">double</span> <span class="n">t1Abs</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span> <span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">p</span><span class="p">()</span> <span class="o">-</span> <span class="n">event</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">p</span><span class="p">()).</span><span class="n">m2Calc</span><span class="p">()</span> <span class="p">);</span>
        <span class="kt">double</span> <span class="n">t2Abs</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span> <span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="mi">4</span><span class="p">].</span><span class="n">p</span><span class="p">()</span> <span class="o">-</span> <span class="n">event</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">p</span><span class="p">()).</span><span class="n">m2Calc</span><span class="p">()</span> <span class="p">);</span>
        <span class="n">tSpecCD</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span><span class="n">t1Abs</span><span class="p">);</span>
        <span class="n">tSpecCD</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span><span class="n">t2Abs</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="c1">// Study nondiffractive inelastic events in (pT, b) space.</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="kt">double</span> <span class="n">b</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">bMPI</span><span class="p">();</span>
      <span class="kt">double</span> <span class="n">enhance</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">enhanceMPI</span><span class="p">();</span>
      <span class="kt">int</span> <span class="n">nMPI</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">nMPI</span><span class="p">();</span>
      <span class="n">pTspecND</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">pT</span> <span class="p">);</span>
      <span class="n">bSpec</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">b</span> <span class="p">);</span>
      <span class="n">enhanceSpec</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">enhance</span> <span class="p">);</span>
      <span class="n">number</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">nMPI</span> <span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">b</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">)</span> <span class="n">pTb1</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">pT</span> <span class="p">);</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">b</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">)</span> <span class="n">pTb2</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">pT</span> <span class="p">);</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">b</span> <span class="o">&lt;</span> <span class="mf">1.5</span><span class="p">)</span> <span class="n">pTb3</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">pT</span> <span class="p">);</span>
      <span class="k">else</span> <span class="n">pTb4</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">pT</span> <span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">pT</span> <span class="o">&lt;</span> <span class="mf">2.</span><span class="p">)</span> <span class="n">bpT1</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">b</span> <span class="p">);</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">pT</span> <span class="o">&lt;</span> <span class="mf">5.</span><span class="p">)</span> <span class="n">bpT2</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">b</span> <span class="p">);</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">pT</span> <span class="o">&lt;</span> <span class="mf">15.</span><span class="p">)</span> <span class="n">bpT3</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">b</span> <span class="p">);</span>
      <span class="k">else</span> <span class="n">bpT4</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">b</span> <span class="p">);</span>
    <span class="p">}</span>
  <span class="c1">// End of event loop.</span>
  <span class="p">}</span>
  <span class="c1">// Final statistics and histograms.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
  <span class="n">pTnChg</span>   <span class="o">/=</span> <span class="n">nChg</span><span class="p">;</span>
  <span class="n">pTnChgSD</span> <span class="o">/=</span> <span class="n">nChgSD</span><span class="p">;</span>
  <span class="n">pTnChgDD</span> <span class="o">/=</span> <span class="n">nChgDD</span><span class="p">;</span>
  <span class="n">pTnChgCD</span> <span class="o">/=</span> <span class="n">nChgCD</span><span class="p">;</span>
  <span class="n">pTnChgND</span> <span class="o">/=</span> <span class="n">nChgND</span><span class="p">;</span>
  <span class="n">nChgmLog</span> <span class="o">/=</span> <span class="n">mLogInel</span><span class="p">;</span>
  <span class="n">pTmLog</span>   <span class="o">/=</span> <span class="n">mLogInel</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">yChg</span> <span class="o">&lt;&lt;</span> <span class="n">nChg</span> <span class="o">&lt;&lt;</span> <span class="n">nChgSD</span> <span class="o">&lt;&lt;</span> <span class="n">nChgDD</span> <span class="o">&lt;&lt;</span> <span class="n">nChgCD</span> <span class="o">&lt;&lt;</span> <span class="n">nChgND</span>
       <span class="o">&lt;&lt;</span> <span class="n">pTnChg</span> <span class="o">&lt;&lt;</span> <span class="n">pTnChgSD</span> <span class="o">&lt;&lt;</span> <span class="n">pTnChgDD</span> <span class="o">&lt;&lt;</span> <span class="n">pTnChgCD</span> <span class="o">&lt;&lt;</span> <span class="n">pTnChgND</span>
       <span class="o">&lt;&lt;</span> <span class="n">mLogInel</span> <span class="o">&lt;&lt;</span> <span class="n">nChgmLog</span> <span class="o">&lt;&lt;</span> <span class="n">pTmLog</span>
       <span class="o">&lt;&lt;</span> <span class="n">tSpecEl</span> <span class="o">&lt;&lt;</span> <span class="n">tSpecElLog</span> <span class="o">&lt;&lt;</span> <span class="n">tSpecSD</span> <span class="o">&lt;&lt;</span> <span class="n">tSpecDD</span> <span class="o">&lt;&lt;</span> <span class="n">tSpecCD</span>
       <span class="o">&lt;&lt;</span> <span class="n">mSpec</span> <span class="o">&lt;&lt;</span> <span class="n">mLogSpec</span>
       <span class="o">&lt;&lt;</span> <span class="n">pTspec</span> <span class="o">&lt;&lt;</span> <span class="n">pTspecND</span> <span class="o">&lt;&lt;</span> <span class="n">bSpec</span> <span class="o">&lt;&lt;</span> <span class="n">enhanceSpec</span> <span class="o">&lt;&lt;</span> <span class="n">number</span>
       <span class="o">&lt;&lt;</span> <span class="n">pTb1</span> <span class="o">&lt;&lt;</span> <span class="n">pTb2</span> <span class="o">&lt;&lt;</span> <span class="n">pTb3</span> <span class="o">&lt;&lt;</span> <span class="n">pTb4</span> <span class="o">&lt;&lt;</span> <span class="n">bpT1</span> <span class="o">&lt;&lt;</span> <span class="n">bpT2</span> <span class="o">&lt;&lt;</span> <span class="n">bpT3</span> <span class="o">&lt;&lt;</span> <span class="n">bpT4</span><span class="p">;</span>
  <span class="c1">// Done.</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
    </div>
  </div>
</div>

</div> <div class="well well-sm"> <h1 id="main05cc">main05.cc</h1><hr>
<div class="codehilite"><pre><span class="c1">// main05.cc is a part of the PYTHIA event generator.</span>
<span class="c1">// Copyright (C) 2016 Torbjorn Sjostrand.</span>
<span class="c1">// PYTHIA is licenced under the GNU GPL version 2, see COPYING for details.</span>
<span class="c1">// Please respect the MCnet Guidelines, see GUIDELINES for details.</span>
<span class="c1">// This is a simple test program.</span>
<span class="c1">// It studies jet production at the LHC, using SlowJet and CellJet.</span>
<span class="c1">// Note: the two finders are intended to construct approximately the same</span>
<span class="c1">// jet properties, but provides output in slightly different format,</span>
<span class="c1">// and have here not been optimized to show maximum possible agreement.</span>
</pre></div>


<div class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" href="#fileid4">Rest of the main05.cc code</a>
    </h4>
  </div>
  <div id="fileid4" class="panel-collapse collapse">
    <div class="panel-body">
<div class="codehilite"><pre><span class="cp">#include</span> <span class="cpf">&quot;Pythia8/Pythia.h&quot;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">Pythia8</span><span class="p">;</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Number of events, generated and listed ones.</span>
  <span class="kt">int</span> <span class="n">nEvent</span>    <span class="o">=</span> <span class="mi">500</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">nListJets</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
  <span class="c1">// Generator. LHC process and output selection. Initialization.</span>
  <span class="n">Pythia</span> <span class="n">pythia</span><span class="p">;</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Beams:eCM = 14000.&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;HardQCD:all = on&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;PhaseSpace:pTHatMin = 200.&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Next:numberShowInfo = 0&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Next:numberShowProcess = 0&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Next:numberShowEvent = 0&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
  <span class="c1">// Common parameters for the two jet finders.</span>
  <span class="kt">double</span> <span class="n">etaMax</span>   <span class="o">=</span> <span class="mf">4.</span><span class="p">;</span>
  <span class="kt">double</span> <span class="n">radius</span>   <span class="o">=</span> <span class="mf">0.7</span><span class="p">;</span>
  <span class="kt">double</span> <span class="n">pTjetMin</span> <span class="o">=</span> <span class="mf">10.</span><span class="p">;</span>
  <span class="c1">// Exclude neutrinos (and other invisible) from study.</span>
  <span class="kt">int</span>    <span class="n">nSel</span>     <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="c1">// Range and granularity of CellJet jet finder.</span>
  <span class="kt">int</span>    <span class="n">nEta</span>     <span class="o">=</span> <span class="mi">80</span><span class="p">;</span>
  <span class="kt">int</span>    <span class="n">nPhi</span>     <span class="o">=</span> <span class="mi">64</span><span class="p">;</span>
  <span class="c1">// Set up SlowJet jet finder, with anti-kT clustering</span>
  <span class="c1">// and pion mass assumed for non-photons..</span>
  <span class="n">SlowJet</span> <span class="n">slowJet</span><span class="p">(</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">pTjetMin</span><span class="p">,</span> <span class="n">etaMax</span><span class="p">,</span> <span class="n">nSel</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
  <span class="c1">// Set up CellJet jet finder.</span>
  <span class="n">CellJet</span> <span class="n">cellJet</span><span class="p">(</span> <span class="n">etaMax</span><span class="p">,</span> <span class="n">nEta</span><span class="p">,</span> <span class="n">nPhi</span><span class="p">,</span> <span class="n">nSel</span><span class="p">);</span>
  <span class="c1">// Histograms. Note similarity in names, even when the two jet finders</span>
  <span class="c1">// do not calculate identically the same property (pT vs. ET, y vs. eta).</span>
  <span class="n">Hist</span> <span class="n">nJetsS</span><span class="p">(</span><span class="s">&quot;number of jets, SlowJet&quot;</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">49.5</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">nJetsC</span><span class="p">(</span><span class="s">&quot;number of jets, CellJet&quot;</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">49.5</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">nJetsD</span><span class="p">(</span><span class="s">&quot;number of jets, CellJet - SlowJet&quot;</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="o">-</span><span class="mf">22.5</span><span class="p">,</span> <span class="mf">22.5</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">eTjetsS</span><span class="p">(</span><span class="s">&quot;pT for jets, SlowJet&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">500.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">eTjetsC</span><span class="p">(</span><span class="s">&quot;eT for jets, CellJet&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">500.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">etaJetsS</span><span class="p">(</span><span class="s">&quot;y for jets, SlowJet&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.</span><span class="p">,</span> <span class="mf">5.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">etaJetsC</span><span class="p">(</span><span class="s">&quot;eta for jets, CellJet&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.</span><span class="p">,</span> <span class="mf">5.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">phiJetsS</span><span class="p">(</span><span class="s">&quot;phi for jets, SlowJwt&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="n">M_PI</span><span class="p">,</span> <span class="n">M_PI</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">phiJetsC</span><span class="p">(</span><span class="s">&quot;phi for jets, CellJet&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="n">M_PI</span><span class="p">,</span> <span class="n">M_PI</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">distJetsS</span><span class="p">(</span><span class="s">&quot;R distance between jets, SlowJet&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">10.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">distJetsC</span><span class="p">(</span><span class="s">&quot;R distance between jets, CellJet&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">10.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">eTdiffS</span><span class="p">(</span><span class="s">&quot;pT difference, SlowJet&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">100.</span><span class="p">,</span> <span class="mf">400.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">eTdiffC</span><span class="p">(</span><span class="s">&quot;eT difference, CellJet&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">100.</span><span class="p">,</span> <span class="mf">400.</span><span class="p">);</span>
  <span class="c1">// Begin event loop. Generate event. Skip if error.</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iEvent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iEvent</span> <span class="o">&lt;</span> <span class="n">nEvent</span><span class="p">;</span> <span class="o">++</span><span class="n">iEvent</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">())</span> <span class="k">continue</span><span class="p">;</span>
    <span class="c1">// Analyze Slowet jet properties. List first few.</span>
    <span class="n">slowJet</span><span class="p">.</span> <span class="n">analyze</span><span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span> <span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">iEvent</span> <span class="o">&lt;</span> <span class="n">nListJets</span><span class="p">)</span> <span class="n">slowJet</span><span class="p">.</span><span class="n">list</span><span class="p">();</span>
    <span class="c1">// Fill SlowJet inclusive jet distributions.</span>
    <span class="n">nJetsS</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">slowJet</span><span class="p">.</span><span class="n">sizeJet</span><span class="p">()</span> <span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">slowJet</span><span class="p">.</span><span class="n">sizeJet</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">eTjetsS</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">slowJet</span><span class="p">.</span><span class="n">pT</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">);</span>
      <span class="n">etaJetsS</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">slowJet</span><span class="p">.</span><span class="n">y</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">);</span>
      <span class="n">phiJetsS</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">slowJet</span><span class="p">.</span><span class="n">phi</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">);</span>
    <span class="p">}</span>
    <span class="c1">// Fill SlowJet distance between jets.</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">slowJet</span><span class="p">.</span><span class="n">sizeJet</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span><span class="mi">1</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">slowJet</span><span class="p">.</span><span class="n">sizeJet</span><span class="p">();</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
      <span class="kt">double</span> <span class="n">dEta</span> <span class="o">=</span> <span class="n">slowJet</span><span class="p">.</span><span class="n">y</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">-</span> <span class="n">slowJet</span><span class="p">.</span><span class="n">y</span><span class="p">(</span><span class="n">j</span><span class="p">);</span>
      <span class="kt">double</span> <span class="n">dPhi</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span> <span class="n">slowJet</span><span class="p">.</span><span class="n">phi</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">-</span> <span class="n">slowJet</span><span class="p">.</span><span class="n">phi</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">dPhi</span> <span class="o">&gt;</span> <span class="n">M_PI</span><span class="p">)</span> <span class="n">dPhi</span> <span class="o">=</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">M_PI</span> <span class="o">-</span> <span class="n">dPhi</span><span class="p">;</span>
      <span class="kt">double</span> <span class="n">dR</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span> <span class="n">pow2</span><span class="p">(</span><span class="n">dEta</span><span class="p">)</span> <span class="o">+</span> <span class="n">pow2</span><span class="p">(</span><span class="n">dPhi</span><span class="p">)</span> <span class="p">);</span>
      <span class="n">distJetsS</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">dR</span> <span class="p">);</span>
    <span class="p">}</span>
    <span class="c1">// Fill SlowJet pT-difference between jets (to check ordering of list).</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">slowJet</span><span class="p">.</span><span class="n">sizeJet</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
      <span class="n">eTdiffS</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">slowJet</span><span class="p">.</span><span class="n">pT</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">slowJet</span><span class="p">.</span><span class="n">pT</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">);</span>
    <span class="c1">// Analyze CellJet jet properties. List first few.</span>
    <span class="n">cellJet</span><span class="p">.</span> <span class="n">analyze</span><span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">,</span> <span class="n">pTjetMin</span><span class="p">,</span> <span class="n">radius</span> <span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">iEvent</span> <span class="o">&lt;</span> <span class="n">nListJets</span><span class="p">)</span> <span class="n">cellJet</span><span class="p">.</span><span class="n">list</span><span class="p">();</span>
    <span class="c1">// Fill CellJet inclusive jet distributions.</span>
    <span class="n">nJetsC</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">cellJet</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">cellJet</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">eTjetsC</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">cellJet</span><span class="p">.</span><span class="n">eT</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">);</span>
      <span class="n">etaJetsC</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">cellJet</span><span class="p">.</span><span class="n">etaWeighted</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">);</span>
      <span class="n">phiJetsC</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">cellJet</span><span class="p">.</span><span class="n">phiWeighted</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">);</span>
    <span class="p">}</span>
    <span class="c1">// Fill CellJet distance between jets.</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">cellJet</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span><span class="mi">1</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">cellJet</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
      <span class="kt">double</span> <span class="n">dEta</span> <span class="o">=</span> <span class="n">cellJet</span><span class="p">.</span><span class="n">etaWeighted</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="o">-</span> <span class="n">cellJet</span><span class="p">.</span><span class="n">etaWeighted</span><span class="p">(</span><span class="n">j</span><span class="p">);</span>
      <span class="kt">double</span> <span class="n">dPhi</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span> <span class="n">cellJet</span><span class="p">.</span><span class="n">phiWeighted</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="o">-</span> <span class="n">cellJet</span><span class="p">.</span><span class="n">phiWeighted</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">dPhi</span> <span class="o">&gt;</span> <span class="n">M_PI</span><span class="p">)</span> <span class="n">dPhi</span> <span class="o">=</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">M_PI</span> <span class="o">-</span> <span class="n">dPhi</span><span class="p">;</span>
      <span class="kt">double</span> <span class="n">dR</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span> <span class="n">pow2</span><span class="p">(</span><span class="n">dEta</span><span class="p">)</span> <span class="o">+</span> <span class="n">pow2</span><span class="p">(</span><span class="n">dPhi</span><span class="p">)</span> <span class="p">);</span>
      <span class="n">distJetsC</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">dR</span> <span class="p">);</span>
    <span class="p">}</span>
    <span class="c1">// Fill CellJet ET-difference between jets (to check ordering of list).</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">cellJet</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
      <span class="n">eTdiffC</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">cellJet</span><span class="p">.</span><span class="n">eT</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">cellJet</span><span class="p">.</span><span class="n">eT</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">);</span>
    <span class="c1">// Compare number of jets for the two finders.</span>
    <span class="n">nJetsD</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">cellJet</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="n">slowJet</span><span class="p">.</span><span class="n">sizeJet</span><span class="p">()</span> <span class="p">);</span>
  <span class="c1">// End of event loop. Statistics. Histograms.</span>
  <span class="p">}</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">nJetsS</span> <span class="o">&lt;&lt;</span> <span class="n">nJetsC</span> <span class="o">&lt;&lt;</span> <span class="n">nJetsD</span> <span class="o">&lt;&lt;</span> <span class="n">eTjetsS</span> <span class="o">&lt;&lt;</span> <span class="n">eTjetsC</span>
       <span class="o">&lt;&lt;</span> <span class="n">etaJetsS</span> <span class="o">&lt;&lt;</span> <span class="n">etaJetsC</span> <span class="o">&lt;&lt;</span> <span class="n">phiJetsS</span> <span class="o">&lt;&lt;</span> <span class="n">phiJetsC</span>
       <span class="o">&lt;&lt;</span> <span class="n">distJetsS</span> <span class="o">&lt;&lt;</span> <span class="n">distJetsC</span> <span class="o">&lt;&lt;</span> <span class="n">eTdiffS</span> <span class="o">&lt;&lt;</span> <span class="n">eTdiffC</span><span class="p">;</span>
  <span class="c1">// Done.</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
    </div>
  </div>
</div>

</div> <div class="well well-sm"> <h1 id="main06cc">main06.cc</h1><hr>
<div class="codehilite"><pre><span class="c1">// main06.cc is a part of the PYTHIA event generator.</span>
<span class="c1">// Copyright (C) 2016 Torbjorn Sjostrand.</span>
<span class="c1">// PYTHIA is licenced under the GNU GPL version 2, see COPYING for details.</span>
<span class="c1">// Please respect the MCnet Guidelines, see GUIDELINES for details.</span>
<span class="c1">// This is a simple test program.</span>
<span class="c1">// It studies event properties of LEP1 events.</span>
</pre></div>


<div class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" href="#fileid5">Rest of the main06.cc code</a>
    </h4>
  </div>
  <div id="fileid5" class="panel-collapse collapse">
    <div class="panel-body">
<div class="codehilite"><pre><span class="cp">#include</span> <span class="cpf">&quot;Pythia8/Pythia.h&quot;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">Pythia8</span><span class="p">;</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Generator.</span>
  <span class="n">Pythia</span> <span class="n">pythia</span><span class="p">;</span>
  <span class="c1">// Allow no substructure in e+- beams: normal for corrected LEP data.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;PDF:lepton = off&quot;</span><span class="p">);</span>
  <span class="c1">// Process selection.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;WeakSingleBoson:ffbar2gmZ = on&quot;</span><span class="p">);</span>
  <span class="c1">// Switch off all Z0 decays and then switch back on those to quarks.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;23:onMode = off&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;23:onIfAny = 1 2 3 4 5&quot;</span><span class="p">);</span>
  <span class="c1">// LEP1 initialization at Z0 mass.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Beams:idA =  11&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Beams:idB = -11&quot;</span><span class="p">);</span>
  <span class="kt">double</span> <span class="n">mZ</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">particleData</span><span class="p">.</span><span class="n">m0</span><span class="p">(</span><span class="mi">23</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">parm</span><span class="p">(</span><span class="s">&quot;Beams:eCM&quot;</span><span class="p">,</span> <span class="n">mZ</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
  <span class="c1">// Histograms.</span>
  <span class="n">Hist</span> <span class="n">nCharge</span><span class="p">(</span><span class="s">&quot;charged multiplicity&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">99.5</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">spheri</span><span class="p">(</span><span class="s">&quot;Sphericity&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">linea</span><span class="p">(</span><span class="s">&quot;Linearity&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">thrust</span><span class="p">(</span><span class="s">&quot;thrust&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">oblateness</span><span class="p">(</span><span class="s">&quot;oblateness&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">sAxis</span><span class="p">(</span><span class="s">&quot;cos(theta_Sphericity)&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">lAxis</span><span class="p">(</span><span class="s">&quot;cos(theta_Linearity)&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">tAxis</span><span class="p">(</span><span class="s">&quot;cos(theta_Thrust)&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">nLund</span><span class="p">(</span><span class="s">&quot;Lund jet multiplicity&quot;</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">39.5</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">nJade</span><span class="p">(</span><span class="s">&quot;Jade jet multiplicity&quot;</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">39.5</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">nDurham</span><span class="p">(</span><span class="s">&quot;Durham jet multiplicity&quot;</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">39.5</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">eDifLund</span><span class="p">(</span><span class="s">&quot;Lund e_i - e_{i+1}&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.</span><span class="p">,</span><span class="mf">45.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">eDifJade</span><span class="p">(</span><span class="s">&quot;Jade e_i - e_{i+1}&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.</span><span class="p">,</span><span class="mf">45.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">eDifDurham</span><span class="p">(</span><span class="s">&quot;Durham e_i - e_{i+1}&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.</span><span class="p">,</span><span class="mf">45.</span><span class="p">);</span>
  <span class="c1">// Set up Sphericity, &quot;Linearity&quot;, Thrust and cluster jet analyses.</span>
  <span class="n">Sphericity</span> <span class="n">sph</span><span class="p">;</span>
  <span class="n">Sphericity</span> <span class="n">lin</span><span class="p">(</span><span class="mf">1.</span><span class="p">);</span>
  <span class="n">Thrust</span> <span class="n">thr</span><span class="p">;</span>
  <span class="n">ClusterJet</span> <span class="n">lund</span><span class="p">(</span><span class="s">&quot;Lund&quot;</span><span class="p">);</span>
  <span class="n">ClusterJet</span> <span class="n">jade</span><span class="p">(</span><span class="s">&quot;Jade&quot;</span><span class="p">);</span>
  <span class="n">ClusterJet</span> <span class="n">durham</span><span class="p">(</span><span class="s">&quot;Durham&quot;</span><span class="p">);</span>
  <span class="c1">// Begin event loop. Generate event. Skip if error. List first few.</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iEvent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iEvent</span> <span class="o">&lt;</span> <span class="mi">10000</span><span class="p">;</span> <span class="o">++</span><span class="n">iEvent</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">())</span> <span class="k">continue</span><span class="p">;</span>
    <span class="c1">// Find and histogram charged multiplicity.</span>
    <span class="kt">int</span> <span class="n">nCh</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">isFinal</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">isCharged</span><span class="p">())</span> <span class="o">++</span><span class="n">nCh</span><span class="p">;</span>
    <span class="n">nCharge</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">nCh</span> <span class="p">);</span>
    <span class="c1">// Find and histogram sphericity.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">sph</span><span class="p">.</span><span class="n">analyze</span><span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span> <span class="p">))</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">iEvent</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="n">sph</span><span class="p">.</span><span class="n">list</span><span class="p">();</span>
      <span class="n">spheri</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">sph</span><span class="p">.</span><span class="n">sphericity</span><span class="p">()</span> <span class="p">);</span>
      <span class="n">sAxis</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">sph</span><span class="p">.</span><span class="n">eventAxis</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">pz</span><span class="p">()</span> <span class="p">);</span>
      <span class="kt">double</span> <span class="n">e1</span> <span class="o">=</span> <span class="n">sph</span><span class="p">.</span><span class="n">eigenValue</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
      <span class="kt">double</span> <span class="n">e2</span> <span class="o">=</span> <span class="n">sph</span><span class="p">.</span><span class="n">eigenValue</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
      <span class="kt">double</span> <span class="n">e3</span> <span class="o">=</span> <span class="n">sph</span><span class="p">.</span><span class="n">eigenValue</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">e2</span> <span class="o">&gt;</span> <span class="n">e1</span> <span class="o">||</span> <span class="n">e3</span> <span class="o">&gt;</span> <span class="n">e2</span><span class="p">)</span> <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;eigenvalues out of order: &quot;</span>
      <span class="o">&lt;&lt;</span> <span class="n">e1</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;  &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">e2</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;  &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">e3</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// Find and histogram linearized sphericity.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">lin</span><span class="p">.</span><span class="n">analyze</span><span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span> <span class="p">))</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">iEvent</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="n">lin</span><span class="p">.</span><span class="n">list</span><span class="p">();</span>
      <span class="n">linea</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">lin</span><span class="p">.</span><span class="n">sphericity</span><span class="p">()</span> <span class="p">);</span>
      <span class="n">lAxis</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">lin</span><span class="p">.</span><span class="n">eventAxis</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">pz</span><span class="p">()</span> <span class="p">);</span>
      <span class="kt">double</span> <span class="n">e1</span> <span class="o">=</span> <span class="n">lin</span><span class="p">.</span><span class="n">eigenValue</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
      <span class="kt">double</span> <span class="n">e2</span> <span class="o">=</span> <span class="n">lin</span><span class="p">.</span><span class="n">eigenValue</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
      <span class="kt">double</span> <span class="n">e3</span> <span class="o">=</span> <span class="n">lin</span><span class="p">.</span><span class="n">eigenValue</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">e2</span> <span class="o">&gt;</span> <span class="n">e1</span> <span class="o">||</span> <span class="n">e3</span> <span class="o">&gt;</span> <span class="n">e2</span><span class="p">)</span> <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;eigenvalues out of order: &quot;</span>
      <span class="o">&lt;&lt;</span> <span class="n">e1</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;  &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">e2</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;  &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">e3</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// Find and histogram thrust.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">thr</span><span class="p">.</span><span class="n">analyze</span><span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span> <span class="p">))</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">iEvent</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="n">thr</span><span class="p">.</span><span class="n">list</span><span class="p">();</span>
      <span class="n">thrust</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">thr</span><span class="p">.</span><span class="n">thrust</span><span class="p">()</span> <span class="p">);</span>
      <span class="n">oblateness</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">thr</span><span class="p">.</span><span class="n">oblateness</span><span class="p">()</span> <span class="p">);</span>
      <span class="n">tAxis</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">thr</span><span class="p">.</span><span class="n">eventAxis</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">pz</span><span class="p">()</span> <span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span> <span class="n">abs</span><span class="p">(</span><span class="n">thr</span><span class="p">.</span><span class="n">eventAxis</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">pAbs</span><span class="p">()</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1e-8</span>
        <span class="o">||</span> <span class="n">abs</span><span class="p">(</span><span class="n">thr</span><span class="p">.</span><span class="n">eventAxis</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">pAbs</span><span class="p">()</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1e-8</span>
        <span class="o">||</span> <span class="n">abs</span><span class="p">(</span><span class="n">thr</span><span class="p">.</span><span class="n">eventAxis</span><span class="p">(</span><span class="mi">3</span><span class="p">).</span><span class="n">pAbs</span><span class="p">()</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1e-8</span>
        <span class="o">||</span> <span class="n">abs</span><span class="p">(</span><span class="n">thr</span><span class="p">.</span><span class="n">eventAxis</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">thr</span><span class="p">.</span><span class="n">eventAxis</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mf">1e-8</span>
        <span class="o">||</span> <span class="n">abs</span><span class="p">(</span><span class="n">thr</span><span class="p">.</span><span class="n">eventAxis</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">thr</span><span class="p">.</span><span class="n">eventAxis</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mf">1e-8</span>
        <span class="o">||</span> <span class="n">abs</span><span class="p">(</span><span class="n">thr</span><span class="p">.</span><span class="n">eventAxis</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">thr</span><span class="p">.</span><span class="n">eventAxis</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mf">1e-8</span> <span class="p">)</span> <span class="p">{</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; suspicious Thrust eigenvectors &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
        <span class="n">thr</span><span class="p">.</span><span class="n">list</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="c1">// Find and histogram cluster jets: Lund, Jade and Durham distance.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">lund</span><span class="p">.</span><span class="n">analyze</span><span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">iEvent</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="n">lund</span><span class="p">.</span><span class="n">list</span><span class="p">();</span>
      <span class="n">nLund</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">lund</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="p">);</span>
      <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">lund</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span>
        <span class="n">eDifLund</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">lund</span><span class="p">.</span><span class="n">p</span><span class="p">(</span><span class="n">j</span><span class="p">).</span><span class="n">e</span><span class="p">()</span> <span class="o">-</span> <span class="n">lund</span><span class="p">.</span><span class="n">p</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">).</span><span class="n">e</span><span class="p">()</span> <span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">jade</span><span class="p">.</span><span class="n">analyze</span><span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">iEvent</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="n">jade</span><span class="p">.</span><span class="n">list</span><span class="p">();</span>
      <span class="n">nJade</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">jade</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="p">);</span>
      <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">jade</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span>
        <span class="n">eDifJade</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">jade</span><span class="p">.</span><span class="n">p</span><span class="p">(</span><span class="n">j</span><span class="p">).</span><span class="n">e</span><span class="p">()</span> <span class="o">-</span> <span class="n">jade</span><span class="p">.</span><span class="n">p</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">).</span><span class="n">e</span><span class="p">()</span> <span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">durham</span><span class="p">.</span><span class="n">analyze</span><span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">iEvent</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="n">durham</span><span class="p">.</span><span class="n">list</span><span class="p">();</span>
      <span class="n">nDurham</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">durham</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="p">);</span>
      <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">durham</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span>
        <span class="n">eDifDurham</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">durham</span><span class="p">.</span><span class="n">p</span><span class="p">(</span><span class="n">j</span><span class="p">).</span><span class="n">e</span><span class="p">()</span> <span class="o">-</span> <span class="n">durham</span><span class="p">.</span><span class="n">p</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">).</span><span class="n">e</span><span class="p">()</span> <span class="p">);</span>
    <span class="p">}</span>
  <span class="c1">// End of event loop. Statistics. Output histograms.</span>
  <span class="p">}</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">nCharge</span> <span class="o">&lt;&lt;</span> <span class="n">spheri</span> <span class="o">&lt;&lt;</span> <span class="n">linea</span> <span class="o">&lt;&lt;</span> <span class="n">thrust</span> <span class="o">&lt;&lt;</span> <span class="n">oblateness</span>
       <span class="o">&lt;&lt;</span> <span class="n">sAxis</span> <span class="o">&lt;&lt;</span> <span class="n">lAxis</span> <span class="o">&lt;&lt;</span> <span class="n">tAxis</span>
       <span class="o">&lt;&lt;</span> <span class="n">nLund</span> <span class="o">&lt;&lt;</span> <span class="n">nJade</span> <span class="o">&lt;&lt;</span> <span class="n">nDurham</span>
       <span class="o">&lt;&lt;</span> <span class="n">eDifLund</span> <span class="o">&lt;&lt;</span> <span class="n">eDifJade</span> <span class="o">&lt;&lt;</span> <span class="n">eDifDurham</span><span class="p">;</span>
  <span class="c1">// Done.</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
    </div>
  </div>
</div>

</div> <div class="well well-sm"> <h1 id="main07cc">main07.cc</h1><hr>
<div class="codehilite"><pre><span class="c1">// main07.cc is a part of the PYTHIA event generator.</span>
<span class="c1">// Copyright (C) 2016 Torbjorn Sjostrand.</span>
<span class="c1">// PYTHIA is licenced under the GNU GPL version 2, see COPYING for details.</span>
<span class="c1">// Please respect the MCnet Guidelines, see GUIDELINES for details.</span>
<span class="c1">// Illustration how to generate various two-body channels from</span>
<span class="c1">// astroparticle processes, e.g. neutralino annihilation or decay.</span>
<span class="c1">// To this end a &quot;blob&quot; of energy is created with unit cross section,</span>
<span class="c1">// from the fictitious collision of two non-radiating incoming e+e-.</span>
<span class="c1">// In the accompanying main29.cmnd file the decay channels of this</span>
<span class="c1">// blob can be set up. Furthermore, only gamma, e+-, p/pbar and</span>
<span class="c1">// neutrinos are stable, everything else is set to decay.</span>
<span class="c1">// (The &quot;single-particle gun&quot; of main21.cc offers another possible</span>
<span class="c1">// approach to the same problem.)</span>
</pre></div>


<div class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" href="#fileid6">Rest of the main07.cc code</a>
    </h4>
  </div>
  <div id="fileid6" class="panel-collapse collapse">
    <div class="panel-body">
<div class="codehilite"><pre><span class="cp">#include</span> <span class="cpf">&quot;Pythia8/Pythia.h&quot;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">Pythia8</span><span class="p">;</span>
<span class="c1">//==========================================================================</span>
<span class="c1">// A derived class for (e+ e- -&gt;) GenericResonance -&gt; various final states.</span>
<span class="k">class</span> <span class="nc">Sigma1GenRes</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Sigma1Process</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="c1">// Constructor.</span>
  <span class="n">Sigma1GenRes</span><span class="p">()</span> <span class="p">{}</span>
  <span class="c1">// Evaluate sigmaHat(sHat): dummy unit cross section.</span>
  <span class="k">virtual</span> <span class="kt">double</span> <span class="n">sigmaHat</span><span class="p">()</span> <span class="p">{</span><span class="k">return</span> <span class="mf">1.</span><span class="p">;}</span>
  <span class="c1">// Select flavour. No colour or anticolour.</span>
  <span class="k">virtual</span> <span class="kt">void</span> <span class="n">setIdColAcol</span><span class="p">()</span> <span class="p">{</span><span class="n">setId</span><span class="p">(</span> <span class="o">-</span><span class="mi">11</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">999999</span><span class="p">);</span>
    <span class="n">setColAcol</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);}</span>
  <span class="c1">// Info on the subprocess.</span>
  <span class="k">virtual</span> <span class="n">string</span> <span class="n">name</span><span class="p">()</span>    <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="s">&quot;GenericResonance&quot;</span><span class="p">;}</span>
  <span class="k">virtual</span> <span class="kt">int</span>    <span class="n">code</span><span class="p">()</span>    <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="mi">9001</span><span class="p">;}</span>
  <span class="k">virtual</span> <span class="n">string</span> <span class="n">inFlux</span><span class="p">()</span>  <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="s">&quot;ffbarSame&quot;</span><span class="p">;}</span>
<span class="p">};</span>
<span class="c1">//==========================================================================</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Pythia generator.</span>
  <span class="n">Pythia</span> <span class="n">pythia</span><span class="p">;</span>
  <span class="c1">// A class to generate the fictitious resonance initial state.</span>
  <span class="n">SigmaProcess</span><span class="o">*</span> <span class="n">sigma1GenRes</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Sigma1GenRes</span><span class="p">();</span>
  <span class="c1">// Hand pointer to Pythia.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">setSigmaPtr</span><span class="p">(</span> <span class="n">sigma1GenRes</span><span class="p">);</span>
  <span class="c1">// Read in the rest of the settings and data from a separate file.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readFile</span><span class="p">(</span><span class="s">&quot;main07.cmnd&quot;</span><span class="p">);</span>
  <span class="c1">// Initialization.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
  <span class="c1">// Extract settings to be used in the main program.</span>
  <span class="kt">int</span> <span class="n">nEvent</span>  <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Main:numberOfEvents&quot;</span><span class="p">);</span>
  <span class="kt">int</span> <span class="n">nAbort</span>  <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Main:timesAllowErrors&quot;</span><span class="p">);</span>
  <span class="c1">// Histogram particle spectra.</span>
  <span class="n">Hist</span> <span class="n">eGamma</span><span class="p">(</span><span class="s">&quot;energy spectrum of photons&quot;</span><span class="p">,</span>        <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">250.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">eE</span><span class="p">(</span>    <span class="s">&quot;energy spectrum of e+ and e-&quot;</span><span class="p">,</span>      <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">250.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">eP</span><span class="p">(</span>    <span class="s">&quot;energy spectrum of p and pbar&quot;</span><span class="p">,</span>     <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">250.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">eNu</span><span class="p">(</span>   <span class="s">&quot;energy spectrum of neutrinos&quot;</span><span class="p">,</span>      <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">250.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">eRest</span><span class="p">(</span> <span class="s">&quot;energy spectrum of rest particles&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">250.</span><span class="p">);</span>
  <span class="c1">// Begin event loop.</span>
  <span class="kt">int</span> <span class="n">iAbort</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iEvent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iEvent</span> <span class="o">&lt;</span> <span class="n">nEvent</span><span class="p">;</span> <span class="o">++</span><span class="n">iEvent</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Generate events. Quit if many failures.</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">())</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">++</span><span class="n">iAbort</span> <span class="o">&lt;</span> <span class="n">nAbort</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; Event generation aborted prematurely, owing to error!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// Loop over all particles and analyze the final-state ones.</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">isFinal</span><span class="p">())</span> <span class="p">{</span>
      <span class="kt">int</span> <span class="n">idAbs</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">idAbs</span><span class="p">();</span>
      <span class="kt">double</span> <span class="n">eI</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">e</span><span class="p">();</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">idAbs</span> <span class="o">==</span> <span class="mi">22</span><span class="p">)</span> <span class="n">eGamma</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span><span class="n">eI</span><span class="p">);</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">idAbs</span> <span class="o">==</span> <span class="mi">11</span><span class="p">)</span> <span class="n">eE</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span><span class="n">eI</span><span class="p">);</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">idAbs</span> <span class="o">==</span> <span class="mi">2212</span><span class="p">)</span> <span class="n">eP</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span><span class="n">eI</span><span class="p">);</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">idAbs</span> <span class="o">==</span> <span class="mi">12</span> <span class="o">||</span> <span class="n">idAbs</span> <span class="o">==</span> <span class="mi">14</span> <span class="o">||</span> <span class="n">idAbs</span> <span class="o">==</span> <span class="mi">16</span><span class="p">)</span> <span class="n">eNu</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span><span class="n">eI</span><span class="p">);</span>
      <span class="k">else</span> <span class="p">{</span>
        <span class="n">eRest</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span><span class="n">eI</span><span class="p">);</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; Error: stable id = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">id</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="c1">// End of event loop.</span>
  <span class="p">}</span>
  <span class="c1">// Final statistics and histograms.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">eGamma</span> <span class="o">&lt;&lt;</span> <span class="n">eE</span> <span class="o">&lt;&lt;</span> <span class="n">eP</span> <span class="o">&lt;&lt;</span> <span class="n">eNu</span> <span class="o">&lt;&lt;</span> <span class="n">eRest</span><span class="p">;</span>
  <span class="c1">// Done.</span>
  <span class="k">delete</span> <span class="n">sigma1GenRes</span><span class="p">;</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
    </div>
  </div>
</div>

</div> <div class="well well-sm"> <h1 id="main08cc">main08.cc</h1><hr>
<div class="codehilite"><pre><span class="c1">// main08.cc is a part of the PYTHIA event generator.</span>
<span class="c1">// Copyright (C) 2016 Torbjorn Sjostrand.</span>
<span class="c1">// PYTHIA is licenced under the GNU GPL version 2, see COPYING for details.</span>
<span class="c1">// Please respect the MCnet Guidelines, see GUIDELINES for details.</span>
<span class="c1">// This is a simple test program.</span>
<span class="c1">// It illustrates methods to emphasize generation at high pT.</span>
</pre></div>


<div class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" href="#fileid7">Rest of the main08.cc code</a>
    </h4>
  </div>
  <div id="fileid7" class="panel-collapse collapse">
    <div class="panel-body">
<div class="codehilite"><pre><span class="cp">#include</span> <span class="cpf">&quot;Pythia8/Pythia.h&quot;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">Pythia8</span><span class="p">;</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Different modes are illustrated for setting the pT ranges.</span>
  <span class="c1">// 1 : Hardcoded in the main program.</span>
  <span class="c1">// 2 : Using the Main:subrun keyword in a separate command file.</span>
  <span class="c1">// A third method instead biases selection continuously.</span>
  <span class="c1">// 3 : Bias high-pT selection by a pT^4 factor.</span>
  <span class="c1">// Matching also to low-pT processes is more complicated.</span>
  <span class="c1">// 4 : Matching between low- and high-pT. (No diffraction.)</span>
  <span class="c1">// 5: As 4, but bias high-pT selection by a pT^4 factor.</span>
  <span class="kt">int</span> <span class="n">mode</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
  <span class="c1">// Number of events to generate per bin.</span>
  <span class="kt">int</span> <span class="n">nEvent</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">;</span>
  <span class="c1">// One does not need complete events to study pThard spectrum only.</span>
  <span class="kt">bool</span> <span class="n">completeEvents</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
  <span class="c1">// Optionally minimize output (almost) to final results.</span>
  <span class="kt">bool</span> <span class="n">smallOutput</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
  <span class="c1">// Book histograms.</span>
  <span class="kt">int</span> <span class="n">nRange</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
  <span class="kt">double</span> <span class="n">pTrange</span> <span class="o">=</span> <span class="p">(</span><span class="n">mode</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">?</span> <span class="mf">1000.</span> <span class="o">:</span> <span class="mf">100.</span><span class="p">;</span>
  <span class="n">Hist</span> <span class="n">pTraw</span><span class="p">(</span><span class="s">&quot;pTHat distribution, unweighted&quot;</span><span class="p">,</span> <span class="n">nRange</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">pTrange</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">pTnorm</span><span class="p">(</span><span class="s">&quot;pTHat distribution, weighted&quot;</span><span class="p">,</span> <span class="n">nRange</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">pTrange</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">pTpow3</span><span class="p">(</span><span class="s">&quot;pTHat distribution, pT3*weighted&quot;</span><span class="p">,</span> <span class="n">nRange</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">pTrange</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">pTpow5</span><span class="p">(</span><span class="s">&quot;pTHat distribution, pT5*weighted&quot;</span><span class="p">,</span> <span class="n">nRange</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">pTrange</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">pTnormPart</span><span class="p">(</span><span class="s">&quot;pTHat distribution, weighted&quot;</span><span class="p">,</span> <span class="n">nRange</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">pTrange</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">pTpow3Part</span><span class="p">(</span><span class="s">&quot;pTHat distribution, pT3*weighted&quot;</span><span class="p">,</span> <span class="n">nRange</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">pTrange</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">pTpow5Part</span><span class="p">(</span><span class="s">&quot;pTHat distribution, pT5*weighted&quot;</span><span class="p">,</span> <span class="n">nRange</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">pTrange</span><span class="p">);</span>
  <span class="c1">// Generator.</span>
  <span class="n">Pythia</span> <span class="n">pythia</span><span class="p">;</span>
  <span class="c1">// Shorthand for some public members of pythia (also static ones).</span>
  <span class="n">Settings</span><span class="o">&amp;</span> <span class="n">settings</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">;</span>
  <span class="n">Info</span><span class="o">&amp;</span> <span class="n">info</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">;</span>
  <span class="c1">// Optionally limit output to minimal one.</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">smallOutput</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Init:showProcesses = off&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Init:showMultipartonInteractions = off&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Init:showChangedSettings = off&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Init:showChangedParticleData = off&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Next:numberCount = 1000000000&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Next:numberShowInfo = 0&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Next:numberShowProcess = 0&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Next:numberShowEvent = 0&quot;</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="c1">// Number of bins to use. In mode 2 read from main08.cmnd file.</span>
  <span class="kt">int</span> <span class="n">nBin</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">mode</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readFile</span><span class="p">(</span><span class="s">&quot;main08.cmnd&quot;</span><span class="p">);</span>
    <span class="n">nBin</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Main:numberOfSubruns&quot;</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">mode</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="n">nBin</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">mode</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span> <span class="n">nBin</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">mode</span> <span class="o">==</span> <span class="mi">5</span><span class="p">)</span> <span class="n">nBin</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="c1">// Mode 1: set up five pT bins - last one open-ended.</span>
  <span class="kt">double</span> <span class="n">pTlimit</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mf">100.</span><span class="p">,</span> <span class="mf">150.</span><span class="p">,</span> <span class="mf">250.</span><span class="p">,</span> <span class="mf">400.</span><span class="p">,</span> <span class="mf">600.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">};</span>
  <span class="c1">// Modes 4 &amp; 5: set up pT bins for range [0, 100]. The lowest bin</span>
  <span class="c1">// is generated with soft processes, to regularize pT -&gt; 0 blowup.</span>
  <span class="c1">// Warning: if pTlimitLow[1] is picked too low there will be a</span>
  <span class="c1">// visible discontinuity, since soft processes are generated with</span>
  <span class="c1">// dampening and &quot;Sudakov&quot; for pT -&gt; 0, while hard processes are not.</span>
  <span class="kt">double</span> <span class="n">pTlimitLow</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">20.</span><span class="p">,</span> <span class="mf">40.</span><span class="p">,</span> <span class="mf">70.</span><span class="p">,</span> <span class="mf">100.</span><span class="p">};</span>
  <span class="kt">double</span> <span class="n">pTlimitTwo</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">20.</span><span class="p">,</span> <span class="mf">100.</span><span class="p">};</span>
  <span class="c1">// Loop over number of bins, i.e. number of subruns.</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iBin</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iBin</span> <span class="o">&lt;</span> <span class="n">nBin</span><span class="p">;</span> <span class="o">++</span><span class="n">iBin</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Normally HardQCD, but in two cases nonDiffractive.</span>
    <span class="c1">// Need MPI on in nonDiffractive to get first interaction, but not else.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">mode</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="o">&amp;&amp;</span> <span class="n">iBin</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;HardQCD:all = off&quot;</span><span class="p">);</span>
      <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;SoftQCD:nonDiffractive = on&quot;</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">completeEvents</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;PartonLevel:all = on&quot;</span><span class="p">);</span>
        <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;PartonLevel:ISR = off&quot;</span><span class="p">);</span>
        <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;PartonLevel:FSR = off&quot;</span><span class="p">);</span>
        <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;HadronLevel:all = off&quot;</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;HardQCD:all = on&quot;</span><span class="p">);</span>
      <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;SoftQCD:nonDiffractive = off&quot;</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">completeEvents</span><span class="p">)</span> <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;PartonLevel:all = off&quot;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="c1">// Mode 1: hardcoded here. Use settings.parm for non-string input.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">mode</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">settings</span><span class="p">.</span><span class="n">parm</span><span class="p">(</span><span class="s">&quot;PhaseSpace:pTHatMin&quot;</span><span class="p">,</span> <span class="n">pTlimit</span><span class="p">[</span><span class="n">iBin</span><span class="p">]);</span>
      <span class="n">settings</span><span class="p">.</span><span class="n">parm</span><span class="p">(</span><span class="s">&quot;PhaseSpace:pTHatMax&quot;</span><span class="p">,</span> <span class="n">pTlimit</span><span class="p">[</span><span class="n">iBin</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]);</span>
    <span class="p">}</span>
    <span class="c1">// Mode 2: subruns stored in the main08.cmnd file.</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">mode</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="n">pythia</span><span class="p">.</span><span class="n">readFile</span><span class="p">(</span><span class="s">&quot;main08.cmnd&quot;</span><span class="p">,</span> <span class="n">iBin</span><span class="p">);</span>
    <span class="c1">// Mode 3: The whole range in one step, but pT-weighted.</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">mode</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">settings</span><span class="p">.</span><span class="n">parm</span><span class="p">(</span><span class="s">&quot;PhaseSpace:pTHatMin&quot;</span><span class="p">,</span> <span class="n">pTlimit</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
      <span class="n">settings</span><span class="p">.</span><span class="n">parm</span><span class="p">(</span><span class="s">&quot;PhaseSpace:pTHatMax&quot;</span><span class="p">,</span> <span class="mf">0.</span><span class="p">);</span>
      <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;PhaseSpace:bias2Selection = on&quot;</span><span class="p">);</span>
      <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;PhaseSpace:bias2SelectionPow = 4.&quot;</span><span class="p">);</span>
      <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;PhaseSpace:bias2SelectionRef = 100.&quot;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="c1">// Mode 4: hardcoded here. Use settings.parm for non-string input.</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">mode</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">settings</span><span class="p">.</span><span class="n">parm</span><span class="p">(</span><span class="s">&quot;PhaseSpace:pTHatMin&quot;</span><span class="p">,</span> <span class="n">pTlimitLow</span><span class="p">[</span><span class="n">iBin</span><span class="p">]);</span>
      <span class="n">settings</span><span class="p">.</span><span class="n">parm</span><span class="p">(</span><span class="s">&quot;PhaseSpace:pTHatMax&quot;</span><span class="p">,</span> <span class="n">pTlimitLow</span><span class="p">[</span><span class="n">iBin</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]);</span>
    <span class="p">}</span>
    <span class="c1">// Mode 5: hardcoded here. Use settings.parm for non-string input.</span>
    <span class="c1">// Hard processes in one step, but pT-weighted.</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">mode</span> <span class="o">==</span> <span class="mi">5</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">settings</span><span class="p">.</span><span class="n">parm</span><span class="p">(</span><span class="s">&quot;PhaseSpace:pTHatMin&quot;</span><span class="p">,</span> <span class="n">pTlimitTwo</span><span class="p">[</span><span class="n">iBin</span><span class="p">]);</span>
      <span class="n">settings</span><span class="p">.</span><span class="n">parm</span><span class="p">(</span><span class="s">&quot;PhaseSpace:pTHatMax&quot;</span><span class="p">,</span> <span class="n">pTlimitTwo</span><span class="p">[</span><span class="n">iBin</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">iBin</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;PhaseSpace:bias2Selection = on&quot;</span><span class="p">);</span>
        <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;PhaseSpace:bias2SelectionPow = 4.&quot;</span><span class="p">);</span>
        <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;PhaseSpace:bias2SelectionRef = 20.&quot;</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="c1">// Initialize for LHC at 14 TeV.</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Beams:eCM = 14000.&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
    <span class="c1">// Reset local histograms (that need to be rescaled before added).</span>
    <span class="n">pTnormPart</span><span class="p">.</span><span class="n">null</span><span class="p">();</span>
    <span class="n">pTpow3Part</span><span class="p">.</span><span class="n">null</span><span class="p">();</span>
    <span class="n">pTpow5Part</span><span class="p">.</span><span class="n">null</span><span class="p">();</span>
    <span class="c1">// Begin event loop.</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iEvent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iEvent</span> <span class="o">&lt;</span> <span class="n">nEvent</span><span class="p">;</span> <span class="o">++</span><span class="n">iEvent</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Generate events. Skip if failure.</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">())</span> <span class="k">continue</span><span class="p">;</span>
      <span class="c1">// Soft events have no upper pT limit. They therefore overlap</span>
      <span class="c1">// with hard events, and the overlap must be removed by hand.</span>
      <span class="c1">// No overlap for elastic/diffraction, which is only part of soft.</span>
      <span class="kt">double</span> <span class="n">pTHat</span>  <span class="o">=</span> <span class="n">info</span><span class="p">.</span><span class="n">pTHat</span><span class="p">();</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">mode</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="o">&amp;&amp;</span> <span class="n">iBin</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">info</span><span class="p">.</span><span class="n">isNonDiffractive</span><span class="p">()</span>
        <span class="o">&amp;&amp;</span> <span class="n">pTHat</span> <span class="o">&gt;</span> <span class="n">pTlimitLow</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">continue</span><span class="p">;</span>
      <span class="c1">// Fill hard scale of event.</span>
      <span class="kt">double</span> <span class="n">weight</span> <span class="o">=</span> <span class="n">info</span><span class="p">.</span><span class="n">weight</span><span class="p">();</span>
      <span class="n">pTraw</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">pTHat</span> <span class="p">);</span>
      <span class="n">pTnormPart</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">pTHat</span><span class="p">,</span> <span class="n">weight</span><span class="p">);</span>
      <span class="n">pTpow3Part</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">pTHat</span><span class="p">,</span> <span class="n">weight</span> <span class="o">*</span> <span class="n">pow3</span><span class="p">(</span><span class="n">pTHat</span><span class="p">)</span> <span class="p">);</span>
      <span class="n">pTpow5Part</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">pTHat</span><span class="p">,</span> <span class="n">weight</span> <span class="o">*</span> <span class="n">pow5</span><span class="p">(</span><span class="n">pTHat</span><span class="p">)</span> <span class="p">);</span>
    <span class="c1">// End of event loop. Statistics.</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">smallOutput</span><span class="p">)</span> <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
    <span class="c1">// Normalize to cross section for each case, and add to sum.</span>
    <span class="kt">double</span> <span class="n">sigmaNorm</span> <span class="o">=</span> <span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">sigmaGen</span><span class="p">()</span> <span class="o">/</span> <span class="n">info</span><span class="p">.</span><span class="n">weightSum</span><span class="p">())</span>
                     <span class="o">*</span> <span class="p">(</span><span class="n">nRange</span> <span class="o">/</span> <span class="n">pTrange</span><span class="p">);</span>
    <span class="n">pTnorm</span> <span class="o">+=</span> <span class="n">sigmaNorm</span> <span class="o">*</span> <span class="n">pTnormPart</span><span class="p">;</span>
    <span class="n">pTpow3</span> <span class="o">+=</span> <span class="n">sigmaNorm</span> <span class="o">*</span> <span class="n">pTpow3Part</span><span class="p">;</span>
    <span class="n">pTpow5</span> <span class="o">+=</span> <span class="n">sigmaNorm</span> <span class="o">*</span> <span class="n">pTpow5Part</span><span class="p">;</span>
  <span class="c1">// End of pT-bin loop.</span>
  <span class="p">}</span>
  <span class="c1">// Output histograms.</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">pTraw</span> <span class="o">&lt;&lt;</span> <span class="n">pTnorm</span> <span class="o">&lt;&lt;</span> <span class="n">pTpow3</span> <span class="o">&lt;&lt;</span> <span class="n">pTpow5</span><span class="p">;</span>
  <span class="c1">// Done.</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
    </div>
  </div>
</div>

</div> <div class="well well-sm"> <h1 id="main09cc">main09.cc</h1><hr>
<div class="codehilite"><pre><span class="c1">// main09.cc is a part of the PYTHIA event generator.</span>
<span class="c1">// Copyright (C) 2016 Torbjorn Sjostrand.</span>
<span class="c1">// PYTHIA is licenced under the GNU GPL version 2, see COPYING for details.</span>
<span class="c1">// Please respect the MCnet Guidelines, see GUIDELINES for details.</span>
<span class="c1">// Generate a predetermined second hard interaction.</span>
</pre></div>


<div class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" href="#fileid8">Rest of the main09.cc code</a>
    </h4>
  </div>
  <div id="fileid8" class="panel-collapse collapse">
    <div class="panel-body">
<div class="codehilite"><pre><span class="cp">#include</span> <span class="cpf">&quot;Pythia8/Pythia.h&quot;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">Pythia8</span><span class="p">;</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Generator.</span>
  <span class="n">Pythia</span> <span class="n">pythia</span><span class="p">;</span>
  <span class="n">Event</span><span class="o">&amp;</span> <span class="n">event</span>   <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">;</span>
  <span class="c1">// Select first hard process (just a small sample of possibilities).</span>
  <span class="c1">//pythia.readString(&quot;HardQCD:all = on&quot;);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Top:all = on&quot;</span><span class="p">);</span>
  <span class="c1">//pythia.readString(&quot;WeakSingleBoson:ffbar2gmZ = on&quot;);</span>
  <span class="c1">//pythia.readString(&quot;WeakSingleBoson:ffbar2W = on&quot;);</span>
  <span class="c1">// Select second hard process (complete list of options).</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;SecondHard:generate = on&quot;</span><span class="p">);</span>
  <span class="c1">//pythia.readString(&quot;SecondHard:TwoJets = on&quot;);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;SecondHard:PhotonAndJet = on&quot;</span><span class="p">);</span>
  <span class="c1">//pythia.readString(&quot;SecondHard:TwoPhotons = on&quot;);</span>
  <span class="c1">//pythia.readString(&quot;SecondHard:SingleGmZ = on&quot;);</span>
  <span class="c1">//pythia.readString(&quot;SecondHard:SingleW = on&quot;);</span>
  <span class="c1">//pythia.readString(&quot;SecondHard:TwoBJets = on&quot;);</span>
  <span class="c1">// Kinematics cuts, common for the two.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;PhaseSpace:mHatMin = 40.&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;PhaseSpace:pTHatMin = 20.&quot;</span><span class="p">);</span>
  <span class="c1">// Initialize for LHC at 8 TeV.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Beams:eCM = 8000.&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
  <span class="c1">// Histogram.</span>
  <span class="n">Hist</span> <span class="n">pTfirst</span><span class="p">(</span><span class="s">&quot;pT first collision&quot;</span><span class="p">,</span>    <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">400.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">pTsecond</span><span class="p">(</span><span class="s">&quot;pT second collision&quot;</span><span class="p">,</span>  <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">200.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">pTdiff</span><span class="p">(</span><span class="s">&quot;pT first-second collision&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">100.</span><span class="p">,</span> <span class="mf">300.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">nMult</span><span class="p">(</span><span class="s">&quot;number of multiparton interactions&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">99.5</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">bMore</span><span class="p">(</span><span class="s">&quot;b enhancement factor&quot;</span><span class="p">,</span>    <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">10.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">nChg</span><span class="p">(</span><span class="s">&quot;charged multiplicity&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">999.5</span><span class="p">);</span>
  <span class="c1">// Generate events.</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iev</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iev</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">;</span> <span class="o">++</span><span class="n">iev</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
    <span class="c1">// Histogram pT.</span>
    <span class="kt">double</span> <span class="n">pT1</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">pTMPI</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="kt">double</span> <span class="n">pT2</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">pTMPI</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="n">pTfirst</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">pT1</span> <span class="p">);</span>
    <span class="n">pTsecond</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">pT2</span> <span class="p">);</span>
    <span class="n">pTdiff</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">pT1</span> <span class="o">-</span> <span class="n">pT2</span> <span class="p">);</span>
    <span class="c1">// Histogram multiparton interactions</span>
    <span class="kt">double</span> <span class="n">nMPI</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">nMPI</span><span class="p">();</span>
    <span class="n">nMult</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">nMPI</span> <span class="p">);</span>
    <span class="n">bMore</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">enhanceMPI</span><span class="p">()</span> <span class="p">);</span>
    <span class="c1">// Histogram charged multiplicity.</span>
    <span class="kt">int</span> <span class="n">nCharged</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">event</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">isFinal</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">isCharged</span><span class="p">())</span> <span class="o">++</span><span class="n">nCharged</span><span class="p">;</span>
    <span class="n">nChg</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">nCharged</span> <span class="p">);</span>
  <span class="p">}</span>
  <span class="c1">// Compare full statistics listing with what is set in info.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">scientific</span> <span class="o">&lt;&lt;</span> <span class="n">setprecision</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s"> From pythia.info: sigma = &quot;</span>
       <span class="o">&lt;&lt;</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">sigmaGen</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; +- &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">sigmaErr</span><span class="p">()</span>
       <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="c1">// Print histograms.</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">pTfirst</span> <span class="o">&lt;&lt;</span> <span class="n">pTsecond</span> <span class="o">&lt;&lt;</span> <span class="n">pTdiff</span> <span class="o">&lt;&lt;</span> <span class="n">nMult</span> <span class="o">&lt;&lt;</span> <span class="n">bMore</span> <span class="o">&lt;&lt;</span> <span class="n">nChg</span><span class="p">;</span>
  <span class="c1">// Done.</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
    </div>
  </div>
</div>

</div> <div class="well well-sm"> <h1 id="main10cc">main10.cc</h1><hr>
<div class="codehilite"><pre><span class="c1">// main10.cc is a part of the PYTHIA event generator.</span>
<span class="c1">// Copyright (C) 2016 Torbjorn Sjostrand.</span>
<span class="c1">// PYTHIA is licenced under the GNU GPL version 2, see COPYING for details.</span>
<span class="c1">// Please respect the MCnet Guidelines, see GUIDELINES for details.</span>
<span class="c1">// Example how you can use UserHooks to trace pT spectrum through program,</span>
<span class="c1">// and veto undesirable jet multiplicities.</span>
</pre></div>


<div class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" href="#fileid9">Rest of the main10.cc code</a>
    </h4>
  </div>
  <div id="fileid9" class="panel-collapse collapse">
    <div class="panel-body">
<div class="codehilite"><pre><span class="cp">#include</span> <span class="cpf">&quot;Pythia8/Pythia.h&quot;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">Pythia8</span><span class="p">;</span>
<span class="c1">//==========================================================================</span>
<span class="c1">// Put histograms here to make them global, so they can be used both</span>
<span class="c1">// in MyUserHooks and in the main program.</span>
<span class="n">Hist</span> <span class="nf">pTtrial</span><span class="p">(</span><span class="s">&quot;trial pT spectrum&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">400.</span><span class="p">);</span>
<span class="n">Hist</span> <span class="nf">pTselect</span><span class="p">(</span><span class="s">&quot;selected pT spectrum (before veto)&quot;, 100, 0., 400.)</span><span class="p">;</span>
<span class="n">Hist</span> <span class="nf">pTaccept</span><span class="p">(</span><span class="s">&quot;accepted pT spectrum (after veto)&quot;, 100, 0., 400.)</span><span class="p">;</span>
<span class="n">Hist</span> <span class="nf">nPartonsB</span><span class="p">(</span><span class="s">&quot;number of partons before veto&quot;</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">19.5</span><span class="p">);</span>
<span class="n">Hist</span> <span class="nf">nJets</span><span class="p">(</span><span class="s">&quot;number of jets before veto&quot;</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">19.5</span><span class="p">);</span>
<span class="n">Hist</span> <span class="nf">nPartonsA</span><span class="p">(</span><span class="s">&quot;number of partons after veto&quot;</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">19.5</span><span class="p">);</span>
<span class="n">Hist</span> <span class="nf">nFSRatISR</span><span class="p">(</span><span class="s">&quot;number of FSR emissions at first ISR emission&quot;</span><span class="p">,</span>
  <span class="mi">20</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">19.5</span><span class="p">);</span>
<span class="c1">//==========================================================================</span>
<span class="c1">// Write own derived UserHooks class.</span>
<span class="k">class</span> <span class="nc">MyUserHooks</span> <span class="o">:</span> <span class="k">public</span> <span class="n">UserHooks</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="c1">// Constructor creates anti-kT jet finder with (-1, R, pTmin, etaMax).</span>
  <span class="n">MyUserHooks</span><span class="p">()</span> <span class="p">{</span> <span class="n">slowJet</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SlowJet</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">10.</span><span class="p">,</span> <span class="mf">5.</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// Destructor deletes anti-kT jet finder.</span>
  <span class="o">~</span><span class="n">MyUserHooks</span><span class="p">()</span> <span class="p">{</span><span class="k">delete</span> <span class="n">slowJet</span><span class="p">;}</span>
  <span class="c1">// Allow process cross section to be modified...</span>
  <span class="k">virtual</span> <span class="kt">bool</span> <span class="n">canModifySigma</span><span class="p">()</span> <span class="p">{</span><span class="k">return</span> <span class="nb">true</span><span class="p">;}</span>
  <span class="c1">// ...which gives access to the event at the trial level, before selection.</span>
  <span class="k">virtual</span> <span class="kt">double</span> <span class="n">multiplySigmaBy</span><span class="p">(</span><span class="k">const</span> <span class="n">SigmaProcess</span><span class="o">*</span> <span class="n">sigmaProcessPtr</span><span class="p">,</span>
    <span class="k">const</span> <span class="n">PhaseSpace</span><span class="o">*</span> <span class="n">phaseSpacePtr</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">inEvent</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// All events should be 2 -&gt; 2, but kill them if not.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">sigmaProcessPtr</span><span class="o">-&gt;</span><span class="n">nFinal</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)</span> <span class="k">return</span> <span class="mf">0.</span><span class="p">;</span>
    <span class="c1">// Extract the pT for 2 -&gt; 2 processes in the event generation chain</span>
    <span class="c1">// (inEvent = false for initialization).</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">inEvent</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">pTHat</span> <span class="o">=</span> <span class="n">phaseSpacePtr</span><span class="o">-&gt;</span><span class="n">pTHat</span><span class="p">();</span>
      <span class="c1">// Fill histogram of pT spectrum.</span>
      <span class="n">pTtrial</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">pTHat</span> <span class="p">);</span>
    <span class="p">}</span>
    <span class="c1">// Here we do not modify 2 -&gt; 2 cross sections.</span>
    <span class="k">return</span> <span class="mf">1.</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// Allow a veto for the interleaved evolution in pT.</span>
  <span class="k">virtual</span> <span class="kt">bool</span> <span class="n">canVetoPT</span><span class="p">()</span> <span class="p">{</span><span class="k">return</span> <span class="nb">true</span><span class="p">;}</span>
  <span class="c1">// Do the veto test at a pT scale of 5 GeV.</span>
  <span class="k">virtual</span> <span class="kt">double</span> <span class="n">scaleVetoPT</span><span class="p">()</span> <span class="p">{</span><span class="k">return</span> <span class="mf">5.</span><span class="p">;}</span>
  <span class="c1">// Access the event in the interleaved evolution.</span>
  <span class="k">virtual</span> <span class="kt">bool</span> <span class="n">doVetoPT</span><span class="p">(</span><span class="kt">int</span> <span class="n">iPos</span><span class="p">,</span> <span class="k">const</span> <span class="n">Event</span><span class="o">&amp;</span> <span class="n">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// iPos &lt;= 3 for interleaved evolution; skip others.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">iPos</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">)</span> <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="c1">// Fill histogram of pT spectrum at this stage.</span>
    <span class="n">pTselect</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span><span class="n">pTHat</span><span class="p">);</span>
    <span class="c1">// Extract a copy of the partons in the hardest system.</span>
    <span class="n">subEvent</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
    <span class="n">nPartonsB</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">workEvent</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="p">);</span>
    <span class="c1">// Find number of jets with given conditions.</span>
    <span class="n">slowJet</span><span class="o">-&gt;</span><span class="n">analyze</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">nJet</span> <span class="o">=</span> <span class="n">slowJet</span><span class="o">-&gt;</span><span class="n">sizeJet</span><span class="p">();</span>
    <span class="n">nJets</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">nJet</span> <span class="p">);</span>
    <span class="c1">// Veto events which do not have exactly three jets.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">nJet</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">)</span> <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
    <span class="c1">// Statistics of survivors.</span>
    <span class="n">nPartonsA</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">workEvent</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="p">);</span>
    <span class="n">pTaccept</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span><span class="n">pTHat</span><span class="p">);</span>
    <span class="c1">// Do not veto events that got this far.</span>
    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// Allow a veto after (by default) first step.</span>
  <span class="k">virtual</span> <span class="kt">bool</span> <span class="n">canVetoStep</span><span class="p">()</span> <span class="p">{</span><span class="k">return</span> <span class="nb">true</span><span class="p">;}</span>
  <span class="c1">// Access the event in the interleaved evolution after first step.</span>
  <span class="k">virtual</span> <span class="kt">bool</span> <span class="n">doVetoStep</span><span class="p">(</span> <span class="kt">int</span> <span class="n">iPos</span><span class="p">,</span> <span class="kt">int</span> <span class="n">nISR</span><span class="p">,</span> <span class="kt">int</span> <span class="n">nFSR</span><span class="p">,</span> <span class="k">const</span> <span class="n">Event</span><span class="o">&amp;</span> <span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Only want to study what happens at first ISR emission</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">iPos</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">&amp;&amp;</span> <span class="n">nISR</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="n">nFSRatISR</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">nFSR</span> <span class="p">);</span>
    <span class="c1">// Not intending to veto any events here.</span>
    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
  <span class="p">}</span>
<span class="k">private</span><span class="o">:</span>
  <span class="c1">// The anti-kT (or kT, C/A) jet finder.</span>
  <span class="n">SlowJet</span><span class="o">*</span> <span class="n">slowJet</span><span class="p">;</span>
  <span class="c1">// Save the pThat scale.</span>
  <span class="kt">double</span> <span class="n">pTHat</span><span class="p">;</span>
<span class="p">};</span>
<span class="c1">//==========================================================================</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Generator.</span>
  <span class="n">Pythia</span> <span class="n">pythia</span><span class="p">;</span>
  <span class="c1">//  Process selection. No need to study hadron level.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;HardQCD:all = on&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;PhaseSpace:pTHatMin = 50.&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;HadronLevel:all = off&quot;</span><span class="p">);</span>
  <span class="c1">// Set up to do a user veto and send it in.</span>
  <span class="n">MyUserHooks</span><span class="o">*</span> <span class="n">myUserHooks</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MyUserHooks</span><span class="p">();</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">setUserHooksPtr</span><span class="p">(</span> <span class="n">myUserHooks</span><span class="p">);</span>
  <span class="c1">// Tevatron initialization.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Beams:idB = -2212&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Beams:eCM = 1960.&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
  <span class="c1">// Begin event loop.</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iEvent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iEvent</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">;</span> <span class="o">++</span><span class="n">iEvent</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Generate events.</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
  <span class="c1">// End of event loop.</span>
  <span class="p">}</span>
  <span class="c1">// Statistics. Histograms.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">pTtrial</span> <span class="o">&lt;&lt;</span> <span class="n">pTselect</span> <span class="o">&lt;&lt;</span> <span class="n">pTaccept</span>
       <span class="o">&lt;&lt;</span> <span class="n">nPartonsB</span> <span class="o">&lt;&lt;</span> <span class="n">nJets</span> <span class="o">&lt;&lt;</span> <span class="n">nPartonsA</span>
       <span class="o">&lt;&lt;</span> <span class="n">nFSRatISR</span><span class="p">;</span>
  <span class="c1">// Done.</span>
  <span class="k">delete</span> <span class="n">myUserHooks</span><span class="p">;</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
    </div>
  </div>
</div>

</div> <div class="well well-sm"> <h1 id="main11cc">main11.cc</h1><hr>
<div class="codehilite"><pre><span class="c1">// main11.cc is a part of the PYTHIA event generator.</span>
<span class="c1">// Copyright (C) 2016 Torbjorn Sjostrand.</span>
<span class="c1">// PYTHIA is licenced under the GNU GPL version 2, see COPYING for details.</span>
<span class="c1">// Please respect the MCnet Guidelines, see GUIDELINES for details.</span>
<span class="c1">// This is a simple test program.</span>
<span class="c1">// It illustrates how Les Houches Event File input can be used in Pythia8.</span>
<span class="c1">// It uses the ttsample.lhe(.gz) input file, the latter only with 100 events.</span>
</pre></div>


<div class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" href="#fileid10">Rest of the main11.cc code</a>
    </h4>
  </div>
  <div id="fileid10" class="panel-collapse collapse">
    <div class="panel-body">
<div class="codehilite"><pre><span class="cp">#include</span> <span class="cpf">&quot;Pythia8/Pythia.h&quot;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">Pythia8</span><span class="p">;</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// You can always read an plain LHE file,</span>
  <span class="c1">// but if you ran &quot;./configure --with-gzip&quot; before &quot;make&quot;</span>
  <span class="c1">// then you can also read a gzipped LHE file.</span>
<span class="cp">#ifdef GZIPSUPPORT</span>
  <span class="kt">bool</span> <span class="n">useGzip</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
<span class="cp">#else</span>
  <span class="kt">bool</span> <span class="n">useGzip</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
<span class="cp">#endif</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; useGzip = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">useGzip</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="c1">// Generator. We here stick with default values, but changes</span>
  <span class="c1">// could be inserted with readString or readFile.</span>
  <span class="n">Pythia</span> <span class="n">pythia</span><span class="p">;</span>
  <span class="c1">// Initialize Les Houches Event File run. List initialization information.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Beams:frameType = 4&quot;</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">useGzip</span><span class="p">)</span> <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Beams:LHEF = ttbar.lhe.gz&quot;</span><span class="p">);</span>
  <span class="k">else</span>         <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Beams:LHEF = ttbar.lhe&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
  <span class="c1">// Book histogram.</span>
  <span class="n">Hist</span> <span class="n">nCharged</span><span class="p">(</span><span class="s">&quot;charged particle multiplicity&quot;</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">399.5</span><span class="p">);</span>
  <span class="c1">// Allow for possibility of a few faulty events.</span>
  <span class="kt">int</span> <span class="n">nAbort</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">iAbort</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="c1">// Begin event loop; generate until none left in input file.</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iEvent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">;</span> <span class="o">++</span><span class="n">iEvent</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Generate events, and check whether generation failed.</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">())</span> <span class="p">{</span>
      <span class="c1">// If failure because reached end of file then exit event loop.</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">atEndOfFile</span><span class="p">())</span> <span class="k">break</span><span class="p">;</span>
      <span class="c1">// First few failures write off as &quot;acceptable&quot; errors, then quit.</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">++</span><span class="n">iAbort</span> <span class="o">&lt;</span> <span class="n">nAbort</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// Sum up final charged multiplicity and fill in histogram.</span>
    <span class="kt">int</span> <span class="n">nChg</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">isFinal</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">isCharged</span><span class="p">())</span>
      <span class="o">++</span><span class="n">nChg</span><span class="p">;</span>
    <span class="n">nCharged</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span><span class="n">nChg</span><span class="p">);</span>
  <span class="c1">// End of event loop.</span>
  <span class="p">}</span>
  <span class="c1">// Give statistics. Print histogram.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">nCharged</span><span class="p">;</span>
  <span class="c1">// Done.</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
    </div>
  </div>
</div>

</div> <div class="well well-sm"> <h1 id="main12cc">main12.cc</h1><hr>
<div class="codehilite"><pre><span class="c1">// main12.cc is a part of the PYTHIA event generator.</span>
<span class="c1">// Copyright (C) 2016 Torbjorn Sjostrand.</span>
<span class="c1">// PYTHIA is licenced under the GNU GPL version 2, see COPYING for details.</span>
<span class="c1">// Please respect the MCnet Guidelines, see GUIDELINES for details.</span>
<span class="c1">// This is a simple test program.</span>
<span class="c1">// It illustrates how Les Houches Event File input can be used in PYTHIA.</span>
<span class="c1">// It uses two LHE files, ttbar.lhe and ttbar2.lhe, which are combined</span>
<span class="c1">// using Beams:newLHEFsameInit = on to skip new initialization second time.</span>
<span class="c1">// Then the second file is viewed as a simple continuation of the first,</span>
<span class="c1">// just split for practical reasons, rather than as a separate new run</span>
<span class="c1">// with a new set of processes.</span>
<span class="c1">// In the first file top decays have been performed, in the second not,</span>
<span class="c1">// and are instead handled by the internal PYTHIA resonance-decay machinery.</span>
<span class="c1">// Furthermore the internal top production processes are switched on and</span>
<span class="c1">// mixed in, giving an unrealistic &quot;double up&quot; total top cross section.</span>
<span class="c1">// Much of this of course is not intended to be realistic,</span>
<span class="c1">// but rather illustrates several tricks that can be useful.</span>
</pre></div>


<div class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" href="#fileid11">Rest of the main12.cc code</a>
    </h4>
  </div>
  <div id="fileid11" class="panel-collapse collapse">
    <div class="panel-body">
<div class="codehilite"><pre><span class="cp">#include</span> <span class="cpf">&quot;Pythia8/Pythia.h&quot;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">Pythia8</span><span class="p">;</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">//  Number of listed events. Allow for possibility of a few faulty events.</span>
  <span class="kt">int</span> <span class="n">nPrintLHA</span>  <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">nPrintRest</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">nAbort</span>     <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
  <span class="c1">// Generator</span>
  <span class="n">Pythia</span> <span class="n">pythia</span><span class="p">;</span>
  <span class="c1">// Switch on internal ttbar production.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Top:gg2ttbar = on&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Top:qqbar2ttbar = on&quot;</span><span class="p">);</span>
  <span class="c1">// Use same top mass as in Pythia 6.4 to simplify comparison.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;6:m0 = 175.&quot;</span><span class="p">);</span>
  <span class="c1">// No automatic event listings - do it manually below.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Next:numberShowLHA = 0&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Next:numberShowInfo = 0&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Next:numberShowProcess = 0&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Next:numberShowEvent = 0&quot;</span><span class="p">);</span>
  <span class="c1">// Initialize Les Houches Event File run.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Beams:frameType = 4&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Beams:LHEF = ttbar.lhe&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
  <span class="c1">// Book histogram.</span>
  <span class="n">Hist</span> <span class="n">nCharged</span><span class="p">(</span><span class="s">&quot;charged particle multiplicity&quot;</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">399.5</span><span class="p">);</span>
  <span class="c1">// Set counters.</span>
  <span class="kt">int</span> <span class="n">iPrintLHA</span>  <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">iPrintRest</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">iAbort</span>     <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">iFile</span>      <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="c1">// Begin event loop</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iEvent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">;</span> <span class="o">++</span><span class="n">iEvent</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Generate until none left in input file.</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">())</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">atEndOfFile</span><span class="p">())</span> <span class="p">{</span>
        <span class="c1">// First time open next file, second time stop event loop.</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">iFile</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Beams:newLHEFsameInit = on&quot;</span><span class="p">);</span>
          <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Beams:LHEF = ttbar2.lhe&quot;</span><span class="p">);</span>
          <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
          <span class="o">++</span><span class="n">iFile</span><span class="p">;</span>
          <span class="k">continue</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="c1">// First few failures write off as &quot;acceptable&quot; errors, then quit.</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">++</span><span class="n">iAbort</span> <span class="o">&lt;</span> <span class="n">nAbort</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// List first few Les Houches and other events.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">isLHA</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">iPrintLHA</span> <span class="o">&lt;</span> <span class="n">nPrintLHA</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">pythia</span><span class="p">.</span><span class="n">LHAeventList</span><span class="p">();</span>
      <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">list</span><span class="p">();</span>
      <span class="n">pythia</span><span class="p">.</span><span class="n">process</span><span class="p">.</span><span class="n">list</span><span class="p">();</span>
      <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="n">list</span><span class="p">();</span>
      <span class="o">++</span><span class="n">iPrintLHA</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">isLHA</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">iPrintRest</span> <span class="o">&lt;</span> <span class="n">nPrintRest</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">list</span><span class="p">();</span>
      <span class="n">pythia</span><span class="p">.</span><span class="n">process</span><span class="p">.</span><span class="n">list</span><span class="p">();</span>
      <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="n">list</span><span class="p">();</span>
      <span class="o">++</span><span class="n">iPrintRest</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// Sum up final charged multiplicity and fill in histogram.</span>
    <span class="kt">int</span> <span class="n">nChg</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">isFinal</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">isCharged</span><span class="p">())</span>
      <span class="o">++</span><span class="n">nChg</span><span class="p">;</span>
    <span class="n">nCharged</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span><span class="n">nChg</span><span class="p">);</span>
  <span class="c1">// End of event loop.</span>
  <span class="p">}</span>
  <span class="c1">// Give statistics. Print histogram.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">nCharged</span><span class="p">;</span>
  <span class="c1">// Done.</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
    </div>
  </div>
</div>

</div> <div class="well well-sm"> <h1 id="main13cc">main13.cc</h1><hr>
<div class="codehilite"><pre><span class="c1">// main13.cc is a part of the PYTHIA event generator.</span>
<span class="c1">// Copyright (C) 2016 Torbjorn Sjostrand.</span>
<span class="c1">// PYTHIA is licenced under the GNU GPL version 2, see COPYING for details.</span>
<span class="c1">// Please respect the MCnet Guidelines, see GUIDELINES for details.</span>
<span class="c1">// This is a simple test program.</span>
<span class="c1">// It illustrates how two Les Houches Event Files can be combined in PYTHIA,</span>
<span class="c1">// just like in main12.cc, but here with the difference that information is</span>
<span class="c1">// stored in main13.cmnd and read out using the subruns possibility.</span>
</pre></div>


<div class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" href="#fileid12">Rest of the main13.cc code</a>
    </h4>
  </div>
  <div id="fileid12" class="panel-collapse collapse">
    <div class="panel-body">
<div class="codehilite"><pre><span class="cp">#include</span> <span class="cpf">&quot;Pythia8/Pythia.h&quot;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">Pythia8</span><span class="p">;</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Book histogram.</span>
  <span class="n">Hist</span> <span class="n">nCharged</span><span class="p">(</span><span class="s">&quot;charged particle multiplicity&quot;</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">399.5</span><span class="p">);</span>
  <span class="c1">// Generator.</span>
  <span class="n">Pythia</span> <span class="n">pythia</span><span class="p">;</span>
  <span class="c1">// Read in subrun-independent data from main13.cmnd.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readFile</span><span class="p">(</span> <span class="s">&quot;main13.cmnd&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
  <span class="c1">// Extract data to be used in main program. Set counters.</span>
  <span class="kt">int</span> <span class="n">nSubrun</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Main:numberOfSubruns&quot;</span><span class="p">);</span>
  <span class="kt">int</span> <span class="n">nAbort</span>  <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Main:timesAllowErrors&quot;</span><span class="p">);</span>
  <span class="kt">int</span> <span class="n">iAbort</span>  <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="c1">// Begin loop over subruns.</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iSubrun</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">iSubrun</span> <span class="o">&lt;=</span> <span class="n">nSubrun</span><span class="p">;</span> <span class="o">++</span><span class="n">iSubrun</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Read in subrun-specific data from main13.cmnd.</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readFile</span><span class="p">(</span> <span class="s">&quot;main13.cmnd&quot;</span><span class="p">,</span> <span class="n">iSubrun</span><span class="p">);</span>
    <span class="c1">// Initialize generator.</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
    <span class="c1">// Begin infinite event loop - to be exited at end of file.</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iEvent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">;</span> <span class="o">++</span><span class="n">iEvent</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Generate next event.</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">())</span> <span class="p">{</span>
        <span class="c1">// Leave event loop if at end of file.</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">atEndOfFile</span><span class="p">())</span> <span class="k">break</span><span class="p">;</span>
        <span class="c1">// First few failures write off as &quot;acceptable&quot; errors, then quit.</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">++</span><span class="n">iAbort</span> <span class="o">&lt;</span> <span class="n">nAbort</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="c1">// Sum up final charged multiplicity and fill in histogram.</span>
      <span class="kt">int</span> <span class="n">nChg</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">isFinal</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">isCharged</span><span class="p">())</span> <span class="o">++</span><span class="n">nChg</span><span class="p">;</span>
      <span class="n">nCharged</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span><span class="n">nChg</span><span class="p">);</span>
    <span class="c1">// End of event loop.</span>
    <span class="p">}</span>
  <span class="c1">// End of subrun loop.</span>
  <span class="p">}</span>
  <span class="c1">// Give statistics. Print histogram.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">nCharged</span><span class="p">;</span>
  <span class="c1">// Done.</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
    </div>
  </div>
</div>

</div> <div class="well well-sm"> <h1 id="main14cc">main14.cc</h1><hr>
<div class="codehilite"><pre><span class="c1">// main14.cc is a part of the PYTHIA event generator.</span>
<span class="c1">// Copyright (C) 2016 Torbjorn Sjostrand.</span>
<span class="c1">// PYTHIA is licenced under the GNU GPL version 2, see COPYING for details.</span>
<span class="c1">// Please respect the MCnet Guidelines, see GUIDELINES for details.</span>
<span class="c1">// Comparison with some PYTHIA 6.413 cross sections process by process.</span>
<span class="c1">// Several processes have been left out to keep reasonable execution time.</span>
<span class="c1">// Some processes are not handled absolutely identically, so minor</span>
<span class="c1">// systematic differences may occur in addition to the statistical ones.</span>
<span class="c1">// (For some MSSM Higgs processes 6.413 has been modified to use</span>
<span class="c1">// running quark masses in loops, like 8.1, to allow proper comparison.)</span>
<span class="c1">// Subruns  0 -  5 : QCD jets</span>
<span class="c1">//          6 - 10 : prompt photons.</span>
<span class="c1">//         11 - 12 : t-channel gamma/Z/W exchange.</span>
<span class="c1">//         13 - 23 : gamma*/Z^0/W^+-, singly, in pairs or with parton</span>
<span class="c1">//         24 - 25 : onia.</span>
<span class="c1">//         26 - 30 : top.</span>
<span class="c1">//         31 - 40 : Standard Model Higgs.</span>
<span class="c1">//         41 - 45 : MSSM Higgses (trivial couplings).</span>
<span class="c1">//         46 - 47 : Z&#39; and W&#39;</span>
<span class="c1">//         48 - 51 : Left-right-symmetric scenario.</span>
<span class="c1">//         52 - 52 : Leptoquark.</span>
<span class="c1">//         53 - 55 : Excited fermions (compositeness).</span>
<span class="c1">//         56 - 56 : excited Graviton (RS extra dimensions).</span>
</pre></div>


<div class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" href="#fileid13">Rest of the main14.cc code</a>
    </h4>
  </div>
  <div id="fileid13" class="panel-collapse collapse">
    <div class="panel-body">
<div class="codehilite"><pre><span class="cp">#include</span> <span class="cpf">&quot;Pythia8/Pythia.h&quot;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">Pythia8</span><span class="p">;</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// First and last process to test: can run from 0 through 40.</span>
  <span class="kt">int</span> <span class="n">iFirst</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">iLast</span>  <span class="o">=</span> <span class="mi">56</span><span class="p">;</span>
  <span class="c1">// Statistics. Pythia6 run was with 10000, so no point to use more.</span>
  <span class="kt">int</span> <span class="n">nEvent</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">;</span>
  <span class="c1">// Normally one subprocess word per subrun, but exceptions exist.</span>
  <span class="kt">int</span> <span class="n">nSub</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="n">nSub</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="n">nSub</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
  <span class="n">nSub</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
  <span class="c1">// Starting positions in subprocess words list, recursively defined.</span>
  <span class="kt">int</span> <span class="n">iBeg</span><span class="p">[</span><span class="mi">101</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">};</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="n">iBeg</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">iBeg</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">nSub</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
  <span class="c1">// List of subprocess words.</span>
  <span class="n">string</span> <span class="n">processes</span><span class="p">[</span><span class="mi">61</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&quot;HardQCD:gg2gg&quot;</span><span class="p">,</span> <span class="s">&quot;HardQCD:gg2qqbar&quot;</span><span class="p">,</span>
    <span class="s">&quot;HardQCD:gg2ccbar&quot;</span><span class="p">,</span>  <span class="s">&quot;HardQCD:gg2bbbar&quot;</span><span class="p">,</span><span class="s">&quot;HardQCD:qg2qg&quot;</span> <span class="p">,</span>
    <span class="s">&quot;HardQCD:qq2qq&quot;</span><span class="p">,</span> <span class="s">&quot;HardQCD:qqbar2gg&quot;</span><span class="p">,</span> <span class="s">&quot;HardQCD:qqbar2qqbarNew&quot;</span><span class="p">,</span>
    <span class="s">&quot;HardQCD:qqbar2ccbar&quot;</span><span class="p">,</span> <span class="s">&quot;HardQCD:qqbar2bbbar&quot;</span><span class="p">,</span> <span class="s">&quot;PromptPhoton:qg2qgamma&quot;</span><span class="p">,</span>
    <span class="s">&quot;PromptPhoton:qqbar2ggamma&quot;</span><span class="p">,</span> <span class="s">&quot;PromptPhoton:gg2ggamma&quot;</span><span class="p">,</span>
    <span class="s">&quot;PromptPhoton:ffbar2gammagamma&quot;</span><span class="p">,</span> <span class="s">&quot;PromptPhoton:gg2gammagamma&quot;</span><span class="p">,</span>
    <span class="s">&quot;WeakBosonExchange:ff2ff(t:gmZ)&quot;</span><span class="p">,</span> <span class="s">&quot;WeakBosonExchange:ff2ff(t:W)&quot;</span><span class="p">,</span>
    <span class="s">&quot;WeakSingleBoson:ffbar2gmZ&quot;</span><span class="p">,</span> <span class="s">&quot;WeakSingleBoson:ffbar2W&quot;</span><span class="p">,</span>
    <span class="s">&quot;WeakDoubleBoson:ffbar2gmZgmZ&quot;</span><span class="p">,</span> <span class="s">&quot;WeakDoubleBoson:ffbar2ZW&quot;</span><span class="p">,</span>
    <span class="s">&quot;WeakDoubleBoson:ffbar2WW&quot;</span><span class="p">,</span> <span class="s">&quot;WeakBosonAndParton:qqbar2gmZg&quot;</span><span class="p">,</span>
    <span class="s">&quot;WeakBosonAndParton:qg2gmZq&quot;</span><span class="p">,</span> <span class="s">&quot;WeakBosonAndParton:ffbar2gmZgm&quot;</span><span class="p">,</span>
    <span class="s">&quot;WeakBosonAndParton:qqbar2Wg&quot;</span><span class="p">,</span> <span class="s">&quot;WeakBosonAndParton:qg2Wq&quot;</span><span class="p">,</span>
    <span class="s">&quot;WeakBosonAndParton:ffbar2Wgm&quot;</span><span class="p">,</span> <span class="s">&quot;Charmonium:all&quot;</span><span class="p">,</span> <span class="s">&quot;Bottomonium:all&quot;</span><span class="p">,</span>
    <span class="s">&quot;Top:gg2ttbar&quot;</span><span class="p">,</span>  <span class="s">&quot;Top:qqbar2ttbar&quot;</span><span class="p">,</span>  <span class="s">&quot;Top:qq2tq(t:W)&quot;</span><span class="p">,</span>
    <span class="s">&quot;Top:ffbar2ttbar(s:gmZ)&quot;</span><span class="p">,</span> <span class="s">&quot;Top:ffbar2tqbar(s:W)&quot;</span><span class="p">,</span>
    <span class="s">&quot;HiggsSM:ffbar2H&quot;</span><span class="p">,</span> <span class="s">&quot;HiggsSM:gg2H&quot;</span><span class="p">,</span> <span class="s">&quot;HiggsSM:ffbar2HZ&quot;</span><span class="p">,</span>
    <span class="s">&quot;HiggsSM:ffbar2HW&quot;</span><span class="p">,</span> <span class="s">&quot;HiggsSM:ff2Hff(t:ZZ)&quot;</span><span class="p">,</span> <span class="s">&quot;HiggsSM:ff2Hff(t:WW)&quot;</span><span class="p">,</span>
    <span class="s">&quot;HiggsSM:qg2Hq&quot;</span><span class="p">,</span> <span class="s">&quot;HiggsSM:gg2Hg(l:t)&quot;</span><span class="p">,</span> <span class="s">&quot;HiggsSM:qg2Hq(l:t)&quot;</span><span class="p">,</span>
    <span class="s">&quot;HiggsSM:qqbar2Hg(l:t)&quot;</span><span class="p">,</span> <span class="s">&quot;HiggsBSM:allH1&quot;</span><span class="p">,</span> <span class="s">&quot;HiggsBSM:allH2&quot;</span><span class="p">,</span>
    <span class="s">&quot;HiggsBSM:allA3&quot;</span><span class="p">,</span> <span class="s">&quot;HiggsBSM:allH+-&quot;</span><span class="p">,</span> <span class="s">&quot;HiggsBSM:allHpair&quot;</span><span class="p">,</span>
    <span class="s">&quot;NewGaugeBoson:ffbar2gmZZprime&quot;</span><span class="p">,</span> <span class="s">&quot;NewGaugeBoson:ffbar2Wprime&quot;</span><span class="p">,</span>
    <span class="s">&quot;LeftRightSymmmetry:ffbar2ZR&quot;</span><span class="p">,</span> <span class="s">&quot;LeftRightSymmmetry:ffbar2WR&quot;</span><span class="p">,</span>
    <span class="s">&quot;LeftRightSymmmetry:ffbar2HLHL&quot;</span><span class="p">,</span> <span class="s">&quot;LeftRightSymmmetry:ffbar2HRHR&quot;</span><span class="p">,</span>
    <span class="s">&quot;LeptoQuark:all&quot;</span><span class="p">,</span> <span class="s">&quot;ExcitedFermion:dg2dStar&quot;</span><span class="p">,</span>
    <span class="s">&quot;ExcitedFermion:qq2dStarq&quot;</span><span class="p">,</span> <span class="s">&quot;ExcitedFermion:qqbar2eStare&quot;</span><span class="p">,</span>
    <span class="s">&quot;ExtraDimensionsG*:all&quot;</span> <span class="p">};</span>
  <span class="c1">// List of cross sections from Pythia6.</span>
  <span class="kt">double</span> <span class="n">sigma6</span><span class="p">[</span><span class="mi">57</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>   <span class="mf">4.960e-01</span><span class="p">,</span> <span class="mf">1.627e-02</span><span class="p">,</span> <span class="mf">2.790e-01</span><span class="p">,</span> <span class="mf">2.800e-02</span><span class="p">,</span>
    <span class="mf">3.310e-04</span><span class="p">,</span> <span class="mf">3.653e-04</span><span class="p">,</span> <span class="mf">1.697e-04</span><span class="p">,</span> <span class="mf">1.163e-05</span><span class="p">,</span> <span class="mf">1.065e-07</span><span class="p">,</span> <span class="mf">8.259e-08</span><span class="p">,</span>
    <span class="mf">8.237e-08</span><span class="p">,</span> <span class="mf">2.544e-05</span><span class="p">,</span> <span class="mf">5.321e-06</span><span class="p">,</span> <span class="mf">5.571e-05</span><span class="p">,</span> <span class="mf">1.621e-04</span><span class="p">,</span> <span class="mf">9.039e-09</span><span class="p">,</span>
    <span class="mf">2.247e-08</span><span class="p">,</span> <span class="mf">5.893e-08</span><span class="p">,</span> <span class="mf">3.781e-06</span><span class="p">,</span> <span class="mf">1.078e-05</span><span class="p">,</span> <span class="mf">4.551e-08</span><span class="p">,</span> <span class="mf">1.025e-05</span><span class="p">,</span>
    <span class="mf">3.208e-05</span><span class="p">,</span> <span class="mf">5.435e-08</span><span class="p">,</span> <span class="mf">1.038e-04</span><span class="p">,</span> <span class="mf">3.929e-05</span><span class="p">,</span> <span class="mf">4.155e-07</span><span class="p">,</span> <span class="mf">6.685e-08</span><span class="p">,</span>
    <span class="mf">1.898e-07</span><span class="p">,</span> <span class="mf">4.240e-10</span><span class="p">,</span> <span class="mf">7.142e-09</span><span class="p">,</span> <span class="mf">1.547e-10</span><span class="p">,</span> <span class="mf">7.064e-09</span><span class="p">,</span> <span class="mf">1.316e-10</span><span class="p">,</span>
    <span class="mf">2.332e-10</span><span class="p">,</span> <span class="mf">5.105e-10</span><span class="p">,</span> <span class="mf">1.316e-09</span><span class="p">,</span> <span class="mf">4.462e-11</span><span class="p">,</span> <span class="mf">5.557e-09</span><span class="p">,</span> <span class="mf">1.966e-09</span><span class="p">,</span>
    <span class="mf">8.725e-12</span><span class="p">,</span> <span class="mf">2.450e-08</span><span class="p">,</span> <span class="mf">5.839e-09</span><span class="p">,</span> <span class="mf">1.687e-08</span><span class="p">,</span> <span class="mf">8.950e-11</span><span class="p">,</span> <span class="mf">4.188e-11</span><span class="p">,</span>
    <span class="mf">1.980e-07</span><span class="p">,</span> <span class="mf">4.551e-07</span><span class="p">,</span> <span class="mf">6.005e-09</span><span class="p">,</span> <span class="mf">1.102e-07</span><span class="p">,</span> <span class="mf">7.784e-11</span><span class="p">,</span> <span class="mf">3.488e-11</span><span class="p">,</span>
    <span class="mf">6.006e-08</span><span class="p">,</span> <span class="mf">3.235e-06</span><span class="p">,</span> <span class="mf">1.689e-05</span><span class="p">,</span> <span class="mf">5.986e-07</span><span class="p">,</span> <span class="mf">3.241e-10</span> <span class="p">};</span>
  <span class="c1">// Generator.</span>
  <span class="n">Pythia</span> <span class="n">pythia</span><span class="p">;</span>
  <span class="c1">// Standard set of masses for comparison with Fortran code.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;5:m0  = 4.2&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;6:m0  = 175.&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;23:m0 = 91.2&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;24:m0 = 80.&quot;</span><span class="p">);</span>
  <span class="c1">// Same kinematics cuts as Fortran code.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;PhaseSpace:pTHatMin = 20.&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;6:mMin = 20.&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;23:mMin = 20.&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;24:mMin = 20.&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;25:mMin = 20.&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;32:mMin = 400.&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;34:mMin = 400.&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;42:mMin = 50.&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;5000039:mMin = 50.&quot;</span><span class="p">);</span>
  <span class="c1">// Also same renormalization and factorization scale.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;SigmaProcess:renormScale2 = 3&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;SigmaProcess:factorScale2 = 3&quot;</span><span class="p">);</span>
  <span class="c1">// Switch off unnecessary parts.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;PartonLevel:all = off&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;ProcessLevel:resonanceDecays = off&quot;</span><span class="p">);</span>
  <span class="c1">// No printing of settings, particle data or events.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Init:showProcesses = off&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Init:showChangedSettings = off&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Init:showChangedParticleData = off&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Next:numberCount = 0&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Next:numberShowInfo = 0&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Next:numberShowProcess = 0&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Next:numberShowEvent = 0&quot;</span><span class="p">);</span>
  <span class="c1">// Debug: show information on cross section maximum and violation.</span>
  <span class="c1">//pythia.readString(&quot;PhaseSpace:showSearch = on&quot;);</span>
  <span class="c1">//pythia.readString(&quot;PhaseSpace:showViolation = on&quot;);</span>
  <span class="c1">// Loop over processes.</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iProc</span> <span class="o">=</span> <span class="n">iFirst</span><span class="p">;</span> <span class="n">iProc</span> <span class="o">&lt;=</span> <span class="n">iLast</span><span class="p">;</span> <span class="o">++</span><span class="n">iProc</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s"> Begin subrun number &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">iProc</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; : &quot;</span><span class="p">;</span>
    <span class="c1">// Switch off previous process(es) and switch on new one(s).</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">iProc</span> <span class="o">&gt;</span> <span class="n">iFirst</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">iBeg</span><span class="p">[</span><span class="n">iProc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">iBeg</span><span class="p">[</span><span class="n">iProc</span><span class="p">];</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
      <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span> <span class="n">processes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot; = off&quot;</span> <span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">iBeg</span><span class="p">[</span><span class="n">iProc</span><span class="p">];</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">iBeg</span><span class="p">[</span><span class="n">iProc</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span> <span class="n">processes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot; = on&quot;</span> <span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;</span> <span class="n">iBeg</span><span class="p">[</span><span class="n">iProc</span><span class="p">])</span> <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; + &quot;</span><span class="p">;</span>
      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">processes</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="c1">// Switch between SM and MSSM Higgs scenario.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">iProc</span> <span class="o">&lt;=</span> <span class="mi">40</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Higgs:useBSM = off&quot;</span><span class="p">);</span>
      <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;25:m0 = 200.&quot;</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Higgs:useBSM = on&quot;</span><span class="p">);</span>
      <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;25:m0 = 115.&quot;</span><span class="p">);</span>
      <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;35:m0 = 300.&quot;</span><span class="p">);</span>
      <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;36:m0 = 300.&quot;</span><span class="p">);</span>
      <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;37:m0 = 320.&quot;</span><span class="p">);</span>
      <span class="c1">// With default option Higgs:clipWings = on need to reset mass range.</span>
      <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;25:mMin = 50.&quot;</span><span class="p">);</span>
      <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;25:mMax = 0.&quot;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="c1">// Initialize for LHC.</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Beams:eCM = 14000.&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
    <span class="c1">// Debug: show initialized resonance data first time around.</span>
    <span class="c1">//if (iProc == iFirst) pythia.particleData.listChanged(true);</span>
    <span class="c1">// Generate events to get cross section statistics.</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iEvent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iEvent</span> <span class="o">&lt;</span> <span class="n">nEvent</span><span class="p">;</span> <span class="o">++</span><span class="n">iEvent</span><span class="p">)</span> <span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
    <span class="c1">// Show statistics.</span>
    <span class="c1">//pythia.stat();</span>
    <span class="kt">double</span> <span class="n">sigma</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">sigmaGen</span><span class="p">();</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; Cross section is &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">scientific</span> <span class="o">&lt;&lt;</span> <span class="n">setprecision</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
         <span class="o">&lt;&lt;</span> <span class="n">sigma</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; and in Pythia6 was &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">sigma6</span><span class="p">[</span><span class="n">iProc</span><span class="p">]</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot;,</span><span class="se">\n</span><span class="s"> i.e. now is factor &gt;&gt;&gt; &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">fixed</span>
         <span class="o">&lt;&lt;</span> <span class="n">sigma</span> <span class="o">/</span> <span class="n">sigma6</span><span class="p">[</span><span class="n">iProc</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &lt;&lt;&lt; different&quot;</span> <span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
  <span class="c1">// End of loop over processes.</span>
  <span class="p">}</span>
  <span class="c1">// Done.</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
    </div>
  </div>
</div>

</div> <div class="well well-sm"> <h1 id="main15cc">main15.cc</h1><hr>
<div class="codehilite"><pre><span class="c1">// main15.cc is a part of the PYTHIA event generator.</span>
<span class="c1">// Copyright (C) 2016 Torbjorn Sjostrand.</span>
<span class="c1">// PYTHIA is licenced under the GNU GPL version 2, see COPYING for details.</span>
<span class="c1">// Please respect the MCnet Guidelines, see GUIDELINES for details.</span>
<span class="c1">// This is a simple test program.</span>
<span class="c1">// It illustrates how either</span>
<span class="c1">// (a) B decays (sections marked &quot;Repeated decays:), or</span>
<span class="c1">// (b) all hadronization (sections marked &quot;Repeated hadronization:&quot;)</span>
<span class="c1">// could be repeated a number of times for each event,</span>
<span class="c1">// to improve statistics when this could be a problem.</span>
<span class="c1">// Option (a) is faster than (b), but less generic.</span>
<span class="c1">// Note 1: the compartmentalization of hadronization in forceHadronLevel</span>
<span class="c1">// from the rest of the event processing somewhat limits the ways the</span>
<span class="c1">// program can retry in case of problems, and so an occasional abort</span>
<span class="c1">// may occur more easily than normally.</span>
<span class="c1">// Note 2: for simple cases, where it is only one particle that is to be</span>
<span class="c1">// decayed repeatedly, the event[i].undoDecay() method is handy.</span>
<span class="c1">// When used for several particles, remember that the position of</span>
<span class="c1">// some particles may be moved by the undoDecay step.</span>
</pre></div>


<div class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" href="#fileid14">Rest of the main15.cc code</a>
    </h4>
  </div>
  <div id="fileid14" class="panel-collapse collapse">
    <div class="panel-body">
<div class="codehilite"><pre><span class="cp">#include</span> <span class="cpf">&quot;Pythia8/Pythia.h&quot;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">Pythia8</span><span class="p">;</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Main switches: redo B decays only or redo all hadronization, but not both.</span>
  <span class="kt">bool</span> <span class="n">redoBDecays</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
  <span class="kt">bool</span> <span class="n">redoHadrons</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">redoHadrons</span><span class="p">)</span> <span class="n">redoBDecays</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
  <span class="c1">// Number of events. Number to list redone events.</span>
  <span class="kt">int</span> <span class="n">nEvent</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">nListRedo</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="c1">// Number of times decays/hadronization should be redone for each event.</span>
  <span class="kt">int</span> <span class="n">nRepeat</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">redoBDecays</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">redoHadrons</span><span class="p">)</span> <span class="n">nRepeat</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="c1">// Generator. Shorthand for event.</span>
  <span class="n">Pythia</span> <span class="n">pythia</span><span class="p">;</span>
  <span class="n">Event</span><span class="o">&amp;</span> <span class="n">event</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">;</span>
  <span class="c1">// Simulate b production above given pTmin scale.</span>
  <span class="c1">// Warning: these processes do not catch all possible production modes.</span>
  <span class="c1">// You would need to use HardQCD:all or even SoftQCD:nonDiffractive for that.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;HardQCD:gg2bbbar = on&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;HardQCD:qqbar2bbbar = on&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;PhaseSpace:pTHatMin = 50.&quot;</span><span class="p">);</span>
  <span class="c1">// Repeated decays: list of weakly decaying B hadrons.</span>
  <span class="c1">// Note: this list is overkill; some will never be produced.</span>
  <span class="kt">int</span> <span class="n">bCodes</span><span class="p">[</span><span class="mi">28</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">511</span><span class="p">,</span> <span class="mi">521</span><span class="p">,</span> <span class="mi">531</span><span class="p">,</span> <span class="mi">541</span><span class="p">,</span> <span class="mi">5122</span><span class="p">,</span> <span class="mi">5132</span><span class="p">,</span> <span class="mi">5142</span><span class="p">,</span> <span class="mi">5232</span><span class="p">,</span> <span class="mi">5242</span><span class="p">,</span>
    <span class="mi">5332</span><span class="p">,</span> <span class="mi">5342</span><span class="p">,</span> <span class="mi">5412</span><span class="p">,</span> <span class="mi">5414</span><span class="p">,</span> <span class="mi">5422</span><span class="p">,</span> <span class="mi">5424</span><span class="p">,</span> <span class="mi">5432</span><span class="p">,</span> <span class="mi">5434</span><span class="p">,</span> <span class="mi">5442</span><span class="p">,</span> <span class="mi">5444</span><span class="p">,</span> <span class="mi">5512</span><span class="p">,</span>
    <span class="mi">5514</span><span class="p">,</span> <span class="mi">5522</span><span class="p">,</span> <span class="mi">5524</span><span class="p">,</span> <span class="mi">5532</span><span class="p">,</span> <span class="mi">5534</span><span class="p">,</span> <span class="mi">5542</span><span class="p">,</span> <span class="mi">5544</span><span class="p">,</span> <span class="mi">5544</span> <span class="p">};</span>
  <span class="kt">int</span> <span class="n">nCodes</span> <span class="o">=</span> <span class="mi">28</span><span class="p">;</span>
  <span class="c1">// Repeated decays: location of B handrons.</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">iBHad</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">nBHad</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="c1">// Repeated hadronization: spare copy of event.</span>
  <span class="n">Event</span> <span class="n">savedEvent</span><span class="p">;</span>
  <span class="c1">// Repeated hadronization: switch off normal HadronLevel call.</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">redoHadrons</span><span class="p">)</span> <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;HadronLevel:all = off&quot;</span><span class="p">);</span>
  <span class="c1">// Initialize for LHC energies; default 14 TeV</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
  <span class="c1">// Histogram invariant mass of muon pairs.</span>
  <span class="n">Hist</span> <span class="n">nBperEvent</span><span class="p">(</span><span class="s">&quot;number of b quarks in an event&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">9.5</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">nSameEvent</span><span class="p">(</span><span class="s">&quot;number of times same event is used&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">9.5</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">oppSignMass</span><span class="p">(</span><span class="s">&quot;mass of opposite-sign muon pair&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">sameSignMass</span><span class="p">(</span><span class="s">&quot;mass of same-sign muon pair&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">);</span>
  <span class="c1">// Begin event loop.</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iEvent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iEvent</span> <span class="o">&lt;</span> <span class="n">nEvent</span><span class="p">;</span> <span class="o">++</span><span class="n">iEvent</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Repeated decays: switch off decays of weakly decaying B hadrons.</span>
    <span class="c1">// (More compact solution than repeated readString(..).)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">redoBDecays</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iC</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iC</span> <span class="o">&lt;</span> <span class="n">nCodes</span><span class="p">;</span> <span class="o">++</span><span class="n">iC</span><span class="p">)</span>
      <span class="n">pythia</span><span class="p">.</span><span class="n">particleData</span><span class="p">.</span><span class="n">mayDecay</span><span class="p">(</span> <span class="n">bCodes</span><span class="p">[</span><span class="n">iC</span><span class="p">],</span> <span class="nb">false</span><span class="p">);</span>
    <span class="c1">// Generate event. Skip it if error.</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">())</span> <span class="k">continue</span><span class="p">;</span>
    <span class="c1">// Find and histogram number of b quarks.</span>
    <span class="kt">int</span> <span class="n">nBquark</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">stat</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">event</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">stat</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">statusAbs</span><span class="p">();</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">idAbs</span><span class="p">()</span> <span class="o">==</span> <span class="mi">5</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">stat</span> <span class="o">==</span> <span class="mi">62</span> <span class="o">||</span> <span class="n">stat</span> <span class="o">==</span> <span class="mi">63</span><span class="p">))</span> <span class="o">++</span><span class="n">nBquark</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">nBperEvent</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">nBquark</span> <span class="p">);</span>
    <span class="c1">// Repeated decays: find all locations where B hadrons are stored.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">redoBDecays</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">iBHad</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
      <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">event</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">idAbs</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">idAbs</span><span class="p">();</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iC</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iC</span> <span class="o">&lt;</span> <span class="mi">28</span><span class="p">;</span> <span class="o">++</span><span class="n">iC</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">idAbs</span> <span class="o">==</span> <span class="n">bCodes</span><span class="p">[</span><span class="n">iC</span><span class="p">])</span> <span class="p">{</span>
          <span class="n">iBHad</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="c1">// Repeated decays: check that #b = #B.</span>
      <span class="n">nBHad</span> <span class="o">=</span> <span class="n">iBHad</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">nBquark</span> <span class="o">!=</span> <span class="n">nBHad</span><span class="p">)</span> <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; Warning: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">nBquark</span>
        <span class="o">&lt;&lt;</span> <span class="s">&quot; b quarks but &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">nBHad</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; B hadrons&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
      <span class="c1">// Repeated decays: store size of current event.</span>
      <span class="n">event</span><span class="p">.</span><span class="n">saveSize</span><span class="p">();</span>
      <span class="c1">// Repeated decays: switch back on weakly decaying B hadrons.</span>
      <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iC</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iC</span> <span class="o">&lt;</span> <span class="n">nCodes</span><span class="p">;</span> <span class="o">++</span><span class="n">iC</span><span class="p">)</span>
        <span class="n">pythia</span><span class="p">.</span><span class="n">particleData</span><span class="p">.</span><span class="n">mayDecay</span><span class="p">(</span> <span class="n">bCodes</span><span class="p">[</span><span class="n">iC</span><span class="p">],</span> <span class="nb">true</span><span class="p">);</span>
    <span class="c1">//  Repeated hadronization: copy event into spare position.</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">redoHadrons</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">savedEvent</span> <span class="o">=</span> <span class="n">event</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// Begin loop over rounds of decays / hadronization for same event.</span>
    <span class="kt">int</span> <span class="n">nWithPair</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iRepeat</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iRepeat</span> <span class="o">&lt;</span> <span class="n">nRepeat</span><span class="p">;</span> <span class="o">++</span><span class="n">iRepeat</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Repeated decays: remove B decay products from previous round.</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">redoBDecays</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">iRepeat</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">event</span><span class="p">.</span><span class="n">restoreSize</span><span class="p">();</span>
          <span class="c1">// Repeated decays: mark decayed B hadrons as undecayed.</span>
          <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iB</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iB</span> <span class="o">&lt;</span> <span class="n">nBHad</span><span class="p">;</span> <span class="o">++</span><span class="n">iB</span><span class="p">)</span> <span class="n">event</span><span class="p">[</span> <span class="n">iBHad</span><span class="p">[</span><span class="n">iB</span><span class="p">]</span> <span class="p">].</span><span class="n">statusPos</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="c1">// Repeated decays: do decays of B hadrons, sequentially for products.</span>
        <span class="c1">// Note: modeDecays does not work for bottomonium (or heavier) states,</span>
        <span class="c1">// since there decays like Upsilon -&gt; g g g also need hadronization.</span>
        <span class="c1">// Also, there is no provision for Bose-Einstein effects.</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pythia</span><span class="p">.</span><span class="n">moreDecays</span><span class="p">())</span> <span class="k">continue</span><span class="p">;</span>
      <span class="c1">// Repeated hadronization: restore saved event record.</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">redoHadrons</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">iRepeat</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="n">event</span> <span class="o">=</span> <span class="n">savedEvent</span><span class="p">;</span>
        <span class="c1">// Repeated hadronization: do HadronLevel (repeatedly).</span>
        <span class="c1">// Note: argument false needed owing to bug in junction search??</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pythia</span><span class="p">.</span><span class="n">forceHadronLevel</span><span class="p">(</span><span class="nb">false</span><span class="p">))</span> <span class="k">continue</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="c1">// List last repetition of first few events.</span>
      <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="n">redoBDecays</span> <span class="o">||</span> <span class="n">redoHadrons</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">iEvent</span> <span class="o">&lt;</span> <span class="n">nListRedo</span>
        <span class="o">&amp;&amp;</span> <span class="n">iRepeat</span> <span class="o">==</span> <span class="n">nRepeat</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="n">event</span><span class="p">.</span><span class="n">list</span><span class="p">();</span>
      <span class="c1">// Look for muons among decay products (also from charm/tau/...).</span>
      <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">iMuNeg</span><span class="p">,</span> <span class="n">iMuPos</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">event</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">id</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">id</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">id</span> <span class="o">==</span>  <span class="mi">13</span><span class="p">)</span> <span class="n">iMuNeg</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">id</span> <span class="o">==</span> <span class="o">-</span><span class="mi">13</span><span class="p">)</span> <span class="n">iMuPos</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="c1">// Check whether pair(s) present.</span>
      <span class="kt">int</span> <span class="n">nMuNeg</span> <span class="o">=</span> <span class="n">iMuNeg</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
      <span class="kt">int</span> <span class="n">nMuPos</span> <span class="o">=</span> <span class="n">iMuPos</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">nMuNeg</span> <span class="o">+</span> <span class="n">nMuPos</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="o">++</span><span class="n">nWithPair</span><span class="p">;</span>
        <span class="c1">// Fill masses of opposite-sign pairs.</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iN</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iN</span> <span class="o">&lt;</span> <span class="n">nMuNeg</span><span class="p">;</span> <span class="o">++</span><span class="n">iN</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iP</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iP</span> <span class="o">&lt;</span> <span class="n">nMuPos</span><span class="p">;</span> <span class="o">++</span><span class="n">iP</span><span class="p">)</span>
          <span class="n">oppSignMass</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span>
            <span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="n">iMuNeg</span><span class="p">[</span><span class="n">iN</span><span class="p">]].</span><span class="n">p</span><span class="p">()</span> <span class="o">+</span> <span class="n">event</span><span class="p">[</span><span class="n">iMuPos</span><span class="p">[</span><span class="n">iP</span><span class="p">]].</span><span class="n">p</span><span class="p">()).</span><span class="n">mCalc</span><span class="p">()</span> <span class="p">);</span>
        <span class="c1">// Fill masses of same-sign pairs.</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i1</span> <span class="o">&lt;</span> <span class="n">nMuNeg</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="o">++</span><span class="n">i1</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i2</span> <span class="o">=</span> <span class="n">i1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i2</span> <span class="o">&lt;</span> <span class="n">nMuNeg</span><span class="p">;</span> <span class="o">++</span><span class="n">i2</span><span class="p">)</span>
          <span class="n">sameSignMass</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span>
            <span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="n">iMuNeg</span><span class="p">[</span><span class="n">i1</span><span class="p">]].</span><span class="n">p</span><span class="p">()</span> <span class="o">+</span> <span class="n">event</span><span class="p">[</span><span class="n">iMuNeg</span><span class="p">[</span><span class="n">i2</span><span class="p">]].</span><span class="n">p</span><span class="p">()).</span><span class="n">mCalc</span><span class="p">()</span> <span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i1</span> <span class="o">&lt;</span> <span class="n">nMuPos</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="o">++</span><span class="n">i1</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i2</span> <span class="o">=</span> <span class="n">i1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i2</span> <span class="o">&lt;</span> <span class="n">nMuPos</span><span class="p">;</span> <span class="o">++</span><span class="n">i2</span><span class="p">)</span>
          <span class="n">sameSignMass</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span>
            <span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="n">iMuPos</span><span class="p">[</span><span class="n">i1</span><span class="p">]].</span><span class="n">p</span><span class="p">()</span> <span class="o">+</span> <span class="n">event</span><span class="p">[</span><span class="n">iMuPos</span><span class="p">[</span><span class="n">i2</span><span class="p">]].</span><span class="n">p</span><span class="p">()).</span><span class="n">mCalc</span><span class="p">()</span> <span class="p">);</span>
      <span class="c1">// Finished analysis of current round.</span>
      <span class="p">}</span>
    <span class="c1">// End of loop over many rounds. fill number of rounds with pairs.</span>
    <span class="p">}</span>
    <span class="n">nSameEvent</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">nWithPair</span> <span class="p">);</span>
  <span class="c1">// End of event loop.</span>
  <span class="p">}</span>
  <span class="c1">// Statistics. Histograms.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">nBperEvent</span> <span class="o">&lt;&lt;</span> <span class="n">nSameEvent</span> <span class="o">&lt;&lt;</span> <span class="n">oppSignMass</span> <span class="o">&lt;&lt;</span> <span class="n">sameSignMass</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="c1">// Done.</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
    </div>
  </div>
</div>

</div> <div class="well well-sm"> <h1 id="main16cc">main16.cc</h1><hr>
<div class="codehilite"><pre><span class="c1">// main16.cc is a part of the PYTHIA event generator.</span>
<span class="c1">// Copyright (C) 2016 Torbjorn Sjostrand.</span>
<span class="c1">// PYTHIA is licenced under the GNU GPL version 2, see COPYING for details.</span>
<span class="c1">// Please respect the MCnet Guidelines, see GUIDELINES for details.</span>
<span class="c1">// This is a simple test program.</span>
<span class="c1">// It illustrates (a) how to collect the analysis code in a separate class</span>
<span class="c1">// and (b) how to provide the .cmnd filename on the command line</span>
<span class="c1">// Once you have linked the main program you can run it with a command line</span>
<span class="c1">// ./main16.exe main16.cmnd &gt; out16</span>
</pre></div>


<div class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" href="#fileid15">Rest of the main16.cc code</a>
    </h4>
  </div>
  <div id="fileid15" class="panel-collapse collapse">
    <div class="panel-body">
<div class="codehilite"><pre><span class="cp">#include</span> <span class="cpf">&quot;Pythia8/Pythia.h&quot;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">Pythia8</span><span class="p">;</span>
<span class="c1">//==========================================================================</span>
<span class="c1">// Put all your own analysis code in the myAnalysis class.</span>
<span class="k">class</span> <span class="nc">MyAnalysis</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="c1">// Constructor can be empty.</span>
  <span class="n">MyAnalysis</span><span class="p">()</span> <span class="p">{}</span>
  <span class="c1">// Initialization actions.</span>
  <span class="kt">void</span> <span class="n">init</span><span class="p">();</span>
  <span class="c1">// Analysis of each new event.</span>
  <span class="kt">void</span> <span class="nf">analyze</span><span class="p">(</span><span class="n">Event</span><span class="o">&amp;</span> <span class="n">event</span><span class="p">);</span>
  <span class="c1">// Show final results.</span>
  <span class="kt">void</span> <span class="nf">finish</span><span class="p">();</span>
<span class="k">private</span><span class="o">:</span>
  <span class="c1">// Declare variables and objects that span init - analyze - finish.</span>
  <span class="kt">int</span>  <span class="n">nEvt</span><span class="p">;</span>
  <span class="n">Hist</span> <span class="n">brH</span><span class="p">,</span> <span class="n">yH</span><span class="p">,</span> <span class="n">etaChg</span><span class="p">,</span> <span class="n">mult</span><span class="p">;</span>
<span class="p">};</span>
<span class="c1">//--------------------------------------------------------------------------</span>
<span class="c1">// The initialization code.</span>
<span class="kt">void</span> <span class="n">MyAnalysis</span><span class="o">::</span><span class="n">init</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Initialize counter for number of events.</span>
  <span class="n">nEvt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="c1">// Book histograms.</span>
  <span class="n">brH</span><span class="p">.</span><span class="n">book</span><span class="p">(</span><span class="s">&quot;Higgs branching ratios by flavour&quot;</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">29.5</span><span class="p">);</span>
  <span class="n">yH</span><span class="p">.</span><span class="n">book</span><span class="p">(</span><span class="s">&quot;Higgs rapidity&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.</span><span class="p">,</span> <span class="mf">10.</span><span class="p">);</span>
  <span class="n">etaChg</span><span class="p">.</span><span class="n">book</span><span class="p">(</span><span class="s">&quot;charged pseudorapidity&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.</span><span class="p">,</span> <span class="mf">10.</span><span class="p">);</span>
  <span class="n">mult</span><span class="p">.</span><span class="n">book</span><span class="p">(</span> <span class="s">&quot;charged multiplicity&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">799.5</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">//--------------------------------------------------------------------------</span>
<span class="c1">// The event analysis code.</span>
<span class="kt">void</span> <span class="n">MyAnalysis</span><span class="o">::</span><span class="n">analyze</span><span class="p">(</span><span class="n">Event</span><span class="o">&amp;</span> <span class="n">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Increase counter.</span>
  <span class="o">++</span><span class="n">nEvt</span><span class="p">;</span>
  <span class="c1">// Find latest copy of Higgs and plot its rapidity.</span>
  <span class="kt">int</span> <span class="n">iH</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">event</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">id</span><span class="p">()</span> <span class="o">==</span> <span class="mi">25</span><span class="p">)</span> <span class="n">iH</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
  <span class="n">yH</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">event</span><span class="p">[</span><span class="n">iH</span><span class="p">].</span><span class="n">y</span><span class="p">()</span> <span class="p">);</span>
  <span class="c1">// Plot flavour of decay channel.</span>
  <span class="kt">int</span> <span class="n">idDau1</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span> <span class="n">event</span><span class="p">[</span><span class="n">iH</span><span class="p">].</span><span class="n">daughter1</span><span class="p">()</span> <span class="p">].</span><span class="n">idAbs</span><span class="p">();</span>
  <span class="kt">int</span> <span class="n">idDau2</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span> <span class="n">event</span><span class="p">[</span><span class="n">iH</span><span class="p">].</span><span class="n">daughter2</span><span class="p">()</span> <span class="p">].</span><span class="n">idAbs</span><span class="p">();</span>
  <span class="kt">int</span> <span class="n">iChan</span>  <span class="o">=</span> <span class="mi">29</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">idDau2</span> <span class="o">==</span> <span class="n">idDau1</span> <span class="o">&amp;&amp;</span> <span class="n">idDau1</span> <span class="o">&lt;</span> <span class="mi">25</span><span class="p">)</span> <span class="n">iChan</span> <span class="o">=</span> <span class="n">idDau1</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">min</span><span class="p">(</span> <span class="n">idDau1</span><span class="p">,</span> <span class="n">idDau2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">22</span> <span class="o">&amp;&amp;</span> <span class="n">max</span><span class="p">(</span> <span class="n">idDau1</span><span class="p">,</span> <span class="n">idDau2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">23</span><span class="p">)</span> <span class="n">iChan</span> <span class="o">=</span> <span class="mi">26</span><span class="p">;</span>
  <span class="n">brH</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">iChan</span><span class="p">);</span>
  <span class="c1">// Plot pseudorapidity distribution. Sum up charged multiplicity.</span>
  <span class="kt">int</span> <span class="n">nChg</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">event</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">isFinal</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">isCharged</span><span class="p">())</span> <span class="p">{</span>
    <span class="n">etaChg</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">eta</span><span class="p">()</span> <span class="p">);</span>
    <span class="o">++</span><span class="n">nChg</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">mult</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">nChg</span> <span class="p">);</span>
<span class="p">}</span>
<span class="c1">//--------------------------------------------------------------------------</span>
<span class="c1">// The finishing code.</span>
<span class="kt">void</span> <span class="n">MyAnalysis</span><span class="o">::</span><span class="n">finish</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Normalize histograms.</span>
  <span class="kt">double</span> <span class="n">binFactor</span> <span class="o">=</span> <span class="mf">5.</span> <span class="o">/</span> <span class="n">nEvt</span><span class="p">;</span>
  <span class="n">yH</span>     <span class="o">*=</span> <span class="n">binFactor</span><span class="p">;</span>
  <span class="n">etaChg</span> <span class="o">*=</span> <span class="n">binFactor</span><span class="p">;</span>
  <span class="c1">// Print histograms.</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">brH</span> <span class="o">&lt;&lt;</span> <span class="n">yH</span> <span class="o">&lt;&lt;</span> <span class="n">etaChg</span> <span class="o">&lt;&lt;</span> <span class="n">mult</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">//==========================================================================</span>
<span class="c1">// You should not need to touch the main program: its actions are</span>
<span class="c1">// determined by the .cmnd file and the rest belongs in MyAnalysis.</span>
<span class="kt">int</span> <span class="n">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
  <span class="c1">// Check that correct number of command-line arguments</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; Unexpected number of command-line arguments. </span><span class="se">\n</span><span class="s">&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; You are expected to provide a file name and nothing else. </span><span class="se">\n</span><span class="s">&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; Program stopped! &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// Check that the provided file name corresponds to an existing file.</span>
  <span class="n">ifstream</span> <span class="n">is</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">is</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; Command-line file &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; was not found. </span><span class="se">\n</span><span class="s">&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; Program stopped! &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// Confirm that external file will be used for settings..</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; PYTHIA settings will be read from file &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="c1">// Declare generator. Read in commands from external file.</span>
  <span class="n">Pythia</span> <span class="n">pythia</span><span class="p">;</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readFile</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
  <span class="c1">// Initialization.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
  <span class="c1">// Declare user analysis class. Do initialization part of it.</span>
  <span class="n">MyAnalysis</span> <span class="n">myAnalysis</span><span class="p">;</span>
  <span class="n">myAnalysis</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
  <span class="c1">// Read in number of event and maximal number of aborts.</span>
  <span class="kt">int</span> <span class="n">nEvent</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Main:numberOfEvents&quot;</span><span class="p">);</span>
  <span class="kt">int</span> <span class="n">nAbort</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Main:timesAllowErrors&quot;</span><span class="p">);</span>
  <span class="kt">bool</span> <span class="n">hasPL</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;PartonLevel:all&quot;</span><span class="p">);</span>
  <span class="c1">// Begin event loop.</span>
  <span class="kt">int</span> <span class="n">iAbort</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iEvent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iEvent</span> <span class="o">&lt;</span> <span class="n">nEvent</span><span class="p">;</span> <span class="o">++</span><span class="n">iEvent</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Generate events. Quit if too many failures.</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">())</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">++</span><span class="n">iAbort</span> <span class="o">&lt;</span> <span class="n">nAbort</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; Event generation aborted prematurely, owing to error!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// User Analysis of current event.</span>
    <span class="n">myAnalysis</span><span class="p">.</span><span class="n">analyze</span><span class="p">(</span> <span class="p">(</span><span class="n">hasPL</span> <span class="o">?</span> <span class="n">pythia</span><span class="p">.</span><span class="nl">event</span> <span class="p">:</span> <span class="n">pythia</span><span class="p">.</span><span class="n">process</span><span class="p">)</span> <span class="p">);</span>
  <span class="c1">// End of event loop.</span>
  <span class="p">}</span>
  <span class="c1">// Final statistics.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
  <span class="c1">// User finishing.</span>
  <span class="n">myAnalysis</span><span class="p">.</span><span class="n">finish</span><span class="p">();</span>
  <span class="c1">// Done.</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
    </div>
  </div>
</div>

</div> <div class="well well-sm"> <h1 id="main17cc">main17.cc</h1><hr>
<div class="codehilite"><pre><span class="c1">// main17.cc is a part of the PYTHIA event generator.</span>
<span class="c1">// Copyright (C) 2016 Torbjorn Sjostrand.</span>
<span class="c1">// PYTHIA is licenced under the GNU GPL version 2, see COPYING for details.</span>
<span class="c1">// Please respect the MCnet Guidelines, see GUIDELINES for details.</span>
<span class="c1">// This is a simple test program.</span>
<span class="c1">// It illustrates</span>
<span class="c1">// (a) how to use UserHooks to regularize onium cross section for pT -&gt; 0,</span>
<span class="c1">// (b) how decays could be handled externally.</span>
</pre></div>


<div class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" href="#fileid16">Rest of the main17.cc code</a>
    </h4>
  </div>
  <div id="fileid16" class="panel-collapse collapse">
    <div class="panel-body">
<div class="codehilite"><pre><span class="cp">#include</span> <span class="cpf">&quot;Pythia8/Pythia.h&quot;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">Pythia8</span><span class="p">;</span>
<span class="c1">//==========================================================================</span>
<span class="c1">// A derived class to do J/psi decays.</span>
<span class="k">class</span> <span class="nc">JpsiDecay</span> <span class="o">:</span> <span class="k">public</span> <span class="n">DecayHandler</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="c1">// Constructor.</span>
  <span class="n">JpsiDecay</span><span class="p">(</span><span class="n">ParticleData</span><span class="o">*</span> <span class="n">pdtPtrIn</span><span class="p">,</span> <span class="n">Rndm</span><span class="o">*</span> <span class="n">rndmPtrIn</span><span class="p">)</span> <span class="p">{</span><span class="n">times</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">pdtPtr</span> <span class="o">=</span> <span class="n">pdtPtrIn</span><span class="p">;</span> <span class="n">rndmPtr</span> <span class="o">=</span> <span class="n">rndmPtrIn</span><span class="p">;}</span>
  <span class="c1">// Routine for doing the decay.</span>
  <span class="kt">bool</span> <span class="n">decay</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&amp;</span> <span class="n">idProd</span><span class="p">,</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;&amp;</span> <span class="n">mProd</span><span class="p">,</span>
    <span class="n">vector</span><span class="o">&lt;</span><span class="n">Vec4</span><span class="o">&gt;&amp;</span> <span class="n">pProd</span><span class="p">,</span> <span class="kt">int</span> <span class="n">iDec</span><span class="p">,</span> <span class="k">const</span> <span class="n">Event</span><span class="o">&amp;</span> <span class="n">event</span><span class="p">);</span>
<span class="k">private</span><span class="o">:</span>
  <span class="c1">// Count number of times JpsiDecay is called.</span>
  <span class="kt">int</span> <span class="n">times</span><span class="p">;</span>
  <span class="c1">// Pointer to the particle data table.</span>
  <span class="n">ParticleData</span><span class="o">*</span> <span class="n">pdtPtr</span><span class="p">;</span>
  <span class="c1">// Pointer to the random number generator.</span>
  <span class="n">Rndm</span><span class="o">*</span> <span class="n">rndmPtr</span><span class="p">;</span>
<span class="p">};</span>
<span class="c1">//--------------------------------------------------------------------------</span>
<span class="c1">// The actual J/psi decay routine.</span>
<span class="c1">// Not intended for realism, just to illustrate the principles.</span>
<span class="kt">bool</span> <span class="n">JpsiDecay</span><span class="o">::</span><span class="n">decay</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&amp;</span> <span class="n">idProd</span><span class="p">,</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;&amp;</span> <span class="n">mProd</span><span class="p">,</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="n">Vec4</span><span class="o">&gt;&amp;</span> <span class="n">pProd</span><span class="p">,</span> <span class="kt">int</span> <span class="n">iDec</span><span class="p">,</span> <span class="k">const</span> <span class="n">Event</span><span class="o">&amp;</span> <span class="n">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Always do decay J/psi -&gt; mu+ mu-; store the muons.</span>
  <span class="n">idProd</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="o">-</span><span class="mi">13</span><span class="p">);</span>
  <span class="n">idProd</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="mi">13</span><span class="p">);</span>
  <span class="c1">// Muon mass(es), here from Pythia tables, also stored.</span>
  <span class="kt">double</span> <span class="n">mMuon</span> <span class="o">=</span> <span class="n">pdtPtr</span><span class="o">-&gt;</span><span class="n">m0</span><span class="p">(</span><span class="mi">13</span><span class="p">);</span>
  <span class="n">mProd</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">mMuon</span><span class="p">);</span>
  <span class="n">mProd</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">mMuon</span><span class="p">);</span>
  <span class="c1">// Calculate muon energy and momentum in J/psi rest frame.</span>
  <span class="kt">double</span> <span class="n">eMuon</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">mProd</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
  <span class="kt">double</span> <span class="n">pAbsMuon</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">eMuon</span> <span class="o">*</span> <span class="n">eMuon</span> <span class="o">-</span> <span class="n">mMuon</span> <span class="o">*</span> <span class="n">mMuon</span><span class="p">);</span>
  <span class="c1">// Assume decay angles isotropic in rest frame.</span>
  <span class="kt">double</span> <span class="n">cosTheta</span> <span class="o">=</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">rndmPtr</span><span class="o">-&gt;</span><span class="n">flat</span><span class="p">()</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">;</span>
  <span class="kt">double</span> <span class="n">sinTheta</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span> <span class="o">-</span> <span class="n">cosTheta</span> <span class="o">*</span> <span class="n">cosTheta</span><span class="p">));</span>
  <span class="kt">double</span> <span class="n">phi</span> <span class="o">=</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">M_PI</span> <span class="o">*</span> <span class="n">rndmPtr</span><span class="o">-&gt;</span><span class="n">flat</span><span class="p">();</span>
  <span class="kt">double</span> <span class="n">pxMuon</span> <span class="o">=</span> <span class="n">pAbsMuon</span> <span class="o">*</span> <span class="n">sinTheta</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">);</span>
  <span class="kt">double</span> <span class="n">pyMuon</span> <span class="o">=</span> <span class="n">pAbsMuon</span> <span class="o">*</span> <span class="n">sinTheta</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">);</span>
  <span class="kt">double</span> <span class="n">pzMuon</span> <span class="o">=</span> <span class="n">pAbsMuon</span> <span class="o">*</span> <span class="n">cosTheta</span><span class="p">;</span>
  <span class="c1">// Define mu+ and mu- four-vectors in the J/psi rest frame.</span>
  <span class="n">Vec4</span> <span class="nf">pMuPlus</span><span class="p">(</span>   <span class="n">pxMuon</span><span class="p">,</span>  <span class="n">pyMuon</span><span class="p">,</span>  <span class="n">pzMuon</span><span class="p">,</span> <span class="n">eMuon</span><span class="p">);</span>
  <span class="n">Vec4</span> <span class="nf">pMuMinus</span><span class="p">(</span> <span class="o">-</span><span class="n">pxMuon</span><span class="p">,</span> <span class="o">-</span><span class="n">pyMuon</span><span class="p">,</span> <span class="o">-</span><span class="n">pzMuon</span><span class="p">,</span> <span class="n">eMuon</span><span class="p">);</span>
  <span class="c1">// Boost them by velocity vector of the J/psi mother and store.</span>
  <span class="n">pMuPlus</span><span class="p">.</span><span class="n">bst</span><span class="p">(</span><span class="n">pProd</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
  <span class="n">pMuMinus</span><span class="p">.</span><span class="n">bst</span><span class="p">(</span><span class="n">pProd</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
  <span class="n">pProd</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">pMuPlus</span><span class="p">);</span>
  <span class="n">pProd</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">pMuMinus</span><span class="p">);</span>
  <span class="c1">// Print message the first few times, to show that it works.</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">times</span><span class="o">++</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">iMother</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="n">iDec</span><span class="p">].</span><span class="n">mother1</span><span class="p">();</span>
    <span class="kt">int</span> <span class="n">idMother</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="n">iMother</span><span class="p">].</span><span class="n">id</span><span class="p">();</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s"> J/psi decay performed, J/psi in line &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">iDec</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot;, mother id = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">idMother</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// Done</span>
  <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">//==========================================================================</span>
<span class="kt">int</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Number of events to generate and to list. Max number of errors.</span>
  <span class="kt">int</span> <span class="n">nEvent</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">nList</span>  <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">nAbort</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
  <span class="c1">// Pythia generator.</span>
  <span class="n">Pythia</span> <span class="n">pythia</span><span class="p">;</span>
  <span class="c1">// Initialization for charmonium (singlet+octet) production at the LHC.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Charmonium:all = on&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Beams:eCM = 7000.&quot;</span><span class="p">);</span>
  <span class="c1">// Normally cutoff at pTHat = 1, but push it lower combined with dampening.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;PhaseSpace:pTHatMin = 0.5&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;PhaseSpace:pTHatMinDiverge = 0.5&quot;</span><span class="p">);</span>
  <span class="c1">// Set up to do a user veto and send it in.</span>
  <span class="c1">// First argument: multiplies the pT0 of multiparton interactions</span>
  <span class="c1">// to define the pT dampeing scale.</span>
  <span class="c1">// Second argument: howe many powers of alpha_strong to</span>
  <span class="c1">// reweight with new (larger) argument.</span>
  <span class="c1">// Third argument: choice of process scale two different ways;</span>
  <span class="c1">// probably does not make much difference.</span>
  <span class="c1">// See &quot;User Hooks&quot; in manual for detail on SuppressSmallPT.</span>
  <span class="n">UserHooks</span><span class="o">*</span> <span class="n">oniumUserHook</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SuppressSmallPT</span><span class="p">(</span> <span class="mf">1.</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">setUserHooksPtr</span><span class="p">(</span> <span class="n">oniumUserHook</span><span class="p">);</span>
  <span class="c1">// A class to do J/psi decays externally.</span>
  <span class="n">DecayHandler</span><span class="o">*</span> <span class="n">handleDecays</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JpsiDecay</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pythia</span><span class="p">.</span><span class="n">particleData</span><span class="p">,</span>
    <span class="o">&amp;</span><span class="n">pythia</span><span class="p">.</span><span class="n">rndm</span><span class="p">);</span>
  <span class="c1">// The list of particles the class can handle.</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">handledParticles</span><span class="p">;</span>
  <span class="n">handledParticles</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="mi">443</span><span class="p">);</span>
  <span class="c1">// Hand pointer and list to Pythia.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">setDecayPtr</span><span class="p">(</span> <span class="n">handleDecays</span><span class="p">,</span> <span class="n">handledParticles</span><span class="p">);</span>
  <span class="c1">// Switch off automatic event listing in favour of manual.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Next:numberShowInfo = 0&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Next:numberShowProcess = 0&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Next:numberShowEvent = 0&quot;</span><span class="p">);</span>
  <span class="c1">// Initialization.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
  <span class="c1">// Book histograms.</span>
  <span class="n">Hist</span> <span class="nf">pThard</span><span class="p">(</span><span class="s">&quot;pTHat of hard subprocess&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">50.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="nf">pTJPsi</span><span class="p">(</span><span class="s">&quot;pT of J/Psi&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">50.</span><span class="p">);</span>
  <span class="c1">// Begin event loop.</span>
  <span class="kt">int</span> <span class="n">iList</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">iAbort</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iEvent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iEvent</span> <span class="o">&lt;</span> <span class="n">nEvent</span><span class="p">;</span> <span class="o">++</span><span class="n">iEvent</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Generate events. Quit if many failures.</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">())</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">++</span><span class="n">iAbort</span> <span class="o">&lt;</span> <span class="n">nAbort</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; Event generation aborted prematurely, owing to error!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// Histogram pThard spectrum of process.</span>
    <span class="kt">double</span> <span class="n">pTHat</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">pTHat</span><span class="p">();</span>
    <span class="n">pThard</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">pTHat</span> <span class="p">);</span>
    <span class="c1">// Look for event with externally handled decays.</span>
    <span class="kt">bool</span> <span class="n">externalDecay</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
      <span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">statusAbs</span><span class="p">();</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">==</span> <span class="mi">93</span> <span class="o">||</span> <span class="n">status</span> <span class="o">==</span> <span class="mi">94</span><span class="p">)</span> <span class="p">{</span><span class="n">externalDecay</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span> <span class="k">break</span><span class="p">;}</span>
    <span class="p">}</span>
    <span class="c1">// List first few events with external decay.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">externalDecay</span> <span class="o">&amp;&amp;</span> <span class="o">++</span><span class="n">iList</span> <span class="o">&lt;=</span> <span class="n">nList</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">pythia</span><span class="p">.</span><span class="n">process</span><span class="p">.</span><span class="n">list</span><span class="p">();</span>
      <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="n">list</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="c1">// Histogram pT spectrum of J/Psi.</span>
   <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">id</span><span class="p">()</span> <span class="o">==</span> <span class="mi">443</span><span class="p">)</span> <span class="n">pTJPsi</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pT</span><span class="p">()</span> <span class="p">);</span>
  <span class="c1">// End of event loop.</span>
  <span class="p">}</span>
  <span class="c1">// Final statistics. Print histograms.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">pThard</span> <span class="o">&lt;&lt;</span> <span class="n">pTJPsi</span><span class="p">;</span>
  <span class="c1">// Done.</span>
  <span class="k">delete</span> <span class="n">handleDecays</span><span class="p">;</span>
  <span class="k">delete</span> <span class="n">oniumUserHook</span><span class="p">;</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
    </div>
  </div>
</div>

</div> <div class="well well-sm"> <h1 id="main18cc">main18.cc</h1><hr>
<div class="codehilite"><pre><span class="c1">// main18.cc is a part of the PYTHIA event generator.</span>
<span class="c1">// Copyright (C) 2016 Torbjorn Sjostrand.</span>
<span class="c1">// PYTHIA is licenced under the GNU GPL version 2, see COPYING for details.</span>
<span class="c1">// Please respect the MCnet Guidelines, see GUIDELINES for details.</span>
<span class="c1">// This is a simple test program.</span>
<span class="c1">// It illustrates how to write an event filter.</span>
<span class="c1">// No new functionality is involved - all could be done in the main program</span>
<span class="c1">// - but the division of tasks may be more convenient for recurrent cuts.</span>
</pre></div>


<div class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" href="#fileid17">Rest of the main18.cc code</a>
    </h4>
  </div>
  <div id="fileid17" class="panel-collapse collapse">
    <div class="panel-body">
<div class="codehilite"><pre><span class="cp">#include</span> <span class="cpf">&quot;Pythia8/Pythia.h&quot;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">Pythia8</span><span class="p">;</span>
<span class="c1">//==========================================================================</span>
<span class="c1">// The EventFilter class.</span>
<span class="c1">// The constructor takes the following arguments</span>
<span class="c1">// select = 1 : keep only final particles.</span>
<span class="c1">//        = 2 : keep only final visible particles (i.e. not neutrinos).</span>
<span class="c1">//        = 3 : keep only final charged particles.</span>
<span class="c1">// etaMax (default = 50) : keep only particles with pseudorapidity</span>
<span class="c1">//        |eta| &lt; etaMax.</span>
<span class="c1">// pTminCharged (default = 0) : keep a charged particle only if</span>
<span class="c1">//        its transverse momentum pT &lt; pTminCharged.</span>
<span class="c1">// pTminNeutral (default = 0) : keep a neutral particle only if</span>
<span class="c1">//        its transverse momentum pT &lt; pTminNeutral.</span>
<span class="c1">// Main methods:</span>
<span class="c1">// filter( event) takes an event record as input and analyzes it.</span>
<span class="c1">// size() returns the number of particles kept.</span>
<span class="c1">// index(i) returns the index in the full event of the i&#39;th kept particle.</span>
<span class="c1">// particlePtr(i) returns a pointer to the i&#39;th kept particle.</span>
<span class="c1">// particleRef(i) returns a reference to the i&#39;th kept particle.</span>
<span class="c1">// list() gives a listing of the kept particles only.</span>
<span class="k">class</span> <span class="nc">EventFilter</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="c1">// Constructor sets properties of filter.</span>
  <span class="n">EventFilter</span><span class="p">(</span> <span class="kt">int</span> <span class="n">selectIn</span><span class="p">,</span> <span class="kt">double</span> <span class="n">etaMaxIn</span> <span class="o">=</span> <span class="mf">50.</span><span class="p">,</span>
    <span class="kt">double</span> <span class="n">pTminChargedIn</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">,</span> <span class="kt">double</span> <span class="n">pTminNeutralIn</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">)</span>
    <span class="o">:</span> <span class="n">select</span><span class="p">(</span><span class="n">selectIn</span><span class="p">),</span> <span class="n">etaMax</span><span class="p">(</span><span class="n">etaMaxIn</span><span class="p">),</span> <span class="n">pTminCharged</span><span class="p">(</span><span class="n">pTminChargedIn</span><span class="p">),</span>
    <span class="n">pTminNeutral</span><span class="p">(</span><span class="n">pTminNeutralIn</span><span class="p">)</span> <span class="p">{}</span>
  <span class="c1">// Analysis of each new event to find acceptable particles.</span>
  <span class="kt">void</span> <span class="n">filter</span><span class="p">(</span><span class="n">Event</span><span class="o">&amp;</span> <span class="n">event</span><span class="p">);</span>
  <span class="c1">// Return size of array, and index of a particle.</span>
  <span class="kt">int</span> <span class="nf">size</span><span class="p">()</span>       <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="n">keptPtrs</span><span class="p">.</span><span class="n">size</span><span class="p">();}</span>
  <span class="kt">int</span> <span class="nf">index</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="n">keptIndx</span><span class="p">[</span><span class="n">i</span><span class="p">];}</span>
  <span class="c1">// Return pointer or reference to a particle.</span>
  <span class="n">Particle</span><span class="o">*</span> <span class="nf">particlePtr</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span><span class="k">return</span>  <span class="n">keptPtrs</span><span class="p">[</span><span class="n">i</span><span class="p">];}</span>
  <span class="n">Particle</span><span class="o">&amp;</span> <span class="n">particleRef</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span><span class="k">return</span> <span class="o">*</span><span class="n">keptPtrs</span><span class="p">[</span><span class="n">i</span><span class="p">];}</span>
  <span class="c1">// List kept particles only.</span>
  <span class="kt">void</span> <span class="n">list</span><span class="p">(</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="n">os</span> <span class="o">=</span> <span class="n">cout</span><span class="p">);</span>
<span class="k">private</span><span class="o">:</span>
  <span class="c1">// Filter properties, set by constructor.</span>
  <span class="kt">int</span>    <span class="n">select</span><span class="p">;</span>
  <span class="kt">double</span> <span class="n">etaMax</span><span class="p">,</span> <span class="n">pTminCharged</span><span class="p">,</span> <span class="n">pTminNeutral</span><span class="p">;</span>
  <span class="c1">// Kept particle indices and pointers, referring to original event.</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span>       <span class="n">keptIndx</span><span class="p">;</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="n">Particle</span><span class="o">*&gt;</span> <span class="n">keptPtrs</span><span class="p">;</span>
<span class="p">};</span>
<span class="c1">//--------------------------------------------------------------------------</span>
<span class="c1">// The filter method.</span>
<span class="kt">void</span> <span class="n">EventFilter</span><span class="o">::</span><span class="n">filter</span><span class="p">(</span><span class="n">Event</span><span class="o">&amp;</span> <span class="n">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Reset arrays in preparation for new event.</span>
  <span class="n">keptIndx</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="n">keptPtrs</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="c1">// Loop over all particles in the event record.</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">event</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Skip if particle kind selection criteria not fulfilled.</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">isFinal</span><span class="p">())</span> <span class="k">continue</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">select</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">isVisible</span><span class="p">())</span> <span class="k">continue</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">isCharged</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">isCharged</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">select</span> <span class="o">==</span> <span class="mi">3</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">isCharged</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
    <span class="c1">// Skip if too large pseudorapidity.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">eta</span><span class="p">())</span> <span class="o">&gt;</span> <span class="n">etaMax</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
    <span class="c1">// Skip if too small pT.</span>
    <span class="k">if</span>       <span class="p">(</span><span class="n">isCharged</span> <span class="o">&amp;&amp;</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pT</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">pTminCharged</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
    <span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="o">!</span><span class="n">isCharged</span> <span class="o">&amp;&amp;</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pT</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">pTminNeutral</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
    <span class="c1">// Add particle to vectors of indices and pointers.</span>
    <span class="n">keptIndx</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span> <span class="n">i</span> <span class="p">);</span>
    <span class="n">keptPtrs</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">);</span>
  <span class="c1">// End of particle loop. Done.</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="c1">//--------------------------------------------------------------------------</span>
<span class="c1">// The list method: downscaled version of Event::list.</span>
<span class="kt">void</span> <span class="n">EventFilter</span><span class="o">::</span><span class="n">list</span><span class="p">(</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="n">os</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Header.</span>
  <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s"> --------  PYTHIA Event Listing  (filtered)  ------------------&quot;</span>
     <span class="o">&lt;&lt;</span> <span class="s">&quot;-----------------------------------------------------------------&quot;</span>
     <span class="o">&lt;&lt;</span> <span class="s">&quot;----</span><span class="se">\n</span><span class="s"> </span><span class="se">\n</span><span class="s">    no        id   name            status     mothers  &quot;</span>
     <span class="o">&lt;&lt;</span> <span class="s">&quot; daughters     colours      p_x        p_y        p_z         e  &quot;</span>
     <span class="o">&lt;&lt;</span> <span class="s">&quot;        m </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
  <span class="c1">// At high energy switch to scientific format for momenta.</span>
  <span class="kt">double</span> <span class="n">eSum</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iKept</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iKept</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">iKept</span><span class="p">)</span> <span class="n">eSum</span> <span class="o">+=</span> <span class="n">keptPtrs</span><span class="p">[</span><span class="n">iKept</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">e</span><span class="p">();</span>
  <span class="kt">bool</span> <span class="n">useFixed</span> <span class="o">=</span> <span class="p">(</span><span class="n">eSum</span> <span class="o">&lt;</span> <span class="mf">1e5</span><span class="p">);</span>
  <span class="c1">// Listing of kept particles in event.</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iKept</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iKept</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">iKept</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">keptIndx</span><span class="p">[</span><span class="n">iKept</span><span class="p">];</span>
    <span class="n">Particle</span><span class="o">&amp;</span> <span class="n">pt</span> <span class="o">=</span> <span class="o">*</span><span class="n">keptPtrs</span><span class="p">[</span><span class="n">iKept</span><span class="p">];</span>
    <span class="c1">// Basic line for a particle, always printed.</span>
    <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="n">setw</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="n">setw</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">pt</span><span class="p">.</span><span class="n">id</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;   &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">left</span>
       <span class="o">&lt;&lt;</span> <span class="n">setw</span><span class="p">(</span><span class="mi">18</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">pt</span><span class="p">.</span><span class="n">nameWithStatus</span><span class="p">(</span><span class="mi">18</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">right</span> <span class="o">&lt;&lt;</span> <span class="n">setw</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
       <span class="o">&lt;&lt;</span> <span class="n">pt</span><span class="p">.</span><span class="n">status</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">setw</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">pt</span><span class="p">.</span><span class="n">mother1</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">setw</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
       <span class="o">&lt;&lt;</span> <span class="n">pt</span><span class="p">.</span><span class="n">mother2</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">setw</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">pt</span><span class="p">.</span><span class="n">daughter1</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">setw</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
       <span class="o">&lt;&lt;</span> <span class="n">pt</span><span class="p">.</span><span class="n">daughter2</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">setw</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">pt</span><span class="p">.</span><span class="n">col</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">setw</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">pt</span><span class="p">.</span><span class="n">acol</span><span class="p">()</span>
       <span class="o">&lt;&lt;</span> <span class="p">(</span> <span class="p">(</span><span class="n">useFixed</span><span class="p">)</span> <span class="o">?</span> <span class="nl">fixed</span> <span class="p">:</span> <span class="n">scientific</span> <span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">setprecision</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
       <span class="o">&lt;&lt;</span> <span class="n">setw</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">pt</span><span class="p">.</span><span class="n">px</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">setw</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">pt</span><span class="p">.</span><span class="n">py</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">setw</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>
       <span class="o">&lt;&lt;</span> <span class="n">pt</span><span class="p">.</span><span class="n">pz</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">setw</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">pt</span><span class="p">.</span><span class="n">e</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">setw</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">pt</span><span class="p">.</span><span class="n">m</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// Listing finished.</span>
  <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s"> --------  End PYTHIA Event Listing  ----------------------------&quot;</span>
     <span class="o">&lt;&lt;</span> <span class="s">&quot;-------------------------------------------------------------------&quot;</span>
     <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">//==========================================================================</span>
<span class="c1">// Use the EventFilter method to plot some event properties.</span>
<span class="kt">int</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Number of events to generate, to list, to allow aborts.</span>
  <span class="kt">int</span>    <span class="n">nEvent</span>   <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
  <span class="kt">int</span>    <span class="n">nList</span>    <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="kt">int</span>    <span class="n">nAbort</span>   <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
  <span class="c1">// Declare generator.</span>
  <span class="n">Pythia</span> <span class="n">pythia</span><span class="p">;</span>
  <span class="c1">// Hard QCD events with pThat &gt; 100.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;HardQCD:all = on&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;PhaseSpace:pTHatMin = 100.&quot;</span><span class="p">);</span>
  <span class="c1">// No automatic event listings - do it manually below.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Next:numberShowInfo = 0&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Next:numberShowProcess = 0&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Next:numberShowEvent = 0&quot;</span><span class="p">);</span>
  <span class="c1">// Initialization for LHC.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
  <span class="c1">// Values for filter.</span>
  <span class="kt">int</span>    <span class="n">select</span>   <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
  <span class="kt">double</span> <span class="n">etaMax</span>   <span class="o">=</span> <span class="mf">3.</span><span class="p">;</span>
  <span class="kt">double</span> <span class="n">pTminChg</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">;</span>
  <span class="c1">// Declare Event Filter according to specification.</span>
  <span class="n">EventFilter</span> <span class="nf">filter</span><span class="p">(</span> <span class="n">select</span><span class="p">,</span> <span class="n">etaMax</span><span class="p">,</span> <span class="n">pTminChg</span><span class="p">);</span>
  <span class="c1">// Histograms.</span>
  <span class="n">Hist</span> <span class="nf">nCharged</span><span class="p">(</span>   <span class="s">&quot;selected charged multiplicity&quot;</span><span class="p">,</span>     <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">199.5</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="nf">etaCharged</span><span class="p">(</span> <span class="s">&quot;selected charged eta distribution&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="nf">pTCharged</span><span class="p">(</span>  <span class="s">&quot;selected charged pT distribution&quot;</span><span class="p">,</span>  <span class="mi">100</span><span class="p">,</span>  <span class="mf">0.0</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">);</span>
  <span class="c1">// Begin event loop.</span>
  <span class="kt">int</span> <span class="n">iAbort</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iEvent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iEvent</span> <span class="o">&lt;</span> <span class="n">nEvent</span><span class="p">;</span> <span class="o">++</span><span class="n">iEvent</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Generate events. Quit if too many failures.</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">())</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">++</span><span class="n">iAbort</span> <span class="o">&lt;</span> <span class="n">nAbort</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; Event generation aborted prematurely, owing to error!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// Find final charged particles with |eta| &lt; 3 and pT &gt; 1 GeV.</span>
    <span class="n">filter</span><span class="p">.</span><span class="n">filter</span><span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">);</span>
    <span class="c1">// List first few events, both complete and after filtering.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">iEvent</span> <span class="o">&lt;</span> <span class="n">nList</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">list</span><span class="p">();</span>
      <span class="n">pythia</span><span class="p">.</span><span class="n">process</span><span class="p">.</span><span class="n">list</span><span class="p">();</span>
      <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="n">list</span><span class="p">();</span>
      <span class="n">filter</span><span class="p">.</span><span class="n">list</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="c1">// Analyze selected particle sample.</span>
    <span class="n">nCharged</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">filter</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">filter</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Use both reference and pointer notation to illustrate freedom.</span>
      <span class="n">etaCharged</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">filter</span><span class="p">.</span><span class="n">particleRef</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">eta</span><span class="p">()</span> <span class="p">);</span>
      <span class="n">pTCharged</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span>  <span class="n">filter</span><span class="p">.</span><span class="n">particlePtr</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">pT</span><span class="p">()</span> <span class="p">);</span>
    <span class="p">}</span>
  <span class="c1">// End of event loop.</span>
  <span class="p">}</span>
  <span class="c1">// Final statistics.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
  <span class="c1">// Histograms.</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">nCharged</span> <span class="o">&lt;&lt;</span> <span class="n">etaCharged</span> <span class="o">&lt;&lt;</span> <span class="n">pTCharged</span><span class="p">;</span>
  <span class="c1">// Done.</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
    </div>
  </div>
</div>

</div> <div class="well well-sm"> <h1 id="main19cc">main19.cc</h1><hr>
<div class="codehilite"><pre><span class="c1">// main19.cc is a part of the PYTHIA event generator.</span>
<span class="c1">// Copyright (C) 2016 Torbjorn Sjostrand.</span>
<span class="c1">// PYTHIA is licenced under the GNU GPL version 2, see COPYING for details.</span>
<span class="c1">// Please respect the MCnet Guidelines, see GUIDELINES for details.</span>
<span class="c1">// This program runs four instances of Pythia simultaneously,</span>
<span class="c1">// one for signal events, one for pileup background ones, and two</span>
<span class="c1">// For beam-gas background ones. Note that Pythia does not do nuclear</span>
<span class="c1">// effects, so beam-gas is represented by &quot;fixed-target&quot; pp collisions.</span>
<span class="c1">// The = and += overloaded operators are used to join several</span>
<span class="c1">// event records into one, but should be used with caution.</span>
<span class="c1">// The possibility to instantiate Pythia with Settings and ParticleData</span>
<span class="c1">// databases is illustrated, but not essential here. It means that the</span>
<span class="c1">// share/Pythia8/xmldoc/*.xml files are only read once, saving some time.</span>
<span class="c1">// Note that each instance of Pythia is running independently of any other,</span>
<span class="c1">// but with two important points to remember.</span>
<span class="c1">// 1) By default all generate the same random number sequence,</span>
<span class="c1">//    which has to be corrected if they are to generate the same</span>
<span class="c1">//    physics, like the two beam-gas ones below.</span>
<span class="c1">// 2) Interfaces to external Fortran programs are &quot;by definition&quot; static.</span>
<span class="c1">//    Thus it is not a good idea to use LHAPDF5 to set different PDF&#39;s</span>
<span class="c1">//    in different instances.</span>
</pre></div>


<div class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" href="#fileid18">Rest of the main19.cc code</a>
    </h4>
  </div>
  <div id="fileid18" class="panel-collapse collapse">
    <div class="panel-body">
<div class="codehilite"><pre><span class="cp">#include</span> <span class="cpf">&quot;Pythia8/Pythia.h&quot;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">Pythia8</span><span class="p">;</span>
<span class="c1">//==========================================================================</span>
<span class="c1">// Method to pick a number according to a Poissonian distribution.</span>
<span class="kt">int</span> <span class="nf">poisson</span><span class="p">(</span><span class="kt">double</span> <span class="n">nAvg</span><span class="p">,</span> <span class="n">Rndm</span><span class="o">&amp;</span> <span class="n">rndm</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Set maximum to avoid overflow.</span>
  <span class="k">const</span> <span class="kt">int</span> <span class="n">NMAX</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
  <span class="c1">// Random number.</span>
  <span class="kt">double</span> <span class="n">rPoisson</span> <span class="o">=</span> <span class="n">rndm</span><span class="p">.</span><span class="n">flat</span><span class="p">()</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="n">nAvg</span><span class="p">);</span>
  <span class="c1">// Initialize.</span>
  <span class="kt">double</span> <span class="n">rSum</span>  <span class="o">=</span> <span class="mf">0.</span><span class="p">;</span>
  <span class="kt">double</span> <span class="n">rTerm</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">;</span>
  <span class="c1">// Add to sum and check whether done.</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">NMAX</span><span class="p">;</span> <span class="p">)</span> <span class="p">{</span>
    <span class="n">rSum</span> <span class="o">+=</span> <span class="n">rTerm</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">rSum</span> <span class="o">&gt;</span> <span class="n">rPoisson</span><span class="p">)</span> <span class="k">return</span> <span class="n">i</span><span class="p">;</span>
    <span class="c1">// Evaluate next term.</span>
    <span class="o">++</span><span class="n">i</span><span class="p">;</span>
    <span class="n">rTerm</span> <span class="o">*=</span> <span class="n">nAvg</span> <span class="o">/</span> <span class="n">i</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// Emergency return.</span>
  <span class="k">return</span> <span class="n">NMAX</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">//==========================================================================</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Number of signal events to generate.</span>
  <span class="kt">int</span> <span class="n">nEvent</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
  <span class="c1">// Beam Energy.</span>
  <span class="kt">double</span> <span class="n">eBeam</span> <span class="o">=</span> <span class="mf">7000.</span><span class="p">;</span>
  <span class="c1">// Average number of pileup events per signal event.</span>
  <span class="kt">double</span> <span class="n">nPileupAvg</span> <span class="o">=</span> <span class="mf">2.5</span><span class="p">;</span>
  <span class="c1">// Average number of beam-gas events per signal ones, on two sides.</span>
  <span class="kt">double</span> <span class="n">nBeamAGasAvg</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">;</span>
  <span class="kt">double</span> <span class="n">nBeamBGasAvg</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">;</span>
  <span class="c1">// Signal generator instance.</span>
  <span class="n">Pythia</span> <span class="n">pythiaSignal</span><span class="p">;</span>
  <span class="c1">// Switch off automatic event listing (illustrates settings inheritance).</span>
  <span class="n">pythiaSignal</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Next:numberShowInfo = 0&quot;</span><span class="p">);</span>
  <span class="n">pythiaSignal</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Next:numberShowProcess = 0&quot;</span><span class="p">);</span>
  <span class="n">pythiaSignal</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Next:numberShowEvent = 0&quot;</span><span class="p">);</span>
  <span class="c1">// Switch off K0S decay (illustrates particle data inheritance).</span>
  <span class="n">pythiaSignal</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;130:mayDecay = off&quot;</span><span class="p">);</span>
  <span class="c1">// Background generator instances copies settings and particle data.</span>
  <span class="n">Pythia</span> <span class="n">pythiaPileup</span><span class="p">(</span>   <span class="n">pythiaSignal</span><span class="p">.</span><span class="n">settings</span><span class="p">,</span> <span class="n">pythiaSignal</span><span class="p">.</span><span class="n">particleData</span><span class="p">);</span>
  <span class="n">Pythia</span> <span class="n">pythiaBeamAGas</span><span class="p">(</span> <span class="n">pythiaSignal</span><span class="p">.</span><span class="n">settings</span><span class="p">,</span> <span class="n">pythiaSignal</span><span class="p">.</span><span class="n">particleData</span><span class="p">);</span>
  <span class="n">Pythia</span> <span class="n">pythiaBeamBGas</span><span class="p">(</span> <span class="n">pythiaSignal</span><span class="p">.</span><span class="n">settings</span><span class="p">,</span> <span class="n">pythiaSignal</span><span class="p">.</span><span class="n">particleData</span><span class="p">);</span>
  <span class="c1">// Switch off Lambda decay (illustrates particle data non-inheritance).</span>
  <span class="n">pythiaSignal</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;3122:mayDecay = off&quot;</span><span class="p">);</span>
  <span class="c1">// One object where all individual events are to be collected.</span>
  <span class="n">Event</span> <span class="n">sumEvent</span><span class="p">;</span>
  <span class="c1">// Initialize generator for signal processes.</span>
  <span class="n">pythiaSignal</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;HardQCD:all = on&quot;</span><span class="p">);</span>
  <span class="n">pythiaSignal</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;PhaseSpace:pTHatMin = 50.&quot;</span><span class="p">);</span>
  <span class="n">pythiaSignal</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">parm</span><span class="p">(</span><span class="s">&quot;Beams:eCM&quot;</span><span class="p">,</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">eBeam</span><span class="p">);</span>
  <span class="n">pythiaSignal</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
  <span class="c1">// Initialize generator for pileup (background) processes.</span>
  <span class="n">pythiaPileup</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Random:setSeed = on&quot;</span><span class="p">);</span>
  <span class="n">pythiaPileup</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Random:seed = 10000002&quot;</span><span class="p">);</span>
  <span class="n">pythiaPileup</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;SoftQCD:all = on&quot;</span><span class="p">);</span>
  <span class="n">pythiaPileup</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">parm</span><span class="p">(</span><span class="s">&quot;Beams:eCM&quot;</span><span class="p">,</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">eBeam</span><span class="p">);</span>
  <span class="n">pythiaPileup</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
  <span class="c1">// Initialize generators for beam A - gas (background) processes.</span>
  <span class="n">pythiaBeamAGas</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Random:setSeed = on&quot;</span><span class="p">);</span>
  <span class="n">pythiaBeamAGas</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Random:seed = 10000003&quot;</span><span class="p">);</span>
  <span class="n">pythiaBeamAGas</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;SoftQCD:all = on&quot;</span><span class="p">);</span>
  <span class="n">pythiaBeamAGas</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Beams:frameType = 2&quot;</span><span class="p">);</span>
  <span class="n">pythiaBeamAGas</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">parm</span><span class="p">(</span><span class="s">&quot;Beams:eA&quot;</span><span class="p">,</span> <span class="n">eBeam</span><span class="p">);</span>
  <span class="n">pythiaBeamAGas</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">parm</span><span class="p">(</span><span class="s">&quot;Beams:eB&quot;</span><span class="p">,</span> <span class="mf">0.</span><span class="p">);</span>
  <span class="n">pythiaBeamAGas</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
  <span class="c1">// Initialize generators for beam B - gas (background) processes.</span>
  <span class="n">pythiaBeamBGas</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Random:setSeed = on&quot;</span><span class="p">);</span>
  <span class="n">pythiaBeamBGas</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Random:seed = 10000004&quot;</span><span class="p">);</span>
  <span class="n">pythiaBeamBGas</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;SoftQCD:all = on&quot;</span><span class="p">);</span>
  <span class="n">pythiaBeamBGas</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Beams:frameType = 2&quot;</span><span class="p">);</span>
  <span class="n">pythiaBeamBGas</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">parm</span><span class="p">(</span><span class="s">&quot;Beams:eA&quot;</span><span class="p">,</span> <span class="mf">0.</span><span class="p">);</span>
  <span class="n">pythiaBeamBGas</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">parm</span><span class="p">(</span><span class="s">&quot;Beams:eB&quot;</span><span class="p">,</span> <span class="n">eBeam</span><span class="p">);</span>
  <span class="n">pythiaBeamBGas</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
  <span class="c1">// Histograms: number of pileups, total charged multiplicity.</span>
  <span class="n">Hist</span> <span class="n">nPileH</span><span class="p">(</span><span class="s">&quot;number of pileup events per signal event&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">99.5</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">nAGH</span><span class="p">(</span><span class="s">&quot;number of beam A + gas events per signal event&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">99.5</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">nBGH</span><span class="p">(</span><span class="s">&quot;number of beam B + gas events per signal event&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">99.5</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">nChgH</span><span class="p">(</span><span class="s">&quot;number of charged multiplicity&quot;</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1999.5</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">sumPZH</span><span class="p">(</span><span class="s">&quot;total pZ of system&quot;</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">100000.</span><span class="p">,</span> <span class="mf">100000.</span><span class="p">);</span>
  <span class="c1">// Loop over events.</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iEvent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iEvent</span> <span class="o">&lt;</span> <span class="n">nEvent</span><span class="p">;</span> <span class="o">++</span><span class="n">iEvent</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Generate a signal event. Copy this event into sumEvent.</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pythiaSignal</span><span class="p">.</span><span class="n">next</span><span class="p">())</span> <span class="k">continue</span><span class="p">;</span>
    <span class="n">sumEvent</span> <span class="o">=</span> <span class="n">pythiaSignal</span><span class="p">.</span><span class="n">event</span><span class="p">;</span>
    <span class="c1">// Select the number of pileup events to generate.</span>
    <span class="kt">int</span> <span class="n">nPileup</span> <span class="o">=</span> <span class="n">poisson</span><span class="p">(</span><span class="n">nPileupAvg</span><span class="p">,</span> <span class="n">pythiaPileup</span><span class="p">.</span><span class="n">rndm</span><span class="p">);</span>
    <span class="n">nPileH</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">nPileup</span> <span class="p">);</span>
    <span class="c1">// Generate a number of pileup events. Add them to sumEvent.</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iPileup</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iPileup</span> <span class="o">&lt;</span> <span class="n">nPileup</span><span class="p">;</span> <span class="o">++</span><span class="n">iPileup</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">pythiaPileup</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
      <span class="n">sumEvent</span> <span class="o">+=</span> <span class="n">pythiaPileup</span><span class="p">.</span><span class="n">event</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// Select the number of beam A + gas events to generate.</span>
    <span class="kt">int</span> <span class="n">nBeamAGas</span> <span class="o">=</span> <span class="n">poisson</span><span class="p">(</span><span class="n">nBeamAGasAvg</span><span class="p">,</span> <span class="n">pythiaBeamAGas</span><span class="p">.</span><span class="n">rndm</span><span class="p">);</span>
    <span class="n">nAGH</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">nBeamAGas</span> <span class="p">);</span>
    <span class="c1">// Generate a number of beam A + gas events. Add them to sumEvent.</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iAG</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iAG</span> <span class="o">&lt;</span> <span class="n">nBeamAGas</span><span class="p">;</span> <span class="o">++</span><span class="n">iAG</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">pythiaBeamAGas</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
      <span class="n">sumEvent</span> <span class="o">+=</span> <span class="n">pythiaBeamAGas</span><span class="p">.</span><span class="n">event</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// Select the number of beam B + gas events to generate.</span>
    <span class="kt">int</span> <span class="n">nBeamBGas</span> <span class="o">=</span> <span class="n">poisson</span><span class="p">(</span><span class="n">nBeamBGasAvg</span><span class="p">,</span> <span class="n">pythiaBeamBGas</span><span class="p">.</span><span class="n">rndm</span><span class="p">);</span>
    <span class="n">nBGH</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">nBeamBGas</span> <span class="p">);</span>
    <span class="c1">// Generate a number of beam B + gas events. Add them to sumEvent.</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iBG</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iBG</span> <span class="o">&lt;</span> <span class="n">nBeamBGas</span><span class="p">;</span> <span class="o">++</span><span class="n">iBG</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">pythiaBeamBGas</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
      <span class="n">sumEvent</span> <span class="o">+=</span> <span class="n">pythiaBeamBGas</span><span class="p">.</span><span class="n">event</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// List first few events.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">iEvent</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">pythiaSignal</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">list</span><span class="p">();</span>
      <span class="n">pythiaSignal</span><span class="p">.</span><span class="n">process</span><span class="p">.</span><span class="n">list</span><span class="p">();</span>
      <span class="n">sumEvent</span><span class="p">.</span><span class="n">list</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="c1">// Find charged multiplicity.</span>
    <span class="kt">int</span> <span class="n">nChg</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">sumEvent</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">sumEvent</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">isFinal</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">sumEvent</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">isCharged</span><span class="p">())</span> <span class="o">++</span><span class="n">nChg</span><span class="p">;</span>
    <span class="n">nChgH</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">nChg</span> <span class="p">);</span>
    <span class="c1">// Fill net pZ - nonvanishing owing to beam + gas.</span>
    <span class="n">sumPZH</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">sumEvent</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">pz</span><span class="p">()</span> <span class="p">);</span>
  <span class="c1">// End of event loop</span>
  <span class="p">}</span>
  <span class="c1">// Statistics. Histograms.</span>
  <span class="n">pythiaSignal</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
  <span class="n">pythiaPileup</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
  <span class="n">pythiaBeamAGas</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
  <span class="n">pythiaBeamBGas</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">nPileH</span> <span class="o">&lt;&lt;</span> <span class="n">nAGH</span> <span class="o">&lt;&lt;</span> <span class="n">nBGH</span> <span class="o">&lt;&lt;</span> <span class="n">nChgH</span> <span class="o">&lt;&lt;</span> <span class="n">sumPZH</span><span class="p">;</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
    </div>
  </div>
</div>

</div> <div class="well well-sm"> <h1 id="main20cc">main20.cc</h1><hr>
<div class="codehilite"><pre><span class="c1">// main20.cc is a part of the PYTHIA event generator.</span>
<span class="c1">// Copyright (C) 2016 Torbjorn Sjostrand.</span>
<span class="c1">// PYTHIA is licenced under the GNU GPL version 2, see COPYING for details.</span>
<span class="c1">// Please respect the MCnet Guidelines, see GUIDELINES for details.</span>
<span class="c1">// This is a simple test program. It shows how PYTHIA 8 can write</span>
<span class="c1">// a Les Houches Event File based on its process-level events.</span>
</pre></div>


<div class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" href="#fileid19">Rest of the main20.cc code</a>
    </h4>
  </div>
  <div id="fileid19" class="panel-collapse collapse">
    <div class="panel-body">
<div class="codehilite"><pre><span class="cp">#include</span> <span class="cpf">&quot;Pythia8/Pythia.h&quot;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">Pythia8</span><span class="p">;</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Generator.</span>
  <span class="n">Pythia</span> <span class="n">pythia</span><span class="p">;</span>
  <span class="c1">// Process selection. Minimal masses for gamma*/Z and W+-.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;WeakDoubleBoson:all = on&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;23:mMin = 50.&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;24:mMin = 50.&quot;</span><span class="p">);</span>
  <span class="c1">// Switch off generation of steps subsequent to the process level one.</span>
  <span class="c1">// (These will not be stored anyway, so only steal time.)</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;PartonLevel:all = off&quot;</span><span class="p">);</span>
  <span class="c1">// Create an LHAup object that can access relevant information in pythia.</span>
  <span class="n">LHAupFromPYTHIA8</span> <span class="n">myLHA</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pythia</span><span class="p">.</span><span class="n">process</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">);</span>
  <span class="c1">// Open a file on which LHEF events should be stored, and write header.</span>
  <span class="n">myLHA</span><span class="p">.</span><span class="n">openLHEF</span><span class="p">(</span><span class="s">&quot;weakbosons.lhe&quot;</span><span class="p">);</span>
  <span class="c1">// LHC 8 TeV initialization.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Beams:eCM = 8000.&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
  <span class="c1">// Store initialization info in the LHAup object.</span>
  <span class="n">myLHA</span><span class="p">.</span><span class="n">setInit</span><span class="p">();</span>
  <span class="c1">// Write out this initialization info on the file.</span>
  <span class="n">myLHA</span><span class="p">.</span><span class="n">initLHEF</span><span class="p">();</span>
  <span class="c1">// Loop over events.</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Generate an event.</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
    <span class="c1">// Store event info in the LHAup object.</span>
    <span class="n">myLHA</span><span class="p">.</span><span class="n">setEvent</span><span class="p">();</span>
    <span class="c1">// Write out this event info on the file.</span>
    <span class="c1">// With optional argument (verbose =) false the file is smaller.</span>
    <span class="n">myLHA</span><span class="p">.</span><span class="n">eventLHEF</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="c1">// Statistics: full printout.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
  <span class="c1">// Update the cross section info based on Monte Carlo integration during run.</span>
  <span class="n">myLHA</span><span class="p">.</span><span class="n">updateSigma</span><span class="p">();</span>
  <span class="c1">// Write endtag. Overwrite initialization info with new cross sections.</span>
  <span class="n">myLHA</span><span class="p">.</span><span class="n">closeLHEF</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
  <span class="c1">// Done.</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
    </div>
  </div>
</div>

</div> <div class="well well-sm"> <h1 id="main21cc">main21.cc</h1><hr>
<div class="codehilite"><pre><span class="c1">// main21.cc is a part of the PYTHIA event generator.</span>
<span class="c1">// Copyright (C) 2016 Torbjorn Sjostrand.</span>
<span class="c1">// PYTHIA is licenced under the GNU GPL version 2, see COPYING for details.</span>
<span class="c1">// Please respect the MCnet Guidelines, see GUIDELINES for details.</span>
<span class="c1">// This is a simple test program.</span>
<span class="c1">// It illustrates how to feed in a single particle (including a resonance)</span>
<span class="c1">// or a toy parton-level configurations.</span>
</pre></div>


<div class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" href="#fileid20">Rest of the main21.cc code</a>
    </h4>
  </div>
  <div id="fileid20" class="panel-collapse collapse">
    <div class="panel-body">
<div class="codehilite"><pre><span class="cp">#include</span> <span class="cpf">&quot;Pythia8/Pythia.h&quot;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">Pythia8</span><span class="p">;</span>
<span class="c1">//==========================================================================</span>
<span class="c1">// Single-particle gun. The particle must be a colour singlet.</span>
<span class="c1">// Input: flavour, energy, direction (theta, phi).</span>
<span class="c1">// If theta &lt; 0 then random choice over solid angle.</span>
<span class="c1">// Optional final argument to put particle at rest =&gt; E = m.</span>
<span class="kt">void</span> <span class="nf">fillParticle</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">,</span> <span class="kt">double</span> <span class="n">ee</span><span class="p">,</span> <span class="kt">double</span> <span class="n">thetaIn</span><span class="p">,</span> <span class="kt">double</span> <span class="n">phiIn</span><span class="p">,</span>
  <span class="n">Event</span><span class="o">&amp;</span> <span class="n">event</span><span class="p">,</span> <span class="n">ParticleData</span><span class="o">&amp;</span> <span class="n">pdt</span><span class="p">,</span> <span class="n">Rndm</span><span class="o">&amp;</span> <span class="n">rndm</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">atRest</span> <span class="o">=</span> <span class="nb">false</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Reset event record to allow for new event.</span>
  <span class="n">event</span><span class="p">.</span><span class="n">reset</span><span class="p">();</span>
  <span class="c1">// Select particle mass; where relevant according to Breit-Wigner.</span>
  <span class="kt">double</span> <span class="n">mm</span> <span class="o">=</span> <span class="n">pdt</span><span class="p">.</span><span class="n">mSel</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
  <span class="kt">double</span> <span class="n">pp</span> <span class="o">=</span> <span class="n">sqrtpos</span><span class="p">(</span><span class="n">ee</span><span class="o">*</span><span class="n">ee</span> <span class="o">-</span> <span class="n">mm</span><span class="o">*</span><span class="n">mm</span><span class="p">);</span>
  <span class="c1">// Special case when particle is supposed to be at rest.</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">atRest</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">ee</span> <span class="o">=</span> <span class="n">mm</span><span class="p">;</span>
    <span class="n">pp</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// Angles as input or uniform in solid angle.</span>
  <span class="kt">double</span> <span class="n">cThe</span><span class="p">,</span> <span class="n">sThe</span><span class="p">,</span> <span class="n">phi</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">thetaIn</span> <span class="o">&gt;=</span> <span class="mf">0.</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cThe</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">thetaIn</span><span class="p">);</span>
    <span class="n">sThe</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">thetaIn</span><span class="p">);</span>
    <span class="n">phi</span>  <span class="o">=</span> <span class="n">phiIn</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="n">cThe</span> <span class="o">=</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">rndm</span><span class="p">.</span><span class="n">flat</span><span class="p">()</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">;</span>
    <span class="n">sThe</span> <span class="o">=</span> <span class="n">sqrtpos</span><span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">cThe</span> <span class="o">*</span> <span class="n">cThe</span><span class="p">);</span>
    <span class="n">phi</span> <span class="o">=</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">M_PI</span> <span class="o">*</span> <span class="n">rndm</span><span class="p">.</span><span class="n">flat</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="c1">// Store the particle in the event record.</span>
  <span class="n">event</span><span class="p">.</span><span class="n">append</span><span class="p">(</span> <span class="n">id</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pp</span> <span class="o">*</span> <span class="n">sThe</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">),</span> <span class="n">pp</span> <span class="o">*</span> <span class="n">sThe</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">),</span>
    <span class="n">pp</span> <span class="o">*</span> <span class="n">cThe</span><span class="p">,</span> <span class="n">ee</span><span class="p">,</span> <span class="n">mm</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">//==========================================================================</span>
<span class="c1">// Simple method to do the filling of partons into the event record.</span>
<span class="kt">void</span> <span class="nf">fillPartons</span><span class="p">(</span><span class="kt">int</span> <span class="n">type</span><span class="p">,</span> <span class="kt">double</span> <span class="n">ee</span><span class="p">,</span> <span class="n">Event</span><span class="o">&amp;</span> <span class="n">event</span><span class="p">,</span> <span class="n">ParticleData</span><span class="o">&amp;</span> <span class="n">pdt</span><span class="p">,</span>
  <span class="n">Rndm</span><span class="o">&amp;</span> <span class="n">rndm</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Reset event record to allow for new event.</span>
  <span class="n">event</span><span class="p">.</span><span class="n">reset</span><span class="p">();</span>
  <span class="c1">// Information on a q qbar system, to be hadronized.</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">type</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">||</span> <span class="n">type</span> <span class="o">==</span> <span class="mi">12</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span>    <span class="n">id</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">mm</span> <span class="o">=</span> <span class="n">pdt</span><span class="p">.</span><span class="n">m0</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
    <span class="kt">double</span> <span class="n">pp</span> <span class="o">=</span> <span class="n">sqrtpos</span><span class="p">(</span><span class="n">ee</span><span class="o">*</span><span class="n">ee</span> <span class="o">-</span> <span class="n">mm</span><span class="o">*</span><span class="n">mm</span><span class="p">);</span>
    <span class="n">event</span><span class="p">.</span><span class="n">append</span><span class="p">(</span>  <span class="n">id</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span>  <span class="n">pp</span><span class="p">,</span> <span class="n">ee</span><span class="p">,</span> <span class="n">mm</span><span class="p">);</span>
    <span class="n">event</span><span class="p">.</span><span class="n">append</span><span class="p">(</span> <span class="o">-</span><span class="n">id</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="n">pp</span><span class="p">,</span> <span class="n">ee</span><span class="p">,</span> <span class="n">mm</span><span class="p">);</span>
  <span class="c1">// Information on a g g system, to be hadronized.</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">type</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">||</span> <span class="n">type</span> <span class="o">==</span> <span class="mi">13</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">event</span><span class="p">.</span><span class="n">append</span><span class="p">(</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span>  <span class="n">ee</span><span class="p">,</span> <span class="n">ee</span><span class="p">);</span>
    <span class="n">event</span><span class="p">.</span><span class="n">append</span><span class="p">(</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="n">ee</span><span class="p">,</span> <span class="n">ee</span><span class="p">);</span>
  <span class="c1">// Information on a g g g system, to be hadronized.</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">type</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">event</span><span class="p">.</span><span class="n">append</span><span class="p">(</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span>        <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span>        <span class="n">ee</span><span class="p">,</span> <span class="n">ee</span><span class="p">);</span>
    <span class="n">event</span><span class="p">.</span><span class="n">append</span><span class="p">(</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">103</span><span class="p">,</span>  <span class="mf">0.8</span> <span class="o">*</span> <span class="n">ee</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.6</span> <span class="o">*</span> <span class="n">ee</span><span class="p">,</span> <span class="n">ee</span><span class="p">);</span>
    <span class="n">event</span><span class="p">.</span><span class="n">append</span><span class="p">(</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">103</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.8</span> <span class="o">*</span> <span class="n">ee</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.6</span> <span class="o">*</span> <span class="n">ee</span><span class="p">,</span> <span class="n">ee</span><span class="p">);</span>
  <span class="c1">// Information on a q q q junction system, to be hadronized.</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">type</span> <span class="o">==</span> <span class="mi">4</span> <span class="o">||</span> <span class="n">type</span> <span class="o">==</span> <span class="mi">5</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Need a colour singlet mother parton to define junction origin.</span>
    <span class="n">event</span><span class="p">.</span><span class="n">append</span><span class="p">(</span> <span class="mi">1000022</span><span class="p">,</span> <span class="o">-</span><span class="mi">21</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                  <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.01</span> <span class="o">*</span> <span class="n">ee</span><span class="p">,</span> <span class="mf">1.01</span> <span class="o">*</span> <span class="n">ee</span><span class="p">);</span>
    <span class="c1">// The three endpoint q q q; the minimal system.</span>
    <span class="kt">double</span> <span class="n">rt75</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="mf">0.75</span><span class="p">);</span>
    <span class="n">event</span><span class="p">.</span><span class="n">append</span><span class="p">(</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                          <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.01</span> <span class="o">*</span> <span class="n">ee</span><span class="p">,</span> <span class="mf">1.01</span> <span class="o">*</span> <span class="n">ee</span><span class="p">);</span>
    <span class="n">event</span><span class="p">.</span><span class="n">append</span><span class="p">(</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                   <span class="n">rt75</span> <span class="o">*</span> <span class="n">ee</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">ee</span><span class="p">,</span>        <span class="n">ee</span> <span class="p">);</span>
    <span class="n">event</span><span class="p">.</span><span class="n">append</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">103</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                  <span class="o">-</span><span class="n">rt75</span> <span class="o">*</span> <span class="n">ee</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">ee</span><span class="p">,</span>        <span class="n">ee</span> <span class="p">);</span>
    <span class="c1">// Define the qqq configuration as starting point for adding gluons.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">type</span> <span class="o">==</span> <span class="mi">5</span><span class="p">)</span> <span class="p">{</span>
      <span class="kt">int</span> <span class="n">colNow</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">103</span><span class="p">};</span>
      <span class="n">Vec4</span> <span class="n">pQ</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
      <span class="n">pQ</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">Vec4</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">);</span>
      <span class="n">pQ</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">Vec4</span><span class="p">(</span> <span class="n">rt75</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.</span><span class="p">);</span>
      <span class="n">pQ</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">Vec4</span><span class="p">(</span><span class="o">-</span><span class="n">rt75</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.</span><span class="p">);</span>
      <span class="c1">// Minimal cos(q-g opening angle), allows more or less nasty events.</span>
      <span class="kt">double</span> <span class="n">cosThetaMin</span> <span class="o">=</span><span class="mf">0.</span><span class="p">;</span>
      <span class="c1">// Add a few gluons (almost) at random.</span>
      <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">nglu</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">nglu</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="o">++</span><span class="n">nglu</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">iq</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="kt">int</span><span class="p">(</span> <span class="mf">2.99999</span> <span class="o">*</span> <span class="n">rndm</span><span class="p">.</span><span class="n">flat</span><span class="p">()</span> <span class="p">);</span>
        <span class="kt">double</span> <span class="n">px</span><span class="p">,</span> <span class="n">py</span><span class="p">,</span> <span class="n">pz</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">prod</span><span class="p">;</span>
        <span class="k">do</span> <span class="p">{</span>
          <span class="n">e</span> <span class="o">=</span>  <span class="n">ee</span> <span class="o">*</span> <span class="n">rndm</span><span class="p">.</span><span class="n">flat</span><span class="p">();</span>
          <span class="kt">double</span> <span class="n">cThe</span> <span class="o">=</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">rndm</span><span class="p">.</span><span class="n">flat</span><span class="p">()</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">;</span>
          <span class="kt">double</span> <span class="n">phi</span> <span class="o">=</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">M_PI</span> <span class="o">*</span> <span class="n">rndm</span><span class="p">.</span><span class="n">flat</span><span class="p">();</span>
          <span class="n">px</span> <span class="o">=</span> <span class="n">e</span> <span class="o">*</span> <span class="n">sqrt</span><span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">cThe</span><span class="o">*</span><span class="n">cThe</span><span class="p">)</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">);</span>
          <span class="n">py</span> <span class="o">=</span> <span class="n">e</span> <span class="o">*</span> <span class="n">sqrt</span><span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">cThe</span><span class="o">*</span><span class="n">cThe</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">);</span>
          <span class="n">pz</span> <span class="o">=</span> <span class="n">e</span> <span class="o">*</span> <span class="n">cThe</span><span class="p">;</span>
          <span class="n">prod</span> <span class="o">=</span> <span class="p">(</span> <span class="n">px</span> <span class="o">*</span> <span class="n">pQ</span><span class="p">[</span><span class="n">iq</span><span class="p">].</span><span class="n">px</span><span class="p">()</span> <span class="o">+</span> <span class="n">py</span> <span class="o">*</span> <span class="n">pQ</span><span class="p">[</span><span class="n">iq</span><span class="p">].</span><span class="n">py</span><span class="p">()</span> <span class="o">+</span> <span class="n">pz</span> <span class="o">*</span> <span class="n">pQ</span><span class="p">[</span><span class="n">iq</span><span class="p">].</span><span class="n">pz</span><span class="p">()</span> <span class="p">)</span>
            <span class="o">/</span> <span class="n">e</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">prod</span> <span class="o">&lt;</span> <span class="n">cosThetaMin</span><span class="p">);</span>
        <span class="kt">int</span> <span class="n">colNew</span> <span class="o">=</span> <span class="mi">104</span> <span class="o">+</span> <span class="n">nglu</span><span class="p">;</span>
        <span class="n">event</span><span class="p">.</span><span class="n">append</span><span class="p">(</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">colNew</span><span class="p">,</span> <span class="n">colNow</span><span class="p">[</span><span class="n">iq</span><span class="p">],</span>
          <span class="n">px</span><span class="p">,</span> <span class="n">py</span><span class="p">,</span> <span class="n">pz</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="mf">0.</span><span class="p">);</span>
        <span class="n">colNow</span><span class="p">[</span><span class="n">iq</span><span class="p">]</span> <span class="o">=</span> <span class="n">colNew</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="c1">// Update daughter range of mother.</span>
      <span class="n">event</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">daughters</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">event</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="c1">// Information on a q q qbar qbar dijunction system, to be hadronized.</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">type</span> <span class="o">&gt;=</span> <span class="mi">6</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// The two fictitious beam remnant particles; needed for junctions.</span>
    <span class="n">event</span><span class="p">.</span><span class="n">append</span><span class="p">(</span> <span class="mi">2212</span><span class="p">,</span> <span class="o">-</span><span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">ee</span><span class="p">,</span> <span class="n">ee</span><span class="p">,</span> <span class="mf">0.</span><span class="p">);</span>
    <span class="n">event</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mi">2212</span><span class="p">,</span> <span class="o">-</span><span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">ee</span><span class="p">,</span> <span class="n">ee</span><span class="p">,</span> <span class="mf">0.</span><span class="p">);</span>
    <span class="c1">// Opening angle between &quot;diquark&quot; legs.</span>
    <span class="kt">double</span> <span class="n">theta</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">cThe</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
    <span class="kt">double</span> <span class="n">sThe</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
    <span class="c1">// Set one colour depending on whether more gluons or not.</span>
    <span class="kt">int</span> <span class="n">acol</span> <span class="o">=</span> <span class="p">(</span><span class="n">type</span> <span class="o">==</span> <span class="mi">6</span><span class="p">)</span> <span class="o">?</span> <span class="mi">103</span> <span class="o">:</span> <span class="mi">106</span><span class="p">;</span>
    <span class="c1">// The four endpoint q q qbar qbar; the minimal system.</span>
    <span class="c1">// Two additional fictitious partons to make up original beams.</span>
    <span class="n">event</span><span class="p">.</span><span class="n">append</span><span class="p">(</span>  <span class="mi">2</span><span class="p">,</span>   <span class="mi">23</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                  <span class="n">ee</span> <span class="o">*</span> <span class="n">sThe</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span>  <span class="n">ee</span> <span class="o">*</span> <span class="n">cThe</span><span class="p">,</span> <span class="n">ee</span><span class="p">,</span> <span class="mf">0.</span><span class="p">);</span>
    <span class="n">event</span><span class="p">.</span><span class="n">append</span><span class="p">(</span>  <span class="mi">1</span><span class="p">,</span>   <span class="mi">23</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                 <span class="o">-</span><span class="n">ee</span> <span class="o">*</span> <span class="n">sThe</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span>  <span class="n">ee</span> <span class="o">*</span> <span class="n">cThe</span><span class="p">,</span> <span class="n">ee</span><span class="p">,</span> <span class="mf">0.</span><span class="p">);</span>
    <span class="n">event</span><span class="p">.</span><span class="n">append</span><span class="p">(</span>  <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">21</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">103</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                         <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span>  <span class="n">ee</span>       <span class="p">,</span> <span class="n">ee</span><span class="p">,</span> <span class="mf">0.</span><span class="p">);</span>
    <span class="n">event</span><span class="p">.</span><span class="n">append</span><span class="p">(</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span>   <span class="mi">23</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span>
                  <span class="n">ee</span> <span class="o">*</span> <span class="n">sThe</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="n">ee</span> <span class="o">*</span> <span class="n">cThe</span><span class="p">,</span> <span class="n">ee</span><span class="p">,</span> <span class="mf">0.</span><span class="p">);</span>
    <span class="n">event</span><span class="p">.</span><span class="n">append</span><span class="p">(</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>   <span class="mi">23</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span>
                 <span class="o">-</span><span class="n">ee</span> <span class="o">*</span> <span class="n">sThe</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="n">ee</span> <span class="o">*</span> <span class="n">cThe</span><span class="p">,</span> <span class="n">ee</span><span class="p">,</span> <span class="mf">0.</span><span class="p">);</span>
    <span class="n">event</span><span class="p">.</span><span class="n">append</span><span class="p">(</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">21</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">acol</span><span class="p">,</span>
                         <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="n">ee</span>       <span class="p">,</span> <span class="n">ee</span><span class="p">,</span> <span class="mf">0.</span><span class="p">);</span>
    <span class="c1">// Add extra gluons on string between junctions.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">type</span> <span class="o">==</span> <span class="mi">7</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">event</span><span class="p">.</span><span class="n">append</span><span class="p">(</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">103</span><span class="p">,</span> <span class="mi">106</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">ee</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">ee</span><span class="p">,</span> <span class="mf">0.</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">type</span> <span class="o">==</span> <span class="mi">8</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">event</span><span class="p">.</span><span class="n">append</span><span class="p">(</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">103</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">ee</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">ee</span><span class="p">,</span> <span class="mf">0.</span><span class="p">);</span>
      <span class="n">event</span><span class="p">.</span><span class="n">append</span><span class="p">(</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">106</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span><span class="o">-</span><span class="n">ee</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">ee</span><span class="p">,</span> <span class="mf">0.</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">type</span> <span class="o">==</span> <span class="mi">9</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">event</span><span class="p">.</span><span class="n">append</span><span class="p">(</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">103</span><span class="p">,</span> <span class="mi">107</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">ee</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">ee</span><span class="p">,</span> <span class="mf">0.</span><span class="p">);</span>
      <span class="n">event</span><span class="p">.</span><span class="n">append</span><span class="p">(</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">107</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="n">ee</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">ee</span><span class="p">,</span> <span class="mf">0.</span><span class="p">);</span>
      <span class="n">event</span><span class="p">.</span><span class="n">append</span><span class="p">(</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">106</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span><span class="o">-</span><span class="n">ee</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">ee</span><span class="p">,</span> <span class="mf">0.</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">type</span> <span class="o">==</span> <span class="mi">10</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">event</span><span class="p">.</span><span class="n">append</span><span class="p">(</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">103</span><span class="p">,</span> <span class="mi">107</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">ee</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">ee</span><span class="p">,</span> <span class="mf">0.</span><span class="p">);</span>
      <span class="n">event</span><span class="p">.</span><span class="n">append</span><span class="p">(</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">107</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="n">ee</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">ee</span><span class="p">,</span> <span class="mf">0.</span><span class="p">);</span>
      <span class="n">event</span><span class="p">.</span><span class="n">append</span><span class="p">(</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">109</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span><span class="o">-</span><span class="n">ee</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">ee</span><span class="p">,</span> <span class="mf">0.</span><span class="p">);</span>
      <span class="n">event</span><span class="p">.</span><span class="n">append</span><span class="p">(</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">109</span><span class="p">,</span> <span class="mi">106</span><span class="p">,</span><span class="o">-</span><span class="n">ee</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">ee</span><span class="p">,</span> <span class="mf">0.</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="c1">// No more cases: done.</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="c1">//==========================================================================</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Pick kind of events to generate:</span>
  <span class="c1">// 0 = single-particle gun.</span>
  <span class="c1">// 1 = q qbar.</span>
  <span class="c1">// 2 = g g.</span>
  <span class="c1">// 3 = g g g.</span>
  <span class="c1">// 4 = minimal q q q junction topology.</span>
  <span class="c1">// 5 = q q q junction topology with gluons on the strings.</span>
  <span class="c1">// 6 = q q qbar qbar dijunction topology, no gluons.</span>
  <span class="c1">// 7 - 10 = ditto, but with 1 - 4 gluons on string between junctions.</span>
  <span class="c1">// 11 = single-resonance gun.</span>
  <span class="c1">// 12 = q qbar plus parton shower.</span>
  <span class="c1">// 13 = g g plus parton shower.</span>
  <span class="kt">int</span> <span class="n">type</span> <span class="o">=</span> <span class="mi">11</span><span class="p">;</span>
  <span class="c1">// Set particle species and energy for single-particle gun.</span>
  <span class="kt">int</span>    <span class="n">idGun</span>  <span class="o">=</span> <span class="p">(</span><span class="n">type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">?</span> <span class="mi">15</span> <span class="o">:</span> <span class="mi">25</span><span class="p">;</span>
  <span class="kt">double</span> <span class="n">eeGun</span>  <span class="o">=</span> <span class="p">(</span><span class="n">type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">?</span> <span class="mf">20.</span> <span class="o">:</span> <span class="mf">125.</span><span class="p">;</span>
  <span class="kt">bool</span>   <span class="n">atRest</span> <span class="o">=</span> <span class="p">(</span><span class="n">type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">?</span> <span class="nb">false</span> <span class="o">:</span> <span class="nb">true</span><span class="p">;</span>
  <span class="c1">// Set typical energy per parton.</span>
  <span class="kt">double</span> <span class="n">ee</span> <span class="o">=</span> <span class="mf">20.0</span><span class="p">;</span>
  <span class="c1">// Set number of events to generate and to list.</span>
  <span class="kt">int</span> <span class="n">nEvent</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">nList</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
  <span class="c1">// Generator; shorthand for event and particleData.</span>
  <span class="n">Pythia</span> <span class="n">pythia</span><span class="p">;</span>
  <span class="n">Event</span><span class="o">&amp;</span> <span class="n">event</span>      <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">;</span>
  <span class="n">ParticleData</span><span class="o">&amp;</span> <span class="n">pdt</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">particleData</span><span class="p">;</span>
  <span class="c1">// Key requirement: switch off ProcessLevel, and thereby also PartonLevel.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;ProcessLevel:all = off&quot;</span><span class="p">);</span>
  <span class="c1">// Optionally switch off resonance decays, or only showers in them.</span>
  <span class="c1">//pythia.readString(&quot;ProcessLevel:resonanceDecays = off&quot;);</span>
  <span class="c1">//pythia.readString(&quot;PartonLevel:FSRinResonances = off&quot;);</span>
  <span class="c1">// Optionally switch off ordinary decays.</span>
  <span class="c1">//pythia.readString(&quot;HadronLevel:Decay = off&quot;);</span>
  <span class="c1">// Switch off automatic event listing in favour of manual.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Next:numberShowInfo = 0&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Next:numberShowProcess = 0&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Next:numberShowEvent = 0&quot;</span><span class="p">);</span>
  <span class="c1">// Initialize.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
  <span class="c1">// Book histograms.</span>
  <span class="n">Hist</span> <span class="n">epCons</span><span class="p">(</span><span class="s">&quot;deviation from energy-momentum conservation&quot;</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1e-4</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">chgCons</span><span class="p">(</span><span class="s">&quot;deviation from charge conservation&quot;</span><span class="p">,</span><span class="mi">57</span><span class="p">,</span><span class="o">-</span><span class="mf">9.5</span><span class="p">,</span><span class="mf">9.5</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">nFinal</span><span class="p">(</span><span class="s">&quot;final particle multiplicity&quot;</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">99.5</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">dnparticledp</span><span class="p">(</span><span class="s">&quot;dn/dp for particles&quot;</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="n">ee</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">status85</span><span class="p">(</span><span class="s">&quot;multiplicity status code 85&quot;</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">49.5</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">status86</span><span class="p">(</span><span class="s">&quot;multiplicity status code 86&quot;</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">49.5</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">status83</span><span class="p">(</span><span class="s">&quot;multiplicity status code 83&quot;</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">49.5</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">status84</span><span class="p">(</span><span class="s">&quot;multiplicity status code 84&quot;</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">49.5</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">dndtheta</span><span class="p">(</span><span class="s">&quot;particle flow in event plane&quot;</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="o">-</span><span class="n">M_PI</span><span class="p">,</span><span class="n">M_PI</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">dedtheta</span><span class="p">(</span><span class="s">&quot;energy flow in event plane&quot;</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="o">-</span><span class="n">M_PI</span><span class="p">,</span><span class="n">M_PI</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">dpartondtheta</span><span class="p">(</span><span class="s">&quot;parton flow in event plane&quot;</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="o">-</span><span class="n">M_PI</span><span class="p">,</span><span class="n">M_PI</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">dndyAnti</span><span class="p">(</span><span class="s">&quot;dn/dy primaries antijunction&quot;</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.</span><span class="p">,</span> <span class="mf">10.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">dndyJun</span><span class="p">(</span><span class="s">&quot;dn/dy primaries junction&quot;</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.</span><span class="p">,</span> <span class="mf">10.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">dndySum</span><span class="p">(</span><span class="s">&quot;dn/dy all primaries&quot;</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.</span><span class="p">,</span> <span class="mf">10.</span><span class="p">);</span>
  <span class="c1">// Begin of event loop.</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iEvent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iEvent</span> <span class="o">&lt;</span> <span class="n">nEvent</span><span class="p">;</span> <span class="o">++</span><span class="n">iEvent</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Set up single particle, with random direction in solid angle.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">type</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">type</span> <span class="o">==</span> <span class="mi">11</span><span class="p">)</span> <span class="n">fillParticle</span><span class="p">(</span> <span class="n">idGun</span><span class="p">,</span> <span class="n">eeGun</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span>
      <span class="n">event</span><span class="p">,</span> <span class="n">pdt</span><span class="p">,</span> <span class="n">pythia</span><span class="p">.</span><span class="n">rndm</span><span class="p">,</span> <span class="n">atRest</span><span class="p">);</span>
    <span class="c1">// Set up parton-level configuration.</span>
    <span class="k">else</span> <span class="n">fillPartons</span><span class="p">(</span> <span class="n">type</span><span class="p">,</span> <span class="n">ee</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">pdt</span><span class="p">,</span> <span class="n">pythia</span><span class="p">.</span><span class="n">rndm</span><span class="p">);</span>
    <span class="c1">// To have partons shower they must be set maximum allowed scale.</span>
    <span class="c1">// (Can be set individually to restrict radiation differently.)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">type</span> <span class="o">==</span> <span class="mi">12</span> <span class="o">||</span> <span class="n">type</span> <span class="o">==</span> <span class="mi">13</span><span class="p">)</span> <span class="p">{</span>
      <span class="kt">double</span> <span class="n">scale</span> <span class="o">=</span> <span class="n">ee</span><span class="p">;</span>
      <span class="n">event</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">scale</span><span class="p">(</span> <span class="n">scale</span><span class="p">);</span>
      <span class="n">event</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">scale</span><span class="p">(</span> <span class="n">scale</span><span class="p">);</span>
      <span class="c1">// Now actually do the shower, for range of partons, and max scale.</span>
      <span class="c1">// (Most restrictive of global and individual applied to each parton.)</span>
      <span class="n">pythia</span><span class="p">.</span><span class="n">forceTimeShower</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">scale</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="c1">// Generate events. Quit if failure.</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">())</span> <span class="p">{</span>
      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; Event generation aborted prematurely, owing to error!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// List first few events.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">iEvent</span> <span class="o">&lt;</span> <span class="n">nList</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">event</span><span class="p">.</span><span class="n">list</span><span class="p">();</span>
      <span class="c1">// Also list junctions.</span>
      <span class="n">event</span><span class="p">.</span><span class="n">listJunctions</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="c1">// Initialize statistics.</span>
    <span class="n">Vec4</span> <span class="n">pSum</span> <span class="o">=</span> <span class="o">-</span> <span class="n">event</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">p</span><span class="p">();</span>
    <span class="kt">double</span> <span class="n">chargeSum</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="n">chargeSum</span> <span class="o">=</span> <span class="o">-</span><span class="n">event</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">charge</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">type</span> <span class="o">==</span> <span class="mi">4</span> <span class="o">||</span> <span class="n">type</span> <span class="o">==</span> <span class="mi">5</span><span class="p">)</span> <span class="n">chargeSum</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">nFin</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">n85</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">n86</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">n83</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">n84</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="c1">// Loop over all particles.</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">event</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
      <span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">statusAbs</span><span class="p">();</span>
      <span class="c1">// Find any unrecognized particle codes.</span>
      <span class="kt">int</span> <span class="n">id</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">id</span><span class="p">();</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">id</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="o">!</span><span class="n">pdt</span><span class="p">.</span><span class="n">isParticle</span><span class="p">(</span><span class="n">id</span><span class="p">))</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; Error! Unknown code id = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">id</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
      <span class="c1">// Find particles with E-p mismatch.</span>
      <span class="kt">double</span> <span class="n">eCalc</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">eCalc</span><span class="p">();</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">eCalc</span><span class="o">/</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">e</span><span class="p">()</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1e-6</span><span class="p">)</span> <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; e mismatch, i = &quot;</span>
        <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; e_nominal = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">e</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; e-from-p = &quot;</span>
        <span class="o">&lt;&lt;</span> <span class="n">eCalc</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; m-from-e &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">mCalc</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
      <span class="c1">// Parton flow in event plane.</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">==</span> <span class="mi">71</span> <span class="o">||</span> <span class="n">status</span> <span class="o">==</span> <span class="mi">72</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">double</span> <span class="n">thetaXZ</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">thetaXZ</span><span class="p">();</span>
        <span class="n">dpartondtheta</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span><span class="n">thetaXZ</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="c1">// Origin of primary hadrons.</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">==</span> <span class="mi">85</span><span class="p">)</span> <span class="o">++</span><span class="n">n85</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">==</span> <span class="mi">86</span><span class="p">)</span> <span class="o">++</span><span class="n">n86</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">==</span> <span class="mi">83</span><span class="p">)</span> <span class="o">++</span><span class="n">n83</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">==</span> <span class="mi">84</span><span class="p">)</span> <span class="o">++</span><span class="n">n84</span><span class="p">;</span>
      <span class="c1">// Flow of primary hadrons in the event plane.</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">&gt;</span> <span class="mi">80</span> <span class="o">&amp;&amp;</span> <span class="n">status</span> <span class="o">&lt;</span> <span class="mi">90</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">double</span> <span class="n">eAbs</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">e</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">eAbs</span> <span class="o">&lt;</span> <span class="mf">0.</span><span class="p">)</span> <span class="p">{</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; e &lt; 0 line &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">i</span><span class="p">;</span> <span class="n">event</span><span class="p">.</span><span class="n">list</span><span class="p">();}</span>
        <span class="kt">double</span> <span class="n">thetaXZ</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">thetaXZ</span><span class="p">();</span>
        <span class="n">dndtheta</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span><span class="n">thetaXZ</span><span class="p">);</span>
        <span class="n">dedtheta</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span><span class="n">thetaXZ</span><span class="p">,</span> <span class="n">eAbs</span><span class="p">);</span>
        <span class="c1">// Rapidity distribution of primary hadrons.</span>
        <span class="kt">double</span> <span class="n">y</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">y</span><span class="p">();</span>
        <span class="n">dndySum</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span><span class="n">y</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">type</span> <span class="o">&gt;=</span> <span class="mi">6</span><span class="p">)</span> <span class="p">{</span>
          <span class="kt">int</span> <span class="n">motherId</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">mother1</span><span class="p">()].</span><span class="n">id</span><span class="p">();</span>
          <span class="k">if</span> <span class="p">(</span><span class="n">motherId</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="n">dndyJun</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">y</span><span class="p">());</span>
          <span class="k">else</span> <span class="n">dndyAnti</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">y</span><span class="p">());</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="c1">// Study final-state particles.</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">isFinal</span><span class="p">())</span> <span class="p">{</span>
        <span class="n">pSum</span> <span class="o">+=</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">p</span><span class="p">();</span>
        <span class="n">chargeSum</span> <span class="o">+=</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">charge</span><span class="p">();</span>
        <span class="n">nFin</span><span class="o">++</span><span class="p">;</span>
        <span class="kt">double</span> <span class="n">pAbs</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pAbs</span><span class="p">();</span>
        <span class="n">dnparticledp</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span><span class="n">pAbs</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="c1">// Fill histograms once for each event.</span>
    <span class="kt">double</span> <span class="n">epDev</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">pSum</span><span class="p">.</span><span class="n">e</span><span class="p">())</span> <span class="o">+</span> <span class="n">abs</span><span class="p">(</span><span class="n">pSum</span><span class="p">.</span><span class="n">px</span><span class="p">())</span> <span class="o">+</span> <span class="n">abs</span><span class="p">(</span><span class="n">pSum</span><span class="p">.</span><span class="n">py</span><span class="p">())</span>
      <span class="o">+</span> <span class="n">abs</span><span class="p">(</span><span class="n">pSum</span><span class="p">.</span><span class="n">pz</span><span class="p">());</span>
    <span class="n">epCons</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span><span class="n">epDev</span><span class="p">);</span>
    <span class="n">chgCons</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span><span class="n">chargeSum</span><span class="p">);</span>
    <span class="n">nFinal</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span><span class="n">nFin</span><span class="p">);</span>
    <span class="n">status85</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span><span class="n">n85</span><span class="p">);</span>
    <span class="n">status86</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span><span class="n">n86</span><span class="p">);</span>
    <span class="n">status83</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span><span class="n">n83</span><span class="p">);</span>
    <span class="n">status84</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span><span class="n">n84</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">epDev</span> <span class="o">&gt;</span> <span class="mf">1e-3</span>  <span class="o">||</span> <span class="n">abs</span><span class="p">(</span><span class="n">chargeSum</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.1</span><span class="p">)</span> <span class="n">event</span><span class="p">.</span><span class="n">list</span><span class="p">();</span>
  <span class="c1">// End of event loop.</span>
  <span class="p">}</span>
  <span class="c1">// Print statistics, histograms and done.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">epCons</span> <span class="o">&lt;&lt;</span> <span class="n">chgCons</span> <span class="o">&lt;&lt;</span> <span class="n">nFinal</span> <span class="o">&lt;&lt;</span> <span class="n">dnparticledp</span>
       <span class="o">&lt;&lt;</span> <span class="n">dndtheta</span> <span class="o">&lt;&lt;</span> <span class="n">dedtheta</span> <span class="o">&lt;&lt;</span> <span class="n">dpartondtheta</span> <span class="o">&lt;&lt;</span> <span class="n">dndySum</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">type</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">)</span> <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">status85</span> <span class="o">&lt;&lt;</span> <span class="n">status86</span> <span class="o">&lt;&lt;</span> <span class="n">status83</span>
       <span class="o">&lt;&lt;</span> <span class="n">status84</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">type</span> <span class="o">&gt;=</span> <span class="mi">6</span><span class="p">)</span> <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">dndyJun</span> <span class="o">&lt;&lt;</span> <span class="n">dndyAnti</span><span class="p">;</span>
  <span class="c1">// Done.</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
    </div>
  </div>
</div>

</div> <div class="well well-sm"> <h1 id="main22cc">main22.cc</h1><hr>
<div class="codehilite"><pre><span class="c1">// main22.cc is a part of the PYTHIA event generator.</span>
<span class="c1">// Copyright (C) 2016 Torbjorn Sjostrand.</span>
<span class="c1">// PYTHIA is licenced under the GNU GPL version 2, see COPYING for details.</span>
<span class="c1">// Please respect the MCnet Guidelines, see GUIDELINES for details.</span>
<span class="c1">// Simple illustration how to provide (a) your own resonance-width class,</span>
<span class="c1">// and (b) your own cross-section class, with instances handed in to Pythia.</span>
<span class="c1">// The hypothetical scenario is that top would have been so long-lived</span>
<span class="c1">// that a toponium resonance Theta could form. Then production could</span>
<span class="c1">// proceed via q qbar -&gt; gamma*/Z* -&gt; Theta, with decay either to</span>
<span class="c1">// a fermion pair or (dominantly) to three gluons.</span>
<span class="c1">// The implementation is not physically correct in any number of ways,</span>
<span class="c1">// but should exemplify the strategy needed for realistic cases.</span>
</pre></div>


<div class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" href="#fileid21">Rest of the main22.cc code</a>
    </h4>
  </div>
  <div id="fileid21" class="panel-collapse collapse">
    <div class="panel-body">
<div class="codehilite"><pre><span class="cp">#include</span> <span class="cpf">&quot;Pythia8/Pythia.h&quot;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">Pythia8</span><span class="p">;</span>
<span class="c1">//==========================================================================</span>
<span class="c1">// The ResonanceTheta class handles a toponium resonance.</span>
<span class="k">class</span> <span class="nc">ResonanceTheta</span> <span class="o">:</span> <span class="k">public</span> <span class="n">ResonanceWidths</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="c1">// Constructor.</span>
  <span class="n">ResonanceTheta</span><span class="p">(</span><span class="kt">int</span> <span class="n">idResIn</span><span class="p">)</span> <span class="p">{</span><span class="n">initBasic</span><span class="p">(</span><span class="n">idResIn</span><span class="p">);}</span>
<span class="k">private</span><span class="o">:</span>
  <span class="c1">// Locally stored properties and couplings.</span>
  <span class="kt">double</span> <span class="n">normTheta2qqbar</span><span class="p">,</span> <span class="n">normTheta2llbar</span><span class="p">,</span> <span class="n">normTheta2ggg</span><span class="p">;</span>
  <span class="c1">// Initialize constants.</span>
  <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">initConstants</span><span class="p">();</span>
  <span class="c1">// Calculate various common prefactors for the current mass.</span>
  <span class="c1">// Superfluous here, so skipped.</span>
  <span class="c1">//virtual void calcPreFac(bool = false);</span>
  <span class="c1">// Calculate width for currently considered channel.</span>
  <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">calcWidth</span><span class="p">(</span><span class="kt">bool</span> <span class="o">=</span> <span class="nb">false</span><span class="p">);</span>
<span class="p">};</span>
<span class="c1">//--------------------------------------------------------------------------</span>
<span class="c1">// Initialize constants.</span>
<span class="kt">void</span> <span class="n">ResonanceTheta</span><span class="o">::</span><span class="n">initConstants</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Dummy normalization of couplings to the allowed decay channels.</span>
  <span class="n">normTheta2qqbar</span> <span class="o">=</span> <span class="mf">0.0001</span><span class="p">;</span>
  <span class="n">normTheta2llbar</span> <span class="o">=</span> <span class="mf">0.0001</span><span class="p">;</span>
  <span class="n">normTheta2ggg</span>   <span class="o">=</span> <span class="mf">0.001</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">//--------------------------------------------------------------------------</span>
<span class="c1">// Calculate width for currently considered channel.</span>
<span class="kt">void</span> <span class="n">ResonanceTheta</span><span class="o">::</span><span class="n">calcWidth</span><span class="p">(</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Expression for Theta -&gt; q qbar (q up to b). Colour factor.</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">id1Abs</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">)</span> <span class="n">widNow</span> <span class="o">=</span> <span class="mf">3.</span> <span class="o">*</span> <span class="n">normTheta2qqbar</span> <span class="o">*</span> <span class="n">mHat</span><span class="p">;</span>
  <span class="c1">// Expression for Theta -&gt; l lbar (l = e, mu, tau).</span>
  <span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">id1Abs</span> <span class="o">==</span> <span class="mi">11</span>  <span class="o">||</span> <span class="n">id1Abs</span> <span class="o">==</span> <span class="mi">13</span> <span class="o">||</span> <span class="n">id1Abs</span> <span class="o">==</span> <span class="mi">15</span><span class="p">)</span>
    <span class="n">widNow</span> <span class="o">=</span> <span class="n">normTheta2llbar</span> <span class="o">*</span> <span class="n">mHat</span><span class="p">;</span>
  <span class="c1">// Expression for Theta -&gt; g g g. Colour factor.</span>
  <span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">id1Abs</span> <span class="o">==</span> <span class="mi">21</span><span class="p">)</span> <span class="n">widNow</span> <span class="o">=</span> <span class="mf">8.</span> <span class="o">*</span> <span class="n">normTheta2ggg</span> <span class="o">*</span> <span class="n">mHat</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">//==========================================================================</span>
<span class="c1">// A derived class for q qbar -&gt; Theta (toponium bound state).</span>
<span class="k">class</span> <span class="nc">Sigma1qqbar2Theta</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Sigma1Process</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="c1">// Constructor.</span>
  <span class="n">Sigma1qqbar2Theta</span><span class="p">()</span> <span class="p">{}</span>
  <span class="c1">// Initialize process.</span>
  <span class="k">virtual</span> <span class="kt">void</span> <span class="n">initProc</span><span class="p">();</span>
  <span class="c1">// Calculate flavour-independent parts of cross section.</span>
  <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">sigmaKin</span><span class="p">();</span>
  <span class="c1">// Evaluate sigmaHat(sHat). Assumed flavour-independent so simple.</span>
  <span class="k">virtual</span> <span class="kt">double</span> <span class="nf">sigmaHat</span><span class="p">()</span> <span class="p">{</span><span class="k">return</span> <span class="n">sigma</span><span class="p">;}</span>
  <span class="c1">// Select flavour, colour and anticolour.</span>
  <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">setIdColAcol</span><span class="p">();</span>
  <span class="c1">// Evaluate weight for decay angles.</span>
  <span class="k">virtual</span> <span class="kt">double</span> <span class="nf">weightDecay</span><span class="p">(</span> <span class="n">Event</span><span class="o">&amp;</span> <span class="n">process</span><span class="p">,</span> <span class="kt">int</span> <span class="n">iResBeg</span><span class="p">,</span> <span class="kt">int</span> <span class="n">iResEnd</span><span class="p">);</span>
  <span class="c1">// Info on the subprocess.</span>
  <span class="k">virtual</span> <span class="n">string</span> <span class="nf">name</span><span class="p">()</span>       <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="s">&quot;q qbar -&gt; Theta&quot;</span><span class="p">;}</span>
  <span class="k">virtual</span> <span class="kt">int</span>    <span class="nf">code</span><span class="p">()</span>       <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="mi">621</span><span class="p">;}</span>
  <span class="k">virtual</span> <span class="n">string</span> <span class="nf">inFlux</span><span class="p">()</span>     <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="s">&quot;qqbarSame&quot;</span><span class="p">;}</span>
  <span class="k">virtual</span> <span class="kt">int</span>    <span class="nf">resonanceA</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="mi">663</span><span class="p">;}</span>
<span class="k">private</span><span class="o">:</span>
  <span class="c1">// Store flavour-specific process information and standard prefactor.</span>
  <span class="kt">int</span>    <span class="n">idTheta</span><span class="p">;</span>
  <span class="kt">double</span> <span class="n">mRes</span><span class="p">,</span> <span class="n">GammaRes</span><span class="p">,</span> <span class="n">m2Res</span><span class="p">,</span> <span class="n">GamMRat</span><span class="p">,</span> <span class="n">normTheta2qqbar</span><span class="p">,</span> <span class="n">sigma</span><span class="p">;</span>
  <span class="c1">// Pointer to properties of Theta, to access decay width.</span>
  <span class="n">ParticleDataEntry</span><span class="o">*</span> <span class="n">particlePtr</span><span class="p">;</span>
<span class="p">};</span>
<span class="c1">//--------------------------------------------------------------------------</span>
<span class="c1">// Initialize process.</span>
<span class="kt">void</span> <span class="n">Sigma1qqbar2Theta</span><span class="o">::</span><span class="n">initProc</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Store Theta mass and width for propagator.</span>
  <span class="n">idTheta</span>  <span class="o">=</span> <span class="mi">663</span><span class="p">;</span>
  <span class="n">mRes</span>     <span class="o">=</span> <span class="n">particleDataPtr</span><span class="o">-&gt;</span><span class="n">m0</span><span class="p">(</span><span class="n">idTheta</span><span class="p">);</span>
  <span class="n">GammaRes</span> <span class="o">=</span> <span class="n">particleDataPtr</span><span class="o">-&gt;</span><span class="n">mWidth</span><span class="p">(</span><span class="n">idTheta</span><span class="p">);</span>
  <span class="n">m2Res</span>    <span class="o">=</span> <span class="n">mRes</span><span class="o">*</span><span class="n">mRes</span><span class="p">;</span>
  <span class="n">GamMRat</span>  <span class="o">=</span> <span class="n">GammaRes</span> <span class="o">/</span> <span class="n">mRes</span><span class="p">;</span>
  <span class="c1">// Same normlization as in ResonanceTheta for coupling strength.</span>
  <span class="n">normTheta2qqbar</span> <span class="o">=</span> <span class="mf">0.0001</span><span class="p">;</span>
  <span class="c1">// Set pointer to particle properties and decay table.</span>
  <span class="n">particlePtr</span> <span class="o">=</span> <span class="n">particleDataPtr</span><span class="o">-&gt;</span><span class="n">particleDataEntryPtr</span><span class="p">(</span><span class="n">idTheta</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">//--------------------------------------------------------------------------</span>
<span class="c1">// Evaluate sigmaHat(sHat); first step when inflavours unknown.</span>
<span class="kt">void</span> <span class="n">Sigma1qqbar2Theta</span><span class="o">::</span><span class="n">sigmaKin</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Incoming width with colour factor.</span>
  <span class="kt">double</span> <span class="n">widthIn</span>  <span class="o">=</span> <span class="n">normTheta2qqbar</span> <span class="o">*</span> <span class="n">mH</span> <span class="o">/</span> <span class="mf">3.</span><span class="p">;</span>
  <span class="c1">// Breit-Wigner, including some (guessed) spin factors.</span>
  <span class="kt">double</span> <span class="n">sigBW</span>    <span class="o">=</span> <span class="mf">12.</span> <span class="o">*</span> <span class="n">M_PI</span> <span class="o">/</span> <span class="p">(</span> <span class="n">pow2</span><span class="p">(</span><span class="n">sH</span> <span class="o">-</span> <span class="n">m2Res</span><span class="p">)</span> <span class="o">+</span> <span class="n">pow2</span><span class="p">(</span><span class="n">sH</span> <span class="o">*</span> <span class="n">GamMRat</span><span class="p">)</span> <span class="p">);</span>
  <span class="c1">// Outgoing width: only includes channels left open.</span>
  <span class="kt">double</span> <span class="n">widthOut</span> <span class="o">=</span> <span class="n">particlePtr</span><span class="o">-&gt;</span><span class="n">resWidthOpen</span><span class="p">(</span><span class="mi">663</span><span class="p">,</span> <span class="n">mH</span><span class="p">);</span>
  <span class="c1">// Total answer.</span>
  <span class="n">sigma</span> <span class="o">=</span> <span class="n">widthIn</span> <span class="o">*</span> <span class="n">sigBW</span> <span class="o">*</span> <span class="n">widthOut</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">//--------------------------------------------------------------------------</span>
<span class="c1">// Select identity, colour and anticolour.</span>
<span class="kt">void</span> <span class="n">Sigma1qqbar2Theta</span><span class="o">::</span><span class="n">setIdColAcol</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Flavours trivial.</span>
  <span class="n">setId</span><span class="p">(</span> <span class="n">id1</span><span class="p">,</span> <span class="n">id2</span><span class="p">,</span> <span class="n">idTheta</span><span class="p">);</span>
  <span class="c1">// Colour flow topologies. Swap when antiquarks.</span>
  <span class="n">setColAcol</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">id1</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="n">swapColAcol</span><span class="p">();</span>
<span class="p">}</span>
<span class="c1">//--------------------------------------------------------------------------</span>
<span class="c1">// Evaluate weight for Theta -&gt; g g g.</span>
<span class="kt">double</span> <span class="n">Sigma1qqbar2Theta</span><span class="o">::</span><span class="n">weightDecay</span><span class="p">(</span> <span class="n">Event</span><span class="o">&amp;</span> <span class="n">process</span><span class="p">,</span> <span class="kt">int</span> <span class="n">iResBeg</span><span class="p">,</span>
  <span class="kt">int</span> <span class="n">iResEnd</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Should be Theta decay. (This is only option here, so overkill.)</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">iResEnd</span> <span class="o">!=</span> <span class="n">iResBeg</span> <span class="o">||</span> <span class="n">process</span><span class="p">[</span><span class="n">iResBeg</span><span class="p">].</span><span class="n">idAbs</span><span class="p">()</span> <span class="o">!=</span> <span class="n">idTheta</span><span class="p">)</span>
    <span class="k">return</span> <span class="mf">1.</span><span class="p">;</span>
  <span class="c1">// Should be decay to three gluons.</span>
  <span class="kt">int</span> <span class="n">i1</span> <span class="o">=</span> <span class="n">process</span><span class="p">[</span><span class="n">iResBeg</span><span class="p">].</span><span class="n">daughter1</span><span class="p">();</span>
  <span class="kt">int</span> <span class="n">i2</span> <span class="o">=</span> <span class="n">i1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">i3</span> <span class="o">=</span> <span class="n">i2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">i3</span> <span class="o">!=</span> <span class="n">process</span><span class="p">[</span><span class="n">iResBeg</span><span class="p">].</span><span class="n">daughter2</span><span class="p">()</span> <span class="o">||</span> <span class="n">process</span><span class="p">[</span><span class="n">i1</span><span class="p">].</span><span class="n">id</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">21</span><span class="p">)</span>
    <span class="k">return</span> <span class="mf">1.</span><span class="p">;</span>
  <span class="c1">// Energy fractions x_i = 2 E_i/m_Theta of gluons in Theta rest frame.</span>
  <span class="kt">double</span> <span class="n">x1</span> <span class="o">=</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">process</span><span class="p">[</span><span class="n">i1</span><span class="p">].</span><span class="n">p</span><span class="p">()</span> <span class="o">*</span> <span class="n">process</span><span class="p">[</span><span class="n">iResBeg</span><span class="p">].</span><span class="n">p</span><span class="p">()</span>
            <span class="o">/</span> <span class="n">process</span><span class="p">[</span><span class="n">iResBeg</span><span class="p">].</span><span class="n">m2</span><span class="p">();</span>
  <span class="kt">double</span> <span class="n">x2</span> <span class="o">=</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">process</span><span class="p">[</span><span class="n">i2</span><span class="p">].</span><span class="n">p</span><span class="p">()</span> <span class="o">*</span> <span class="n">process</span><span class="p">[</span><span class="n">iResBeg</span><span class="p">].</span><span class="n">p</span><span class="p">()</span>
            <span class="o">/</span> <span class="n">process</span><span class="p">[</span><span class="n">iResBeg</span><span class="p">].</span><span class="n">m2</span><span class="p">();</span>
  <span class="kt">double</span> <span class="n">x3</span> <span class="o">=</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">process</span><span class="p">[</span><span class="n">i3</span><span class="p">].</span><span class="n">p</span><span class="p">()</span> <span class="o">*</span> <span class="n">process</span><span class="p">[</span><span class="n">iResBeg</span><span class="p">].</span><span class="n">p</span><span class="p">()</span>
            <span class="o">/</span> <span class="n">process</span><span class="p">[</span><span class="n">iResBeg</span><span class="p">].</span><span class="n">m2</span><span class="p">();</span>
  <span class="c1">// Matrix-element expression for Theta -&gt; g g g.</span>
  <span class="kt">double</span> <span class="n">wtME</span> <span class="o">=</span> <span class="n">pow2</span><span class="p">(</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">x2</span> <span class="o">*</span> <span class="n">x3</span><span class="p">)</span> <span class="p">)</span>
    <span class="o">+</span> <span class="n">pow2</span><span class="p">(</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">x2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">x1</span> <span class="o">*</span> <span class="n">x3</span><span class="p">)</span> <span class="p">)</span> <span class="o">+</span> <span class="n">pow2</span><span class="p">(</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">x3</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">x1</span> <span class="o">*</span> <span class="n">x2</span><span class="p">)</span> <span class="p">);</span>
  <span class="kt">double</span> <span class="n">wtMEmax</span> <span class="o">=</span> <span class="mf">2.</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">wtME</span> <span class="o">/</span> <span class="n">wtMEmax</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">//==========================================================================</span>
<span class="kt">int</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Number of events to generate. Max number of errors.</span>
  <span class="c1">// Warning: generation of complete events is much slower than if you use</span>
  <span class="c1">// PartonLevel:all = off to only get cross sections, so adjust nEvent.</span>
  <span class="kt">int</span> <span class="n">nEvent</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">nAbort</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
  <span class="c1">// Pythia generator.</span>
  <span class="n">Pythia</span> <span class="n">pythia</span><span class="p">;</span>
  <span class="c1">// Create the toponium resonance and a few production/decay channels.</span>
  <span class="c1">// Warning: many more exist, e.g. weak ones of one top quark.</span>
  <span class="c1">// Note: to obtain the correct width for the Breit-Wigner you must</span>
  <span class="c1">// include all channels, but you only need leave those on that you</span>
  <span class="c1">// want to study.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;663:new = Theta void 3 0 0 342.0 0.2 300. 400. 0.&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;663:addChannel = 1 0. 0 1 -1&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;663:addChannel = 1 0. 0 2 -2&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;663:addChannel = 1 0. 0 3 -3&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;663:addChannel = 1 0. 0 4 -4&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;663:addChannel = 1 0. 0 5 -5&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;663:addChannel = 1 0. 0 11 -11&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;663:addChannel = 1 0. 0 13 -13&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;663:addChannel = 1 0. 0 15 -15&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;663:addChannel = 1 0. 0 21 21 21&quot;</span><span class="p">);</span>
  <span class="c1">// Create instance of a class to calculate the width of Theta to the</span>
  <span class="c1">// above channels. Hand in pointer to Pythia.</span>
  <span class="c1">// Note: Pythia will automatically delete this pointer,</span>
  <span class="c1">// along with all other resonances.</span>
  <span class="n">ResonanceWidths</span><span class="o">*</span> <span class="n">resonanceTheta</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ResonanceTheta</span><span class="p">(</span><span class="mi">663</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">setResonancePtr</span><span class="p">(</span><span class="n">resonanceTheta</span><span class="p">);</span>
  <span class="c1">// Create instance of a class to generate the q qbar -&gt; Theta process</span>
  <span class="c1">// from an external matrix element. Hand in pointer to Pythia.</span>
  <span class="n">SigmaProcess</span><span class="o">*</span> <span class="n">sigma1Theta</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Sigma1qqbar2Theta</span><span class="p">();</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">setSigmaPtr</span><span class="p">(</span><span class="n">sigma1Theta</span><span class="p">);</span>
  <span class="c1">// Optionally only compare cross sections.</span>
  <span class="c1">//pythia.readString(&quot;PartonLevel:all = off&quot;);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Check:nErrList = 2&quot;</span><span class="p">);</span>
  <span class="c1">// Initialization for LHC.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
  <span class="c1">// Book histogram.</span>
  <span class="n">Hist</span> <span class="nf">mTheta</span><span class="p">(</span><span class="s">&quot;Theta mass&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">300.</span><span class="p">,</span> <span class="mf">400.</span><span class="p">);</span>
  <span class="c1">// Begin event loop.</span>
  <span class="kt">int</span> <span class="n">iAbort</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iEvent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iEvent</span> <span class="o">&lt;</span> <span class="n">nEvent</span><span class="p">;</span> <span class="o">++</span><span class="n">iEvent</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Generate events. Quit if many failures.</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">())</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">++</span><span class="n">iAbort</span> <span class="o">&lt;</span> <span class="n">nAbort</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; Event generation aborted prematurely, owing to error!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// Fill Theta mass. End of event loop.</span>
    <span class="n">mTheta</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">process</span><span class="p">[</span><span class="mi">5</span><span class="p">].</span><span class="n">m</span><span class="p">()</span> <span class="p">);</span>
  <span class="p">}</span>
  <span class="c1">// Final statistics. Print histogram.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">mTheta</span><span class="p">;</span>
  <span class="c1">// Done.</span>
  <span class="k">delete</span> <span class="n">sigma1Theta</span><span class="p">;</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
    </div>
  </div>
</div>

</div> <div class="well well-sm"> <h1 id="main23cc">main23.cc</h1><hr>
<div class="codehilite"><pre><span class="c1">// main23.cc is a part of the PYTHIA event generator.</span>
<span class="c1">// Copyright (C) 2016 Torbjorn Sjostrand.</span>
<span class="c1">// PYTHIA is licenced under the GNU GPL version 2, see COPYING for details.</span>
<span class="c1">// Please respect the MCnet Guidelines, see GUIDELINES for details.</span>
<span class="c1">// Example how to write a derived class for beam momentum and vertex spread,</span>
<span class="c1">// with an instance handed to Pythia for internal generation.</span>
<span class="c1">// Also how to write a derived class for external random numbers,</span>
<span class="c1">// and how to write a derived class for external parton distributions.</span>
<span class="c1">// Warning: the parameters are not realistic.</span>
</pre></div>


<div class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" href="#fileid22">Rest of the main23.cc code</a>
    </h4>
  </div>
  <div id="fileid22" class="panel-collapse collapse">
    <div class="panel-body">
<div class="codehilite"><pre><span class="cp">#include</span> <span class="cpf">&quot;Pythia8/Pythia.h&quot;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">Pythia8</span><span class="p">;</span>
<span class="c1">//==========================================================================</span>
<span class="c1">// A derived class to set beam momentum and interaction vertex spread.</span>
<span class="k">class</span> <span class="nc">MyBeamShape</span> <span class="o">:</span> <span class="k">public</span> <span class="n">BeamShape</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="c1">// Constructor.</span>
  <span class="n">MyBeamShape</span><span class="p">()</span> <span class="p">{}</span>
  <span class="c1">// Initialize beam parameters.</span>
  <span class="c1">// In this particular example we will reuse the existing settings names</span>
  <span class="c1">// but with modified meaning, so init() in the base class can be kept.</span>
  <span class="c1">//virtual void init( Settings&amp; settings, Rndm* rndmPtrIn);</span>
  <span class="c1">// Set the two beam momentum deviations and the beam vertex.</span>
  <span class="k">virtual</span> <span class="kt">void</span> <span class="n">pick</span><span class="p">();</span>
<span class="p">};</span>
<span class="c1">//--------------------------------------------------------------------------</span>
<span class="c1">// Set the two beam momentum deviations and the beam vertex.</span>
<span class="c1">// Note that momenta are in units of GeV and vertices in mm,</span>
<span class="c1">// always with c = 1, so that e.g. time is in mm/c.</span>
<span class="kt">void</span> <span class="n">MyBeamShape</span><span class="o">::</span><span class="n">pick</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Reset all values.</span>
  <span class="n">deltaPxA</span> <span class="o">=</span> <span class="n">deltaPyA</span> <span class="o">=</span> <span class="n">deltaPzA</span> <span class="o">=</span> <span class="n">deltaPxB</span> <span class="o">=</span> <span class="n">deltaPyB</span> <span class="o">=</span> <span class="n">deltaPzB</span>
    <span class="o">=</span> <span class="n">vertexX</span> <span class="o">=</span> <span class="n">vertexY</span> <span class="o">=</span> <span class="n">vertexZ</span> <span class="o">=</span> <span class="n">vertexT</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">;</span>
  <span class="c1">// Set beam A transverse momentum deviation by a two-dimensional Gaussian.</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">allowMomentumSpread</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">double</span> <span class="n">totalDev</span><span class="p">,</span> <span class="n">gauss</span><span class="p">;</span>
    <span class="k">do</span> <span class="p">{</span>
      <span class="n">totalDev</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">sigmaPxA</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">gauss</span>     <span class="o">=</span> <span class="n">rndmPtr</span><span class="o">-&gt;</span><span class="n">gauss</span><span class="p">();</span>
        <span class="n">deltaPxA</span>  <span class="o">=</span> <span class="n">sigmaPxA</span> <span class="o">*</span> <span class="n">gauss</span><span class="p">;</span>
        <span class="n">totalDev</span> <span class="o">+=</span> <span class="n">gauss</span> <span class="o">*</span> <span class="n">gauss</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">sigmaPyA</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">gauss</span>     <span class="o">=</span> <span class="n">rndmPtr</span><span class="o">-&gt;</span><span class="n">gauss</span><span class="p">();</span>
        <span class="n">deltaPyA</span>  <span class="o">=</span> <span class="n">sigmaPyA</span> <span class="o">*</span> <span class="n">gauss</span><span class="p">;</span>
        <span class="n">totalDev</span> <span class="o">+=</span> <span class="n">gauss</span> <span class="o">*</span> <span class="n">gauss</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">totalDev</span> <span class="o">&gt;</span> <span class="n">maxDevA</span> <span class="o">*</span> <span class="n">maxDevA</span><span class="p">);</span>
    <span class="c1">// Set beam A longitudinal momentum as a triangular shape.</span>
    <span class="c1">// Reuse sigmaPzA to represent maximum deviation in this case.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">sigmaPzA</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">deltaPzA</span>    <span class="o">=</span> <span class="n">sigmaPzA</span> <span class="o">*</span> <span class="p">(</span> <span class="mf">1.</span> <span class="o">-</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">rndmPtr</span><span class="o">-&gt;</span><span class="n">flat</span><span class="p">())</span> <span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">rndmPtr</span><span class="o">-&gt;</span><span class="n">flat</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">)</span> <span class="n">deltaPzA</span> <span class="o">=</span> <span class="o">-</span><span class="n">deltaPzA</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// Set beam B transverse momentum deviation by a two-dimensional Gaussian.</span>
    <span class="k">do</span> <span class="p">{</span>
      <span class="n">totalDev</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">sigmaPxB</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">gauss</span>     <span class="o">=</span> <span class="n">rndmPtr</span><span class="o">-&gt;</span><span class="n">gauss</span><span class="p">();</span>
        <span class="n">deltaPxB</span>  <span class="o">=</span> <span class="n">sigmaPxB</span> <span class="o">*</span> <span class="n">gauss</span><span class="p">;</span>
        <span class="n">totalDev</span> <span class="o">+=</span> <span class="n">gauss</span> <span class="o">*</span> <span class="n">gauss</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">sigmaPyB</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">gauss</span>     <span class="o">=</span> <span class="n">rndmPtr</span><span class="o">-&gt;</span><span class="n">gauss</span><span class="p">();</span>
        <span class="n">deltaPyB</span>  <span class="o">=</span> <span class="n">sigmaPyB</span> <span class="o">*</span> <span class="n">gauss</span><span class="p">;</span>
        <span class="n">totalDev</span> <span class="o">+=</span> <span class="n">gauss</span> <span class="o">*</span> <span class="n">gauss</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">totalDev</span> <span class="o">&gt;</span> <span class="n">maxDevB</span> <span class="o">*</span> <span class="n">maxDevB</span><span class="p">);</span>
    <span class="c1">// Set beam B longitudinal momentum as a triangular shape.</span>
    <span class="c1">// Reuse sigmaPzB to represent maximum deviation in this case.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">sigmaPzB</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">deltaPzB</span> <span class="o">=</span> <span class="n">sigmaPzB</span> <span class="o">*</span> <span class="p">(</span> <span class="mf">1.</span> <span class="o">-</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">rndmPtr</span><span class="o">-&gt;</span><span class="n">flat</span><span class="p">())</span> <span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">rndmPtr</span><span class="o">-&gt;</span><span class="n">flat</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">)</span> <span class="n">deltaPzB</span> <span class="o">=</span> <span class="o">-</span><span class="n">deltaPzB</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="c1">// Set beam vertex location by a two-dimensional Gaussian.</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">allowVertexSpread</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">double</span> <span class="n">totalDev</span><span class="p">,</span> <span class="n">gauss</span><span class="p">;</span>
    <span class="k">do</span> <span class="p">{</span>
      <span class="n">totalDev</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">sigmaVertexX</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">gauss</span>     <span class="o">=</span> <span class="n">rndmPtr</span><span class="o">-&gt;</span><span class="n">gauss</span><span class="p">();</span>
        <span class="n">vertexX</span>   <span class="o">=</span> <span class="n">sigmaVertexX</span> <span class="o">*</span> <span class="n">gauss</span><span class="p">;</span>
        <span class="n">totalDev</span> <span class="o">+=</span> <span class="n">gauss</span> <span class="o">*</span> <span class="n">gauss</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">sigmaVertexY</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">gauss</span>     <span class="o">=</span> <span class="n">rndmPtr</span><span class="o">-&gt;</span><span class="n">gauss</span><span class="p">();</span>
        <span class="n">vertexY</span>   <span class="o">=</span> <span class="n">sigmaVertexY</span> <span class="o">*</span> <span class="n">gauss</span><span class="p">;</span>
        <span class="n">totalDev</span> <span class="o">+=</span> <span class="n">gauss</span> <span class="o">*</span> <span class="n">gauss</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">totalDev</span> <span class="o">&gt;</span> <span class="n">maxDevVertex</span> <span class="o">*</span> <span class="n">maxDevVertex</span><span class="p">);</span>
    <span class="c1">// Set beam B longitudinal momentum as a triangular shape.</span>
    <span class="c1">// This corresponds to two step-function beams colliding.</span>
    <span class="c1">// Reuse sigmaVertexZ to represent maximum deviation in this case.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">sigmaVertexZ</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">vertexZ</span>     <span class="o">=</span> <span class="n">sigmaVertexZ</span> <span class="o">*</span> <span class="p">(</span> <span class="mf">1.</span> <span class="o">-</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">rndmPtr</span><span class="o">-&gt;</span><span class="n">flat</span><span class="p">())</span> <span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">rndmPtr</span><span class="o">-&gt;</span><span class="n">flat</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">)</span> <span class="n">vertexZ</span> <span class="o">=</span> <span class="o">-</span><span class="n">vertexZ</span><span class="p">;</span>
      <span class="c1">// Set beam collision time flat between +-(sigmaVertexZ - |vertexZ|).</span>
      <span class="c1">// This corresponds to two step-function beams colliding (with v = c).</span>
      <span class="n">vertexT</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.</span> <span class="o">*</span> <span class="n">rndmPtr</span><span class="o">-&gt;</span><span class="n">flat</span><span class="p">()</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">sigmaVertexZ</span> <span class="o">-</span> <span class="n">abs</span><span class="p">(</span><span class="n">vertexZ</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="c1">// Add offset to beam vertex.</span>
    <span class="n">vertexX</span>      <span class="o">+=</span> <span class="n">offsetX</span><span class="p">;</span>
    <span class="n">vertexY</span>      <span class="o">+=</span> <span class="n">offsetY</span><span class="p">;</span>
    <span class="n">vertexZ</span>      <span class="o">+=</span> <span class="n">offsetZ</span><span class="p">;</span>
    <span class="n">vertexT</span>      <span class="o">+=</span> <span class="n">offsetT</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="c1">//==========================================================================</span>
<span class="c1">// A derived class to generate random numbers.</span>
<span class="c1">// A guranteed VERY STUPID generator, just to show principles.</span>
<span class="k">class</span> <span class="nc">stupidRndm</span> <span class="o">:</span> <span class="k">public</span> <span class="n">RndmEngine</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="c1">// Constructor.</span>
  <span class="n">stupidRndm</span><span class="p">()</span> <span class="p">{</span> <span class="n">init</span><span class="p">();}</span>
  <span class="c1">// Routine for generating a random number.</span>
  <span class="kt">double</span> <span class="n">flat</span><span class="p">();</span>
<span class="k">private</span><span class="o">:</span>
  <span class="c1">// Initialization.</span>
  <span class="kt">void</span> <span class="n">init</span><span class="p">();</span>
  <span class="c1">// State of the generator.</span>
  <span class="kt">double</span> <span class="n">value</span><span class="p">,</span> <span class="n">exp10</span><span class="p">;</span>
<span class="p">};</span>
<span class="c1">//--------------------------------------------------------------------------</span>
<span class="c1">// Initialization method for the random numbers.</span>
<span class="kt">void</span> <span class="n">stupidRndm</span><span class="o">::</span><span class="n">init</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Initial values.</span>
  <span class="n">value</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">;</span>
  <span class="n">exp10</span> <span class="o">=</span> <span class="n">exp</span><span class="p">(</span><span class="mf">10.</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">//--------------------------------------------------------------------------</span>
<span class="c1">// Generation method for the random numbers.</span>
<span class="kt">double</span> <span class="n">stupidRndm</span><span class="o">::</span><span class="n">flat</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Update counter. Add to current value.</span>
  <span class="k">do</span> <span class="p">{</span>
    <span class="n">value</span> <span class="o">*=</span> <span class="n">exp10</span><span class="p">;</span>
    <span class="n">value</span> <span class="o">+=</span> <span class="n">M_PI</span><span class="p">;</span>
    <span class="n">value</span> <span class="o">-=</span> <span class="kt">double</span><span class="p">(</span><span class="kt">int</span><span class="p">(</span><span class="n">value</span><span class="p">));</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">value</span> <span class="o">&lt;</span> <span class="mf">0.</span><span class="p">)</span> <span class="n">value</span> <span class="o">+=</span> <span class="mf">1.</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">value</span> <span class="o">&lt;=</span> <span class="mf">0.</span> <span class="o">||</span> <span class="n">value</span> <span class="o">&gt;=</span> <span class="mf">1.</span><span class="p">);</span>
  <span class="c1">// Return new value.</span>
  <span class="k">return</span> <span class="n">value</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">//==========================================================================</span>
<span class="c1">// A simple scaling PDF. Not realistic; only to check that it works.</span>
<span class="k">class</span> <span class="nc">Scaling</span> <span class="o">:</span> <span class="k">public</span> <span class="n">PDF</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="c1">// Constructor.</span>
  <span class="n">Scaling</span><span class="p">(</span><span class="kt">int</span> <span class="n">idBeamIn</span> <span class="o">=</span> <span class="mi">2212</span><span class="p">)</span> <span class="o">:</span> <span class="n">PDF</span><span class="p">(</span><span class="n">idBeamIn</span><span class="p">)</span> <span class="p">{}</span>
<span class="k">private</span><span class="o">:</span>
  <span class="c1">// Update PDF values.</span>
  <span class="kt">void</span> <span class="n">xfUpdate</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">,</span> <span class="kt">double</span> <span class="n">x</span><span class="p">,</span> <span class="kt">double</span> <span class="n">Q2</span><span class="p">);</span>
<span class="p">};</span>
<span class="c1">//--------------------------------------------------------------------------</span>
<span class="c1">// No dependence on Q2, so leave out name for last argument.</span>
<span class="kt">void</span> <span class="n">Scaling</span><span class="o">::</span><span class="n">xfUpdate</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">double</span> <span class="n">x</span><span class="p">,</span> <span class="kt">double</span> <span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Valence quarks, carrying 60% of the momentum.</span>
  <span class="kt">double</span> <span class="n">dv</span>  <span class="o">=</span> <span class="mf">4.</span> <span class="o">*</span> <span class="n">x</span> <span class="o">*</span> <span class="n">pow3</span><span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">x</span><span class="p">);</span>
  <span class="kt">double</span> <span class="n">uv</span>  <span class="o">=</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">dv</span><span class="p">;</span>
  <span class="c1">// Gluons and sea quarks carrying the rest.</span>
  <span class="kt">double</span> <span class="n">gl</span>  <span class="o">=</span> <span class="mf">2.</span>  <span class="o">*</span> <span class="n">pow5</span><span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">x</span><span class="p">);</span>
  <span class="kt">double</span> <span class="n">sea</span> <span class="o">=</span> <span class="mf">0.4</span> <span class="o">*</span> <span class="n">pow5</span><span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">x</span><span class="p">);</span>
  <span class="c1">// Update values</span>
  <span class="n">xg</span>    <span class="o">=</span> <span class="n">gl</span><span class="p">;</span>
  <span class="n">xu</span>    <span class="o">=</span> <span class="n">uv</span> <span class="o">+</span> <span class="mf">0.18</span> <span class="o">*</span> <span class="n">sea</span><span class="p">;</span>
  <span class="n">xd</span>    <span class="o">=</span> <span class="n">dv</span> <span class="o">+</span> <span class="mf">0.18</span> <span class="o">*</span> <span class="n">sea</span><span class="p">;</span>
  <span class="n">xubar</span> <span class="o">=</span> <span class="mf">0.18</span> <span class="o">*</span> <span class="n">sea</span><span class="p">;</span>
  <span class="n">xdbar</span> <span class="o">=</span> <span class="mf">0.18</span> <span class="o">*</span> <span class="n">sea</span><span class="p">;</span>
  <span class="n">xs</span>    <span class="o">=</span> <span class="mf">0.08</span> <span class="o">*</span> <span class="n">sea</span><span class="p">;</span>
  <span class="n">xc</span>    <span class="o">=</span> <span class="mf">0.04</span> <span class="o">*</span> <span class="n">sea</span><span class="p">;</span>
  <span class="n">xb</span>    <span class="o">=</span> <span class="mf">0.02</span> <span class="o">*</span> <span class="n">sea</span><span class="p">;</span>
  <span class="c1">// Subdivision of valence and sea.</span>
  <span class="n">xuVal</span> <span class="o">=</span> <span class="n">uv</span><span class="p">;</span>
  <span class="n">xuSea</span> <span class="o">=</span> <span class="n">xubar</span><span class="p">;</span>
  <span class="n">xdVal</span> <span class="o">=</span> <span class="n">dv</span><span class="p">;</span>
  <span class="n">xdSea</span> <span class="o">=</span> <span class="n">xdbar</span><span class="p">;</span>
  <span class="c1">// idSav = 9 to indicate that all flavours reset.</span>
  <span class="n">idSav</span> <span class="o">=</span> <span class="mi">9</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">//==========================================================================</span>
<span class="kt">int</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Number of events to generate. Max number of errors.</span>
  <span class="kt">int</span> <span class="n">nEvent</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">nAbort</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
  <span class="c1">// Pythia generator.</span>
  <span class="n">Pythia</span> <span class="n">pythia</span><span class="p">;</span>
  <span class="c1">// Process selection.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;HardQCD:all = on&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;PhaseSpace:pTHatMin = 20.&quot;</span><span class="p">);</span>
  <span class="c1">// LHC with acollinear beams in the x plane.</span>
  <span class="c1">// Use that default is pp with pz = +-7000 GeV, so this need not be set.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Beams:frameType = 3&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Beams:pxA = 1.&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Beams:pxB = 1.&quot;</span><span class="p">);</span>
  <span class="c1">// A class to generate beam parameters according to own parametrization.</span>
  <span class="n">BeamShape</span><span class="o">*</span> <span class="n">myBeamShape</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MyBeamShape</span><span class="p">();</span>
  <span class="c1">// Hand pointer to Pythia.</span>
  <span class="c1">// If you comment this out you get internal Gaussian-style implementation.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">setBeamShapePtr</span><span class="p">(</span> <span class="n">myBeamShape</span><span class="p">);</span>
  <span class="c1">// Set up beam spread parameters - reused by MyBeamShape.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Beams:allowMomentumSpread = on&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Beams:sigmapxA = 0.1&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Beams:sigmapyA = 0.1&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Beams:sigmapzA = 5.&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Beams:sigmapxB = 0.1&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Beams:sigmapyB = 0.1&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Beams:sigmapzB = 5.&quot;</span><span class="p">);</span>
  <span class="c1">// Set up beam vertex parameters - reused by MyBeamShape.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Beams:allowVertexSpread = on&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Beams:sigmaVertexX = 0.3&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Beams:sigmaVertexY = 0.3&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Beams:sigmaVertexZ = 50.&quot;</span><span class="p">);</span>
  <span class="c1">// In MyBeamShape the time width is not an independent parameter.</span>
  <span class="c1">//pythia.readString(&quot;Beams:sigmaTime = 50.&quot;);</span>
  <span class="c1">// Optionally simplify generation.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;PartonLevel:all = off&quot;</span><span class="p">);</span>
  <span class="c1">// A class to do random numbers externally. Hand pointer to Pythia.</span>
  <span class="n">RndmEngine</span><span class="o">*</span> <span class="n">badRndm</span> <span class="o">=</span> <span class="k">new</span> <span class="n">stupidRndm</span><span class="p">();</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">setRndmEnginePtr</span><span class="p">(</span> <span class="n">badRndm</span><span class="p">);</span>
  <span class="c1">// Two classes to do the two PDFs externally. Hand pointers to Pythia.</span>
  <span class="n">PDF</span><span class="o">*</span> <span class="n">pdfAPtr</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Scaling</span><span class="p">(</span><span class="mi">2212</span><span class="p">);</span>
  <span class="n">PDF</span><span class="o">*</span> <span class="n">pdfBPtr</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Scaling</span><span class="p">(</span><span class="mi">2212</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">setPDFPtr</span><span class="p">(</span> <span class="n">pdfAPtr</span><span class="p">,</span> <span class="n">pdfBPtr</span><span class="p">);</span>
  <span class="c1">// Initialization.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
  <span class="c1">// Read out nominal energy.</span>
  <span class="kt">double</span> <span class="n">eCMnom</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">eCM</span><span class="p">();</span>
  <span class="c1">// Histograms.</span>
  <span class="n">Hist</span> <span class="nf">eCM</span><span class="p">(</span><span class="s">&quot;center-of-mass energy deviation&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">20.</span><span class="p">,</span> <span class="mf">20.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="nf">pXsum</span><span class="p">(</span><span class="s">&quot;net pX offset&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="nf">pYsum</span><span class="p">(</span><span class="s">&quot;net pY offset&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="nf">pZsum</span><span class="p">(</span><span class="s">&quot;net pZ offset&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.</span><span class="p">,</span> <span class="mf">10.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="nf">pZind</span><span class="p">(</span><span class="s">&quot;individual abs(pZ)</span> <span class="n">offset</span><span class="s">&quot;, 100, -10., 10.)</span><span class="p">;</span>
  <span class="n">Hist</span> <span class="nf">vtxX</span><span class="p">(</span><span class="s">&quot;vertex x position&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="nf">vtxY</span><span class="p">(</span><span class="s">&quot;vertex y position&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="nf">vtxZ</span><span class="p">(</span><span class="s">&quot;vertex z position&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">100.</span><span class="p">,</span> <span class="mf">100.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="nf">vtxT</span><span class="p">(</span><span class="s">&quot;vertex time&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">100.</span><span class="p">,</span> <span class="mf">100.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="nf">vtxZT</span><span class="p">(</span><span class="s">&quot;vertex |x| + |t|&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">100.</span><span class="p">);</span>
  <span class="c1">// Begin event loop. Generate event.</span>
  <span class="kt">int</span> <span class="n">iAbort</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iEvent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iEvent</span> <span class="o">&lt;</span> <span class="n">nEvent</span><span class="p">;</span> <span class="o">++</span><span class="n">iEvent</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">())</span> <span class="p">{</span>
      <span class="c1">// List faulty events and quit if many failures.</span>
      <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">list</span><span class="p">();</span>
      <span class="n">pythia</span><span class="p">.</span><span class="n">process</span><span class="p">.</span><span class="n">list</span><span class="p">();</span>
      <span class="c1">//pythia.event.list();</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">++</span><span class="n">iAbort</span> <span class="o">&lt;</span> <span class="n">nAbort</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; Event generation aborted prematurely, owing to error!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// Fill histograms.</span>
    <span class="kt">double</span> <span class="n">eCMnow</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">eCM</span><span class="p">();</span>
    <span class="n">eCM</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">eCMnow</span> <span class="o">-</span> <span class="n">eCMnom</span><span class="p">);</span>
    <span class="n">pXsum</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span>  <span class="n">pythia</span><span class="p">.</span><span class="n">process</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">px</span><span class="p">()</span> <span class="o">-</span> <span class="mf">2.</span> <span class="p">);</span>
    <span class="n">pYsum</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span>  <span class="n">pythia</span><span class="p">.</span><span class="n">process</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">py</span><span class="p">()</span> <span class="p">);</span>
    <span class="n">pZsum</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span>  <span class="n">pythia</span><span class="p">.</span><span class="n">process</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">pz</span><span class="p">()</span> <span class="p">);</span>
    <span class="n">pZind</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span>  <span class="n">pythia</span><span class="p">.</span><span class="n">process</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">pz</span><span class="p">()</span> <span class="o">-</span> <span class="mf">7000.</span> <span class="p">);</span>
    <span class="n">pZind</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="o">-</span><span class="n">pythia</span><span class="p">.</span><span class="n">process</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">pz</span><span class="p">()</span> <span class="o">-</span> <span class="mf">7000.</span> <span class="p">);</span>
    <span class="n">vtxX</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span>  <span class="n">pythia</span><span class="p">.</span><span class="n">process</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">xProd</span><span class="p">()</span> <span class="p">);</span>
    <span class="n">vtxY</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span>  <span class="n">pythia</span><span class="p">.</span><span class="n">process</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">yProd</span><span class="p">()</span> <span class="p">);</span>
    <span class="n">vtxZ</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span>  <span class="n">pythia</span><span class="p">.</span><span class="n">process</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">zProd</span><span class="p">()</span> <span class="p">);</span>
    <span class="n">vtxT</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span>  <span class="n">pythia</span><span class="p">.</span><span class="n">process</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">tProd</span><span class="p">()</span> <span class="p">);</span>
    <span class="kt">double</span> <span class="n">absSum</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">process</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">zProd</span><span class="p">())</span>
                  <span class="o">+</span> <span class="n">abs</span><span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">process</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">tProd</span><span class="p">());</span>
    <span class="n">vtxZT</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">absSum</span> <span class="p">);</span>
  <span class="c1">// End of event loop. Statistics. Histograms.</span>
  <span class="p">}</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">eCM</span> <span class="o">&lt;&lt;</span> <span class="n">pXsum</span> <span class="o">&lt;&lt;</span> <span class="n">pYsum</span> <span class="o">&lt;&lt;</span> <span class="n">pZsum</span> <span class="o">&lt;&lt;</span> <span class="n">pZind</span>
       <span class="o">&lt;&lt;</span> <span class="n">vtxX</span> <span class="o">&lt;&lt;</span> <span class="n">vtxY</span> <span class="o">&lt;&lt;</span> <span class="n">vtxZ</span> <span class="o">&lt;&lt;</span> <span class="n">vtxT</span> <span class="o">&lt;&lt;</span> <span class="n">vtxZT</span><span class="p">;</span>
  <span class="c1">// Study standard Pythia random number generator.</span>
  <span class="n">Hist</span> <span class="nf">rndmDist</span><span class="p">(</span><span class="s">&quot;standard random number distribution&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="nf">rndmCorr</span><span class="p">(</span><span class="s">&quot;standard random number correlation&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
  <span class="kt">double</span> <span class="n">rndmNow</span><span class="p">;</span>
  <span class="kt">double</span> <span class="n">rndmOld</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">rndm</span><span class="p">.</span><span class="n">flat</span><span class="p">();</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">100000</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">rndmNow</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">rndm</span><span class="p">.</span><span class="n">flat</span><span class="p">();</span>
    <span class="n">rndmDist</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span><span class="n">rndmNow</span><span class="p">);</span>
    <span class="n">rndmCorr</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">abs</span><span class="p">(</span><span class="n">rndmNow</span> <span class="o">-</span> <span class="n">rndmOld</span><span class="p">)</span> <span class="p">);</span>
    <span class="n">rndmOld</span> <span class="o">=</span> <span class="n">rndmNow</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">rndmDist</span> <span class="o">&lt;&lt;</span> <span class="n">rndmCorr</span><span class="p">;</span>
  <span class="c1">// Study bad &quot;new&quot; random number generator.</span>
  <span class="n">Hist</span> <span class="nf">rndmDist2</span><span class="p">(</span><span class="s">&quot;stupid random number distribution&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="nf">rndmCorr2</span><span class="p">(</span><span class="s">&quot;stupid random number correlation&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
  <span class="n">rndmOld</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">rndm</span><span class="p">.</span><span class="n">flat</span><span class="p">();</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">100000</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">rndmNow</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">rndm</span><span class="p">.</span><span class="n">flat</span><span class="p">();</span>
    <span class="n">rndmDist2</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span><span class="n">rndmNow</span><span class="p">);</span>
    <span class="n">rndmCorr2</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">abs</span><span class="p">(</span><span class="n">rndmNow</span> <span class="o">-</span> <span class="n">rndmOld</span><span class="p">)</span> <span class="p">);</span>
    <span class="n">rndmOld</span> <span class="o">=</span> <span class="n">rndmNow</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">rndmDist2</span> <span class="o">&lt;&lt;</span> <span class="n">rndmCorr2</span><span class="p">;</span>
  <span class="c1">// Done.</span>
  <span class="k">delete</span> <span class="n">myBeamShape</span><span class="p">;</span>
  <span class="k">delete</span> <span class="n">badRndm</span><span class="p">;</span>
  <span class="k">delete</span> <span class="n">pdfAPtr</span><span class="p">;</span>
  <span class="k">delete</span> <span class="n">pdfBPtr</span><span class="p">;</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
    </div>
  </div>
</div>

</div> <div class="well well-sm"> <h1 id="main24cc">main24.cc</h1><hr>
<div class="codehilite"><pre><span class="c1">// main24.cc is a part of the PYTHIA event generator.</span>
<span class="c1">// Copyright (C) 2016 Peter Skands, Torbjorn Sjostrand.</span>
<span class="c1">// PYTHIA is licenced under the GNU GPL version 2, see COPYING for details.</span>
<span class="c1">// Please respect the MCnet Guidelines, see GUIDELINES for details.</span>
<span class="c1">// This is a simple test program.</span>
<span class="c1">// It illustrates how to run SUSY processes in Pythia8.</span>
<span class="c1">// All input is specified in the main22.cmnd file.</span>
</pre></div>


<div class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" href="#fileid23">Rest of the main24.cc code</a>
    </h4>
  </div>
  <div id="fileid23" class="panel-collapse collapse">
    <div class="panel-body">
<div class="codehilite"><pre><span class="cp">#include</span> <span class="cpf">&quot;Pythia8/Pythia.h&quot;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">Pythia8</span><span class="p">;</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Generator. Shorthand for the event.</span>
  <span class="n">Pythia</span> <span class="n">pythia</span><span class="p">;</span>
  <span class="n">Event</span><span class="o">&amp;</span> <span class="n">event</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">;</span>
  <span class="c1">// Read in commands from external file.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readFile</span><span class="p">(</span><span class="s">&quot;main24.cmnd&quot;</span><span class="p">);</span>
  <span class="c1">// Extract settings to be used in the main program.</span>
  <span class="kt">int</span> <span class="n">nEvent</span>   <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Main:numberOfEvents&quot;</span><span class="p">);</span>
  <span class="kt">int</span> <span class="n">nAbort</span>   <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Main:timesAllowErrors&quot;</span><span class="p">);</span>
  <span class="kt">double</span> <span class="n">eCM</span>   <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">parm</span><span class="p">(</span><span class="s">&quot;Beams:eCM&quot;</span><span class="p">);</span>
  <span class="c1">// Initialize.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
  <span class="c1">// Histograms.</span>
  <span class="kt">double</span> <span class="n">epTol</span> <span class="o">=</span> <span class="mf">1e-6</span> <span class="o">*</span> <span class="n">eCM</span><span class="p">;</span>
  <span class="n">Hist</span> <span class="n">epCons</span><span class="p">(</span><span class="s">&quot;deviation from energy-momentum conservation&quot;</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="n">epTol</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">nFinal</span><span class="p">(</span><span class="s">&quot;final particle multiplicity&quot;</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">799.5</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">dnparticledy</span><span class="p">(</span><span class="s">&quot;dn/dy for particles&quot;</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="o">-</span><span class="mf">10.</span><span class="p">,</span><span class="mf">10.</span><span class="p">);</span>
  <span class="c1">// Begin event loop.</span>
  <span class="kt">int</span> <span class="n">iAbort</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iEvent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iEvent</span> <span class="o">&lt;</span> <span class="n">nEvent</span><span class="p">;</span> <span class="o">++</span><span class="n">iEvent</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Generate events. Quit if failure.</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">())</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">++</span><span class="n">iAbort</span> <span class="o">&lt;</span> <span class="n">nAbort</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; Event generation aborted prematurely, owing to error!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// Loop over final particles in the event.</span>
    <span class="kt">int</span> <span class="n">nFin</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">Vec4</span> <span class="n">pSum</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">event</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">isFinal</span><span class="p">())</span> <span class="p">{</span>
      <span class="n">nFin</span><span class="o">++</span><span class="p">;</span>
      <span class="n">pSum</span> <span class="o">+=</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">p</span><span class="p">();</span>
      <span class="n">dnparticledy</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">y</span><span class="p">());</span>
    <span class="p">}</span>
    <span class="c1">// Check and print event with too big energy-momentum deviation.</span>
    <span class="n">nFinal</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span><span class="n">nFin</span><span class="p">);</span>
    <span class="kt">double</span> <span class="n">epDev</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">pSum</span><span class="p">.</span><span class="n">e</span><span class="p">()</span> <span class="o">-</span> <span class="n">eCM</span><span class="p">)</span> <span class="o">+</span> <span class="n">abs</span><span class="p">(</span><span class="n">pSum</span><span class="p">.</span><span class="n">px</span><span class="p">())</span> <span class="o">+</span> <span class="n">abs</span><span class="p">(</span><span class="n">pSum</span><span class="p">.</span><span class="n">py</span><span class="p">())</span>
      <span class="o">+</span> <span class="n">abs</span><span class="p">(</span><span class="n">pSum</span><span class="p">.</span><span class="n">pz</span><span class="p">());</span>
    <span class="n">epCons</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span><span class="n">epDev</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">epDev</span> <span class="o">&gt;</span> <span class="n">epTol</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; Warning! Event with epDev = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">scientific</span>
           <span class="o">&lt;&lt;</span> <span class="n">setprecision</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">epDev</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; now listed:&quot;</span><span class="p">;</span>
      <span class="n">event</span><span class="p">.</span><span class="n">list</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="c1">// End of event loop.</span>
  <span class="p">}</span>
  <span class="c1">// Final statistics and histogram output.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">epCons</span> <span class="o">&lt;&lt;</span> <span class="n">nFinal</span> <span class="o">&lt;&lt;</span> <span class="n">dnparticledy</span><span class="p">;</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
    </div>
  </div>
</div>

</div> <div class="well well-sm"> <h1 id="main25cc">main25.cc</h1><hr>
<div class="codehilite"><pre><span class="c1">// main25.cc is a part of the PYTHIA event generator.</span>
<span class="c1">// Copyright (C) 2016 Torbjorn Sjostrand.</span>
<span class="c1">// PYTHIA is licenced under the GNU GPL version 2, see COPYING for details.</span>
<span class="c1">// Please respect the MCnet Guidelines, see GUIDELINES for details.</span>
<span class="c1">// This is a simple test program.</span>
<span class="c1">// It illustrates how Les Houches Event File input can be used in Pythia8.</span>
<span class="c1">// Here the very few events are generated with MadGraph, and illustrate</span>
<span class="c1">// more complicated colour topologies.</span>
</pre></div>


<div class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" href="#fileid24">Rest of the main25.cc code</a>
    </h4>
  </div>
  <div id="fileid24" class="panel-collapse collapse">
    <div class="panel-body">
<div class="codehilite"><pre><span class="cp">#include</span> <span class="cpf">&quot;Pythia8/Pythia.h&quot;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">Pythia8</span><span class="p">;</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Generator</span>
  <span class="n">Pythia</span> <span class="n">pythia</span><span class="p">;</span>
  <span class="c1">// Stick with default values, so do not bother with a separate file</span>
  <span class="c1">// for changes. However, do one change, to show readString in action.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;PartonLevel:ISR = off&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;PartonLevel:FSR = off&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;PartonLevel:MPI = off&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;HadronLevel:Hadronize = on&quot;</span><span class="p">);</span>
  <span class="c1">// Initialize Les Houches Event File run.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Beams:frameType = 4&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Beams:LHEF = main25.lhe&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
  <span class="c1">// Book histogram.</span>
  <span class="n">Hist</span> <span class="n">nCharged</span><span class="p">(</span><span class="s">&quot;charged particle multiplicity&quot;</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">399.5</span><span class="p">);</span>
  <span class="c1">// Allow for possibility of a few faulty events.</span>
  <span class="kt">int</span> <span class="n">nAbort</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">iAbort</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="c1">// Begin event loop; generate until none left in input file.</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iEvent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">;</span> <span class="o">++</span><span class="n">iEvent</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Begin event # &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">iEvent</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="c1">// Generate events, and check whether generation failed.</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">())</span> <span class="p">{</span>
      <span class="c1">// If failure because reached end of file then exit event loop.</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">atEndOfFile</span><span class="p">())</span> <span class="k">break</span><span class="p">;</span>
      <span class="c1">// First few failures write off as &quot;acceptable&quot; errors, then quit.</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">++</span><span class="n">iAbort</span> <span class="o">&lt;</span> <span class="n">nAbort</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// Sum up final charged multiplicity and fill in histogram.</span>
    <span class="kt">int</span> <span class="n">nChg</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">isFinal</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">isCharged</span><span class="p">())</span>
      <span class="o">++</span><span class="n">nChg</span><span class="p">;</span>
    <span class="n">nCharged</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span><span class="n">nChg</span><span class="p">);</span>
  <span class="c1">// End of event loop.</span>
  <span class="p">}</span>
  <span class="c1">// Give statistics. Print histogram.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">nCharged</span><span class="p">;</span>
  <span class="c1">// Done.</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
    </div>
  </div>
</div>

</div> <div class="well well-sm"> <h1 id="main26cc">main26.cc</h1><hr>
<div class="codehilite"><pre><span class="c1">// main26.cc is a part of the PYTHIA event generator.</span>
<span class="c1">// Copyright (C) 2016 Torbjorn Sjostrand.</span>
<span class="c1">// PYTHIA is licenced under the GNU GPL version 2, see COPYING for details.</span>
<span class="c1">// Please respect the MCnet Guidelines, see GUIDELINES for details.</span>
<span class="c1">// This is a test program for the extra dimensions processes.</span>
<span class="c1">// Author: Stefan Ask (Stefan DOT Ask AT cern DOT ch)</span>
<span class="c1">// Documentation: S. Ask et al., arXiv:0809.4750 and arXiv:0912.4233</span>
</pre></div>


<div class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" href="#fileid25">Rest of the main26.cc code</a>
    </h4>
  </div>
  <div id="fileid25" class="panel-collapse collapse">
    <div class="panel-body">
<div class="codehilite"><pre><span class="cp">#include</span> <span class="cpf">&quot;Pythia8/Pythia.h&quot;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">Pythia8</span><span class="p">;</span>
<span class="c1">// The main program.</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Test cases</span>
  <span class="c1">// 1  = Jet + G       (real G emission)</span>
  <span class="c1">// 2  = Jet + U       (real U emission)</span>
  <span class="c1">// 3  = Z + G         (real G emission)</span>
  <span class="c1">// 4  = Z + U         (real U emission)</span>
  <span class="c1">// 5  = gamma gamma   (LED G* exchange)</span>
  <span class="c1">// 6  = l lbar        (LED U* exchange).</span>
  <span class="c1">//      Note: charged leptons only!</span>
  <span class="c1">// 7  = Z_KK/gamma_KK (TEV ED resonance)</span>
  <span class="c1">// 8  = G*            (RS resonance, SM on the TeV brane)</span>
  <span class="c1">// 9  = kk-gluon*     (RS resonance)</span>
  <span class="kt">int</span> <span class="n">nTest</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="c1">// Number of events to generate. Max number of errors.</span>
  <span class="kt">int</span> <span class="n">nEvent</span>     <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">nAbort</span>     <span class="o">=</span> <span class="mi">50</span><span class="p">;</span>
  <span class="c1">// Pythia generator.</span>
  <span class="n">Pythia</span> <span class="n">pythia</span><span class="p">;</span>
  <span class="c1">// PYTHIA paramters:</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;PhaseSpace:showViolation = off&quot;</span><span class="p">);</span>
  <span class="c1">// Test case parameters</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">nTest</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;ExtraDimensionsLED:monojet = on&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;ExtraDimensionsLED:n = 4&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;ExtraDimensionsLED:MD = 4000.&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;ExtraDimensionsLED:CutOffmode = 3&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;ExtraDimensionsLED:t = 2&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;5000039:m0 = 2500.&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;5000039:mWidth = 1500.&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;5000039:mMin = 1.&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;5000039:mMax = 13990.&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;PhaseSpace:pTHatMin = 700.&quot;</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">nTest</span> <span class="o">==</span> <span class="mi">2</span><span class="p">){</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;ExtraDimensionsUnpart:gg2Ug = off&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;ExtraDimensionsUnpart:qg2Uq = on&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;ExtraDimensionsUnpart:qqbar2Ug = on&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;ExtraDimensionsUnpart:spinU = 1&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;ExtraDimensionsUnpart:dU = 1.2&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;ExtraDimensionsUnpart:LambdaU = 1000&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;ExtraDimensionsUnpart:lambda = 1.0&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;ExtraDimensionsUnpart:CutOffmode = 0&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;5000039:m0 = 300.&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;5000039:mWidth = 500.&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;5000039:mMin = 1.&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;5000039:mMax = 13990.&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;PhaseSpace:pTHatMin = 700.&quot;</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">nTest</span> <span class="o">==</span> <span class="mi">3</span><span class="p">){</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;ExtraDimensionsLED:ffbar2GZ = on&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;ExtraDimensionsLED:n = 6&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;ExtraDimensionsLED:MD = 2000.&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;ExtraDimensionsLED:CutOffmode = 1&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;5000039:m0 = 3000.&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;5000039:mWidth = 1500.&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;5000039:mMin = 1.&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;5000039:mMax = 13990.&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;PhaseSpace:pTHatMin = 50.&quot;</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">nTest</span> <span class="o">==</span> <span class="mi">4</span><span class="p">){</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;ExtraDimensionsUnpart:ffbar2UZ = on&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;ExtraDimensionsUnpart:spinU = 1&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;ExtraDimensionsUnpart:dU = 2.0&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;ExtraDimensionsUnpart:LambdaU = 1000&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;ExtraDimensionsUnpart:lambda = 1.000&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;ExtraDimensionsUnpart:CutOffmode = 0&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;5000039:m0 = 500.&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;5000039:mWidth = 1000.&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;5000039:mMin = 1.&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;5000039:mMax = 13990.&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;PhaseSpace:pTHatMin = 50.&quot;</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">nTest</span> <span class="o">==</span> <span class="mi">5</span><span class="p">){</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;ExtraDimensionsLED:ffbar2gammagamma = on&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;ExtraDimensionsLED:gg2gammagamma = on&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;ExtraDimensionsLED:LambdaT = 3300.&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;PhaseSpace:mHatMin = 800.&quot;</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">nTest</span> <span class="o">==</span> <span class="mi">6</span><span class="p">){</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;ExtraDimensionsUnpart:ffbar2llbar = on&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;ExtraDimensionsUnpart:gg2llbar = off&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;ExtraDimensionsUnpart:spinU = 1&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;ExtraDimensionsUnpart:dU = 1.3&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;ExtraDimensionsUnpart:LambdaU = 1000&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;ExtraDimensionsUnpart:lambda = 1.0&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;ExtraDimensionsUnpart:gXX = 0&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;ExtraDimensionsUnpart:gXY = 0&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;PhaseSpace:mHatMin = 300.&quot;</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">nTest</span> <span class="o">==</span> <span class="mi">7</span><span class="p">){</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;ExtraDimensionsTEV:ffbar2mu+mu- = on&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;ExtraDimensionsTEV:gmZmode = 3&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;ExtraDimensionsTEV:nMax = 100&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;ExtraDimensionsTEV:mStar = 4000&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;PhaseSpace:mHatMin = 1000&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;PhaseSpace:mHatMax = 6000&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;5000023:isResonance = false&quot;</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">nTest</span> <span class="o">==</span> <span class="mi">8</span><span class="p">){</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;ExtraDimensionsG*:all = on&quot;</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">nTest</span> <span class="o">==</span> <span class="mi">9</span><span class="p">){</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;ExtraDimensionsG*:qqbar2KKgluon* = on&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;ExtraDimensionsG*:KKintMode = 2&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;ExtraDimensionsG*:KKgqR = -0.2&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;ExtraDimensionsG*:KKgqL = -0.2&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;ExtraDimensionsG*:KKgbR = -0.2&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;ExtraDimensionsG*:KKgbL = 1.0&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;ExtraDimensionsG*:KKgtR = 5.0&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;ExtraDimensionsG*:KKgtL = 1.0&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;5100021:m0 = 2000&quot;</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="c1">// Switch off sophisticated tau treatment: not yet matched to SUSY.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;TauDecays:mode = 0&quot;</span><span class="p">);</span>
  <span class="c1">// Initialization for LHC.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Beams:eCM = 14000.&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
  <span class="c1">// Validation histograms</span>
  <span class="n">Hist</span> <span class="n">hEtjet</span><span class="p">(</span><span class="s">&quot;dN/dETjet: monojet check&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">7000.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">hMass</span><span class="p">(</span><span class="s">&quot;dN/m: graviton mass spectrum&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">7000.</span><span class="p">);</span>
  <span class="c1">// Begin event loop.</span>
  <span class="kt">int</span> <span class="n">iAbort</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iEvent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iEvent</span> <span class="o">&lt;</span> <span class="n">nEvent</span><span class="p">;</span> <span class="o">++</span><span class="n">iEvent</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Generate events. Quit if many failures.</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">())</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">++</span><span class="n">iAbort</span> <span class="o">&lt;</span> <span class="n">nAbort</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
      <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; Event generation aborted prematurely, owing to error!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// Checked particle index</span>
    <span class="kt">int</span> <span class="n">tmp_monojet</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="c1">// Particle loop</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iPart</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iPart</span> <span class="o">&lt;</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">iPart</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// From hard process (inital = 21, interm.=22, final=23 state)</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">iPart</span><span class="p">].</span><span class="n">statusAbs</span><span class="p">()</span>  <span class="o">==</span> <span class="mi">22</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Find Z_KK/gamma_KK or kk-gluon</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">iPart</span><span class="p">].</span><span class="n">idAbs</span><span class="p">()</span> <span class="o">==</span> <span class="mi">5000023</span>
         <span class="o">||</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">iPart</span><span class="p">].</span><span class="n">idAbs</span><span class="p">()</span> <span class="o">==</span> <span class="mi">5100021</span>
         <span class="o">||</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">iPart</span><span class="p">].</span><span class="n">idAbs</span><span class="p">()</span> <span class="o">==</span> <span class="mi">5100039</span><span class="p">){</span>
          <span class="n">hMass</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">iPart</span><span class="p">].</span><span class="n">m</span><span class="p">()</span> <span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">iPart</span><span class="p">].</span><span class="n">statusAbs</span><span class="p">()</span>  <span class="o">==</span> <span class="mi">23</span> <span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Find graviton/unparticle</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">iPart</span><span class="p">].</span><span class="n">idAbs</span><span class="p">()</span> <span class="o">==</span> <span class="mi">5000039</span><span class="p">){</span>
          <span class="n">hMass</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">iPart</span><span class="p">].</span><span class="n">m</span><span class="p">()</span> <span class="p">);</span>
        <span class="p">}</span>
        <span class="c1">// Find mono-jets</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">nTest</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">||</span> <span class="n">nTest</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">iPart</span><span class="p">].</span><span class="n">idAbs</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mi">6</span>
            <span class="o">||</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">iPart</span><span class="p">].</span><span class="n">idAbs</span><span class="p">()</span> <span class="o">==</span> <span class="mi">21</span> <span class="p">){</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">tmp_monojet</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
              <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;More than one (hard process) mono-jet ! </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
              <span class="n">tmp_monojet</span>  <span class="o">=</span> <span class="n">iPart</span><span class="p">;</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="c1">// Validation mono-jet wrt G.Giudice et al. paper [hep-ph/9811291v2]</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">tmp_monojet</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="kt">double</span> <span class="n">tmp_eta</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">tmp_monojet</span><span class="p">].</span><span class="n">eta</span><span class="p">();</span>
      <span class="kt">double</span> <span class="n">tmp_et</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">tmp_monojet</span><span class="p">].</span><span class="n">eT</span><span class="p">();</span>
      <span class="kt">double</span> <span class="n">tmp_et_cut</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span> <span class="n">tmp_et</span> <span class="o">&gt;=</span>  <span class="n">tmp_et_cut</span> <span class="o">&amp;&amp;</span> <span class="n">abs</span><span class="p">(</span><span class="n">tmp_eta</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="p">)</span> <span class="p">{</span>
        <span class="n">hEtjet</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">fabs</span><span class="p">(</span><span class="n">tmp_et</span><span class="p">)</span> <span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="c1">// Final statistics.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">hMass</span> <span class="o">&lt;&lt;</span> <span class="n">hEtjet</span><span class="p">;</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
    </div>
  </div>
</div>

</div> <div class="well well-sm"> <h1 id="main27cc">main27.cc</h1><hr>
<div class="codehilite"><pre><span class="c1">// main27.cc is a part of the PYTHIA event generator.</span>
<span class="c1">// Copyright (C) 2016 Torbjorn Sjostrand.</span>
<span class="c1">// PYTHIA is licenced under the GNU GPL version 2, see COPYING for details.</span>
<span class="c1">// Please respect the MCnet Guidelines, see GUIDELINES for details.</span>
<span class="c1">// Kaluza-Klein gamma*/Z resonances in TeV-sized extra dimensions.</span>
</pre></div>


<div class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" href="#fileid26">Rest of the main27.cc code</a>
    </h4>
  </div>
  <div id="fileid26" class="panel-collapse collapse">
    <div class="panel-body">
<div class="codehilite"><pre><span class="cp">#include</span> <span class="cpf">&lt;assert.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;time.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;sstream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;Pythia8/Pythia.h&quot;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">Pythia8</span><span class="p">;</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Generator.</span>
  <span class="n">Pythia</span> <span class="n">pythia</span><span class="p">;</span>
  <span class="n">ParticleData</span><span class="o">&amp;</span> <span class="n">pdt</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">particleData</span><span class="p">;</span>
  <span class="c1">// Pick new random number seed for each run, based on clock.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Random:setSeed = on&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Random:seed = 0&quot;</span><span class="p">);</span>
  <span class="c1">// Process selection.</span>
  <span class="c1">// ANY COMBINATION OF THE PROCESSES FLAGS BELOW IS ALLOWED</span>
  <span class="c1">// HERE WE SWITCH ON ONLY THE MU+MU- FINAL STATE.</span>
  <span class="c1">// TO SWITCH ALL POSSIBLE FINAL STATES ON, UNCOMMENT ALL</span>
  <span class="c1">// THE RELEVANT LINES BELOW:</span>
  <span class="c1">//pythia.readString(&quot;ExtraDimensionsTEV:ffbar2e+e- = on&quot;);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;ExtraDimensionsTEV:ffbar2mu+mu- = on&quot;</span><span class="p">);</span>
  <span class="c1">//pythia.readString(&quot;ExtraDimensionsTEV:ffbar2tau+tau- = on&quot;);</span>
  <span class="c1">//pythia.readString(&quot;ExtraDimensionsTEV:ffbar2uubar = on&quot;);</span>
  <span class="c1">//pythia.readString(&quot;ExtraDimensionsTEV:ffbar2ddbar = on&quot;);</span>
  <span class="c1">//pythia.readString(&quot;ExtraDimensionsTEV:ffbar2ccbar = on&quot;);</span>
  <span class="c1">//pythia.readString(&quot;ExtraDimensionsTEV:ffbar2ssbar = on&quot;);</span>
  <span class="c1">//pythia.readString(&quot;ExtraDimensionsTEV:ffbar2bbbar = on&quot;);</span>
  <span class="c1">//pythia.readString(&quot;ExtraDimensionsTEV:ffbar2ttbar = on&quot;);</span>
  <span class="c1">//pythia.readString(&quot;ExtraDimensionsTEV:ffbar2nuenuebar = on&quot;);</span>
  <span class="c1">//pythia.readString(&quot;ExtraDimensionsTEV:ffbar2numunumubar = on&quot;);</span>
  <span class="c1">//pythia.readString(&quot;ExtraDimensionsTEV:ffbar2nutaunutaubar = on&quot;);</span>
  <span class="c1">// Pick KK mass.</span>
  <span class="kt">double</span> <span class="n">newMass</span> <span class="o">=</span> <span class="mf">4000.</span><span class="p">;</span> <span class="c1">// GeV</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;|-------------------------&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;| KK mass is: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">newMass</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;|-------------------------&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">stringstream</span> <span class="n">strm</span><span class="p">;</span>
  <span class="n">string</span> <span class="n">sNewMass</span><span class="p">,</span> <span class="n">sNewWidth</span><span class="p">,</span> <span class="n">sNewLowBound</span><span class="p">,</span> <span class="n">sNewHighBound</span><span class="p">;</span>
  <span class="c1">// Manually set the mass and therefore the width</span>
  <span class="c1">// and the phase space for the sampling</span>
  <span class="n">strm</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
  <span class="n">strm</span> <span class="o">&lt;&lt;</span> <span class="n">newMass</span><span class="p">;</span>
  <span class="n">strm</span> <span class="o">&gt;&gt;</span> <span class="n">sNewMass</span><span class="p">;</span>
  <span class="n">strm</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
  <span class="n">strm</span> <span class="o">&lt;&lt;</span> <span class="n">newMass</span> <span class="o">/</span> <span class="n">pdt</span><span class="p">.</span><span class="n">m0</span><span class="p">(</span><span class="mi">5000023</span><span class="p">)</span> <span class="o">*</span> <span class="n">pdt</span><span class="p">.</span><span class="n">mWidth</span><span class="p">(</span><span class="mi">5000023</span><span class="p">);</span>
  <span class="n">strm</span> <span class="o">&gt;&gt;</span> <span class="n">sNewWidth</span><span class="p">;</span>
  <span class="n">strm</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
  <span class="n">strm</span> <span class="o">&lt;&lt;</span> <span class="n">newMass</span><span class="o">/</span><span class="mf">4.</span><span class="p">;</span>
  <span class="n">strm</span> <span class="o">&gt;&gt;</span> <span class="n">sNewLowBound</span><span class="p">;</span>
  <span class="n">strm</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
  <span class="n">strm</span> <span class="o">&lt;&lt;</span> <span class="n">newMass</span><span class="o">*</span><span class="mf">2.</span><span class="p">;</span>
  <span class="n">strm</span> <span class="o">&gt;&gt;</span> <span class="n">sNewHighBound</span><span class="p">;</span>
  <span class="c1">// Feed in KK state information and other generation specifics.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;5000023:m0 = &quot;</span> <span class="o">+</span> <span class="n">sNewMass</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;5000023:mWidth = &quot;</span> <span class="o">+</span> <span class="n">sNewWidth</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;5000023:mMin = &quot;</span> <span class="o">+</span> <span class="n">sNewLowBound</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;5000023:mMax = &quot;</span> <span class="o">+</span> <span class="n">sNewHighBound</span><span class="p">);</span>
  <span class="c1">//////////////////////////////////////////////////////////////////////////</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;5000023:isResonance = false&quot;</span><span class="p">);</span> <span class="c1">// THIS IS MANDATORY  //</span>
  <span class="c1">//////////////////////////////////////////////////////////////////////////</span>
  <span class="c1">// 0=(gm+Z), 1=(gm), 2=(Z), 3=(gm+Z+gmKK+ZKK), 4=(m+Z+gmKK), 5=(m+Z+ZKK)</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;ExtraDimensionsTEV:gmZmode = 3&quot;</span><span class="p">);</span>
  <span class="c1">// min=0, max=100, default=10</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;ExtraDimensionsTEV:nMax = 100&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;ExtraDimensionsTEV:mStar = &quot;</span> <span class="o">+</span> <span class="n">sNewMass</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;PhaseSpace:mHatMin = &quot;</span> <span class="o">+</span> <span class="n">sNewLowBound</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;PhaseSpace:mHatMax = &quot;</span> <span class="o">+</span> <span class="n">sNewHighBound</span><span class="p">);</span>
  <span class="c1">// Initialize for LHC.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Beams:eCM = 14000.&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
  <span class="c1">// Histograms.</span>
  <span class="n">Hist</span> <span class="n">mHatHisto</span><span class="p">(</span><span class="s">&quot;dN/dmHat&quot;</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="n">newMass</span><span class="o">/</span><span class="mf">4.</span><span class="p">,</span> <span class="n">newMass</span><span class="o">*</span><span class="mf">2.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">pTmuHisto</span><span class="p">(</span><span class="s">&quot;(dN/dpT)_mu^-&quot;</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">2501.</span><span class="p">);</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">moms</span><span class="p">;</span>
  <span class="c1">// Measure the cpu runtime.</span>
  <span class="kt">clock_t</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">;</span>
  <span class="kt">double</span> <span class="n">t</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
  <span class="c1">// Depending on operating system, either of lines below gives warning.</span>
  <span class="c1">//assert((start = clock()) != -1); // Start timer; clock_t signed.</span>
  <span class="c1">//assert((start = clock()) != -1u); // Start timer; clock_t unsigned.</span>
  <span class="c1">// Simpler option, not using assert.</span>
  <span class="n">start</span> <span class="o">=</span> <span class="n">clock</span><span class="p">();</span>
  <span class="c1">// Begin event loop. Generate event. Skip if error. List first one.</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iEvent</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">;</span> <span class="n">iEvent</span> <span class="o">&lt;</span> <span class="mi">500</span> <span class="p">;</span> <span class="o">++</span><span class="n">iEvent</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">())</span> <span class="k">continue</span><span class="p">;</span>
    <span class="c1">// Begin event analysis.</span>
    <span class="kt">bool</span> <span class="n">isZ</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">ismu</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">iZ</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">imu</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// find the most recent Z</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">id</span><span class="p">()</span> <span class="o">==</span> <span class="mi">5000023</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">iZ</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
        <span class="n">isZ</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="c1">// find the final muon who&#39;s first mother is the Z</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">id</span><span class="p">()</span> <span class="o">==</span> <span class="mi">13</span> <span class="o">&amp;&amp;</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">isFinal</span><span class="p">())</span> <span class="p">{</span>
        <span class="n">moms</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
        <span class="n">moms</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">motherList</span><span class="p">();</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">m</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">;</span> <span class="n">m</span> <span class="o">&lt;</span> <span class="kt">int</span><span class="p">(</span><span class="n">moms</span><span class="p">.</span><span class="n">size</span><span class="p">())</span> <span class="p">;</span> <span class="n">m</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span><span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span> <span class="n">moms</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="p">].</span><span class="n">id</span><span class="p">()</span> <span class="o">==</span> <span class="mi">5000023</span> <span class="p">)</span> <span class="p">{</span>
            <span class="n">imu</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
            <span class="n">ismu</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="p">}</span> <span class="c1">// end if 5000023</span>
        <span class="p">}</span> <span class="c1">// end for moms.size()</span>
      <span class="p">}</span> <span class="c1">// end if final muon</span>
    <span class="p">}</span> <span class="c1">// end for event.size()</span>
    <span class="k">if</span><span class="p">(</span><span class="n">isZ</span> <span class="o">&amp;&amp;</span> <span class="n">ismu</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">mHatHisto</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">iZ</span><span class="p">].</span><span class="n">m</span><span class="p">()</span> <span class="p">);</span>
      <span class="n">pTmuHisto</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">imu</span><span class="p">].</span><span class="n">pT</span><span class="p">()</span> <span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span><span class="p">(</span><span class="n">iEvent</span><span class="o">%</span><span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Event: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">iEvent</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">flush</span><span class="p">;</span>
  <span class="p">}</span> <span class="c1">// end for iEvent&lt;500</span>
  <span class="c1">// Done. Print results.</span>
  <span class="n">stop</span> <span class="o">=</span> <span class="n">clock</span><span class="p">();</span> <span class="c1">// Stop timer</span>
  <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span> <span class="p">(</span><span class="n">stop</span><span class="o">-</span><span class="n">start</span><span class="p">)</span><span class="o">/</span><span class="n">CLOCKS_PER_SEC</span><span class="p">;</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">mHatHisto</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">pTmuHisto</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;|----------------------------------------|&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;| CPU Runtime = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">t</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; sec&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;|----------------------------------------|&quot;</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
    </div>
  </div>
</div>

</div> <div class="well well-sm"> <h1 id="main28cc">main28.cc</h1><hr>
<div class="codehilite"><pre><span class="c1">// main28.cc is a part of the PYTHIA event generator.</span>
<span class="c1">// Copyright (C) 2016 Peter Skands, Torbjorn Sjostrand.</span>
<span class="c1">// PYTHIA is licenced under the GNU GPL version 2, see COPYING for details.</span>
<span class="c1">// Please respect the MCnet Guidelines, see GUIDELINES for details.</span>
<span class="c1">// Example of of R-hadron production.</span>
<span class="c1">// Several of the possibilities shown here, like displaced vertices,</span>
<span class="c1">// are extras that need not be used for the basic setup.</span>
</pre></div>


<div class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" href="#fileid27">Rest of the main28.cc code</a>
    </h4>
  </div>
  <div id="fileid27" class="panel-collapse collapse">
    <div class="panel-body">
<div class="codehilite"><pre><span class="cp">#include</span> <span class="cpf">&quot;Pythia8/Pythia.h&quot;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">Pythia8</span><span class="p">;</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Key settings to be used in the main program.</span>
  <span class="c1">// nGluino = 0, 1, 2 give stop pair, single gluino or gluino pair.</span>
  <span class="kt">int</span> <span class="n">nGluino</span>  <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">nEvent</span>   <span class="o">=</span> <span class="mi">200</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">nAbort</span>   <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">nList</span>    <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kt">double</span> <span class="n">eCM</span>   <span class="o">=</span> <span class="mf">7000.</span><span class="p">;</span>
  <span class="c1">// Generator. Shorthand for the event.</span>
  <span class="n">Pythia</span> <span class="n">pythia</span><span class="p">;</span>
  <span class="n">Event</span><span class="o">&amp;</span> <span class="n">event</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">;</span>
  <span class="c1">// Set up beams: p p is default so only need set energy.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">parm</span><span class="p">(</span><span class="s">&quot;Beams:eCM&quot;</span><span class="p">,</span> <span class="n">eCM</span><span class="p">);</span>
  <span class="c1">// Squark pair: use stop-antistop as example.</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">nGluino</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;SUSY:gg2squarkantisquark = on&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;SUSY:idA = 1000006&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;SUSY:idB = 1000006&quot;</span><span class="p">);</span>
  <span class="c1">// Squark-gluino pair: also supersymmetric u has been made long-lived.</span>
  <span class="c1">// Stop does not work since then one would need inoming top PDF.</span>
  <span class="c1">// Nevertheless R-hadrons are numbered/named as if containing a stop.</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">nGluino</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;SUSY:qg2squarkgluino  = on&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;SUSY:idA = 1000002&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;RHadrons:idStop = 1000002&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;SUSY:idB = 1000021&quot;</span><span class="p">);</span>
  <span class="c1">// Gluino pair.</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;SUSY:gg2gluinogluino  = on&quot;</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="c1">// Use hacked sps1a file, with stop (+su) and gluino made long-lived.</span>
  <span class="c1">// This is based on the width being less than 0.2 GeV by default.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;SLHA:file = sps1aNarrowStopGluino.spc&quot;</span><span class="p">);</span>
  <span class="c1">// Further hacked file, to test R-parity violating gluino decay.</span>
  <span class="c1">//pythia.readString(&quot;SLHA:file = sps1aNarrowStopGluinoRPV.spc&quot;);</span>
  <span class="c1">// Allow R-hadron formation.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Rhadrons:allow = on&quot;</span><span class="p">);</span>
  <span class="c1">// If you want to do the decay separately later,</span>
  <span class="c1">// you need to switch off automatic decays.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;RHadrons:allowDecay = off&quot;</span><span class="p">);</span>
  <span class="c1">// Fraction of gluinoballs.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;RHadrons:probGluinoball = 0.1&quot;</span><span class="p">);</span>
  <span class="c1">// Switch off key components.</span>
  <span class="c1">//pythia.readString(&quot;PartonLevel:MPI = off&quot;);</span>
  <span class="c1">//pythia.readString(&quot;PartonLevel:ISR = off&quot;);</span>
  <span class="c1">//pythia.readString(&quot;PartonLevel:FSR = off&quot;);</span>
  <span class="c1">//pythia.readString(&quot;HadronLevel:Hadronize = off&quot;);</span>
  <span class="c1">// Allow the R-hadrons to have secondary vertices: set c*tau in mm.</span>
  <span class="c1">// Note that width and lifetime can be set independently.</span>
  <span class="c1">// (Nonzero small widths are needed e.g. to select branching ratios.)</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;1000002:tau0 = 200.&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;1000006:tau0 = 250.&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;1000021:tau0 = 300.&quot;</span><span class="p">);</span>
  <span class="c1">// Checks. Optionally relax E-p-conservation.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Check:nErrList = 2&quot;</span><span class="p">);</span>
  <span class="c1">//pythia.readString(&quot;Check:epTolErr = 2e-3&quot;);</span>
  <span class="c1">// Possibility to switch off particle data and event listings.</span>
  <span class="c1">// Also to shop location of displaced vertices.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Init:showChangedSettings = on&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Init:showChangedParticleData = off&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Next:numberShowInfo = 1&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Next:numberShowProcess = 1&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Next:numberShowEvent = 0&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Next:showScaleAndVertex = on&quot;</span><span class="p">);</span>
  <span class="c1">// Initialize.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
  <span class="c1">// Histograms.</span>
  <span class="n">Hist</span> <span class="n">nChargedH</span><span class="p">(</span><span class="s">&quot;charged multiplicity&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">799.5</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">dndyChargedH</span><span class="p">(</span><span class="s">&quot;dn/dy charged&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.</span><span class="p">,</span> <span class="mf">10.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">dndyRH</span><span class="p">(</span><span class="s">&quot;dn/dy R-hadrons&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.</span><span class="p">,</span> <span class="mf">5.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">pTRH</span><span class="p">(</span><span class="s">&quot;pT R-hadrons&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1000.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">xRH</span><span class="p">(</span><span class="s">&quot;p_RHadron / p_sparticle&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">mDiff</span><span class="p">(</span><span class="s">&quot;m(Rhadron) - m(sparticle)&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">5.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">decVtx</span><span class="p">(</span><span class="s">&quot;R-hadron decay vertex (mm from origin)&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1000.</span><span class="p">);</span>
  <span class="c1">// R-hadron flavour composition.</span>
  <span class="n">map</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="n">flavours</span><span class="p">;</span>
  <span class="c1">// Begin event loop.</span>
  <span class="kt">int</span> <span class="n">iAbort</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iEvent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iEvent</span> <span class="o">&lt;</span> <span class="n">nEvent</span><span class="p">;</span> <span class="o">++</span><span class="n">iEvent</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Generate events. Quit if failure.</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">())</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">++</span><span class="n">iAbort</span> <span class="o">&lt;</span> <span class="n">nAbort</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; Event generation aborted prematurely, owing to error!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// Loop over final charged particles in the event.</span>
    <span class="c1">// The R-hadrons may not yet have decayed here.</span>
    <span class="kt">int</span> <span class="n">nCharged</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">Vec4</span> <span class="n">pSum</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">event</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">isFinal</span><span class="p">())</span> <span class="p">{</span>
        <span class="n">pSum</span> <span class="o">+=</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">p</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">isCharged</span><span class="p">())</span> <span class="p">{</span>
          <span class="o">++</span><span class="n">nCharged</span><span class="p">;</span>
          <span class="n">dndyChargedH</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">y</span><span class="p">()</span> <span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">nChargedH</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">nCharged</span> <span class="p">);</span>
    <span class="c1">// Loop over final R-hadrons in the event: kinematic distribution</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">event</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
      <span class="kt">int</span> <span class="n">idAbs</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">idAbs</span><span class="p">();</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">idAbs</span> <span class="o">&gt;</span> <span class="mi">1000100</span> <span class="o">&amp;&amp;</span> <span class="n">idAbs</span> <span class="o">&lt;</span> <span class="mi">2000000</span> <span class="o">&amp;&amp;</span> <span class="n">idAbs</span> <span class="o">!=</span> <span class="mi">1009002</span><span class="p">)</span> <span class="p">{</span>
        <span class="o">++</span><span class="n">flavours</span><span class="p">[</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">id</span><span class="p">()</span> <span class="p">];</span>
        <span class="n">dndyRH</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">y</span><span class="p">()</span> <span class="p">);</span>
        <span class="n">pTRH</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pT</span><span class="p">()</span> <span class="p">);</span>
        <span class="c1">// Trace back to mother; compare momenta and masses.</span>
        <span class="kt">int</span> <span class="n">iMother</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
        <span class="k">while</span><span class="p">(</span> <span class="n">event</span><span class="p">[</span><span class="n">iMother</span><span class="p">].</span><span class="n">statusAbs</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">)</span>
          <span class="n">iMother</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="n">iMother</span><span class="p">].</span><span class="n">mother1</span><span class="p">();</span>
        <span class="kt">double</span> <span class="n">xFrac</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pAbs</span><span class="p">()</span> <span class="o">/</span> <span class="n">event</span><span class="p">[</span><span class="n">iMother</span><span class="p">].</span><span class="n">pAbs</span><span class="p">();</span>
        <span class="n">xRH</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">xFrac</span><span class="p">);</span>
        <span class="kt">double</span> <span class="n">mShift</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">m</span><span class="p">()</span> <span class="o">-</span> <span class="n">event</span><span class="p">[</span><span class="n">iMother</span><span class="p">].</span><span class="n">m</span><span class="p">();</span>
        <span class="n">mDiff</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">mShift</span> <span class="p">);</span>
        <span class="c1">// Separation of R-hadron decay vertex from origin.</span>
        <span class="c1">// Don&#39;t be fooled by pAbs(); it gives the three-vector length</span>
        <span class="c1">// of any Vec4, also one representing spatial coordinates.</span>
        <span class="kt">double</span> <span class="n">dist</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">vDec</span><span class="p">().</span><span class="n">pAbs</span><span class="p">();</span>
        <span class="n">decVtx</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">dist</span><span class="p">);</span>
        <span class="c1">// This is a place where you could allow a R-hadron shift of</span>
        <span class="c1">// identity, momentum and decay vertex to allow for detector effects.</span>
        <span class="c1">// Identity not illustrated here; requires a change of mass as well.</span>
        <span class="c1">// Toy model: assume an exponential energy loss, &lt; &gt; = 1 GeV,</span>
        <span class="c1">// but at most half of kinetic energy. Unchanged direction.</span>
        <span class="c1">// Note that event will no longer conserve energy and momentum.</span>
        <span class="kt">double</span> <span class="n">eLossAvg</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">;</span>
        <span class="kt">double</span> <span class="n">eLoss</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">;</span>
        <span class="k">do</span> <span class="p">{</span> <span class="n">eLoss</span> <span class="o">=</span> <span class="n">eLossAvg</span> <span class="o">*</span> <span class="n">pythia</span><span class="p">.</span><span class="n">rndm</span><span class="p">.</span><span class="n">exp</span><span class="p">();</span> <span class="p">}</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">eLoss</span> <span class="o">&gt;</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">e</span><span class="p">()</span> <span class="o">-</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">m</span><span class="p">()));</span>
        <span class="kt">double</span> <span class="n">eNew</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">e</span><span class="p">()</span> <span class="o">-</span> <span class="n">eLoss</span><span class="p">;</span>
        <span class="n">Vec4</span>   <span class="n">pNew</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">p</span><span class="p">()</span> <span class="o">*</span> <span class="n">sqrt</span><span class="p">(</span> <span class="n">pow2</span><span class="p">(</span><span class="n">eNew</span><span class="p">)</span> <span class="o">-</span> <span class="n">pow2</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">m</span><span class="p">())</span> <span class="p">)</span>
                    <span class="o">/</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pAbs</span><span class="p">();</span>
        <span class="n">pNew</span><span class="p">.</span><span class="n">e</span><span class="p">(</span> <span class="n">eNew</span><span class="p">);</span>
        <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">p</span><span class="p">(</span> <span class="n">pNew</span><span class="p">);</span>
        <span class="c1">// The decay vertex will be calculated based on the production vertex,</span>
        <span class="c1">// the proper lifetime tau and the NEW four-momentum, rather than</span>
        <span class="c1">// e.g. some average momentum, if you do not set it by hand.</span>
        <span class="c1">// This commented-out piece illustrates brute-force setting,</span>
        <span class="c1">// but you should provide real numbers from some tracking program.</span>
        <span class="c1">// With tau = 0 the decay is right at the chosen point.</span>
        <span class="c1">//event[i].tau( 0.);</span>
        <span class="c1">//event[i].vProd( 132., 155., 233., 177.);</span>
      <span class="c1">// End of loop over final R-hadrons.</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="c1">// If you have set R-hadrons stable above,</span>
    <span class="c1">// you can still force them to decay at this stage.</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">forceRHadronDecays</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">iEvent</span> <span class="o">&lt;</span> <span class="n">nList</span><span class="p">)</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="n">list</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
  <span class="c1">// End of event loop.</span>
  <span class="p">}</span>
  <span class="c1">// Final statistics, flavour composition and histogram output.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s"> Composition of produced R-hadrons </span><span class="se">\n</span><span class="s">    code            &quot;</span>
       <span class="o">&lt;&lt;</span> <span class="s">&quot;name   times &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">map</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;::</span><span class="n">iterator</span> <span class="n">flavNow</span> <span class="o">=</span> <span class="n">flavours</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
    <span class="n">flavNow</span> <span class="o">!=</span> <span class="n">flavours</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">flavNow</span><span class="p">)</span>  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">setw</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
    <span class="o">&lt;&lt;</span> <span class="n">flavNow</span><span class="o">-&gt;</span><span class="n">first</span> <span class="o">&lt;&lt;</span> <span class="n">setw</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">pythia</span><span class="p">.</span><span class="n">particleData</span><span class="p">.</span><span class="n">name</span><span class="p">(</span><span class="n">flavNow</span><span class="o">-&gt;</span><span class="n">first</span><span class="p">)</span>
    <span class="o">&lt;&lt;</span> <span class="n">setw</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">flavNow</span><span class="o">-&gt;</span><span class="n">second</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">nChargedH</span> <span class="o">&lt;&lt;</span> <span class="n">dndyChargedH</span> <span class="o">&lt;&lt;</span> <span class="n">dndyRH</span> <span class="o">&lt;&lt;</span> <span class="n">pTRH</span> <span class="o">&lt;&lt;</span> <span class="n">xRH</span> <span class="o">&lt;&lt;</span> <span class="n">mDiff</span>
       <span class="o">&lt;&lt;</span> <span class="n">decVtx</span><span class="p">;</span>
  <span class="c1">// Done.</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
    </div>
  </div>
</div>

</div> <div class="well well-sm"> <h1 id="main29cc">main29.cc</h1><hr>
<div class="codehilite"><pre><span class="c1">// main29.cc is a part of the PYTHIA event generator.</span>
<span class="c1">// Copyright (C) 2016 Torbjorn Sjostrand.</span>
<span class="c1">// PYTHIA is licenced under the GNU GPL version 2, see COPYING for details.</span>
<span class="c1">// Please respect the MCnet Guidelines, see GUIDELINES for details.</span>
<span class="c1">// Omnibus version for colour reconnection (CR) effect studies.</span>
<span class="c1">// Links to two UserHooks that, along with the internal models,</span>
<span class="c1">// implement all the models used for the top mass study in</span>
<span class="c1">// S. Argyropoulos and T. Sjostrand,</span>
<span class="c1">// arXiv:1407.6653 [hep-ph] (LU TP 14-23, DESY 14-134, MCnet-14-15)</span>
<span class="c1">// Warning: some small modifications have been made when collecting</span>
<span class="c1">// the models, but nothing intended to change the behaviour.</span>
<span class="c1">// Note: the move model is also available with ColourReconnection:mode = 2,</span>
<span class="c1">// while the ColourReconnection:mode = 1 model has not been used here.</span>
<span class="c1">// Note: the new models tend to be slower than the default CR scenario,</span>
<span class="c1">// since they have to probe many more reconnection possibilities.</span>
<span class="c1">// Important: the top mass shift analysis encoded here is very primitive,</span>
<span class="c1">// does not perform well at all, and should not be taken seriously.</span>
<span class="c1">// The important part is that you see how the different scenarios</span>
<span class="c1">// should be set up to operate as intended.</span>
</pre></div>


<div class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" href="#fileid28">Rest of the main29.cc code</a>
    </h4>
  </div>
  <div id="fileid28" class="panel-collapse collapse">
    <div class="panel-body">
<div class="codehilite"><pre><span class="cp">#include</span> <span class="cpf">&quot;Pythia8/Pythia.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;Pythia8Plugins/ColourReconnectionHooks.h&quot;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">Pythia8</span><span class="p">;</span>
<span class="c1">//==========================================================================</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Number of events to generate.</span>
  <span class="c1">// Warning: much statistics is needed for significant results,</span>
  <span class="c1">// so this is just an appetizer. Anyway, the reconstruction is</span>
  <span class="c1">// pretty lousy, so not useful for real studies.</span>
  <span class="kt">int</span> <span class="n">nEvent</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span>
  <span class="c1">// Target t and W masses.</span>
  <span class="kt">double</span> <span class="n">mT</span> <span class="o">=</span> <span class="mf">173.3</span><span class="p">;</span>
  <span class="kt">double</span> <span class="n">mW</span> <span class="o">=</span> <span class="mf">80.385</span><span class="p">;</span>
  <span class="c1">// Set up anti-kT jet finder.</span>
  <span class="kt">double</span> <span class="n">Rjet</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">;</span>
  <span class="kt">double</span> <span class="n">pTjetMin</span> <span class="o">=</span> <span class="mf">20.</span><span class="p">;</span>
  <span class="n">SlowJet</span> <span class="n">sJet</span><span class="p">(</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">Rjet</span><span class="p">,</span> <span class="n">pTjetMin</span><span class="p">);</span>
  <span class="c1">// Loop over different reconnection scenarios.</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">mLoop</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">mLoop</span> <span class="o">&lt;</span> <span class="mi">14</span><span class="p">;</span> <span class="o">++</span><span class="n">mLoop</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n\n</span><span class="s"> ================================ Now begin mLoop = &quot;</span>
       <span class="o">&lt;&lt;</span> <span class="n">mLoop</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; ================================</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="c1">// Generator at 8 TeV LHC.</span>
    <span class="n">Pythia</span> <span class="n">pythia</span><span class="p">;</span>
    <span class="n">Event</span><span class="o">&amp;</span> <span class="n">event</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">;</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Beams:eCM = 8000.&quot;</span><span class="p">);</span>
    <span class="c1">// q qbar, g g -&gt; t tbar.</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Top:qqbar2ttbar = on&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Top:gg2ttbar = on&quot;</span><span class="p">);</span>
    <span class="c1">// Colour reconnection setups.</span>
    <span class="n">UserHooks</span><span class="o">*</span> <span class="n">myUserHooks</span><span class="p">;</span>
    <span class="c1">// Tuning parameters for CR scenarios have tune 4C as a starting point.</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Tune:pp = 5&quot;</span><span class="p">);</span>
    <span class="c1">// No reconnection at all.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">mLoop</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;ColourReconnection:reconnect = off&quot;</span><span class="p">);</span>
      <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;PartonLevel:earlyResDec = off&quot;</span><span class="p">);</span>
      <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;MultipartonInteractions:pT0Ref = 2.30&quot;</span><span class="p">);</span>
    <span class="c1">// Standard reconnection, but top decay products unaffected.</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">mLoop</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;ColourReconnection:reconnect = on&quot;</span><span class="p">);</span>
      <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;PartonLevel:earlyResDec = off&quot;</span><span class="p">);</span>
    <span class="c1">// Standard reconnection, including top decay products.</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">mLoop</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;ColourReconnection:reconnect = on&quot;</span><span class="p">);</span>
      <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;PartonLevel:earlyResDec = on&quot;</span><span class="p">);</span>
    <span class="c1">// New gluon swap and move scenarios, including top decay products.</span>
    <span class="c1">// (Note: the move scenario is also implemented internally.)</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">mLoop</span> <span class="o">&gt;=</span> <span class="mi">3</span> <span class="o">&amp;&amp;</span> <span class="n">mLoop</span> <span class="o">&lt;=</span> <span class="mi">8</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;ColourReconnection:reconnect = off&quot;</span><span class="p">);</span>
      <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;PartonLevel:earlyResDec = off&quot;</span><span class="p">);</span>
      <span class="c1">// Swap (mode = 1) or move (2), and flip (1, 2) or not (0).</span>
      <span class="kt">int</span> <span class="n">mode</span> <span class="o">=</span> <span class="p">(</span><span class="n">mLoop</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">)</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">2</span><span class="p">;</span>
      <span class="kt">int</span> <span class="n">flip</span> <span class="o">=</span> <span class="p">(</span> <span class="n">mLoop</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">mode</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span><span class="p">;</span>
      <span class="c1">// Possibilities to vary effects by further parameters.</span>
      <span class="kt">double</span> <span class="n">dLamCut</span>   <span class="o">=</span> <span class="mf">0.</span><span class="p">;</span>
      <span class="kt">double</span> <span class="n">fracGluon</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span> <span class="n">mode</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">flip</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span>
             <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;MultipartonInteractions:pT0Ref = 2.20&quot;</span><span class="p">);</span>
        <span class="k">else</span> <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;MultipartonInteractions:pT0Ref = 2.30&quot;</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">else</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">flip</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span>
             <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;MultipartonInteractions:pT0Ref = 2.15&quot;</span><span class="p">);</span>
        <span class="k">else</span> <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;MultipartonInteractions:pT0Ref = 2.25&quot;</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="n">myUserHooks</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MBReconUserHooks</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="n">flip</span><span class="p">,</span> <span class="n">dLamCut</span><span class="p">,</span> <span class="n">fracGluon</span><span class="p">);</span>
      <span class="n">pythia</span><span class="p">.</span><span class="n">setUserHooksPtr</span><span class="p">(</span> <span class="n">myUserHooks</span><span class="p">);</span>
    <span class="c1">// New scenaros that do top reconnections separately from normal one.</span>
    <span class="c1">// =  9: reconnect with random background gluon;</span>
    <span class="c1">// = 10: reconnect with nearest (smallest-mass) background gluon;</span>
    <span class="c1">// = 11: reconnect with furthest (largest-mass) background gluon;</span>
    <span class="c1">// = 12: reconnect with smallest (with sign) lambda measure shift;</span>
    <span class="c1">// = 13: reconnect only if reduced lamda, and then to most reduction.</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">mLoop</span> <span class="o">&gt;=</span> <span class="mi">9</span> <span class="o">&amp;&amp;</span> <span class="n">mLoop</span> <span class="o">&lt;=</span> <span class="mi">13</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;ColourReconnection:reconnect = on&quot;</span><span class="p">);</span>
      <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;PartonLevel:earlyResDec = off&quot;</span><span class="p">);</span>
      <span class="c1">// Possibility with reduced reconnection strength.</span>
      <span class="kt">double</span> <span class="n">strength</span> <span class="o">=</span> <span class="p">(</span> <span class="n">mLoop</span> <span class="o">==</span> <span class="mi">13</span> <span class="p">)</span> <span class="o">?</span> <span class="mf">1.</span> <span class="o">:</span> <span class="mf">0.075</span><span class="p">;</span>
      <span class="n">myUserHooks</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TopReconUserHooks</span><span class="p">(</span><span class="n">mLoop</span> <span class="o">-</span> <span class="mi">8</span><span class="p">,</span> <span class="n">strength</span><span class="p">);</span>
      <span class="n">pythia</span><span class="p">.</span><span class="n">setUserHooksPtr</span><span class="p">(</span> <span class="n">myUserHooks</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="c1">// Simplify generation. For tryout only.</span>
    <span class="c1">//pythia.readString(&quot;ProcessLevel:resonanceDecays = off&quot;);</span>
    <span class="c1">//pythia.readString(&quot;PartonLevel:ISR = off&quot;);</span>
    <span class="c1">//pythia.readString(&quot;PartonLevel:FSR = off&quot;);</span>
    <span class="c1">//pythia.readString(&quot;PartonLevel:MPI = off&quot;);</span>
    <span class="c1">//pythia.readString(&quot;BeamRemnants:primordialKT = off&quot;);</span>
    <span class="c1">//pythia.readString(&quot;HadronLevel:all = off&quot;);</span>
    <span class="c1">// Top and W masses. Semileptonic top decay chosen by W decay.</span>
    <span class="c1">// (One of two charge states, so properly ought to symmetrize.)</span>
    <span class="c1">// Trick: only allow decay to stable tau, standing in for e and mu</span>
    <span class="c1">// as well, but the tau is easy to remove before jet finding.</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;6:m0 = 173.3&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;24:m0 = 80.385&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;24:onPosIfAny = 1 2 3 4 5&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;24:onNegIfAny = 15&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;24:offIfAny = 11 13&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;15:mayDecay = off&quot;</span><span class="p">);</span>
    <span class="c1">// Reduce printout.</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Init:showChangedParticleData = off&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Next:numberShowInfo = 0&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Next:numberShowProcess = 0&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Next:numberShowEvent = 0&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Next:numberCount = 100000&quot;</span><span class="p">);</span>
    <span class="c1">// Initialize.</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
    <span class="c1">// Histograms for current scenario.</span>
    <span class="n">Hist</span> <span class="n">nRecH</span><span class="p">(</span>  <span class="s">&quot;number of top reconnections&quot;</span><span class="p">,</span>  <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">99.5</span><span class="p">);</span>
    <span class="n">Hist</span> <span class="n">nchH</span><span class="p">(</span>   <span class="s">&quot;charged multiplicity&quot;</span><span class="p">,</span>         <span class="mi">100</span><span class="p">,</span>  <span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">799.</span><span class="p">);</span>
    <span class="n">Hist</span> <span class="n">nJetH</span><span class="p">(</span>  <span class="s">&quot;jet multiplicity&quot;</span><span class="p">,</span>              <span class="mi">20</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">19.5</span><span class="p">);</span>
    <span class="n">Hist</span> <span class="n">mWH</span><span class="p">(</span>    <span class="s">&quot;reconstructed W mass&quot;</span><span class="p">,</span>         <span class="mi">100</span><span class="p">,</span>  <span class="mf">40.</span><span class="p">,</span> <span class="mf">140.</span><span class="p">);</span>
    <span class="n">Hist</span> <span class="n">mTH</span><span class="p">(</span>    <span class="s">&quot;reconstructed t mass&quot;</span><span class="p">,</span>         <span class="mi">100</span><span class="p">,</span> <span class="mf">120.</span><span class="p">,</span> <span class="mf">220.</span><span class="p">);</span>
    <span class="n">Hist</span> <span class="n">mWerrH</span><span class="p">(</span> <span class="s">&quot;reconstructed W mass error&quot;</span><span class="p">,</span>   <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.</span><span class="p">,</span>  <span class="mf">10.</span><span class="p">);</span>
    <span class="n">Hist</span> <span class="n">mTerrH</span><span class="p">(</span> <span class="s">&quot;reconstructed t mass error&quot;</span><span class="p">,</span>   <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">20.</span><span class="p">,</span>  <span class="mf">20.</span><span class="p">);</span>
    <span class="n">Hist</span> <span class="n">pTTH</span><span class="p">(</span>   <span class="s">&quot;reconstructed pT_t&quot;</span><span class="p">,</span>            <span class="mi">11</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">,</span> <span class="mf">275.</span><span class="p">);</span>
    <span class="n">Hist</span> <span class="n">mTpTH</span><span class="p">(</span>  <span class="s">&quot;reconstructed delta-m_t(pT_t)&quot;</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">,</span> <span class="mf">275.</span><span class="p">);</span>
    <span class="c1">// Begin event loop. Generate event. Skip if error.</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iEvent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iEvent</span> <span class="o">&lt;</span> <span class="n">nEvent</span><span class="p">;</span> <span class="o">++</span><span class="n">iEvent</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">())</span> <span class="k">continue</span><span class="p">;</span>
      <span class="c1">// Charged multiplicity.</span>
      <span class="kt">int</span> <span class="n">nch</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">event</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">isFinal</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">isCharged</span><span class="p">())</span> <span class="o">++</span><span class="n">nch</span><span class="p">;</span>
      <span class="n">nchH</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span><span class="n">nch</span><span class="p">);</span>
      <span class="c1">// Remove tau leptons. (Recall: they were put stable, so simple.)</span>
      <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">event</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">idAbs</span><span class="p">()</span> <span class="o">==</span> <span class="mi">15</span><span class="p">)</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">statusNeg</span><span class="p">();</span>
      <span class="c1">// Find number of jets. At least four to keep going.</span>
      <span class="n">sJet</span><span class="p">.</span><span class="n">analyze</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
      <span class="kt">int</span> <span class="n">nJet</span> <span class="o">=</span> <span class="n">sJet</span><span class="p">.</span><span class="n">sizeJet</span><span class="p">();</span>
      <span class="n">nJetH</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">nJet</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">nJet</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
      <span class="c1">// Find two jets that form mass closest to mW.</span>
      <span class="kt">int</span> <span class="n">i1min</span>     <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="kt">int</span> <span class="n">i2min</span>     <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="kt">double</span> <span class="n">m12min</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">;</span>
      <span class="kt">double</span> <span class="n">diff</span>   <span class="o">=</span> <span class="mf">1e10</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i1</span> <span class="o">&lt;</span> <span class="n">nJet</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="o">++</span><span class="n">i1</span><span class="p">)</span>
      <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i2</span> <span class="o">=</span> <span class="n">i1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i2</span> <span class="o">&lt;</span> <span class="n">nJet</span><span class="p">;</span> <span class="o">++</span><span class="n">i2</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">double</span> <span class="n">m12</span> <span class="o">=</span> <span class="p">(</span><span class="n">sJet</span><span class="p">.</span><span class="n">p</span><span class="p">(</span><span class="n">i1</span><span class="p">)</span> <span class="o">+</span> <span class="n">sJet</span><span class="p">.</span><span class="n">p</span><span class="p">(</span><span class="n">i2</span><span class="p">)).</span><span class="n">mCalc</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">m12</span> <span class="o">-</span> <span class="n">mW</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">diff</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">i1min</span>  <span class="o">=</span> <span class="n">i1</span><span class="p">;</span>
          <span class="n">i2min</span>  <span class="o">=</span> <span class="n">i2</span><span class="p">;</span>
          <span class="n">m12min</span> <span class="o">=</span> <span class="n">m12</span><span class="p">;</span>
          <span class="n">diff</span>   <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">m12</span> <span class="o">-</span> <span class="n">mW</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="n">mWH</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">m12min</span><span class="p">);</span>
      <span class="n">mWerrH</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">m12min</span> <span class="o">-</span> <span class="n">mW</span><span class="p">);</span>
      <span class="c1">// Only keep going if within +-5 GeV.</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">m12min</span> <span class="o">-</span> <span class="n">mW</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">5.</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
      <span class="c1">// Find third jet that forms mass closest to mT.</span>
      <span class="kt">int</span> <span class="n">i3min</span>      <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="kt">double</span> <span class="n">m123min</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">;</span>
      <span class="n">diff</span>           <span class="o">=</span> <span class="mf">1e10</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i3</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i3</span> <span class="o">&lt;</span> <span class="n">nJet</span><span class="p">;</span> <span class="o">++</span><span class="n">i3</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">i3</span> <span class="o">!=</span> <span class="n">i1min</span> <span class="o">&amp;&amp;</span> <span class="n">i3</span> <span class="o">!=</span> <span class="n">i2min</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">double</span> <span class="n">m123</span> <span class="o">=</span> <span class="p">(</span><span class="n">sJet</span><span class="p">.</span><span class="n">p</span><span class="p">(</span><span class="n">i1min</span><span class="p">)</span> <span class="o">+</span> <span class="n">sJet</span><span class="p">.</span><span class="n">p</span><span class="p">(</span><span class="n">i2min</span><span class="p">)</span> <span class="o">+</span> <span class="n">sJet</span><span class="p">.</span><span class="n">p</span><span class="p">(</span><span class="n">i3</span><span class="p">)).</span><span class="n">mCalc</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">m123</span> <span class="o">-</span> <span class="n">mT</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">diff</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">i3min</span>   <span class="o">=</span> <span class="n">i3</span><span class="p">;</span>
          <span class="n">m123min</span> <span class="o">=</span> <span class="n">m123</span><span class="p">;</span>
          <span class="n">diff</span>    <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">m123</span> <span class="o">-</span> <span class="n">mT</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="n">mTH</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">m123min</span><span class="p">);</span>
      <span class="n">mTerrH</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">m123min</span> <span class="o">-</span> <span class="n">mT</span><span class="p">);</span>
      <span class="c1">// Only keep going if within +-20 GeV.</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">m123min</span> <span class="o">-</span> <span class="n">mT</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">20.</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
      <span class="c1">// Study top pT and dependence of top mass error.</span>
      <span class="kt">double</span> <span class="n">pTT</span> <span class="o">=</span> <span class="p">(</span><span class="n">sJet</span><span class="p">.</span><span class="n">p</span><span class="p">(</span><span class="n">i1min</span><span class="p">)</span> <span class="o">+</span> <span class="n">sJet</span><span class="p">.</span><span class="n">p</span><span class="p">(</span><span class="n">i2min</span><span class="p">)</span> <span class="o">+</span> <span class="n">sJet</span><span class="p">.</span><span class="n">p</span><span class="p">(</span><span class="n">i3min</span><span class="p">)).</span><span class="n">pT</span><span class="p">();</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">pTT</span> <span class="o">&gt;</span> <span class="mf">250.</span><span class="p">)</span> <span class="n">pTT</span> <span class="o">=</span> <span class="mf">260.</span><span class="p">;</span>
      <span class="n">pTTH</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">pTT</span><span class="p">);</span>
      <span class="n">mTpTH</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">pTT</span><span class="p">,</span> <span class="n">m123min</span> <span class="o">-</span> <span class="n">mT</span><span class="p">);</span>
    <span class="c1">// End of event loop. Statistics. Histograms.</span>
    <span class="p">}</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
    <span class="n">mTpTH</span> <span class="o">/=</span> <span class="n">pTTH</span><span class="p">;</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span>  <span class="n">nchH</span> <span class="o">&lt;&lt;</span> <span class="n">nJetH</span> <span class="o">&lt;&lt;</span> <span class="n">mWH</span> <span class="o">&lt;&lt;</span> <span class="n">mTH</span> <span class="o">&lt;&lt;</span> <span class="n">mWerrH</span>
         <span class="o">&lt;&lt;</span> <span class="n">mTerrH</span> <span class="o">&lt;&lt;</span> <span class="n">pTTH</span> <span class="o">&lt;&lt;</span> <span class="n">mTpTH</span><span class="p">;</span>
    <span class="c1">// End loop over top colour reconnection scenarios.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">mLoop</span> <span class="o">&gt;=</span><span class="mi">3</span><span class="p">)</span> <span class="k">delete</span> <span class="n">myUserHooks</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// Done.</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
    </div>
  </div>
</div>

</div> <div class="well well-sm"> <h1 id="main30cc">main30.cc</h1><hr>
<div class="codehilite"><pre><span class="c1">// main30.cc is a part of the PYTHIA event generator.</span>
<span class="c1">// Copyright (C) 2016 Torbjorn Sjostrand.</span>
<span class="c1">// PYTHIA is licenced under the GNU GPL version 2, see COPYING for details.</span>
<span class="c1">// Please respect the MCnet Guidelines, see GUIDELINES for details.</span>
<span class="c1">// Author: Steve Mrenna.</span>
<span class="c1">// Example how to create a copy of the event record, where the original one</span>
<span class="c1">// is translated to another format, to meet various analysis needs.</span>
<span class="c1">// In this specific case the idea is to set up the history information</span>
<span class="c1">// of the underlying hard process to be close to the PYTHIA 6 structure.</span>
</pre></div>


<div class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" href="#fileid29">Rest of the main30.cc code</a>
    </h4>
  </div>
  <div id="fileid29" class="panel-collapse collapse">
    <div class="panel-body">
<div class="codehilite"><pre><span class="cp">#include</span> <span class="cpf">&quot;Pythia8/Pythia.h&quot;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">Pythia8</span><span class="p">;</span>
<span class="c1">//--------------------------------------------------------------------------</span>
<span class="kt">void</span> <span class="nf">translate</span><span class="p">(</span><span class="n">Event</span><span class="o">&amp;</span><span class="p">,</span> <span class="n">Event</span><span class="o">&amp;</span><span class="p">);</span>
<span class="c1">//--------------------------------------------------------------------------</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Generator.</span>
  <span class="n">Pythia</span> <span class="n">pythia</span><span class="p">;</span>
  <span class="c1">// Shorthand for the event record in pythia.</span>
  <span class="n">Event</span><span class="o">&amp;</span> <span class="n">event</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">;</span>
  <span class="c1">// Read in commands from external file.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readFile</span><span class="p">(</span><span class="s">&quot;main30.cmnd&quot;</span><span class="p">);</span>
  <span class="c1">// Extract settings to be used in the main program.</span>
  <span class="kt">int</span> <span class="n">nEvent</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Main:numberOfEvents&quot;</span><span class="p">);</span>
  <span class="kt">int</span> <span class="n">nAbort</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Main:timesAllowErrors&quot;</span><span class="p">);</span>
  <span class="kt">int</span> <span class="n">nShow</span>  <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Next:numberShowEvent&quot;</span><span class="p">);</span>
  <span class="c1">// Initialize.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
  <span class="c1">// Event record for hard interaction and resonance decays.</span>
  <span class="n">Event</span> <span class="n">hard</span><span class="p">;</span>
  <span class="n">hard</span><span class="p">.</span><span class="n">init</span><span class="p">(</span><span class="s">&quot;(Pythia 6 conventions)&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pythia</span><span class="p">.</span><span class="n">particleData</span><span class="p">);</span>
  <span class="c1">// Begin event loop.</span>
  <span class="kt">int</span> <span class="n">iAbort</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iEvent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iEvent</span> <span class="o">&lt;</span> <span class="n">nEvent</span><span class="p">;</span> <span class="o">++</span><span class="n">iEvent</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Generate events. Quit if many failures.</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">())</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">++</span><span class="n">iAbort</span> <span class="o">&lt;</span> <span class="n">nAbort</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; Event generation aborted prematurely, owing to error!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// Reset record for this event. List first few.</span>
    <span class="n">translate</span><span class="p">(</span> <span class="n">event</span><span class="p">,</span> <span class="n">hard</span> <span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">iEvent</span> <span class="o">&lt;</span> <span class="n">nShow</span><span class="p">)</span> <span class="n">hard</span><span class="p">.</span><span class="n">list</span><span class="p">();</span>
  <span class="c1">// End of event loop.</span>
  <span class="p">}</span>
  <span class="c1">// Final statistics.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
  <span class="c1">// Done.</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">//--------------------------------------------------------------------------</span>
<span class="c1">// Routine to identify the hard process of the event after</span>
<span class="c1">// accounting for the affects of ISR and resonance decay.</span>
<span class="kt">void</span> <span class="nf">translate</span><span class="p">(</span><span class="n">Event</span><span class="o">&amp;</span> <span class="n">event</span><span class="p">,</span> <span class="n">Event</span><span class="o">&amp;</span> <span class="n">hard</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Reset translated event record.</span>
    <span class="n">hard</span><span class="p">.</span><span class="n">reset</span><span class="p">();</span>
    <span class="c1">// Identify primordial partons with kT smearing.</span>
    <span class="kt">int</span> <span class="n">iL1</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">daughter1</span><span class="p">();</span>
    <span class="kt">int</span> <span class="n">iL2</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">daughter1</span><span class="p">();</span>
    <span class="kt">int</span> <span class="n">iLast</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">iL1</span><span class="p">,</span><span class="n">iL2</span><span class="p">);</span>
    <span class="c1">// Identify initial hard partons.</span>
    <span class="kt">int</span> <span class="n">iP1</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">iP2</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">iEv</span><span class="o">=-</span><span class="mi">1</span><span class="p">;</span>
    <span class="c1">// Counters to identify ISR radiator, recoil, and radiation.</span>
    <span class="kt">int</span> <span class="n">i41</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i42</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i43</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span> <span class="n">iEv</span> <span class="o">&lt;</span> <span class="n">iLast</span> <span class="p">)</span> <span class="p">{</span>
      <span class="n">iEv</span><span class="o">++</span><span class="p">;</span>
      <span class="c1">// Identify hard process by status in the 20s.</span>
      <span class="kt">int</span> <span class="n">iStatus</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="n">iEv</span><span class="p">].</span><span class="n">status</span><span class="p">();</span>
      <span class="k">if</span> <span class="p">(</span> <span class="n">abs</span><span class="p">(</span><span class="n">iStatus</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">20</span> <span class="o">&amp;&amp;</span> <span class="n">abs</span><span class="p">(</span><span class="n">iStatus</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">30</span> <span class="p">)</span> <span class="p">{</span>
        <span class="n">hard</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="n">iEv</span><span class="p">]);</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">iStatus</span><span class="o">==-</span><span class="mi">21</span> <span class="p">)</span> <span class="p">{</span>
          <span class="n">hard</span><span class="p">[</span><span class="n">hard</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">].</span><span class="n">mothers</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="n">hard</span><span class="p">[</span><span class="n">hard</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">].</span><span class="n">mothers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">continue</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="c1">// Follow the flow of the hard event.</span>
      <span class="kt">int</span> <span class="n">iDa1</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="n">iEv</span><span class="p">].</span><span class="n">daughter2</span><span class="p">();</span>
      <span class="c1">// Test to determine origin of this shower.</span>
      <span class="kt">bool</span> <span class="n">hardTest</span> <span class="o">=</span> <span class="p">(</span><span class="n">iDa1</span> <span class="o">==</span> <span class="n">iP1</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">iDa1</span> <span class="o">==</span> <span class="n">iP2</span><span class="p">);</span>
      <span class="c1">// Status -41 is the ISR radiator</span>
      <span class="c1">// Status -42 is the ISR recoil</span>
      <span class="c1">// Status -61 is the primordial parton with kT smearing</span>
      <span class="c1">// Status -53 is a recoil in initial-final dipole radiation</span>
      <span class="k">if</span> <span class="p">(</span> <span class="n">iStatus</span> <span class="o">==</span> <span class="o">-</span><span class="mi">41</span> <span class="o">&amp;&amp;</span> <span class="n">hardTest</span> <span class="p">)</span> <span class="p">{</span>
        <span class="n">i41</span> <span class="o">=</span> <span class="n">iEv</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="n">iStatus</span> <span class="o">==</span> <span class="o">-</span><span class="mi">42</span> <span class="o">&amp;&amp;</span> <span class="n">hardTest</span> <span class="p">)</span> <span class="p">{</span>
        <span class="n">i42</span> <span class="o">=</span> <span class="n">iEv</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="n">iStatus</span> <span class="o">==</span> <span class="o">-</span><span class="mi">61</span> <span class="o">&amp;&amp;</span> <span class="n">hardTest</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">i41</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
          <span class="n">i41</span> <span class="o">=</span> <span class="n">iEv</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="n">i42</span> <span class="o">=</span> <span class="n">iEv</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="n">iStatus</span> <span class="o">==</span> <span class="o">-</span><span class="mi">53</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">iDa1</span> <span class="o">==</span> <span class="n">iP1</span> <span class="p">)</span> <span class="p">{</span>
          <span class="n">iP1</span> <span class="o">=</span> <span class="n">iEv</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="n">iDa1</span> <span class="o">==</span> <span class="n">iP2</span> <span class="p">)</span> <span class="p">{</span>
          <span class="n">iP2</span> <span class="o">=</span> <span class="n">iEv</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="p">(</span><span class="n">i41</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">i42</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
      <span class="kt">int</span> <span class="n">ik2</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="n">i41</span><span class="p">].</span><span class="n">daughter2</span><span class="p">();</span>
      <span class="kt">int</span> <span class="n">ik1</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="n">i42</span><span class="p">].</span><span class="n">daughter2</span><span class="p">();</span>
      <span class="k">if</span> <span class="p">(</span> <span class="n">event</span><span class="p">[</span><span class="n">ik2</span><span class="p">].</span><span class="n">pz</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">iTemp</span><span class="o">=</span><span class="n">ik1</span><span class="p">;</span>
        <span class="n">ik1</span><span class="o">=</span><span class="n">ik2</span><span class="p">;</span>
        <span class="n">ik2</span><span class="o">=</span><span class="n">iTemp</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="c1">// Boost to CM frame of hard partons.</span>
      <span class="n">RotBstMatrix</span> <span class="n">toCMS</span><span class="p">;</span>
      <span class="n">toCMS</span><span class="p">.</span><span class="n">toCMframe</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="n">ik1</span><span class="p">].</span><span class="n">p</span><span class="p">(),</span><span class="n">event</span><span class="p">[</span><span class="n">ik2</span><span class="p">].</span><span class="n">p</span><span class="p">());</span>
      <span class="c1">// Momentum of off-shell incoming parton.</span>
      <span class="n">i43</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="n">i41</span><span class="p">].</span><span class="n">daughter1</span><span class="p">();</span>
      <span class="n">Vec4</span> <span class="n">pBoost</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="n">i41</span><span class="p">].</span><span class="n">p</span><span class="p">()</span><span class="o">-</span><span class="n">event</span><span class="p">[</span><span class="n">i43</span><span class="p">].</span><span class="n">p</span><span class="p">();</span>
      <span class="n">RotBstMatrix</span> <span class="n">toHard</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span> <span class="n">event</span><span class="p">[</span><span class="n">i41</span><span class="p">].</span><span class="n">pz</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
        <span class="n">toHard</span><span class="p">.</span><span class="n">fromCMframe</span><span class="p">(</span><span class="n">pBoost</span><span class="p">,</span><span class="n">event</span><span class="p">[</span><span class="n">i42</span><span class="p">].</span><span class="n">p</span><span class="p">());</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">toHard</span><span class="p">.</span><span class="n">fromCMframe</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="n">i42</span><span class="p">].</span><span class="n">p</span><span class="p">(),</span><span class="n">pBoost</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="c1">// Boost to CM frame of old initiators,</span>
      <span class="c1">// then boost from frame of new initiators.</span>
      <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span> <span class="n">hard</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span> <span class="p">)</span> <span class="p">{</span>
        <span class="n">hard</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">rotbst</span><span class="p">(</span><span class="n">toCMS</span><span class="p">);</span>
        <span class="n">hard</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">rotbst</span><span class="p">(</span><span class="n">toHard</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="c1">// Update counter to location of new parton</span>
      <span class="n">iEv</span> <span class="o">=</span> <span class="n">i43</span><span class="p">;</span>
      <span class="c1">// Update event history</span>
      <span class="n">iDa1</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="n">i41</span><span class="p">].</span><span class="n">daughter2</span><span class="p">();</span>
      <span class="k">if</span> <span class="p">(</span> <span class="n">iDa1</span> <span class="o">==</span> <span class="n">iP1</span> <span class="p">)</span> <span class="p">{</span>
        <span class="n">iP1</span> <span class="o">=</span> <span class="n">i41</span><span class="p">;</span>
        <span class="n">iP2</span> <span class="o">=</span> <span class="n">i42</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">iP2</span> <span class="o">=</span> <span class="n">i41</span><span class="p">;</span>
        <span class="n">iP1</span> <span class="o">=</span> <span class="n">i42</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="n">i41</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i42</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// Handle kT smearing of initial partons.</span>
    <span class="n">RotBstMatrix</span> <span class="n">ref0</span><span class="p">,</span> <span class="n">ref1</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">event</span><span class="p">[</span><span class="n">iP1</span><span class="p">].</span><span class="n">pz</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
      <span class="n">ref0</span><span class="p">.</span><span class="n">toCMframe</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="n">iP1</span><span class="p">].</span><span class="n">p</span><span class="p">(),</span><span class="n">event</span><span class="p">[</span><span class="n">iP2</span><span class="p">].</span><span class="n">p</span><span class="p">());</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="n">ref0</span><span class="p">.</span><span class="n">toCMframe</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="n">iP2</span><span class="p">].</span><span class="n">p</span><span class="p">(),</span><span class="n">event</span><span class="p">[</span><span class="n">iP1</span><span class="p">].</span><span class="n">p</span><span class="p">());</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">event</span><span class="p">[</span><span class="n">iL1</span><span class="p">].</span><span class="n">pz</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
      <span class="n">ref1</span><span class="p">.</span><span class="n">fromCMframe</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="n">iL1</span><span class="p">].</span><span class="n">p</span><span class="p">(),</span><span class="n">event</span><span class="p">[</span><span class="n">iL2</span><span class="p">].</span><span class="n">p</span><span class="p">());</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="n">ref1</span><span class="p">.</span><span class="n">fromCMframe</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="n">iL2</span><span class="p">].</span><span class="n">p</span><span class="p">(),</span><span class="n">event</span><span class="p">[</span><span class="n">iL1</span><span class="p">].</span><span class="n">p</span><span class="p">());</span>
    <span class="p">}</span>
    <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span> <span class="n">hard</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span> <span class="p">)</span> <span class="p">{</span>
      <span class="n">hard</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">rotbst</span><span class="p">(</span><span class="n">ref0</span><span class="p">);</span>
      <span class="n">hard</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">rotbst</span><span class="p">(</span><span class="n">ref1</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">hard</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">daughters</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">hard</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
    <span class="n">hard</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">daughters</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">hard</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">iMax</span> <span class="o">=</span> <span class="n">hard</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
    <span class="c1">// Add resonance decays; start here.</span>
    <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">iMax</span> <span class="o">&amp;&amp;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">event</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span> <span class="p">)</span> <span class="p">{</span>
      <span class="kt">int</span> <span class="n">ilast</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
      <span class="kt">int</span> <span class="n">ida1</span><span class="p">,</span> <span class="n">ida2</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span> <span class="n">hard</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">status</span><span class="p">()</span><span class="o">!=-</span><span class="mi">22</span> <span class="p">)</span> <span class="p">{</span>
        <span class="n">hard</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">statusPos</span><span class="p">();</span>
        <span class="k">continue</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span> <span class="n">hard</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">mother1</span><span class="p">()</span><span class="o">==</span><span class="mi">3</span> <span class="p">)</span> <span class="p">{</span>
        <span class="n">ilast</span> <span class="o">=</span> <span class="n">hard</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">daughter1</span><span class="p">();</span>
        <span class="n">ida1</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="n">ilast</span><span class="p">].</span><span class="n">daughter1</span><span class="p">();</span>
        <span class="n">ida2</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="n">ilast</span><span class="p">].</span><span class="n">daughter2</span><span class="p">();</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">ilast</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
        <span class="n">ida1</span> <span class="o">=</span> <span class="n">hard</span><span class="p">[</span><span class="n">ilast</span><span class="p">].</span><span class="n">daughter1</span><span class="p">();</span>
        <span class="n">ida2</span> <span class="o">=</span> <span class="n">hard</span><span class="p">[</span><span class="n">ilast</span><span class="p">].</span><span class="n">daughter2</span><span class="p">();</span>
      <span class="p">}</span>
      <span class="c1">// Resonance decays occur when there are multiple daughters and</span>
      <span class="c1">// it is NOT FSR.</span>
      <span class="k">while</span><span class="p">(</span> <span class="n">ilast</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">ilast</span> <span class="o">&lt;</span> <span class="n">event</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">ida1</span> <span class="o">!=</span> <span class="n">ida2</span> <span class="o">&amp;&amp;</span> <span class="n">event</span><span class="p">[</span><span class="n">ida1</span><span class="p">].</span><span class="n">status</span><span class="p">()</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">51</span> <span class="p">)</span> <span class="k">break</span><span class="p">;</span>
        <span class="n">ilast</span> <span class="o">=</span> <span class="n">ida1</span><span class="p">;</span>
        <span class="n">ida1</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="n">ilast</span><span class="p">].</span><span class="n">daughter1</span><span class="p">();</span>
        <span class="n">ida2</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="n">ilast</span><span class="p">].</span><span class="n">daughter2</span><span class="p">();</span>
      <span class="p">}</span>
      <span class="c1">// Add daughters to the event record, boosting to the frame</span>
      <span class="c1">// of the mother.</span>
      <span class="k">if</span> <span class="p">(</span> <span class="n">ilast</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
        <span class="n">Vec4</span> <span class="n">pall</span> <span class="o">=</span> <span class="n">Vec4</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">ida</span> <span class="o">=</span> <span class="n">ida1</span><span class="p">;</span> <span class="n">ida</span> <span class="o">&lt;=</span> <span class="n">ida2</span><span class="p">;</span> <span class="o">++</span><span class="n">ida</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">pall</span> <span class="o">+=</span> <span class="n">event</span><span class="p">[</span><span class="n">ida</span><span class="p">].</span><span class="n">p</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="n">RotBstMatrix</span> <span class="n">toResonance</span><span class="p">;</span>
        <span class="n">toResonance</span><span class="p">.</span><span class="n">bst</span><span class="p">(</span> <span class="n">pall</span><span class="p">,</span> <span class="n">hard</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">p</span><span class="p">()</span> <span class="p">);</span>
        <span class="kt">int</span> <span class="n">nDau</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">ida</span> <span class="o">=</span> <span class="n">ida1</span><span class="p">;</span> <span class="n">ida</span> <span class="o">&lt;=</span> <span class="n">ida2</span><span class="p">;</span> <span class="o">++</span><span class="n">ida</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">Particle</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">Particle</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="n">ida</span><span class="p">]);</span>
          <span class="n">tmp</span><span class="p">.</span><span class="n">rotbst</span><span class="p">(</span><span class="n">toResonance</span><span class="p">);</span>
          <span class="n">hard</span><span class="p">.</span><span class="n">append</span><span class="p">(</span> <span class="n">tmp</span> <span class="p">);</span>
          <span class="n">hard</span><span class="p">[</span><span class="n">hard</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">].</span><span class="n">mothers</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">);</span>
          <span class="n">iMax</span><span class="o">++</span><span class="p">;</span>
          <span class="n">nDau</span><span class="o">++</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="kt">int</span> <span class="n">ip1</span> <span class="o">=</span> <span class="n">hard</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="n">nDau</span><span class="p">;</span>
        <span class="n">hard</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">daughters</span><span class="p">(</span><span class="n">ip1</span><span class="p">,</span><span class="n">ip1</span><span class="o">+</span><span class="n">nDau</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
    </div>
  </div>
</div>

</div> <div class="well well-sm"> <h1 id="main31cc">main31.cc</h1><hr>
<div class="codehilite"><pre><span class="c1">// main31.cc is a part of the PYTHIA event generator.</span>
<span class="c1">// Copyright (C) 2016 Richard Corke, Torbjorn Sjostrand.</span>
<span class="c1">// PYTHIA is licenced under the GNU GPL version 2, see COPYING for details.</span>
<span class="c1">// Please respect the MCnet Guidelines, see GUIDELINES for details.</span>
<span class="c1">// Example how to perform merging with PWOHEG-BOX events,</span>
<span class="c1">// based on the code found in include/Pythia8Plugins/PowhegHooks.h.</span>
</pre></div>


<div class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" href="#fileid30">Rest of the main31.cc code</a>
    </h4>
  </div>
  <div id="fileid30" class="panel-collapse collapse">
    <div class="panel-body">
<div class="codehilite"><pre><span class="cp">#include</span> <span class="cpf">&quot;Pythia8/Pythia.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;Pythia8Plugins/PowhegHooks.h&quot;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">Pythia8</span><span class="p">;</span>
<span class="c1">//==========================================================================</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Generator</span>
  <span class="n">Pythia</span> <span class="n">pythia</span><span class="p">;</span>
  <span class="c1">// Load configuration file</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readFile</span><span class="p">(</span><span class="s">&quot;main31.cmnd&quot;</span><span class="p">);</span>
  <span class="c1">// Read in main settings</span>
  <span class="kt">int</span> <span class="n">nEvent</span>      <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Main:numberOfEvents&quot;</span><span class="p">);</span>
  <span class="kt">int</span> <span class="n">nError</span>      <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Main:timesAllowErrors&quot;</span><span class="p">);</span>
  <span class="c1">// Read in key POWHEG merging settings</span>
  <span class="kt">int</span> <span class="n">vetoMode</span>    <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;POWHEG:veto&quot;</span><span class="p">);</span>
  <span class="kt">int</span> <span class="n">MPIvetoMode</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;POWHEG:MPIveto&quot;</span><span class="p">);</span>
  <span class="kt">bool</span> <span class="n">loadHooks</span>  <span class="o">=</span> <span class="p">(</span><span class="n">vetoMode</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">MPIvetoMode</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">);</span>
  <span class="c1">// Add in user hooks for shower vetoing</span>
  <span class="n">PowhegHooks</span> <span class="o">*</span><span class="n">powhegHooks</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">loadHooks</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Set ISR and FSR to start at the kinematical limit</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">vetoMode</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;SpaceShower:pTmaxMatch = 2&quot;</span><span class="p">);</span>
      <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;TimeShower:pTmaxMatch = 2&quot;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="c1">// Set MPI to start at the kinematical limit</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">MPIvetoMode</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;MultipartonInteractions:pTmaxMatch = 2&quot;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">powhegHooks</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PowhegHooks</span><span class="p">();</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">setUserHooksPtr</span><span class="p">((</span><span class="n">UserHooks</span> <span class="o">*</span><span class="p">)</span> <span class="n">powhegHooks</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="c1">// Initialise and list settings</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
  <span class="c1">// Counters for number of ISR/FSR emissions vetoed</span>
  <span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">int</span> <span class="n">nISRveto</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">nFSRveto</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="c1">// Begin event loop; generate until nEvent events are processed</span>
  <span class="c1">// or end of LHEF file</span>
  <span class="kt">int</span> <span class="n">iEvent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">iError</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">while</span> <span class="p">(</span><span class="nb">true</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Generate the next event</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">())</span> <span class="p">{</span>
      <span class="c1">// If failure because reached end of file then exit event loop</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">atEndOfFile</span><span class="p">())</span> <span class="k">break</span><span class="p">;</span>
      <span class="c1">// Otherwise count event failure and continue/exit as necessary</span>
      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Warning: event &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">iEvent</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; failed&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">++</span><span class="n">iError</span> <span class="o">==</span> <span class="n">nError</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Error: too many event failures.. exiting&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">continue</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="cm">/*</span>
<span class="cm">     * Process dependent checks and analysis may be inserted here</span>
<span class="cm">     */</span>
    <span class="c1">// Update ISR/FSR veto counters</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">loadHooks</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">nISRveto</span> <span class="o">+=</span> <span class="n">powhegHooks</span><span class="o">-&gt;</span><span class="n">getNISRveto</span><span class="p">();</span>
      <span class="n">nFSRveto</span> <span class="o">+=</span> <span class="n">powhegHooks</span><span class="o">-&gt;</span><span class="n">getNFSRveto</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="c1">// If nEvent is set, check and exit loop if necessary</span>
    <span class="o">++</span><span class="n">iEvent</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">nEvent</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">iEvent</span> <span class="o">==</span> <span class="n">nEvent</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span> <span class="c1">// End of event loop.</span>
  <span class="c1">// Statistics, histograms and veto information</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Number of ISR emissions vetoed: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">nISRveto</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Number of FSR emissions vetoed: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">nFSRveto</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="c1">// Done.</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">powhegHooks</span><span class="p">)</span> <span class="k">delete</span> <span class="n">powhegHooks</span><span class="p">;</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
    </div>
  </div>
</div>

</div> <div class="well well-sm"> <h1 id="main32cc">main32.cc</h1><hr>
<div class="codehilite"><pre><span class="c1">// main32.cc is a part of the PYTHIA event generator.</span>
<span class="c1">// Copyright (C) 2016 Torbjorn Sjostrand.</span>
<span class="c1">// PYTHIA is licenced under the GNU GPL version 2, see COPYING for details.</span>
<span class="c1">// Please respect the MCnet Guidelines, see GUIDELINES for details.</span>
<span class="c1">// This is a sample program showing Alpgen- or Madgraph-style MLM matching</span>
<span class="c1">// for Madgraph LHEF or native Alpgen format event files.</span>
<span class="c1">//</span>
<span class="c1">// Please see the &#39;Jet Matching Style&#39; manual page for a description of the</span>
<span class="c1">// parameters and user options.</span>
<span class="c1">// Includes and namespace</span>
</pre></div>


<div class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" href="#fileid31">Rest of the main32.cc code</a>
    </h4>
  </div>
  <div id="fileid31" class="panel-collapse collapse">
    <div class="panel-body">
<div class="codehilite"><pre><span class="cp">#include</span> <span class="cpf">&quot;Pythia8/Pythia.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;Pythia8Plugins/CombineMatchingInput.h&quot;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">Pythia8</span><span class="p">;</span>
<span class="c1">//==========================================================================</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
 <span class="c1">// Generator and read in commands.</span>
  <span class="n">Pythia</span> <span class="n">pythia</span><span class="p">;</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readFile</span><span class="p">(</span><span class="s">&quot;main32.cmnd&quot;</span><span class="p">);</span>
  <span class="c1">// Extract settings to be used in the main program.</span>
  <span class="kt">int</span> <span class="n">nEvent</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Main:numberOfEvents&quot;</span><span class="p">);</span>
  <span class="kt">int</span> <span class="n">nAbort</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Main:timesAllowErrors&quot;</span><span class="p">);</span>
  <span class="kt">int</span> <span class="n">nSkip</span>  <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Main:spareMode1&quot;</span><span class="p">);</span>
  <span class="c1">// Create UserHooks pointer. Stop if it failed. Pass pointer to Pythia.</span>
  <span class="n">CombineMatchingInput</span> <span class="n">combined</span><span class="p">;</span>
  <span class="n">UserHooks</span><span class="o">*</span> <span class="n">matching</span> <span class="o">=</span> <span class="n">combined</span><span class="p">.</span><span class="n">getHook</span><span class="p">(</span><span class="n">pythia</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">matching</span><span class="p">)</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">setUserHooksPtr</span><span class="p">(</span><span class="n">matching</span><span class="p">);</span>
  <span class="c1">// Initialise Pythia.</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">())</span> <span class="p">{</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Error: could not initialise Pythia&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">};</span>
  <span class="c1">// Optionally skip ahead in LHEF.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">LHAeventSkip</span><span class="p">(</span> <span class="n">nSkip</span> <span class="p">);</span>
  <span class="c1">// Begin event loop. Optionally quit it before end of file.</span>
  <span class="kt">int</span> <span class="n">iAbort</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iEvent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">;</span>  <span class="o">++</span><span class="n">iEvent</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">nEvent</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">iEvent</span> <span class="o">&gt;=</span> <span class="n">nEvent</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
    <span class="c1">// Generate events. Quit if at end of file or many failures.</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">())</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">atEndOfFile</span><span class="p">())</span> <span class="p">{</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Info: end of input file reached&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">++</span><span class="n">iAbort</span> <span class="o">&lt;</span> <span class="n">nAbort</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Abort: too many errors in generation&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// Event analysis goes here.</span>
  <span class="c1">// End of event loop.</span>
  <span class="p">}</span>
  <span class="c1">// Final statistics and done.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
  <span class="k">delete</span> <span class="n">matching</span><span class="p">;</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
    </div>
  </div>
</div>

</div> <div class="well well-sm"> <h1 id="main33cc">main33.cc</h1><hr>
<div class="codehilite"><pre><span class="c1">// main33.cc is a part of the PYTHIA event generator.</span>
<span class="c1">// Copyright (C) 2016 Torbjorn Sjostrand.</span>
<span class="c1">// PYTHIA is licenced under the GNU GPL version 2, see COPYING for details.</span>
<span class="c1">// Please respect the MCnet Guidelines, see GUIDELINES for details.</span>
<span class="c1">// Author: Philip Ilten.</span>
<span class="c1">// An example where the HVQ POWHEGBOX matrix element binary is</span>
<span class="c1">// interfaced directly with PYTHIA. For this example to run correctly</span>
<span class="c1">// PYTHIA must be configured with the</span>
<span class="c1">// --with-powheg-bin=&lt;path to directory containing only POWHEG binaries&gt;</span>
<span class="c1">// option. This will build plugin libraries of the name</span>
<span class="c1">// libpythia8powheg&lt;binary name&gt;.so in the library directory.</span>
<span class="c1">// For these plugin libraries to build correctly, special compiler flags</span>
<span class="c1">// must have been used when building the POWHEGBOX binaries. These are</span>
<span class="c1">// &quot;-rdynamic -fPIE -fPIC -pie&quot;. The following SED command will correctly</span>
<span class="c1">// insert them into the relevant POWHEGBOX Makefile:</span>
<span class="c1">//     sed -i &quot;s/F77= gfortran/F77= gfortran -rdynamic -fPIE -fPIC -pie/g&quot;</span>
<span class="c1">//     Makefile</span>
<span class="c1">// For this specific example the library libpythia8powheghvq.so must</span>
<span class="c1">// have been built.</span>
</pre></div>


<div class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" href="#fileid32">Rest of the main33.cc code</a>
    </h4>
  </div>
  <div id="fileid32" class="panel-collapse collapse">
    <div class="panel-body">
<div class="codehilite"><pre><span class="cp">#include</span> <span class="cpf">&quot;Pythia8/Pythia.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;Pythia8Plugins/PowhegProcs.h&quot;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">Pythia8</span><span class="p">;</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">Pythia</span> <span class="n">pythia</span><span class="p">;</span>
  <span class="c1">// The constructor PowhegProcs(process name, pythia, run directory,</span>
  <span class="c1">// PDF filename, use Pythia random) where run directory by default</span>
  <span class="c1">// is ./powhegrun, the PDF filename is empty, and using Pythia</span>
  <span class="c1">// random is true. If using native PDFs rather than LHAPDF, the PDF</span>
  <span class="c1">// filename is the full name of the PDF file to copy to the run</span>
  <span class="c1">// directory.</span>
  <span class="n">PowhegProcs</span> <span class="n">procs</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pythia</span><span class="p">,</span> <span class="s">&quot;hvq&quot;</span><span class="p">);</span>
  <span class="c1">// The PowhegProcs class automatically sets the Pythia user hooks to</span>
  <span class="c1">// an instance of PowhegHooks. However, this can be modified to a</span>
  <span class="c1">// user chosen set of hooks (or null).</span>
  <span class="c1">// pythia-&gt;setUserHooksPtr(userHooksPtr);</span>
  <span class="c1">// Pythia and the POWHEG user hooks must still be configured, here</span>
  <span class="c1">// this is done via main33.cmnd. These settings are sensible</span>
  <span class="c1">// defaults, but Powheg:nFinal is dependent upon the POWHEG matrix</span>
  <span class="c1">// element being used and so must be changed as appropriate.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readFile</span><span class="p">(</span><span class="s">&quot;main33.cmnd&quot;</span><span class="p">);</span>
  <span class="c1">// The commands readFile and readString are used to configure the</span>
  <span class="c1">// POWHEG matrix element. If a setting is repeated a warning is</span>
  <span class="c1">// issued and the most recent setting is used.</span>
  <span class="n">procs</span><span class="p">.</span><span class="n">readFile</span><span class="p">(</span><span class="s">&quot;main33.pwhg&quot;</span><span class="p">);</span>
  <span class="c1">// This init call must be made before PYTHIA is initialized. It</span>
  <span class="c1">// copies the POWHEG input and PDF file to the POWHEG run directory.</span>
  <span class="n">procs</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
  <span class="c1">// Initialize Pythia, based on the specified settings.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
  <span class="c1">// Run PYTHIA. The random numbers are taken from the associated</span>
  <span class="c1">// PYTHIA random number generator.</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iEvent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iEvent</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">;</span> <span class="o">++</span><span class="n">iEvent</span><span class="p">)</span> <span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
  <span class="c1">// End of run.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
    </div>
  </div>
</div>

</div> <div class="well well-sm"> <h1 id="main34cc">main34.cc</h1><hr>
<div class="codehilite"><pre><span class="c1">// main34.cc is a part of the PYTHIA event generator.</span>
<span class="c1">// Copyright (C) 2016 Torbjorn Sjostrand.</span>
<span class="c1">// PYTHIA is licenced under the GNU GPL version 2, see COPYING for details.</span>
<span class="c1">// Please respect the MCnet Guidelines, see GUIDELINES for details.</span>
<span class="c1">// Author: Philip Ilten, December 2015.</span>
<span class="c1">// An example where the hard process (p p -&gt; mu+ mu-) is automatically</span>
<span class="c1">// produced externally with MadGraph 5, read in, and the remainder of</span>
<span class="c1">// the event is then produced by Pythia (MPI, showers, hadronization,</span>
<span class="c1">// and decays). A comparison is made between events produced with</span>
<span class="c1">// Pythia at LO, MadGraph 5 at LO, and aMC@NLO at NLO.</span>
<span class="c1">// For this example to run, MadGraph 5 must be installed and the</span>
<span class="c1">// command &quot;exe&quot; (set by default as &quot;mg5_aMC&quot;) must be available via</span>
<span class="c1">// the command line. Additionally, GZIP support must be enabled via</span>
<span class="c1">// the &quot;--with-gzip&quot; configuration option(s). Note that this example has</span>
<span class="c1">// only been tested with MadGraph 5 version 2.3.3; due to rapid</span>
<span class="c1">// MadGraph development, this example may not work with other</span>
<span class="c1">// versions. For more details on the LHAMadgraph class see the</span>
<span class="c1">// comments of Pythia8Plugins/LHAMadgraph.h.</span>
</pre></div>


<div class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" href="#fileid33">Rest of the main34.cc code</a>
    </h4>
  </div>
  <div id="fileid33" class="panel-collapse collapse">
    <div class="panel-body">
<div class="codehilite"><pre><span class="cp">#include</span> <span class="cpf">&quot;Pythia8/Pythia.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;Pythia8Plugins/LHAMadgraph.h&quot;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">Pythia8</span><span class="p">;</span>
<span class="c1">//==========================================================================</span>
<span class="c1">// A simple method to run Pythia, analyze the events, and fill a histogram.</span>
<span class="kt">void</span> <span class="nf">run</span><span class="p">(</span><span class="n">Pythia</span><span class="o">*</span> <span class="n">pythia</span><span class="p">,</span> <span class="n">Hist</span><span class="o">&amp;</span> <span class="n">hist</span><span class="p">,</span> <span class="kt">int</span> <span class="n">nEvent</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">pythia</span><span class="o">-&gt;</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Random:setSeed = on&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="o">-&gt;</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Random:seed = 1&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="o">-&gt;</span><span class="n">init</span><span class="p">();</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iEvent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iEvent</span> <span class="o">&lt;</span> <span class="n">nEvent</span><span class="p">;</span> <span class="o">++</span><span class="n">iEvent</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pythia</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">())</span> <span class="k">continue</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">iMu1</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">iMu2</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">pythia</span><span class="o">-&gt;</span><span class="n">event</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">iMu1</span> <span class="o">&amp;&amp;</span> <span class="n">pythia</span><span class="o">-&gt;</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">id</span><span class="p">()</span> <span class="o">==</span> <span class="mi">13</span><span class="p">)</span>  <span class="n">iMu1</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">iMu2</span> <span class="o">&amp;&amp;</span> <span class="n">pythia</span><span class="o">-&gt;</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">id</span><span class="p">()</span> <span class="o">==</span> <span class="o">-</span><span class="mi">13</span><span class="p">)</span> <span class="n">iMu2</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">iMu1</span> <span class="o">&amp;&amp;</span> <span class="n">iMu2</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">iMu1</span> <span class="o">=</span> <span class="n">pythia</span><span class="o">-&gt;</span><span class="n">event</span><span class="p">[</span><span class="n">iMu1</span><span class="p">].</span><span class="n">iBotCopyId</span><span class="p">();</span>
        <span class="n">iMu2</span> <span class="o">=</span> <span class="n">pythia</span><span class="o">-&gt;</span><span class="n">event</span><span class="p">[</span><span class="n">iMu2</span><span class="p">].</span><span class="n">iBotCopyId</span><span class="p">();</span>
        <span class="n">hist</span><span class="p">.</span><span class="n">fill</span><span class="p">((</span><span class="n">pythia</span><span class="o">-&gt;</span><span class="n">event</span><span class="p">[</span><span class="n">iMu1</span><span class="p">].</span><span class="n">p</span><span class="p">()</span> <span class="o">+</span> <span class="n">pythia</span><span class="o">-&gt;</span><span class="n">event</span><span class="p">[</span><span class="n">iMu2</span><span class="p">].</span><span class="n">p</span><span class="p">()).</span><span class="n">pT</span><span class="p">());</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="n">pythia</span><span class="o">-&gt;</span><span class="n">stat</span><span class="p">();</span>
<span class="p">}</span>
<span class="c1">//==========================================================================</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// The name of the MadGraph5_aMC@NLO executable.</span>
  <span class="c1">// You must prepend this string with the path to the executable</span>
  <span class="c1">// on your local installation, or otherwise make it available.</span>
  <span class="n">string</span> <span class="n">exe</span><span class="p">(</span><span class="s">&quot;mg5_aMC&quot;</span><span class="p">);</span>
  <span class="c1">// Create the histograms.</span>
  <span class="n">Hist</span> <span class="n">pyPtZ</span><span class="p">(</span><span class="s">&quot;Pythia dN/dpTZ&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">100.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">mgPtZ</span><span class="p">(</span><span class="s">&quot;MadGraph dN/dpTZ&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">100.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">amPtZ</span><span class="p">(</span><span class="s">&quot;aMC@NLO dN/dpTZ&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">100.</span><span class="p">);</span>
  <span class="c1">// Produce leading-order events with Pythia.</span>
  <span class="n">Pythia</span><span class="o">*</span> <span class="n">pythia</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Pythia</span><span class="p">();</span>
  <span class="n">pythia</span><span class="o">-&gt;</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Beams:eCM = 13000.&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="o">-&gt;</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;WeakSingleBoson:ffbar2gmZ = on&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="o">-&gt;</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;23:onMode = off&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="o">-&gt;</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;23:onIfMatch = -13 13&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="o">-&gt;</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;PhaseSpace:mHatMin = 80.&quot;</span><span class="p">);</span>
  <span class="n">run</span><span class="p">(</span><span class="n">pythia</span><span class="p">,</span> <span class="n">pyPtZ</span><span class="p">,</span> <span class="mi">1000</span><span class="p">);</span>
  <span class="k">delete</span> <span class="n">pythia</span><span class="p">;</span>
  <span class="c1">// Produce leading-order events with MadGraph 5.</span>
  <span class="n">pythia</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Pythia</span><span class="p">();</span>
  <span class="n">LHAupMadgraph</span> <span class="n">madgraph</span><span class="p">(</span><span class="n">pythia</span><span class="p">,</span> <span class="nb">true</span><span class="p">,</span> <span class="s">&quot;madgraphrun&quot;</span><span class="p">,</span> <span class="n">exe</span><span class="p">);</span>
  <span class="n">madgraph</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;generate p p &gt; mu+ mu-&quot;</span><span class="p">);</span>
  <span class="c1">// Note the need for a blank character before &quot;set&quot;.</span>
  <span class="n">madgraph</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot; set ebeam1 6500&quot;</span><span class="p">);</span>
  <span class="n">madgraph</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot; set ebeam2 6500&quot;</span><span class="p">);</span>
  <span class="n">madgraph</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot; set mmll 80&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="o">-&gt;</span><span class="n">setLHAupPtr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">madgraph</span><span class="p">);</span>
  <span class="n">run</span><span class="p">(</span><span class="n">pythia</span><span class="p">,</span> <span class="n">mgPtZ</span><span class="p">,</span> <span class="mi">1000</span><span class="p">);</span>
  <span class="k">delete</span> <span class="n">pythia</span><span class="p">;</span>
  <span class="c1">// Produce next-to-leading-order events with aMC@NLO.</span>
  <span class="n">pythia</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Pythia</span><span class="p">();</span>
  <span class="n">LHAupMadgraph</span> <span class="n">amcatnlo</span><span class="p">(</span><span class="n">pythia</span><span class="p">,</span> <span class="nb">true</span><span class="p">,</span> <span class="s">&quot;amcatnlorun&quot;</span><span class="p">,</span> <span class="n">exe</span><span class="p">);</span>
  <span class="n">amcatnlo</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;generate p p &gt; mu+ mu- [QCD]&quot;</span><span class="p">);</span>
  <span class="c1">// Note the need for a blank character before &quot;set&quot;.</span>
  <span class="n">amcatnlo</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot; set ebeam1 6500&quot;</span><span class="p">);</span>
  <span class="n">amcatnlo</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot; set ebeam2 6500&quot;</span><span class="p">);</span>
  <span class="n">amcatnlo</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot; set mll 80&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="o">-&gt;</span><span class="n">setLHAupPtr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">amcatnlo</span><span class="p">);</span>
  <span class="n">run</span><span class="p">(</span><span class="n">pythia</span><span class="p">,</span> <span class="n">amPtZ</span><span class="p">,</span> <span class="mi">1000</span><span class="p">);</span>
  <span class="k">delete</span> <span class="n">pythia</span><span class="p">;</span>
  <span class="c1">// Print the histograms.</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">pyPtZ</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">mgPtZ</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">amPtZ</span><span class="p">;</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
    </div>
  </div>
</div>

</div> <div class="well well-sm"> <h1 id="main37cc">main37.cc</h1><hr>
<div class="codehilite"><pre><span class="c1">// main37.cc is a part of the PYTHIA event generator.</span>
<span class="c1">// Copyright (C) 2016 Torbjorn Sjostrand.</span>
<span class="c1">// PYTHIA is licenced under the GNU GPL version 2, see COPYING for details.</span>
<span class="c1">// Please respect the MCnet Guidelines, see GUIDELINES for details.</span>
<span class="c1">// This is a simple test program.</span>
<span class="c1">// It illustrates how Les Houches Event File version 3.0 input can be used</span>
<span class="c1">// to mix events according to several different event weights.</span>
</pre></div>


<div class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" href="#fileid34">Rest of the main37.cc code</a>
    </h4>
  </div>
  <div id="fileid34" class="panel-collapse collapse">
    <div class="panel-body">
<div class="codehilite"><pre><span class="cp">#include</span> <span class="cpf">&quot;Pythia8/Pythia.h&quot;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">Pythia8</span><span class="p">;</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Generator</span>
  <span class="n">Pythia</span> <span class="n">pythia</span><span class="p">;</span>
  <span class="c1">// Initialize Les Houches Event File run.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Beams:frameType = 4&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Beams:LHEF = wbj_lhef3.lhe&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
  <span class="c1">// Get number of event weights.</span>
  <span class="kt">int</span> <span class="n">ninitrwgt</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">getInitrwgtSize</span><span class="p">();</span>
  <span class="c1">// Initialise as many histograms as there are event weights.</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="n">Hist</span><span class="o">&gt;</span> <span class="n">pTw</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iHist</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iHist</span> <span class="o">&lt;</span> <span class="n">ninitrwgt</span><span class="p">;</span> <span class="o">++</span><span class="n">iHist</span><span class="p">)</span>
    <span class="n">pTw</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span> <span class="n">Hist</span><span class="p">(</span><span class="s">&quot;pT W&quot;</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">200.</span><span class="p">)</span> <span class="p">);</span>
  <span class="c1">// Begin event loop; generate until none left in input file.</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iEvent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iEvent</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="o">++</span><span class="n">iEvent</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Generate events, and check whether generation failed.</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">())</span> <span class="p">{</span>
      <span class="c1">// If failure because reached end of file then exit event loop.</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">atEndOfFile</span><span class="p">())</span> <span class="k">break</span><span class="p">;</span>
      <span class="k">else</span> <span class="k">continue</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// Find the final copy of the W and its pT.</span>
    <span class="kt">int</span> <span class="n">iW</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span> <span class="o">--</span><span class="n">i</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">idAbs</span><span class="p">()</span> <span class="o">==</span> <span class="mi">24</span><span class="p">)</span> <span class="p">{</span> <span class="n">iW</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span> <span class="k">break</span><span class="p">;}</span>
    <span class="kt">double</span> <span class="n">pT</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">iW</span><span class="p">].</span><span class="n">pT</span><span class="p">();</span>
    <span class="c1">// Loop over the event weights in the detailed format and histogram.</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">nwgt</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">getWeightsDetailedSize</span><span class="p">();</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">iwgt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iwgt</span> <span class="o">&lt;</span> <span class="n">nwgt</span><span class="p">;</span> <span class="o">++</span><span class="n">iwgt</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// The weights happen to have the identifiers 1001, 1002...</span>
      <span class="n">string</span> <span class="n">key</span><span class="p">;</span>
      <span class="n">ostringstream</span> <span class="n">convert</span><span class="p">;</span>
      <span class="n">convert</span> <span class="o">&lt;&lt;</span> <span class="n">iwgt</span> <span class="o">+</span> <span class="mi">1001</span><span class="p">;</span>
      <span class="n">key</span> <span class="o">=</span> <span class="n">convert</span><span class="p">.</span><span class="n">str</span><span class="p">();</span>
      <span class="kt">double</span> <span class="n">w</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">getWeightsDetailedValue</span><span class="p">(</span><span class="n">key</span><span class="p">);</span>
      <span class="n">pTw</span><span class="p">[</span><span class="n">iwgt</span><span class="p">].</span><span class="n">fill</span><span class="p">(</span> <span class="n">max</span><span class="p">(</span><span class="n">pT</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),</span> <span class="n">w</span> <span class="p">);</span>
    <span class="p">}</span>
  <span class="c1">// End of event loop.</span>
  <span class="p">}</span>
  <span class="c1">// Give statistics.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
  <span class="c1">// Print histograms.</span>
  <span class="n">ofstream</span> <span class="n">write</span><span class="p">;</span>
  <span class="n">stringstream</span> <span class="n">suffix</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iHist</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iHist</span> <span class="o">&lt;</span> <span class="n">ninitrwgt</span><span class="p">;</span> <span class="o">++</span><span class="n">iHist</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">suffix</span> <span class="o">&lt;&lt;</span> <span class="n">iHist</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;.dat&quot;</span><span class="p">;</span>
    <span class="c1">// Write histograms to file.</span>
    <span class="n">write</span><span class="p">.</span><span class="n">open</span><span class="p">(</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)(</span><span class="s">&quot;PTW_&quot;</span> <span class="o">+</span> <span class="n">suffix</span><span class="p">.</span><span class="n">str</span><span class="p">()).</span><span class="n">c_str</span><span class="p">());</span>
    <span class="n">pTw</span><span class="p">[</span><span class="n">iHist</span><span class="p">].</span><span class="n">table</span><span class="p">(</span><span class="n">write</span><span class="p">);</span>
    <span class="n">suffix</span><span class="p">.</span><span class="n">str</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">);</span>
    <span class="n">write</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="c1">// Done.</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
    </div>
  </div>
</div>

</div> <div class="well well-sm"> <h1 id="main38cc">main38.cc</h1><hr>
<div class="codehilite"><pre><span class="c1">// main38.cc is a part of the PYTHIA event generator.</span>
<span class="c1">// Copyright (C) 2016 Torbjorn Sjostrand.</span>
<span class="c1">// PYTHIA is licenced under the GNU GPL version 2, see COPYING for details.</span>
<span class="c1">// Please respect the MCnet Guidelines, see GUIDELINES for details.</span>
<span class="c1">// This is a simple test program.</span>
<span class="c1">// It illustrates how Les Houches Event File version 3.0 information</span>
<span class="c1">// can be extracted from pythia.info.</span>
</pre></div>


<div class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" href="#fileid35">Rest of the main38.cc code</a>
    </h4>
  </div>
  <div id="fileid35" class="panel-collapse collapse">
    <div class="panel-body">
<div class="codehilite"><pre><span class="cp">#include</span> <span class="cpf">&quot;Pythia8/Pythia.h&quot;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">Pythia8</span><span class="p">;</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Generator</span>
  <span class="n">Pythia</span> <span class="n">pythia</span><span class="p">;</span>
  <span class="c1">// Stick with default values, so do not bother with a separate file</span>
  <span class="c1">// for changes. However, do one change, to show readString in action.</span>
  <span class="c1">// pythia.readString(&quot;PartonLevel:ISR = off&quot;);</span>
  <span class="c1">// pythia.readString(&quot;PartonLevel:FSR = off&quot;);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;PartonLevel:MPI = off&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;HadronLevel:all = off&quot;</span><span class="p">);</span>
  <span class="c1">//pythia.readString(&quot;PDF:pSet = LHAPDF5:cteq6m.LHpdf&quot;);</span>
  <span class="c1">// Initialize gzipped Les Houches Event File run.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Beams:frameType = 4&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Beams:LHEF = wbj_lhef3.lhe&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
  <span class="c1">// Print extra LHEF v3 initialization information.</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;*****************************************************&quot;</span>
       <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;  RETRIEVE GENERATOR INFORMATION&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ngen</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">getGeneratorSize</span><span class="p">();</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Number of generator tags &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">ngen</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">igen</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">igen</span> <span class="o">&lt;</span> <span class="n">ngen</span><span class="p">;</span> <span class="o">++</span><span class="n">igen</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;.  generator tag .&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">igen</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;. : .&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">getGeneratorValue</span><span class="p">(</span><span class="n">igen</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;.</span><span class="se">\n</span><span class="s">&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot;.  name          .&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">getGeneratorAttribute</span><span class="p">(</span><span class="n">igen</span><span class="p">,</span><span class="s">&quot;name&quot;</span><span class="p">,</span><span class="n">igen</span><span class="p">)</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot;.  version       .&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">getGeneratorAttribute</span><span class="p">(</span><span class="n">igen</span><span class="p">,</span><span class="s">&quot;version&quot;</span><span class="p">,</span><span class="n">igen</span><span class="p">)</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot;.  random        .&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">getGeneratorAttribute</span><span class="p">(</span><span class="n">igen</span><span class="p">,</span><span class="s">&quot;random&quot;</span><span class="p">,</span><span class="n">igen</span><span class="p">)</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot;.&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;.  generator tag .&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">igen</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;. : .&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">getGeneratorValue</span><span class="p">(</span><span class="n">igen</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;.</span><span class="se">\n</span><span class="s">&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot;.  name          .&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">getGeneratorAttribute</span><span class="p">(</span><span class="n">igen</span><span class="p">,</span><span class="s">&quot;name&quot;</span><span class="p">,</span><span class="nb">true</span><span class="p">)</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot;.  version       .&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">getGeneratorAttribute</span><span class="p">(</span><span class="n">igen</span><span class="p">,</span><span class="s">&quot;version&quot;</span><span class="p">,</span><span class="nb">true</span><span class="p">)</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot;.  random        .&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">getGeneratorAttribute</span><span class="p">(</span><span class="n">igen</span><span class="p">,</span><span class="s">&quot;random&quot;</span><span class="p">,</span><span class="nb">true</span><span class="p">)</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot;.&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// Get number of event weights.</span>
  <span class="kt">int</span> <span class="n">ninitrwgt</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">getInitrwgtSize</span><span class="p">();</span>
  <span class="c1">// Initialise as many histograms as there are event weights.</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="n">Hist</span><span class="o">&gt;</span> <span class="n">pTw</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iHist</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iHist</span> <span class="o">&lt;</span> <span class="n">ninitrwgt</span><span class="p">;</span> <span class="o">++</span><span class="n">iHist</span><span class="p">)</span>
    <span class="n">pTw</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span> <span class="n">Hist</span><span class="p">(</span><span class="s">&quot;pT W&quot;</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">200.</span><span class="p">)</span> <span class="p">);</span>
  <span class="c1">// Begin event loop; generate until none left in input file.</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iEvent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iEvent</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">;</span> <span class="o">++</span><span class="n">iEvent</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Read event # &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">iEvent</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="c1">// Generate events, and check whether generation failed.</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">())</span> <span class="p">{</span>
      <span class="c1">// If failure because reached end of file then exit event loop.</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">atEndOfFile</span><span class="p">())</span> <span class="k">break</span><span class="p">;</span>
      <span class="k">else</span> <span class="k">continue</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// Print process-level event.</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">process</span><span class="p">.</span><span class="n">list</span><span class="p">();</span>
    <span class="c1">// Print extra LHEF v3 event information.</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Print event # &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">iEvent</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;*****************************************************&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;  RETRIEVE EVENT INFORMATION&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">eventAttributes</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span> <span class="n">map</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span><span class="n">string</span><span class="o">&gt;::</span><span class="n">const_iterator</span>
        <span class="n">it</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">eventAttributes</span><span class="o">-&gt;</span><span class="n">begin</span><span class="p">();</span>
        <span class="n">it</span> <span class="o">!=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">eventAttributes</span><span class="o">-&gt;</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">it</span> <span class="p">)</span>
          <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;.  attributes    .&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">it</span><span class="o">-&gt;</span><span class="n">first</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;.  .&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">it</span><span class="o">-&gt;</span><span class="n">second</span>
               <span class="o">&lt;&lt;</span> <span class="s">&quot;.  .&quot;</span><span class="p">;</span>
      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;.&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">getEventAttribute</span><span class="p">(</span><span class="s">&quot;npLO&quot;</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;.  .&quot;</span>
           <span class="o">&lt;&lt;</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">getEventAttribute</span><span class="p">(</span><span class="s">&quot;npNLO&quot;</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">getEventAttribute</span><span class="p">(</span><span class="s">&quot;npLO&quot;</span><span class="p">,</span><span class="nb">true</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;.  .&quot;</span>
           <span class="o">&lt;&lt;</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">getEventAttribute</span><span class="p">(</span><span class="s">&quot;npNLO&quot;</span><span class="p">,</span><span class="nb">true</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// Print extra LHEF v3 event weight information.</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;*****************************************************&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;  RETRIEVE WEIGHTS (DETAILED FORMAT) INFORMATION&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">nwgt</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">getWeightsDetailedSize</span><span class="p">();</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Number of wgt tags &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">nwgt</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">iwgt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iwgt</span> <span class="o">&lt;</span> <span class="n">nwgt</span><span class="p">;</span> <span class="o">++</span><span class="n">iwgt</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">string</span> <span class="n">key</span><span class="p">;</span>
      <span class="n">ostringstream</span> <span class="n">convert</span><span class="p">;</span>
      <span class="n">convert</span> <span class="o">&lt;&lt;</span> <span class="n">iwgt</span> <span class="o">+</span> <span class="mi">1001</span><span class="p">;</span>
      <span class="n">key</span> <span class="o">=</span> <span class="n">convert</span><span class="p">.</span><span class="n">str</span><span class="p">();</span>
      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;.  wgt tag       .&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">iwgt</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;. : .&quot;</span>
           <span class="o">&lt;&lt;</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">getWeightsDetailedValue</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;.</span><span class="se">\n</span><span class="s">&quot;</span>
           <span class="o">&lt;&lt;</span> <span class="s">&quot;.  id            .&quot;</span>
           <span class="o">&lt;&lt;</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">getWeightsDetailedAttribute</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="s">&quot;id&quot;</span><span class="p">)</span>
           <span class="o">&lt;&lt;</span> <span class="s">&quot;.  version       .&quot;</span>
           <span class="o">&lt;&lt;</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">getWeightsDetailedAttribute</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="s">&quot;version&quot;</span><span class="p">)</span>
           <span class="o">&lt;&lt;</span> <span class="s">&quot;.&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// Print extra LHEF v3 event weight information directly from iterator.</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;wgt tags directly from iterator&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">nwgts</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">rwgt</span><span class="p">)</span> <span class="n">nwgts</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">rwgt</span><span class="o">-&gt;</span><span class="n">wgts</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Number of weight tags &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">nwgts</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">iwgts</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iwgts</span> <span class="o">&lt;</span> <span class="n">nwgts</span><span class="p">;</span> <span class="o">++</span><span class="n">iwgts</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">string</span> <span class="n">key</span><span class="p">;</span>
      <span class="n">ostringstream</span> <span class="n">convert</span><span class="p">;</span>
      <span class="n">convert</span> <span class="o">&lt;&lt;</span> <span class="n">iwgts</span><span class="o">+</span><span class="mi">1001</span><span class="p">;</span>
      <span class="n">key</span> <span class="o">=</span> <span class="n">convert</span><span class="p">.</span><span class="n">str</span><span class="p">();</span>
      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;.  wgt tag       .&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">iwgts</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;. : .&quot;</span>
           <span class="o">&lt;&lt;</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">rwgt</span><span class="o">-&gt;</span><span class="n">wgts</span><span class="p">[</span><span class="n">key</span><span class="p">].</span><span class="n">contents</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;.</span><span class="se">\n</span><span class="s">&quot;</span>
           <span class="o">&lt;&lt;</span> <span class="s">&quot;.  id            .&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">rwgt</span><span class="o">-&gt;</span><span class="n">wgts</span><span class="p">[</span><span class="n">key</span><span class="p">].</span><span class="n">id</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span> <span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;::</span><span class="n">const_iterator</span>
        <span class="n">it</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">rwgt</span><span class="o">-&gt;</span><span class="n">wgts</span><span class="p">[</span><span class="n">key</span><span class="p">].</span><span class="n">attributes</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
        <span class="n">it</span> <span class="o">!=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">rwgt</span><span class="o">-&gt;</span><span class="n">wgts</span><span class="p">[</span><span class="n">key</span><span class="p">].</span><span class="n">attributes</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">it</span> <span class="p">)</span>
          <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;.  attributes    .&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">it</span><span class="o">-&gt;</span><span class="n">first</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;.  .&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">it</span><span class="o">-&gt;</span><span class="n">second</span>
               <span class="o">&lt;&lt;</span> <span class="s">&quot;.  .&quot;</span><span class="p">;</span>
      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;.&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// Print extra LHEF v3 compressed format event weight information.</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;*****************************************************&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;  RETRIEVE WEIGHTS (COMPRESSED FORMAT) INFORMATION&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">nweights</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">getWeightsCompressedSize</span><span class="p">();</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Number of weights (only one tag!) &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">nweights</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">iweights</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iweights</span> <span class="o">&lt;</span> <span class="n">nweights</span><span class="p">;</span> <span class="o">++</span><span class="n">iweights</span><span class="p">)</span>
      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;.  weight        .&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">iweights</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;. : .&quot;</span>
           <span class="o">&lt;&lt;</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">getWeightsCompressedValue</span><span class="p">(</span><span class="n">iweights</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;.</span><span class="se">\n</span><span class="s">&quot;</span>
           <span class="o">&lt;&lt;</span> <span class="s">&quot;.&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="c1">// Print extra LHEF v3 weight tags directly from iterator.</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;weight tags directly from iterator&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">weights</span><span class="p">)</span>
    <span class="k">for</span> <span class="p">(</span> <span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;::</span><span class="n">const_iterator</span>
      <span class="n">it</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">weights</span><span class="o">-&gt;</span><span class="n">attributes</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
      <span class="n">it</span> <span class="o">!=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">weights</span><span class="o">-&gt;</span><span class="n">attributes</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">it</span> <span class="p">)</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;.  attributes    .&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">it</span><span class="o">-&gt;</span><span class="n">first</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;.  .&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">it</span><span class="o">-&gt;</span><span class="n">second</span>
             <span class="o">&lt;&lt;</span> <span class="s">&quot;.  .&quot;</span><span class="p">;</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;.&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="c1">// Print extra LHEF v3 scale information.</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;*****************************************************&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;  RETRIEVE SCALES INFORMATION&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;.  .&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">getScalesValue</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;.  .&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">getScalesAttribute</span><span class="p">(</span><span class="s">&quot;muf&quot;</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;.  .&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">getScalesAttribute</span><span class="p">(</span><span class="s">&quot;mur&quot;</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;.  .&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">getScalesAttribute</span><span class="p">(</span><span class="s">&quot;mups&quot;</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;.  .&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">getScalesAttribute</span><span class="p">(</span><span class="s">&quot;SCALUP&quot;</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">scales</span><span class="p">)</span>
    <span class="k">for</span> <span class="p">(</span> <span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span><span class="kt">double</span><span class="o">&gt;::</span><span class="n">const_iterator</span>
      <span class="n">it</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">scales</span><span class="o">-&gt;</span><span class="n">attributes</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
      <span class="n">it</span> <span class="o">!=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">scales</span><span class="o">-&gt;</span><span class="n">attributes</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">it</span> <span class="p">)</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;.  attributes    .&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">it</span><span class="o">-&gt;</span><span class="n">first</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;.  .&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">it</span><span class="o">-&gt;</span><span class="n">second</span>
             <span class="o">&lt;&lt;</span> <span class="s">&quot;.  .&quot;</span><span class="p">;</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;.&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="c1">// Find the final copy of the W.</span>
    <span class="kt">int</span> <span class="n">iW</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span> <span class="o">--</span><span class="n">i</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">idAbs</span><span class="p">()</span> <span class="o">==</span> <span class="mi">24</span><span class="p">)</span> <span class="p">{</span> <span class="n">iW</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span> <span class="k">break</span><span class="p">;}</span>
    <span class="kt">double</span> <span class="n">pT</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">iW</span><span class="p">].</span><span class="n">pT</span><span class="p">();</span>
    <span class="c1">// Loop over the event weights in the detailed format and histogram.</span>
    <span class="n">nwgt</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">getWeightsDetailedSize</span><span class="p">();</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">iwgt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iwgt</span> <span class="o">&lt;</span> <span class="n">nwgt</span><span class="p">;</span> <span class="o">++</span><span class="n">iwgt</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">string</span> <span class="n">key</span><span class="p">;</span>
      <span class="n">ostringstream</span> <span class="n">convert</span><span class="p">;</span>
      <span class="n">convert</span> <span class="o">&lt;&lt;</span> <span class="n">iwgt</span> <span class="o">+</span> <span class="mi">1001</span><span class="p">;</span>
      <span class="n">key</span> <span class="o">=</span> <span class="n">convert</span><span class="p">.</span><span class="n">str</span><span class="p">();</span>
      <span class="kt">double</span> <span class="n">w</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">getWeightsDetailedValue</span><span class="p">(</span><span class="n">key</span><span class="p">);</span>
      <span class="n">pTw</span><span class="p">[</span><span class="n">iwgt</span><span class="p">].</span><span class="n">fill</span><span class="p">(</span> <span class="n">max</span><span class="p">(</span><span class="n">pT</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),</span> <span class="n">w</span> <span class="p">);</span>
    <span class="p">}</span>
  <span class="c1">// End of event loop.</span>
  <span class="p">}</span>
  <span class="c1">// Give statistics.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
  <span class="c1">// Print histograms.</span>
  <span class="n">ofstream</span> <span class="n">write</span><span class="p">;</span>
  <span class="n">stringstream</span> <span class="n">suffix</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iHist</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iHist</span> <span class="o">&lt;</span> <span class="n">ninitrwgt</span><span class="p">;</span> <span class="o">++</span><span class="n">iHist</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">suffix</span> <span class="o">&lt;&lt;</span> <span class="n">iHist</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;.dat&quot;</span><span class="p">;</span>
    <span class="c1">// Write histograms to file.</span>
    <span class="n">write</span><span class="p">.</span><span class="n">open</span><span class="p">(</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)(</span><span class="s">&quot;PTW_&quot;</span> <span class="o">+</span> <span class="n">suffix</span><span class="p">.</span><span class="n">str</span><span class="p">()).</span><span class="n">c_str</span><span class="p">());</span>
    <span class="n">pTw</span><span class="p">[</span><span class="n">iHist</span><span class="p">].</span><span class="n">table</span><span class="p">(</span><span class="n">write</span><span class="p">);</span>
    <span class="n">suffix</span><span class="p">.</span><span class="n">str</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">);</span>
    <span class="n">write</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="c1">// Done.</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
    </div>
  </div>
</div>

</div> <div class="well well-sm"> <h1 id="main41cc">main41.cc</h1><hr>
<div class="codehilite"><pre><span class="c1">// main41.cc is a part of the PYTHIA event generator.</span>
<span class="c1">// Copyright (C) 2016 Torbjorn Sjostrand.</span>
<span class="c1">// PYTHIA is licenced under the GNU GPL version 2, see COPYING for details.</span>
<span class="c1">// Please respect the MCnet Guidelines, see GUIDELINES for details.</span>
<span class="c1">// Author: Mikhail Kirsanov, Mikhail.Kirsanov@cern.ch, based on main01.cc.</span>
<span class="c1">// This program illustrates how HepMC can be interfaced to Pythia8.</span>
<span class="c1">// It studies the charged multiplicity distribution at the LHC.</span>
<span class="c1">// HepMC events are output to the hepmcout41.dat file.</span>
<span class="c1">// WARNING: typically one needs 25 MB/100 events at the LHC.</span>
<span class="c1">// Therefore large event samples may be impractical.</span>
</pre></div>


<div class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" href="#fileid36">Rest of the main41.cc code</a>
    </h4>
  </div>
  <div id="fileid36" class="panel-collapse collapse">
    <div class="panel-body">
<div class="codehilite"><pre><span class="cp">#include</span> <span class="cpf">&quot;Pythia8/Pythia.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;Pythia8Plugins/HepMC2.h&quot;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">Pythia8</span><span class="p">;</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Interface for conversion from Pythia8::Event to HepMC event.</span>
  <span class="n">HepMC</span><span class="o">::</span><span class="n">Pythia8ToHepMC</span> <span class="n">ToHepMC</span><span class="p">;</span>
  <span class="c1">// Specify file where HepMC events will be stored.</span>
  <span class="n">HepMC</span><span class="o">::</span><span class="n">IO_GenEvent</span> <span class="n">ascii_io</span><span class="p">(</span><span class="s">&quot;hepmcout41.dat&quot;</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">ios</span><span class="o">::</span><span class="n">out</span><span class="p">);</span>
  <span class="c1">// Generator. Process selection. LHC initialization. Histogram.</span>
  <span class="n">Pythia</span> <span class="n">pythia</span><span class="p">;</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Beams:eCM = 8000.&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;HardQCD:all = on&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;PhaseSpace:pTHatMin = 20.&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
  <span class="n">Hist</span> <span class="n">mult</span><span class="p">(</span><span class="s">&quot;charged multiplicity&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">799.5</span><span class="p">);</span>
  <span class="c1">// Begin event loop. Generate event. Skip if error.</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iEvent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iEvent</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">;</span> <span class="o">++</span><span class="n">iEvent</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">())</span> <span class="k">continue</span><span class="p">;</span>
    <span class="c1">// Find number of all final charged particles and fill histogram.</span>
    <span class="kt">int</span> <span class="n">nCharged</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">isFinal</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">isCharged</span><span class="p">())</span>
        <span class="o">++</span><span class="n">nCharged</span><span class="p">;</span>
    <span class="n">mult</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">nCharged</span> <span class="p">);</span>
    <span class="c1">// Construct new empty HepMC event and fill it.</span>
    <span class="c1">// Units will be as chosen for HepMC build; but can be changed</span>
    <span class="c1">// by arguments, e.g. GenEvt( HepMC::Units::GEV, HepMC::Units::MM)</span>
    <span class="n">HepMC</span><span class="o">::</span><span class="n">GenEvent</span><span class="o">*</span> <span class="n">hepmcevt</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HepMC</span><span class="o">::</span><span class="n">GenEvent</span><span class="p">();</span>
    <span class="n">ToHepMC</span><span class="p">.</span><span class="n">fill_next_event</span><span class="p">(</span> <span class="n">pythia</span><span class="p">,</span> <span class="n">hepmcevt</span> <span class="p">);</span>
    <span class="c1">// Write the HepMC event to file. Done with it.</span>
    <span class="n">ascii_io</span> <span class="o">&lt;&lt;</span> <span class="n">hepmcevt</span><span class="p">;</span>
    <span class="k">delete</span> <span class="n">hepmcevt</span><span class="p">;</span>
  <span class="c1">// End of event loop. Statistics. Histogram.</span>
  <span class="p">}</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">mult</span><span class="p">;</span>
  <span class="c1">// Done.</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
    </div>
  </div>
</div>

</div> <div class="well well-sm"> <h1 id="main42cc">main42.cc</h1><hr>
<div class="codehilite"><pre><span class="c1">// main42.cc is a part of the PYTHIA event generator.</span>
<span class="c1">// Copyright (C) 2016 Torbjorn Sjostrand.</span>
<span class="c1">// PYTHIA is licenced under the GNU GPL version 2, see COPYING for details.</span>
<span class="c1">// Please respect the MCnet Guidelines, see GUIDELINES for details.</span>
<span class="c1">// Author: Mikhail Kirsanov, Mikhail.Kirsanov@cern.ch.</span>
<span class="c1">// This program illustrates how a file with HepMC events</span>
<span class="c1">// can be generated by Pythia8.</span>
<span class="c1">// Input and output files are specified on the command line, e.g. like</span>
<span class="c1">// ./main42.exe main42.cmnd hepmcout42.dat &gt; out</span>
<span class="c1">// The main program contains no analysis; this is intended to happen later.</span>
<span class="c1">// It therefore &quot;never&quot; has to be recompiled to handle different tasks.</span>
<span class="c1">// WARNING: typically one needs 25 MB/100 events at the LHC.</span>
<span class="c1">// Therefore large event samples may be impractical.</span>
</pre></div>


<div class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" href="#fileid37">Rest of the main42.cc code</a>
    </h4>
  </div>
  <div id="fileid37" class="panel-collapse collapse">
    <div class="panel-body">
<div class="codehilite"><pre><span class="cp">#include</span> <span class="cpf">&quot;Pythia8/Pythia.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;Pythia8Plugins/HepMC2.h&quot;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">Pythia8</span><span class="p">;</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
  <span class="c1">// Check that correct number of command-line arguments</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; Unexpected number of command-line arguments. </span><span class="se">\n</span><span class="s"> You are&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; expected to provide one input and one output file name. </span><span class="se">\n</span><span class="s">&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; Program stopped! &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// Check that the provided input name corresponds to an existing file.</span>
  <span class="n">ifstream</span> <span class="n">is</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">is</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; Command-line file &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; was not found. </span><span class="se">\n</span><span class="s">&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; Program stopped! &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// Confirm that external files will be used for input and output.</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s"> &gt;&gt;&gt; PYTHIA settings will be read from file &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
       <span class="o">&lt;&lt;</span> <span class="s">&quot; &lt;&lt;&lt; </span><span class="se">\n</span><span class="s"> &gt;&gt;&gt; HepMC events will be written to file &quot;</span>
       <span class="o">&lt;&lt;</span> <span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &lt;&lt;&lt; </span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="c1">// Interface for conversion from Pythia8::Event to HepMC event.</span>
  <span class="n">HepMC</span><span class="o">::</span><span class="n">Pythia8ToHepMC</span> <span class="n">ToHepMC</span><span class="p">;</span>
  <span class="c1">// Specify file where HepMC events will be stored.</span>
  <span class="n">HepMC</span><span class="o">::</span><span class="n">IO_GenEvent</span> <span class="n">ascii_io</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">std</span><span class="o">::</span><span class="n">ios</span><span class="o">::</span><span class="n">out</span><span class="p">);</span>
  <span class="c1">// Generator.</span>
  <span class="n">Pythia</span> <span class="n">pythia</span><span class="p">;</span>
  <span class="c1">// Read in commands from external file.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readFile</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
  <span class="c1">// Extract settings to be used in the main program.</span>
  <span class="kt">int</span>    <span class="n">nEvent</span>    <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Main:numberOfEvents&quot;</span><span class="p">);</span>
  <span class="kt">int</span>    <span class="n">nAbort</span>    <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Main:timesAllowErrors&quot;</span><span class="p">);</span>
  <span class="c1">// Initialization.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
  <span class="c1">// Begin event loop.</span>
  <span class="kt">int</span> <span class="n">iAbort</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iEvent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iEvent</span> <span class="o">&lt;</span> <span class="n">nEvent</span><span class="p">;</span> <span class="o">++</span><span class="n">iEvent</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Generate event.</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">())</span> <span class="p">{</span>
      <span class="c1">// If failure because reached end of file then exit event loop.</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">atEndOfFile</span><span class="p">())</span> <span class="p">{</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; Aborted since reached end of Les Houches Event File</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="c1">// First few failures write off as &quot;acceptable&quot; errors, then quit.</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">++</span><span class="n">iAbort</span> <span class="o">&lt;</span> <span class="n">nAbort</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; Event generation aborted prematurely, owing to error!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// Construct new empty HepMC event and fill it.</span>
    <span class="c1">// Units will be as chosen for HepMC build, but can be changed</span>
    <span class="c1">// by arguments, e.g. GenEvt( HepMC::Units::GEV, HepMC::Units::MM)</span>
    <span class="n">HepMC</span><span class="o">::</span><span class="n">GenEvent</span><span class="o">*</span> <span class="n">hepmcevt</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HepMC</span><span class="o">::</span><span class="n">GenEvent</span><span class="p">();</span>
    <span class="n">ToHepMC</span><span class="p">.</span><span class="n">fill_next_event</span><span class="p">(</span> <span class="n">pythia</span><span class="p">,</span> <span class="n">hepmcevt</span> <span class="p">);</span>
    <span class="c1">// Write the HepMC event to file. Done with it.</span>
    <span class="n">ascii_io</span> <span class="o">&lt;&lt;</span> <span class="n">hepmcevt</span><span class="p">;</span>
    <span class="k">delete</span> <span class="n">hepmcevt</span><span class="p">;</span>
  <span class="c1">// End of event loop. Statistics.</span>
  <span class="p">}</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
  <span class="c1">// Done.</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
    </div>
  </div>
</div>

</div> <div class="well well-sm"> <h1 id="main43cc">main43.cc</h1><hr>
<div class="codehilite"><pre><span class="c1">// main43.cc is a part of the PYTHIA event generator.</span>
<span class="c1">// Copyright (C) 2016 Torbjorn Sjostrand.</span>
<span class="c1">// PYTHIA is licenced under the GNU GPL version 2, see COPYING for details.</span>
<span class="c1">// Please respect the MCnet Guidelines, see GUIDELINES for details.</span>
<span class="c1">// Author: Mikhail Kirsanov, Mikhail.Kirsanov@cern.ch. This program</span>
<span class="c1">// illustrates how a file with HepMC events can be generated by</span>
<span class="c1">// Pythia8.  It is similar to main42, except that it allows for</span>
<span class="c1">// several subruns, e.g. from related LHEF. Input and output files are</span>
<span class="c1">// specified on the command line, e.g. like</span>
<span class="c1">//     ./main43 main43.cmnd hepmcout43.dat &gt; out</span>
<span class="c1">// The main program contains no analysis; this is intended to happen</span>
<span class="c1">// later. It therefore &quot;never&quot; has to be recompiled to handle</span>
<span class="c1">// different tasks.</span>
<span class="c1">// WARNING: typically one needs 25 MB/100 events at the LHC.</span>
<span class="c1">// Therefore large event samples may be impractical.</span>
</pre></div>


<div class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" href="#fileid38">Rest of the main43.cc code</a>
    </h4>
  </div>
  <div id="fileid38" class="panel-collapse collapse">
    <div class="panel-body">
<div class="codehilite"><pre><span class="cp">#include</span> <span class="cpf">&quot;Pythia8/Pythia.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;Pythia8Plugins/HepMC2.h&quot;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">Pythia8</span><span class="p">;</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
  <span class="c1">// Check that correct number of command-line arguments</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; Unexpected number of command-line arguments. </span><span class="se">\n</span><span class="s"> You are&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; expected to provide one input and one output file name. </span><span class="se">\n</span><span class="s">&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; Program stopped! &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// Check that the provided input name corresponds to an existing file.</span>
  <span class="n">ifstream</span> <span class="n">is</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">is</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; Command-line file &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; was not found. </span><span class="se">\n</span><span class="s">&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; Program stopped! &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// Confirm that external files will be used for input and output.</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s"> &gt;&gt;&gt; PYTHIA settings will be read from file &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
       <span class="o">&lt;&lt;</span> <span class="s">&quot; &lt;&lt;&lt; </span><span class="se">\n</span><span class="s"> &gt;&gt;&gt; HepMC events will be written to file &quot;</span>
       <span class="o">&lt;&lt;</span> <span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &lt;&lt;&lt; </span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="c1">// Interface for conversion from Pythia8::Event to HepMC event.</span>
  <span class="n">HepMC</span><span class="o">::</span><span class="n">Pythia8ToHepMC</span> <span class="n">ToHepMC</span><span class="p">;</span>
  <span class="c1">// Specify file where HepMC events will be stored.</span>
  <span class="n">HepMC</span><span class="o">::</span><span class="n">IO_GenEvent</span> <span class="n">ascii_io</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">std</span><span class="o">::</span><span class="n">ios</span><span class="o">::</span><span class="n">out</span><span class="p">);</span>
  <span class="c1">// Generator.</span>
  <span class="n">Pythia</span> <span class="n">pythia</span><span class="p">;</span>
  <span class="c1">// Read in subrun-independent commands from external file.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readFile</span><span class="p">(</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
  <span class="c1">// Extract data to be used in main program. Set counters.</span>
  <span class="kt">int</span> <span class="n">nSubrun</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Main:numberOfSubruns&quot;</span><span class="p">);</span>
  <span class="kt">int</span> <span class="n">nAbort</span>  <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Main:timesAllowErrors&quot;</span><span class="p">);</span>
  <span class="kt">int</span> <span class="n">iAbort</span>  <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="c1">// Begin loop over subruns.</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iSubrun</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">iSubrun</span> <span class="o">&lt;=</span> <span class="n">nSubrun</span><span class="p">;</span> <span class="o">++</span><span class="n">iSubrun</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Read in subrun-specific data from external file.</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readFile</span><span class="p">(</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">iSubrun</span><span class="p">);</span>
    <span class="c1">// Initialization.</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
    <span class="c1">// Print name of Les Houches Event File.</span>
    <span class="n">string</span> <span class="n">lheFile</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">word</span><span class="p">(</span><span class="s">&quot;Beams:LHEF&quot;</span><span class="p">);</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s"> &gt;&gt;&gt; Now begin subrun &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">iSubrun</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; with events from file &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">lheFile</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &lt;&lt;&lt; </span><span class="se">\n</span><span class="s">&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="c1">// Begin infinite event loop - to be exited at end of file.</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iEvent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">;</span> <span class="o">++</span><span class="n">iEvent</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Generate event.</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">())</span> <span class="p">{</span>
        <span class="c1">// Leave event loop if at end of file.</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">atEndOfFile</span><span class="p">())</span> <span class="k">break</span><span class="p">;</span>
        <span class="c1">// First few failures write off as &quot;acceptable&quot; errors, then quit.</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">++</span><span class="n">iAbort</span> <span class="o">&lt;</span> <span class="n">nAbort</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; Event generation aborted prematurely, owing to error!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="c1">// Construct new empty HepMC event and fill it.</span>
      <span class="c1">// Units will be as chosen for HepMC build, but can be changed</span>
      <span class="c1">// by arguments, e.g. GenEvt( HepMC::Units::GEV, HepMC::Units::MM)</span>
      <span class="n">HepMC</span><span class="o">::</span><span class="n">GenEvent</span><span class="o">*</span> <span class="n">hepmcevt</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HepMC</span><span class="o">::</span><span class="n">GenEvent</span><span class="p">();</span>
      <span class="n">ToHepMC</span><span class="p">.</span><span class="n">fill_next_event</span><span class="p">(</span> <span class="n">pythia</span><span class="p">,</span> <span class="n">hepmcevt</span> <span class="p">);</span>
      <span class="c1">// Write the HepMC event to file. Done with it.</span>
      <span class="n">ascii_io</span> <span class="o">&lt;&lt;</span> <span class="n">hepmcevt</span><span class="p">;</span>
      <span class="k">delete</span> <span class="n">hepmcevt</span><span class="p">;</span>
    <span class="c1">// End of event loop.</span>
    <span class="p">}</span>
  <span class="c1">// End of subrun loop.</span>
  <span class="p">}</span>
  <span class="c1">// Statistics.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
  <span class="c1">// Done.</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
    </div>
  </div>
</div>

</div> <div class="well well-sm"> <h1 id="main46cc">main46.cc</h1><hr>
<div class="codehilite"><pre><span class="c1">// main46.cc is a part of the PYTHIA event generator.</span>
<span class="c1">// Copyright (C) 2013 Torbjorn Sjostrand.</span>
<span class="c1">// PYTHIA is licenced under the GNU GPL version 2, see COPYING for details.</span>
<span class="c1">// Please respect the MCnet Guidelines, see GUIDELINES for details.</span>
<span class="c1">//</span>
<span class="c1">// Author: S.Chekanov (ANL).</span>
<span class="c1">// An example of how to write ProMC files.</span>
<span class="c1">//</span>
<span class="c1">// The ProMC library is described at http://atlaswww.hep.anl.gov/asc/promc/</span>
<span class="c1">// A makefile can be found in the ProMC  package, in examples/pythia.</span>
</pre></div>


<div class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" href="#fileid39">Rest of the main46.cc code</a>
    </h4>
  </div>
  <div id="fileid39" class="panel-collapse collapse">
    <div class="panel-body">
<div class="codehilite"><pre><span class="cp">#include</span> <span class="cpf">&lt;map&gt;</span><span class="cp"></span>
<span class="c1">// ProMC file. Google does not like these warnings.</span>
<span class="cp">#pragma GCC diagnostic ignored &quot;-pedantic&quot;</span>
<span class="cp">#pragma GCC diagnostic ignored &quot;-Wshadow&quot;</span>
<span class="cp">#include</span> <span class="cpf">&quot;ProMCBook.h&quot;</span><span class="cp"></span>
<span class="c1">// Pythia header and namespace.</span>
<span class="cp">#include</span> <span class="cpf">&quot;Pythia8/Pythia.h&quot;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">Pythia8</span><span class="p">;</span>
<span class="c1">//--------------------------------------------------------------------------</span>
<span class="n">string</span> <span class="nf">getEnvVar</span><span class="p">(</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="k">const</span> <span class="o">&amp;</span> <span class="n">key</span> <span class="p">)</span> <span class="p">{</span>
  <span class="kt">char</span> <span class="o">*</span> <span class="n">val</span> <span class="o">=</span> <span class="n">getenv</span><span class="p">(</span> <span class="n">key</span><span class="p">.</span><span class="n">c_str</span><span class="p">()</span> <span class="p">);</span>
  <span class="k">return</span> <span class="p">(</span><span class="n">val</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="o">?</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span> <span class="o">:</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">(</span><span class="n">val</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">//--------------------------------------------------------------------------</span>
<span class="kt">void</span> <span class="nf">readPDG</span><span class="p">(</span> <span class="n">ProMCHeader</span> <span class="o">*</span> <span class="n">header</span>  <span class="p">)</span> <span class="p">{</span>
  <span class="n">string</span> <span class="n">temp_string</span><span class="p">;</span>
  <span class="n">istringstream</span> <span class="n">curstring</span><span class="p">;</span>
  <span class="n">string</span> <span class="n">PdgTableFilename</span> <span class="o">=</span> <span class="n">getEnvVar</span><span class="p">(</span><span class="s">&quot;PROMC&quot;</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">PdgTableFilename</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="n">PdgTableFilename</span> <span class="o">=</span> <span class="n">string</span><span class="p">(</span><span class="n">PROMC</span><span class="p">);</span>
  <span class="n">PdgTableFilename</span> <span class="o">+=</span> <span class="s">&quot;/data/particle.tbl&quot;</span><span class="p">;</span>
  <span class="n">ifstream</span> <span class="n">file_to_read</span><span class="p">(</span><span class="n">PdgTableFilename</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">file_to_read</span><span class="p">.</span><span class="n">good</span><span class="p">())</span> <span class="p">{</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;**        ERROR: PDG Table (&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">PdgTableFilename</span>
         <span class="o">&lt;&lt;</span>  <span class="s">&quot;) not found! exit.                        **&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// First three lines of the file are useless.</span>
  <span class="n">getline</span><span class="p">(</span><span class="n">file_to_read</span><span class="p">,</span><span class="n">temp_string</span><span class="p">);</span>
  <span class="n">getline</span><span class="p">(</span><span class="n">file_to_read</span><span class="p">,</span><span class="n">temp_string</span><span class="p">);</span>
  <span class="n">getline</span><span class="p">(</span><span class="n">file_to_read</span><span class="p">,</span><span class="n">temp_string</span><span class="p">);</span>
  <span class="k">while</span> <span class="p">(</span><span class="n">getline</span><span class="p">(</span><span class="n">file_to_read</span><span class="p">,</span><span class="n">temp_string</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// Needed when using several times istringstream::str(string).</span>
    <span class="n">curstring</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
    <span class="n">curstring</span><span class="p">.</span><span class="n">str</span><span class="p">(</span><span class="n">temp_string</span><span class="p">);</span>
    <span class="kt">long</span> <span class="kt">int</span> <span class="n">ID</span><span class="p">;</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">name</span><span class="p">;</span> <span class="kt">int</span> <span class="n">charge</span><span class="p">;</span> <span class="kt">float</span> <span class="n">mass</span><span class="p">;</span> <span class="kt">float</span> <span class="n">width</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">lifetime</span><span class="p">;</span>
    <span class="c1">// ID name   chg       mass    total width   lifetime</span>
    <span class="c1">//  1 d      -1      0.33000     0.00000   0.00000E+00</span>
    <span class="c1">//  in the table, the charge is in units of e+/3</span>
    <span class="c1">//  the total width is in GeV</span>
    <span class="c1">//  the lifetime is ctau in mm</span>
    <span class="n">curstring</span> <span class="o">&gt;&gt;</span> <span class="n">ID</span> <span class="o">&gt;&gt;</span> <span class="n">name</span> <span class="o">&gt;&gt;</span> <span class="n">charge</span> <span class="o">&gt;&gt;</span> <span class="n">mass</span> <span class="o">&gt;&gt;</span> <span class="n">width</span> <span class="o">&gt;&gt;</span> <span class="n">lifetime</span><span class="p">;</span>
    <span class="n">ProMCHeader_ParticleData</span><span class="o">*</span> <span class="n">pp</span><span class="o">=</span> <span class="n">header</span><span class="o">-&gt;</span><span class="n">add_particledata</span><span class="p">();</span>
    <span class="n">pp</span><span class="o">-&gt;</span><span class="n">set_id</span><span class="p">(</span><span class="n">ID</span><span class="p">);</span>
    <span class="n">pp</span><span class="o">-&gt;</span><span class="n">set_mass</span><span class="p">(</span><span class="n">mass</span><span class="p">);</span>
    <span class="n">pp</span><span class="o">-&gt;</span><span class="n">set_name</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
    <span class="n">pp</span><span class="o">-&gt;</span><span class="n">set_width</span><span class="p">(</span><span class="n">width</span><span class="p">);</span>
    <span class="n">pp</span><span class="o">-&gt;</span><span class="n">set_lifetime</span><span class="p">(</span><span class="n">lifetime</span><span class="p">);</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">ID</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">name</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">mass</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="c1">//--------------------------------------------------------------------------</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">Ntot</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span> <span class="c1">// Total number of events.</span>
  <span class="c1">// Generator. Process selection. LHC initialization.</span>
  <span class="n">Pythia</span> <span class="n">pythia</span><span class="p">;</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;HardQCD:all = on&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;PhaseSpace:pTHatMin = 20.&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Beams:eCM = 14000.&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
  <span class="c1">// ****************  book ProMC file **********************</span>
  <span class="n">ProMCBook</span><span class="o">*</span> <span class="n">epbook</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ProMCBook</span><span class="p">(</span><span class="s">&quot;Pythia8.promc&quot;</span><span class="p">,</span><span class="s">&quot;w&quot;</span><span class="p">);</span>
  <span class="n">epbook</span><span class="o">-&gt;</span><span class="n">setDescription</span><span class="p">(</span><span class="n">Ntot</span><span class="p">,</span><span class="s">&quot;PYTHIA8&quot;</span><span class="p">);</span>
  <span class="c1">// Info on incoming beams and CM energy.</span>
  <span class="n">ProMCHeader</span> <span class="n">header</span><span class="p">;</span>
  <span class="n">header</span><span class="p">.</span><span class="n">set_id1</span><span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">idA</span><span class="p">()</span> <span class="p">);</span>
  <span class="n">header</span><span class="p">.</span><span class="n">set_id2</span><span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">idB</span><span class="p">()</span> <span class="p">);</span>
  <span class="n">header</span><span class="p">.</span><span class="n">set_ecm</span><span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">eCM</span><span class="p">()</span> <span class="p">);</span>
  <span class="n">header</span><span class="p">.</span><span class="n">set_s</span><span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">s</span><span class="p">()</span> <span class="p">);</span>
 <span class="c1">// Use the range 0.01 MeV to 20 TeV using varints (integers).</span>
 <span class="c1">// With particle in GeV, we multiply it by kEV, to get 0.01 MeV = 1 unit.</span>
 <span class="k">const</span> <span class="kt">double</span> <span class="n">kEV</span> <span class="o">=</span> <span class="mi">1000</span><span class="o">*</span><span class="mi">100</span><span class="p">;</span>
 <span class="c1">// With particle in mm, we multiply it by kL to get 0.01 mm = 1 unit.</span>
  <span class="k">const</span> <span class="kt">double</span> <span class="n">kL</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
  <span class="c1">// Set units.</span>
  <span class="n">header</span><span class="p">.</span><span class="n">set_momentumunit</span><span class="p">(</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">kEV</span> <span class="p">);</span>
  <span class="n">header</span><span class="p">.</span><span class="n">set_lengthunit</span><span class="p">(</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">kL</span> <span class="p">);</span>
   <span class="c1">// Store a map with PDG information (stored in the header).</span>
  <span class="n">readPDG</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">header</span> <span class="p">);</span>
  <span class="n">epbook</span><span class="o">-&gt;</span><span class="n">setHeader</span><span class="p">(</span><span class="n">header</span><span class="p">);</span> <span class="c1">// write header</span>
  <span class="c1">// Begin event loop. Generate event. Skip if error.</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="n">Ntot</span><span class="p">;</span> <span class="n">n</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">())</span> <span class="p">{</span>
      <span class="c1">// If failure because reached end of file then exit event loop.</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">atEndOfFile</span><span class="p">())</span> <span class="p">{</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; Aborted since reached end of Les Houches Event File</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">continue</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">//************  ProMC file ***************//</span>
    <span class="n">ProMCEvent</span> <span class="n">promc</span><span class="p">;</span>
    <span class="c1">// Fill event information.</span>
    <span class="n">ProMCEvent_Event</span> <span class="o">*</span><span class="n">eve</span> <span class="o">=</span> <span class="n">promc</span><span class="p">.</span><span class="n">mutable_event</span><span class="p">();</span>
    <span class="n">eve</span><span class="o">-&gt;</span><span class="n">set_number</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
    <span class="n">eve</span><span class="o">-&gt;</span><span class="n">set_process_id</span><span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">code</span><span class="p">()</span> <span class="p">);</span>     <span class="c1">// process ID</span>
    <span class="n">eve</span><span class="o">-&gt;</span><span class="n">set_scale</span><span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">pTHat</span><span class="p">(</span> <span class="p">));</span>         <span class="c1">// relevant for 2 -&gt; 2 only</span>
    <span class="n">eve</span><span class="o">-&gt;</span><span class="n">set_alpha_qed</span><span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">alphaEM</span><span class="p">()</span> <span class="p">);</span>
    <span class="n">eve</span><span class="o">-&gt;</span><span class="n">set_alpha_qcd</span><span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">alphaS</span><span class="p">()</span> <span class="p">);</span>
    <span class="n">eve</span><span class="o">-&gt;</span><span class="n">set_scale_pdf</span><span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">QFac</span><span class="p">()</span> <span class="p">);</span>
    <span class="n">eve</span><span class="o">-&gt;</span><span class="n">set_x1</span><span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">x1pdf</span><span class="p">()</span> <span class="p">);</span>
    <span class="n">eve</span><span class="o">-&gt;</span><span class="n">set_x2</span><span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">x2pdf</span><span class="p">()</span> <span class="p">);</span>
    <span class="n">eve</span><span class="o">-&gt;</span><span class="n">set_id1</span><span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">id1pdf</span><span class="p">()</span> <span class="p">);</span>
    <span class="n">eve</span><span class="o">-&gt;</span><span class="n">set_id2</span><span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">id2pdf</span><span class="p">()</span> <span class="p">);</span>
    <span class="n">eve</span><span class="o">-&gt;</span><span class="n">set_pdf1</span><span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">pdf1</span><span class="p">()</span> <span class="p">);</span>
    <span class="n">eve</span><span class="o">-&gt;</span><span class="n">set_pdf2</span><span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">pdf2</span><span class="p">()</span> <span class="p">);</span>
    <span class="n">eve</span><span class="o">-&gt;</span><span class="n">set_weight</span><span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">weight</span><span class="p">()</span> <span class="p">);</span>
    <span class="c1">// Fill truth particle information, looping over all particles in event.</span>
    <span class="n">ProMCEvent_Particles</span> <span class="o">*</span><span class="n">pa</span><span class="o">=</span> <span class="n">promc</span><span class="p">.</span><span class="n">mutable_particles</span><span class="p">();</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Fill information particle by particle.</span>
      <span class="n">pa</span><span class="o">-&gt;</span><span class="n">add_id</span><span class="p">(</span> <span class="n">i</span>  <span class="p">);</span>
      <span class="n">pa</span><span class="o">-&gt;</span><span class="n">add_pdg_id</span><span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">id</span><span class="p">()</span> <span class="p">);</span>
      <span class="c1">// Particle status in HEPMC style.</span>
      <span class="c1">// pa-&gt;add_status(  pythia.event.statusHepMC(i) );</span>
      <span class="n">pa</span><span class="o">-&gt;</span><span class="n">add_status</span><span class="p">(</span>  <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">status</span><span class="p">()</span> <span class="p">);</span>
      <span class="n">pa</span><span class="o">-&gt;</span><span class="n">add_mother1</span><span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">mother1</span><span class="p">()</span> <span class="p">);</span>
      <span class="n">pa</span><span class="o">-&gt;</span><span class="n">add_mother2</span><span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">mother2</span><span class="p">()</span> <span class="p">);</span>
      <span class="n">pa</span><span class="o">-&gt;</span><span class="n">add_daughter1</span><span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">daughter1</span><span class="p">()</span> <span class="p">);</span>
      <span class="n">pa</span><span class="o">-&gt;</span><span class="n">add_daughter2</span><span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">daughter2</span><span class="p">()</span> <span class="p">);</span>
      <span class="c1">// Only store three-momentum and mass, so need to calculate energy.</span>
      <span class="n">pa</span><span class="o">-&gt;</span><span class="n">add_px</span><span class="p">(</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">px</span><span class="p">()</span><span class="o">*</span><span class="n">kEV</span><span class="p">)</span> <span class="p">);</span>
      <span class="n">pa</span><span class="o">-&gt;</span><span class="n">add_py</span><span class="p">(</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">py</span><span class="p">()</span><span class="o">*</span><span class="n">kEV</span><span class="p">)</span> <span class="p">);</span>
      <span class="n">pa</span><span class="o">-&gt;</span><span class="n">add_pz</span><span class="p">(</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pz</span><span class="p">()</span><span class="o">*</span><span class="n">kEV</span><span class="p">)</span> <span class="p">);</span>
      <span class="n">pa</span><span class="o">-&gt;</span><span class="n">add_mass</span><span class="p">(</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">m</span><span class="p">()</span><span class="o">*</span><span class="n">kEV</span><span class="p">)</span> <span class="p">);</span>
      <span class="c1">// Store production vertex; will often be the origin.</span>
      <span class="n">pa</span><span class="o">-&gt;</span><span class="n">add_x</span><span class="p">(</span> <span class="kt">int</span><span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">xProd</span><span class="p">()</span><span class="o">*</span><span class="n">kL</span><span class="p">)</span> <span class="p">);</span>
      <span class="n">pa</span><span class="o">-&gt;</span><span class="n">add_y</span><span class="p">(</span> <span class="kt">int</span><span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">yProd</span><span class="p">()</span><span class="o">*</span><span class="n">kL</span><span class="p">)</span> <span class="p">);</span>
      <span class="n">pa</span><span class="o">-&gt;</span><span class="n">add_z</span><span class="p">(</span> <span class="kt">int</span><span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">zProd</span><span class="p">()</span><span class="o">*</span><span class="n">kL</span><span class="p">)</span> <span class="p">);</span>
      <span class="n">pa</span><span class="o">-&gt;</span><span class="n">add_t</span><span class="p">(</span> <span class="kt">int</span><span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">tProd</span><span class="p">()</span><span class="o">*</span><span class="n">kL</span><span class="p">)</span> <span class="p">);</span>
    <span class="p">}</span> <span class="c1">// end loop over particles in the event</span>
    <span class="n">epbook</span><span class="o">-&gt;</span><span class="n">write</span><span class="p">(</span><span class="n">promc</span><span class="p">);</span> <span class="c1">// write event</span>
  <span class="p">}</span> <span class="c1">// end loop over events</span>
  <span class="c1">// Print statistics.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
  <span class="kt">double</span> <span class="n">sigmapb</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">sigmaGen</span><span class="p">()</span> <span class="o">*</span> <span class="mf">1.0E9</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;== Cross section for this run = &quot;</span> <span class="o">&lt;&lt;</span>  <span class="n">sigmapb</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; pb&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;== Events for this run = &quot;</span> <span class="o">&lt;&lt;</span>  <span class="n">Ntot</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="kt">double</span> <span class="n">lumi</span> <span class="o">=</span> <span class="p">(</span><span class="n">Ntot</span><span class="o">/</span><span class="n">sigmapb</span><span class="p">)</span><span class="o">/</span><span class="mi">1000</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;== Luminosity for this run = &quot;</span> <span class="o">&lt;&lt;</span>  <span class="n">lumi</span>  <span class="o">&lt;&lt;</span> <span class="s">&quot; fb-1&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">;</span>
  <span class="c1">// Save post-generation statistics for ProMC.</span>
  <span class="n">ProMCStat</span> <span class="n">stat</span><span class="p">;</span>
  <span class="n">stat</span><span class="p">.</span><span class="n">set_cross_section_accumulated</span><span class="p">(</span> <span class="n">sigmapb</span> <span class="p">);</span> <span class="c1">// in pb</span>
  <span class="n">stat</span><span class="p">.</span><span class="n">set_cross_section_error_accumulated</span><span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">sigmaErr</span><span class="p">()</span> <span class="o">*</span> <span class="mf">1e9</span> <span class="p">);</span>
  <span class="n">stat</span><span class="p">.</span><span class="n">set_luminosity_accumulated</span><span class="p">(</span> <span class="n">Ntot</span><span class="o">/</span><span class="n">sigmapb</span> <span class="p">);</span>
  <span class="n">stat</span><span class="p">.</span><span class="n">set_ntried</span><span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">nTried</span><span class="p">()</span> <span class="p">);</span>
  <span class="n">stat</span><span class="p">.</span><span class="n">set_nselected</span><span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">nSelected</span><span class="p">()</span> <span class="p">);</span>
  <span class="n">stat</span><span class="p">.</span><span class="n">set_naccepted</span><span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">nAccepted</span><span class="p">()</span> <span class="p">);</span>
  <span class="n">epbook</span><span class="o">-&gt;</span><span class="n">setStatistics</span><span class="p">(</span> <span class="n">stat</span> <span class="p">);</span>
  <span class="c1">// Close the ProMC file.</span>
  <span class="n">epbook</span><span class="o">-&gt;</span><span class="n">close</span><span class="p">();</span> <span class="c1">// close</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
    </div>
  </div>
</div>

</div> <div class="well well-sm"> <h1 id="main48cc">main48.cc</h1><hr>
<div class="codehilite"><pre><span class="c1">// main48.cc is a part of the PYTHIA event generator.</span>
<span class="c1">// Copyright (C) 2016 Torbjorn Sjostrand.</span>
<span class="c1">// PYTHIA is licenced under the GNU GPL version 2, see COPYING for details.</span>
<span class="c1">// Please respect the MCnet Guidelines, see GUIDELINES for details.</span>
<span class="c1">// Author: Philip Ilten.</span>
<span class="c1">// An example where decays are performed with EvtGen. See the</span>
<span class="c1">// documentation in Pythia8Plugins/EvtGen.h for further details on the</span>
<span class="c1">// EvtGenDecays class. In this example the decay B0 -&gt; nu_e e+ D*-[-&gt;</span>
<span class="c1">// gamma D-[-&gt; nu_ebar e- pi0]] is forced. The invariant mass spectrum</span>
<span class="c1">// of the final state electron and pion is then plotted.</span>
<span class="c1">// The syntax to run this example is:</span>
<span class="c1">//     ./main48 &lt;EvtGen decay file&gt; &lt;EvtGen particle data&gt; &lt;PYTHIA8DATA&gt;</span>
<span class="c1">//              &lt;flag to use EvtGen&gt;</span>
<span class="c1">// This example has only been tested with EvtGen version 1.3.0. The</span>
<span class="c1">// EvtGen package is designed to use Pythia 8 for any decays that it</span>
<span class="c1">// cannot perform. For this to be possible, EvtGen must be linked</span>
<span class="c1">// against the Pythia 8 shared library. To build EvtGen 1.3.0 with</span>
<span class="c1">// Pythia 8.2 the &quot;-llhapdfdummy&quot; library requirement must be</span>
<span class="c1">// removed. Prior to running &quot;./configure&quot; for EvtGen this can be</span>
<span class="c1">// accomplished via:</span>
<span class="c1">//     sed -i &quot;s/-llhapdfdummy//g&quot; configure</span>
<span class="c1">// To modify how this example program is compiled (i.e to remove</span>
<span class="c1">// linking against the EvtGenExternal library) change the main48 rule</span>
<span class="c1">// in the Makefile of this directory.</span>
</pre></div>


<div class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" href="#fileid40">Rest of the main48.cc code</a>
    </h4>
  </div>
  <div id="fileid40" class="panel-collapse collapse">
    <div class="panel-body">
<div class="codehilite"><pre><span class="cp">#include</span> <span class="cpf">&quot;Pythia8/Pythia.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;Pythia8Plugins/EvtGen.h&quot;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">Pythia8</span><span class="p">;</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
  <span class="c1">// Check arguments.</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">!=</span> <span class="mi">5</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; Unexpected number of command-line arguments. </span><span class="se">\n</span><span class="s"> You are&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; expected to provide the arguments </span><span class="se">\n</span><span class="s">&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; 1. EvtGen decay file (e.g. DECAY_2010.DEC) </span><span class="se">\n</span><span class="s">&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; 2. EvtGen particle data (e.g. evt.pdl) </span><span class="se">\n</span><span class="s">&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; 3. PYTHIA8DATA path </span><span class="se">\n</span><span class="s">&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; 4. Flag to use EvtGen (true or false) </span><span class="se">\n</span><span class="s">&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; Program stopped. &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kt">bool</span> <span class="n">use</span><span class="p">(</span><span class="n">string</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span> <span class="o">==</span> <span class="s">&quot;true&quot;</span><span class="p">);</span>
  <span class="c1">// Intialize Pythia.</span>
  <span class="n">Pythia</span> <span class="n">pythia</span><span class="p">;</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Print:quiet = on&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;HardQCD:hardbbbar = on&quot;</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">use</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Not using EvtGen.&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;511:onMode = off&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;511:onIfMatch = 12 -11 -413&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;413:onMode = off&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;413:onIfMatch = 411 22&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;411:onMode = off&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;411:onIfMatch = -11 12 111&quot;</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Using EvtGen.&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
  <span class="c1">// Initialize EvtGen.</span>
  <span class="n">EvtGenDecays</span> <span class="o">*</span><span class="n">evtgen</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">use</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">setenv</span><span class="p">(</span><span class="s">&quot;PYTHIA8DATA&quot;</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">evtgen</span> <span class="o">=</span> <span class="k">new</span> <span class="n">EvtGenDecays</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pythia</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
    <span class="n">evtgen</span><span class="o">-&gt;</span><span class="n">readDecayFile</span><span class="p">(</span><span class="s">&quot;main48.dec&quot;</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="c1">// The event loop.</span>
  <span class="n">Hist</span> <span class="n">mass</span><span class="p">(</span><span class="s">&quot;m(e, pi0) [GeV]&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iEvent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iEvent</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">;</span> <span class="o">++</span><span class="n">iEvent</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Generate the event.</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">())</span> <span class="k">continue</span><span class="p">;</span>
    <span class="c1">// Perform the decays with EvtGen.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">evtgen</span><span class="p">)</span> <span class="n">evtgen</span><span class="o">-&gt;</span><span class="n">decay</span><span class="p">();</span>
    <span class="c1">// Analyze the event.</span>
    <span class="n">Event</span> <span class="o">&amp;</span><span class="n">event</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iPrt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iPrt</span> <span class="o">&lt;</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">event</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">iPrt</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="n">iPrt</span><span class="p">].</span><span class="n">idAbs</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">511</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
      <span class="kt">int</span> <span class="n">iB0</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="n">iPrt</span><span class="p">].</span><span class="n">iBotCopyId</span><span class="p">()),</span> <span class="n">iDsm</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">iDm</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">iE</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">iPi0</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
      <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iDtr</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="n">iB0</span><span class="p">].</span><span class="n">daughter1</span><span class="p">();</span> <span class="n">iDtr</span> <span class="o">&lt;=</span> <span class="n">event</span><span class="p">[</span><span class="n">iB0</span><span class="p">].</span><span class="n">daughter2</span><span class="p">();</span>
           <span class="o">++</span> <span class="n">iDtr</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="n">iDtr</span><span class="p">].</span><span class="n">idAbs</span><span class="p">()</span> <span class="o">==</span> <span class="mi">413</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">iDsm</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="n">iDtr</span><span class="p">].</span><span class="n">iBotCopyId</span><span class="p">();</span>
          <span class="k">continue</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">iDsm</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iDtr</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="n">iDsm</span><span class="p">].</span><span class="n">daughter1</span><span class="p">();</span> <span class="n">iDtr</span> <span class="o">&lt;=</span> <span class="n">event</span><span class="p">[</span><span class="n">iDsm</span><span class="p">].</span><span class="n">daughter2</span><span class="p">();</span>
           <span class="o">++</span> <span class="n">iDtr</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="n">iDtr</span><span class="p">].</span><span class="n">idAbs</span><span class="p">()</span> <span class="o">==</span> <span class="mi">411</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">iDm</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="n">iDtr</span><span class="p">].</span><span class="n">iBotCopyId</span><span class="p">();</span>
          <span class="k">continue</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">iDm</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iDtr</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="n">iDm</span><span class="p">].</span><span class="n">daughter1</span><span class="p">();</span> <span class="n">iDtr</span> <span class="o">&lt;=</span> <span class="n">event</span><span class="p">[</span><span class="n">iDm</span><span class="p">].</span><span class="n">daughter2</span><span class="p">();</span>
           <span class="o">++</span> <span class="n">iDtr</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="n">iDtr</span><span class="p">].</span><span class="n">idAbs</span><span class="p">()</span> <span class="o">==</span> <span class="mi">11</span><span class="p">)</span>  <span class="n">iE</span>   <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="n">iDtr</span><span class="p">].</span><span class="n">iBotCopyId</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="n">iDtr</span><span class="p">].</span><span class="n">idAbs</span><span class="p">()</span> <span class="o">==</span> <span class="mi">111</span><span class="p">)</span> <span class="n">iPi0</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="n">iDtr</span><span class="p">].</span><span class="n">iBotCopyId</span><span class="p">();</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">iE</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="o">||</span> <span class="n">iPi0</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
      <span class="n">mass</span><span class="p">.</span><span class="n">fill</span><span class="p">((</span><span class="n">event</span><span class="p">[</span><span class="n">iE</span><span class="p">].</span><span class="n">p</span><span class="p">()</span> <span class="o">+</span> <span class="n">event</span><span class="p">[</span><span class="n">iPi0</span><span class="p">].</span><span class="n">p</span><span class="p">()).</span><span class="n">mCalc</span><span class="p">());</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="c1">// Print the statistics and histogram.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
  <span class="n">mass</span> <span class="o">/=</span> <span class="n">mass</span><span class="p">.</span><span class="n">getEntries</span><span class="p">();</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">mass</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">evtgen</span><span class="p">)</span> <span class="k">delete</span> <span class="n">evtgen</span><span class="p">;</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
    </div>
  </div>
</div>

</div> <div class="well well-sm"> <h1 id="main51cc">main51.cc</h1><hr>
<div class="codehilite"><pre><span class="c1">// main51.cc is a part of the PYTHIA event generator.</span>
<span class="c1">// Copyright (C) 2016 Torbjorn Sjostrand.</span>
<span class="c1">// PYTHIA is licenced under the GNU GPL version 2, see COPYING for details.</span>
<span class="c1">// Please respect the MCnet Guidelines, see GUIDELINES for details.</span>
<span class="c1">// Test of LHAPDF interface and whether PDF&#39;s behave sensibly.</span>
</pre></div>


<div class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" href="#fileid41">Rest of the main51.cc code</a>
    </h4>
  </div>
  <div id="fileid41" class="panel-collapse collapse">
    <div class="panel-body">
<div class="codehilite"><pre><span class="cp">#include</span> <span class="cpf">&quot;Pythia8/Pythia.h&quot;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">Pythia8</span><span class="p">;</span>
<span class="c1">//==========================================================================</span>
<span class="c1">// Integration to check momentum sum rule.</span>
<span class="kt">double</span> <span class="nf">integrate</span><span class="p">(</span><span class="n">PDF</span><span class="o">*</span> <span class="n">nowPDF</span><span class="p">,</span> <span class="kt">double</span> <span class="n">Q2</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Number of points, x ranges and initial values.</span>
  <span class="kt">int</span>    <span class="n">nLin</span>  <span class="o">=</span> <span class="mi">980</span><span class="p">;</span>
  <span class="kt">int</span>    <span class="n">nLog</span>  <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span>
  <span class="kt">double</span> <span class="n">xLin</span>  <span class="o">=</span> <span class="mf">0.02</span><span class="p">;</span>
  <span class="kt">double</span> <span class="n">xLog</span>  <span class="o">=</span> <span class="mf">1e-8</span><span class="p">;</span>
  <span class="kt">double</span> <span class="n">dxLin</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">xLin</span><span class="p">)</span> <span class="o">/</span> <span class="n">nLin</span><span class="p">;</span>
  <span class="kt">double</span> <span class="n">dxLog</span> <span class="o">=</span> <span class="n">log</span><span class="p">(</span><span class="n">xLin</span> <span class="o">/</span> <span class="n">xLog</span><span class="p">)</span> <span class="o">/</span> <span class="n">nLog</span><span class="p">;</span>
  <span class="kt">double</span> <span class="n">sum</span>   <span class="o">=</span> <span class="mf">0.</span><span class="p">;</span>
  <span class="kt">double</span> <span class="n">x</span><span class="p">,</span> <span class="n">sumNow</span><span class="p">;</span>
  <span class="c1">// Integration at large x in linear steps.</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iLin</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iLin</span> <span class="o">&lt;</span> <span class="n">nLin</span><span class="p">;</span> <span class="o">++</span><span class="n">iLin</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">x</span>      <span class="o">=</span> <span class="n">xLin</span> <span class="o">+</span> <span class="p">(</span><span class="n">iLin</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">dxLin</span><span class="p">;</span>
    <span class="n">sumNow</span> <span class="o">=</span> <span class="n">nowPDF</span><span class="o">-&gt;</span><span class="n">xf</span><span class="p">(</span> <span class="mi">21</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">Q2</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
      <span class="n">sumNow</span> <span class="o">+=</span> <span class="n">nowPDF</span><span class="o">-&gt;</span><span class="n">xf</span><span class="p">(</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">Q2</span><span class="p">)</span> <span class="o">+</span> <span class="n">nowPDF</span><span class="o">-&gt;</span><span class="n">xf</span><span class="p">(</span> <span class="o">-</span><span class="n">i</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">Q2</span><span class="p">);</span>
    <span class="n">sum</span>   <span class="o">+=</span> <span class="n">dxLin</span> <span class="o">*</span> <span class="n">sumNow</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// Integration at small x in logarithmic steps.</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iLog</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iLog</span> <span class="o">&lt;</span> <span class="n">nLog</span><span class="p">;</span> <span class="o">++</span><span class="n">iLog</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">x</span>      <span class="o">=</span> <span class="n">xLog</span> <span class="o">*</span> <span class="n">pow</span><span class="p">(</span> <span class="n">xLin</span> <span class="o">/</span> <span class="n">xLog</span><span class="p">,</span> <span class="p">(</span><span class="n">iLog</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">/</span> <span class="n">nLog</span> <span class="p">);</span>
    <span class="n">sumNow</span> <span class="o">=</span> <span class="n">nowPDF</span><span class="o">-&gt;</span><span class="n">xf</span><span class="p">(</span> <span class="mi">21</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">Q2</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
      <span class="n">sumNow</span> <span class="o">+=</span> <span class="n">nowPDF</span><span class="o">-&gt;</span><span class="n">xf</span><span class="p">(</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">Q2</span><span class="p">)</span> <span class="o">+</span> <span class="n">nowPDF</span><span class="o">-&gt;</span><span class="n">xf</span><span class="p">(</span> <span class="o">-</span><span class="n">i</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">Q2</span><span class="p">);</span>
    <span class="n">sum</span>   <span class="o">+=</span> <span class="n">dxLog</span> <span class="o">*</span> <span class="n">x</span> <span class="o">*</span> <span class="n">sumNow</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// Done.</span>
  <span class="k">return</span> <span class="n">sum</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">//==========================================================================</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// The Pythia class itself is not used, but some facilities that come along.</span>
  <span class="c1">//Pythia pythia;</span>
  <span class="c1">// Chosen new PDF set; LHAPDF5 file name conventions.</span>
  <span class="c1">//string pdfSet = &quot;LHAPDF5:cteq5l.LHgrid&quot;;</span>
  <span class="c1">//string pdfSet = &quot;LHAPDF5:cteq61.LHpdf&quot;;</span>
  <span class="c1">//string pdfSet = &quot;LHAPDF5:cteq61.LHgrid&quot;;</span>
  <span class="c1">//string pdfSet = &quot;LHAPDF5:MRST2004nlo.LHgrid&quot;;</span>
  <span class="c1">//string pdfSet = &quot;LHAPDF5:MRST2001lo.LHgrid&quot;;</span>
  <span class="n">string</span> <span class="n">pdfSet</span> <span class="o">=</span> <span class="s">&quot;LHAPDF5:MRST2007lomod.LHgrid&quot;</span><span class="p">;</span>
  <span class="c1">// Pointers to old default and new tryout PDF sets.</span>
  <span class="n">Info</span> <span class="n">info</span><span class="p">;</span>
  <span class="n">PDF</span><span class="o">*</span> <span class="n">oldPDF</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CTEQ5L</span><span class="p">(</span><span class="mi">2212</span><span class="p">);</span>
  <span class="n">PDF</span><span class="o">*</span> <span class="n">newPDF</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LHAPDF</span><span class="p">(</span><span class="mi">2212</span><span class="p">,</span> <span class="n">pdfSet</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">info</span><span class="p">);</span>
  <span class="c1">// Alternative: compare two Pomeron PDF&#39;s. Boost second by factor 2.</span>
  <span class="c1">//PDF* oldPDF = new PomFix( 990, -0.2, 2.5, 0., 3., 0.4, 0.5);</span>
  <span class="c1">//PDF* newPDF = new PomH1Jets( 990, 2.);</span>
  <span class="c1">//PDF* oldPDF = new PomH1FitAB( 990, 2);</span>
  <span class="c1">//PDF* newPDF = new PomH1FitAB( 990, 3);</span>
  <span class="c1">// Allow extrapolation of PDF&#39;s beyond x and Q2 boundaries, at own risk.</span>
  <span class="c1">// Default behaviour is to freeze PDF&#39;s at boundaries.</span>
  <span class="n">newPDF</span><span class="o">-&gt;</span><span class="n">setExtrapolate</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
  <span class="c1">// Histogram F(x, Q2) = (9/4) x*g(x, Q2) + sum_{i = q, qbar} x*f_i(x, Q2)</span>
  <span class="c1">// for range 10^{-8} &lt; x &lt; 1 logarithmic in x and for Q2 = 4 and 100.</span>
  <span class="n">Hist</span> <span class="n">oldF4</span><span class="p">(</span><span class="s">&quot;F( x, Q2 = 4) old&quot;</span><span class="p">,</span> <span class="mi">80</span> <span class="p">,</span> <span class="o">-</span><span class="mf">8.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">newF4</span><span class="p">(</span><span class="s">&quot;F( x, Q2 = 4) new&quot;</span><span class="p">,</span> <span class="mi">80</span> <span class="p">,</span> <span class="o">-</span><span class="mf">8.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">ratF4</span><span class="p">(</span><span class="s">&quot;F( x, Q2 = 4) new/old&quot;</span><span class="p">,</span> <span class="mi">80</span> <span class="p">,</span> <span class="o">-</span><span class="mf">8.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">oldF100</span><span class="p">(</span><span class="s">&quot;F( x, Q2 = 100) old&quot;</span><span class="p">,</span> <span class="mi">80</span> <span class="p">,</span> <span class="o">-</span><span class="mf">8.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">newF100</span><span class="p">(</span><span class="s">&quot;F( x, Q2 = 100) new&quot;</span><span class="p">,</span> <span class="mi">80</span> <span class="p">,</span> <span class="o">-</span><span class="mf">8.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">ratF100</span><span class="p">(</span><span class="s">&quot;F( x, Q2 = 100) new/old&quot;</span><span class="p">,</span> <span class="mi">80</span> <span class="p">,</span> <span class="o">-</span><span class="mf">8.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">);</span>
  <span class="c1">// Loop over the two Q2 values.</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iQ</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iQ</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">;</span> <span class="o">++</span><span class="n">iQ</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">double</span> <span class="n">Q2</span> <span class="o">=</span> <span class="p">(</span><span class="n">iQ</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">?</span> <span class="mf">4.</span> <span class="o">:</span> <span class="mi">100</span><span class="p">;</span>
    <span class="c1">// Loop over x values, in a logarithmic scale</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iX</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iX</span> <span class="o">&lt;</span> <span class="mi">80</span><span class="p">;</span> <span class="o">++</span><span class="n">iX</span><span class="p">)</span> <span class="p">{</span>
      <span class="kt">double</span> <span class="n">xLog</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="mf">0.1</span> <span class="o">*</span> <span class="n">iX</span> <span class="o">+</span> <span class="mf">0.05</span><span class="p">);</span>
      <span class="kt">double</span> <span class="n">x</span> <span class="o">=</span> <span class="n">pow</span><span class="p">(</span> <span class="mf">10.</span><span class="p">,</span> <span class="n">xLog</span><span class="p">);</span>
      <span class="c1">// Evaluate old summed PDF.</span>
      <span class="kt">double</span> <span class="n">oldSum</span> <span class="o">=</span> <span class="mf">2.25</span> <span class="o">*</span> <span class="n">oldPDF</span><span class="o">-&gt;</span><span class="n">xf</span><span class="p">(</span> <span class="mi">21</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">Q2</span><span class="p">);</span>
      <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
        <span class="n">oldSum</span> <span class="o">+=</span> <span class="n">oldPDF</span><span class="o">-&gt;</span><span class="n">xf</span><span class="p">(</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">Q2</span><span class="p">)</span> <span class="o">+</span> <span class="n">oldPDF</span><span class="o">-&gt;</span><span class="n">xf</span><span class="p">(</span> <span class="o">-</span><span class="n">i</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">Q2</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">iQ</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="n">oldF4</span><span class="p">.</span><span class="n">fill</span> <span class="p">(</span> <span class="n">xLog</span><span class="p">,</span> <span class="n">oldSum</span> <span class="p">);</span>
      <span class="k">else</span>       <span class="n">oldF100</span><span class="p">.</span><span class="n">fill</span> <span class="p">(</span> <span class="n">xLog</span><span class="p">,</span> <span class="n">oldSum</span> <span class="p">);</span>
      <span class="c1">// Evaluate new summed PDF.</span>
      <span class="kt">double</span> <span class="n">newSum</span> <span class="o">=</span> <span class="mf">2.25</span> <span class="o">*</span> <span class="n">newPDF</span><span class="o">-&gt;</span><span class="n">xf</span><span class="p">(</span> <span class="mi">21</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">Q2</span><span class="p">);</span>
      <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
        <span class="n">newSum</span> <span class="o">+=</span> <span class="n">newPDF</span><span class="o">-&gt;</span><span class="n">xf</span><span class="p">(</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">Q2</span><span class="p">)</span> <span class="o">+</span> <span class="n">newPDF</span><span class="o">-&gt;</span><span class="n">xf</span><span class="p">(</span> <span class="o">-</span><span class="n">i</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">Q2</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">iQ</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="n">newF4</span><span class="p">.</span><span class="n">fill</span> <span class="p">(</span> <span class="n">xLog</span><span class="p">,</span> <span class="n">newSum</span> <span class="p">);</span>
      <span class="k">else</span>       <span class="n">newF100</span><span class="p">.</span><span class="n">fill</span> <span class="p">(</span> <span class="n">xLog</span><span class="p">,</span> <span class="n">newSum</span> <span class="p">);</span>
    <span class="c1">//End loops over x and Q2 values.</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="c1">// Show F(x, Q2) and their ratio new/old.</span>
  <span class="n">ratF4</span> <span class="o">=</span> <span class="n">newF4</span> <span class="o">/</span> <span class="n">oldF4</span><span class="p">;</span>
  <span class="n">ratF100</span> <span class="o">=</span> <span class="n">newF100</span> <span class="o">/</span> <span class="n">oldF100</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">oldF4</span> <span class="o">&lt;&lt;</span> <span class="n">newF4</span> <span class="o">&lt;&lt;</span> <span class="n">ratF4</span> <span class="o">&lt;&lt;</span> <span class="n">oldF100</span> <span class="o">&lt;&lt;</span> <span class="n">newF100</span> <span class="o">&lt;&lt;</span> <span class="n">ratF100</span><span class="p">;</span>
  <span class="c1">// Histogram momentum sum as a function of Q2 (or rather log10(Q2)).</span>
  <span class="n">Hist</span> <span class="n">oldXSum</span><span class="p">(</span><span class="s">&quot;momentum sum(log10(Q2)) old&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.</span><span class="p">,</span> <span class="mf">8.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">newXSum</span><span class="p">(</span><span class="s">&quot;momentum sum(log10(Q2)) new&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.</span><span class="p">,</span> <span class="mf">8.</span><span class="p">);</span>
  <span class="c1">// Loop over Q2 values.</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iQ</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iQ</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">;</span> <span class="o">++</span><span class="n">iQ</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">double</span> <span class="n">log10Q2</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.0</span> <span class="o">+</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">iQ</span> <span class="o">+</span> <span class="mf">0.05</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">Q2</span> <span class="o">=</span> <span class="n">pow</span><span class="p">(</span> <span class="mf">10.</span><span class="p">,</span> <span class="n">log10Q2</span><span class="p">);</span>
    <span class="c1">// Evaluate old and new momentum sums.</span>
    <span class="kt">double</span> <span class="n">oldSum</span> <span class="o">=</span> <span class="n">integrate</span><span class="p">(</span> <span class="n">oldPDF</span><span class="p">,</span> <span class="n">Q2</span><span class="p">);</span>
    <span class="n">oldXSum</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">log10Q2</span><span class="p">,</span> <span class="n">oldSum</span><span class="p">);</span>
    <span class="kt">double</span> <span class="n">newSum</span> <span class="o">=</span> <span class="n">integrate</span><span class="p">(</span> <span class="n">newPDF</span><span class="p">,</span> <span class="n">Q2</span><span class="p">);</span>
    <span class="n">newXSum</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">log10Q2</span><span class="p">,</span> <span class="n">newSum</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="c1">// Show momentum sum as a function of Q2.</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">oldXSum</span> <span class="o">&lt;&lt;</span> <span class="n">newXSum</span><span class="p">;</span>
  <span class="c1">// Done.</span>
  <span class="k">delete</span> <span class="n">oldPDF</span><span class="p">;</span>
  <span class="k">delete</span> <span class="n">newPDF</span><span class="p">;</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
    </div>
  </div>
</div>

</div> <div class="well well-sm"> <h1 id="main52cc">main52.cc</h1><hr>
<div class="codehilite"><pre><span class="c1">// main52.cc is a part of the PYTHIA event generator.</span>
<span class="c1">// Copyright (C) 2016 Torbjorn Sjostrand.</span>
<span class="c1">// PYTHIA is licenced under the GNU GPL version 2, see COPYING for details.</span>
<span class="c1">// Please respect the MCnet Guidelines, see GUIDELINES for details.</span>
<span class="c1">// Studies of hadron-level and parton-level minimum-bias quantities,</span>
<span class="c1">// comparing internal default PDF with one from LHAPDF.</span>
<span class="c1">// Major differences indicate need for major retuning, e.g. pT0Ref.</span>
<span class="c1">// Access time information.</span>
</pre></div>


<div class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" href="#fileid42">Rest of the main52.cc code</a>
    </h4>
  </div>
  <div id="fileid42" class="panel-collapse collapse">
    <div class="panel-body">
<div class="codehilite"><pre><span class="cp">#include</span> <span class="cpf">&lt;ctime&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;Pythia8/Pythia.h&quot;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">Pythia8</span><span class="p">;</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Machine: 1 = Tevatron, 2 = LHC. Statistics.</span>
  <span class="kt">int</span> <span class="n">machine</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">nEvent</span>  <span class="o">=</span> <span class="mi">10000</span><span class="p">;</span>
  <span class="c1">// Select new PDF set; LHAPDF5 file name conventions.</span>
  <span class="c1">//string pdfSet = &quot;LHAPDF5:cteq5l.LHgrid&quot;;</span>
  <span class="c1">//string pdfSet = &quot;LHAPDF5:cteq61.LHpdf&quot;;</span>
  <span class="c1">//string pdfSet = &quot;LHAPDF5:cteq61.LHgrid&quot;;</span>
  <span class="c1">//string pdfSet = &quot;LHAPDF5:MRST2004nlo.LHgrid&quot;;</span>
  <span class="n">string</span> <span class="n">pdfSet</span> <span class="o">=</span> <span class="s">&quot;LHAPDF5:MRST2001lo.LHgrid&quot;</span><span class="p">;</span>
  <span class="c1">// Histograms for hadron-level quantities.</span>
  <span class="kt">double</span> <span class="n">nMax</span> <span class="o">=</span> <span class="p">(</span><span class="n">machine</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">?</span> <span class="mf">199.5</span> <span class="o">:</span> <span class="mf">399.5</span><span class="p">;</span>
  <span class="n">Hist</span> <span class="n">nChargedOld</span><span class="p">(</span><span class="s">&quot;n_charged old PDF&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">nMax</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">nChargedNew</span><span class="p">(</span><span class="s">&quot;n_charged new PDF&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">nMax</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">nChargedRat</span><span class="p">(</span><span class="s">&quot;n_charged new/old PDF&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">nMax</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">ySpecOld</span><span class="p">(</span><span class="s">&quot;y charged distribution old PDF&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.</span><span class="p">,</span> <span class="mf">10.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">ySpecNew</span><span class="p">(</span><span class="s">&quot;y charged distribution new PDF&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.</span><span class="p">,</span> <span class="mf">10.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">ySpecRat</span><span class="p">(</span><span class="s">&quot;y charged distribution new/old PDF&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.</span><span class="p">,</span> <span class="mf">10.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">pTSpecOld</span><span class="p">(</span><span class="s">&quot;pT charged distribution old PDF&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">20.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">pTSpecNew</span><span class="p">(</span><span class="s">&quot;pT charged distribution new PDF&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">20.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">pTSpecRat</span><span class="p">(</span><span class="s">&quot;pT charged distribution new/old PDF&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">20.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">avgPTnChOld</span><span class="p">(</span><span class="s">&quot;&lt;pT&gt;(n_charged) old PDF&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">nMax</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">avgPTnChNew</span><span class="p">(</span><span class="s">&quot;&lt;pT&gt;(n_charged) new PDF&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">nMax</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">avgPTnChRat</span><span class="p">(</span><span class="s">&quot;&lt;pT&gt;(n_charged) new/old PDF&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">nMax</span><span class="p">);</span>
  <span class="c1">// Histograms for parton-level quantities.</span>
  <span class="n">Hist</span> <span class="n">xDistOld</span><span class="p">(</span><span class="s">&quot;MPI log(x) distribution old PDF&quot;</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">xDistNew</span><span class="p">(</span><span class="s">&quot;MPI log(x) distribution new PDF&quot;</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">xDistRat</span><span class="p">(</span><span class="s">&quot;MPI log(x) distribution new/old PDF&quot;</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">pTDistOld</span><span class="p">(</span><span class="s">&quot;MPI pT (=Q) distribution old PDF&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">20.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">pTDistNew</span><span class="p">(</span><span class="s">&quot;MPI pT (=Q) distribution new PDF&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">20.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">pTDistRat</span><span class="p">(</span><span class="s">&quot;MPI pT (=Q) distribution new/old PDF&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">20.</span><span class="p">);</span>
  <span class="c1">// Loop over one default run and one with new PDF.</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iRun</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iRun</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">;</span> <span class="o">++</span><span class="n">iRun</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Get starting time in seconds.</span>
    <span class="kt">time_t</span> <span class="n">tBegin</span> <span class="o">=</span> <span class="n">time</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="c1">// Generator.</span>
    <span class="n">Pythia</span> <span class="n">pythia</span><span class="p">;</span>
    <span class="n">Event</span><span class="o">&amp;</span> <span class="n">event</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">;</span>
    <span class="c1">// Generate minimum-bias events, with or without double diffraction.</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;SoftQCD:nonDiffractive = on&quot;</span><span class="p">);</span>
    <span class="c1">//pythia.readString(&quot;SoftQCD:doubleDiffractive = on&quot;);</span>
    <span class="c1">// Generate QCD jet events, above some threshold.</span>
    <span class="c1">//pythia.readString(&quot;HardQCD:all = on&quot;);</span>
    <span class="c1">//pythia.readString(&quot;PhaseSpace:pTHatMin = 50.&quot;);</span>
    <span class="c1">// In second run pick new PDF set.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">iRun</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;PDF:pSet = &quot;</span> <span class="o">+</span> <span class="n">pdfSet</span><span class="p">);</span>
     <span class="c1">// Allow extrapolation of PDF&#39;s beyond x and Q2 boundaries, at own risk.</span>
     <span class="c1">// Default behaviour is to freeze PDF&#39;s at boundaries.</span>
     <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;PDF:extrapolate = on&quot;</span><span class="p">);</span>
      <span class="c1">// Need to change pT0Ref depending on choice of PDF.</span>
      <span class="c1">// One possibility: retune to same &lt;n_charged&gt;.</span>
      <span class="c1">//pythia.readString(&quot;MultipartonInteractions:pT0Ref = 2.17&quot;);</span>
    <span class="p">}</span>
    <span class="c1">// Tevatron/LHC initialization.</span>
    <span class="kt">double</span> <span class="n">eCM</span> <span class="o">=</span>  <span class="p">(</span><span class="n">machine</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">?</span> <span class="mf">1960.</span> <span class="o">:</span> <span class="mf">7000.</span><span class="p">;</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">parm</span><span class="p">(</span><span class="s">&quot;Beams:eCM&quot;</span><span class="p">,</span> <span class="n">eCM</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">machine</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Beams:idB = -2212&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
    <span class="c1">// Begin event loop.</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iEvent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iEvent</span> <span class="o">&lt;</span> <span class="n">nEvent</span><span class="p">;</span> <span class="o">++</span><span class="n">iEvent</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Generate events.  Skip if error.</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">())</span> <span class="k">continue</span><span class="p">;</span>
      <span class="c1">// Statistics on multiplicity and pT.</span>
      <span class="kt">int</span>    <span class="n">nCh</span>   <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="kt">double</span> <span class="n">pTsum</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">event</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">isFinal</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">isCharged</span><span class="p">())</span> <span class="p">{</span>
        <span class="o">++</span><span class="n">nCh</span><span class="p">;</span>
        <span class="n">pTsum</span> <span class="o">+=</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pT</span><span class="p">();</span>
        <span class="c1">// Fill histograms for charged y and pT spectra.</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">iRun</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">ySpecOld</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">y</span><span class="p">()</span> <span class="p">);</span>
          <span class="n">pTSpecOld</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pT</span><span class="p">()</span> <span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="n">ySpecNew</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">y</span><span class="p">()</span> <span class="p">);</span>
          <span class="n">pTSpecNew</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pT</span><span class="p">()</span>  <span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="c1">// Fill histograms for summed quantities.</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">iRun</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">nChargedOld</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">nCh</span> <span class="p">);</span>
        <span class="n">avgPTnChOld</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">nCh</span><span class="p">,</span> <span class="n">pTsum</span> <span class="o">/</span> <span class="n">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nCh</span><span class="p">)</span> <span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">nChargedNew</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">nCh</span> <span class="p">);</span>
        <span class="n">avgPTnChNew</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">nCh</span><span class="p">,</span> <span class="n">pTsum</span> <span class="o">/</span> <span class="n">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nCh</span><span class="p">)</span> <span class="p">);</span>
      <span class="p">}</span>
      <span class="c1">// Loop through event record and fill x of all incoming partons.</span>
      <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">event</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">status</span><span class="p">()</span> <span class="o">==</span> <span class="o">-</span><span class="mi">21</span> <span class="o">||</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">status</span><span class="p">()</span> <span class="o">==</span> <span class="o">-</span><span class="mi">31</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">double</span> <span class="n">x</span> <span class="o">=</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">e</span><span class="p">()</span> <span class="o">/</span> <span class="n">eCM</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">iRun</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="n">xDistOld</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">log10</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">);</span>
        <span class="k">else</span>           <span class="n">xDistNew</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">log10</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">);</span>
      <span class="p">}</span>
      <span class="c1">// Loop through multiparton interactions list and fill pT of all MPI&#39;s.</span>
      <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">nMPI</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">double</span> <span class="n">pT</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">pTMPI</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">iRun</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="n">pTDistOld</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">pT</span> <span class="p">);</span>
        <span class="k">else</span>           <span class="n">pTDistNew</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">pT</span> <span class="p">);</span>
      <span class="p">}</span>
    <span class="c1">// End of event loop.</span>
    <span class="p">}</span>
    <span class="c1">// Statistics.</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Stat:showPartonLevel = on&quot;</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
    <span class="c1">// Get finishing time in seconds. Print used time.</span>
    <span class="kt">time_t</span> <span class="n">tEnd</span> <span class="o">=</span> <span class="n">time</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s"> This subrun took &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">tEnd</span> <span class="o">-</span> <span class="n">tBegin</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; seconds </span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="c1">// End of loop over two runs.</span>
  <span class="p">}</span>
  <span class="c1">// Form &lt;pT&gt;(n_charged) ratios.</span>
  <span class="n">avgPTnChOld</span> <span class="o">/=</span> <span class="n">nChargedOld</span><span class="p">;</span>
  <span class="n">avgPTnChNew</span> <span class="o">/=</span> <span class="n">nChargedNew</span><span class="p">;</span>
  <span class="c1">// Take ratios of new to old distributions.</span>
  <span class="n">nChargedRat</span>  <span class="o">=</span> <span class="n">nChargedNew</span> <span class="o">/</span> <span class="n">nChargedOld</span><span class="p">;</span>
  <span class="n">ySpecRat</span>     <span class="o">=</span> <span class="n">ySpecNew</span>    <span class="o">/</span> <span class="n">ySpecOld</span><span class="p">;</span>
  <span class="n">pTSpecRat</span>    <span class="o">=</span> <span class="n">pTSpecNew</span>    <span class="o">/</span> <span class="n">pTSpecOld</span><span class="p">;</span>
  <span class="n">avgPTnChRat</span>  <span class="o">=</span> <span class="n">avgPTnChNew</span> <span class="o">/</span> <span class="n">avgPTnChOld</span><span class="p">;</span>
  <span class="n">xDistRat</span>     <span class="o">=</span> <span class="n">xDistNew</span>    <span class="o">/</span> <span class="n">xDistOld</span><span class="p">;</span>
  <span class="n">pTDistRat</span>    <span class="o">=</span> <span class="n">pTDistNew</span>   <span class="o">/</span> <span class="n">pTDistOld</span><span class="p">;</span>
  <span class="c1">// Print histograms.</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">nChargedOld</span> <span class="o">&lt;&lt;</span> <span class="n">nChargedNew</span> <span class="o">&lt;&lt;</span> <span class="n">nChargedRat</span>
       <span class="o">&lt;&lt;</span> <span class="n">ySpecOld</span>    <span class="o">&lt;&lt;</span> <span class="n">ySpecNew</span>    <span class="o">&lt;&lt;</span> <span class="n">ySpecRat</span>
       <span class="o">&lt;&lt;</span> <span class="n">pTSpecOld</span>   <span class="o">&lt;&lt;</span> <span class="n">pTSpecNew</span>   <span class="o">&lt;&lt;</span> <span class="n">pTSpecRat</span>
       <span class="o">&lt;&lt;</span> <span class="n">avgPTnChOld</span> <span class="o">&lt;&lt;</span> <span class="n">avgPTnChNew</span> <span class="o">&lt;&lt;</span> <span class="n">avgPTnChRat</span>
       <span class="o">&lt;&lt;</span> <span class="n">xDistOld</span>    <span class="o">&lt;&lt;</span> <span class="n">xDistNew</span>    <span class="o">&lt;&lt;</span> <span class="n">xDistRat</span>
       <span class="o">&lt;&lt;</span> <span class="n">pTDistOld</span>   <span class="o">&lt;&lt;</span> <span class="n">pTDistNew</span>   <span class="o">&lt;&lt;</span> <span class="n">pTDistRat</span><span class="p">;</span>
  <span class="c1">// Second part of study, as simple extra check:</span>
  <span class="c1">// Begin fill shape of effective PDF at typical MPI Q2 = 10 scale:</span>
  <span class="c1">// F_effective(x) = (9/4) x*g(x) + Sum_i (x*q_i(x) + x*qbar_i(x)).</span>
  <span class="n">Info</span> <span class="n">info</span><span class="p">;</span>
  <span class="kt">double</span> <span class="n">Q2</span> <span class="o">=</span> <span class="mf">10.</span><span class="p">;</span>
  <span class="n">PDF</span><span class="o">*</span> <span class="n">oldPDF</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CTEQ5L</span><span class="p">(</span><span class="mi">2212</span><span class="p">);</span>
  <span class="n">PDF</span><span class="o">*</span> <span class="n">newPDF</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LHAPDF</span><span class="p">(</span><span class="mi">2212</span><span class="p">,</span> <span class="n">pdfSet</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">info</span><span class="p">);</span>
  <span class="c1">// Histograms.</span>
  <span class="n">Hist</span> <span class="n">effFlinOld</span><span class="p">(</span><span class="s">&quot;F_effective( x, Q2 = 10) old&quot;</span><span class="p">,</span> <span class="mi">100</span> <span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">effFlinNew</span><span class="p">(</span><span class="s">&quot;F_effective( x, Q2 = 10) new&quot;</span><span class="p">,</span> <span class="mi">100</span> <span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">effFlinRat</span><span class="p">(</span><span class="s">&quot;F_effective( x, Q2 = 10) new/old&quot;</span><span class="p">,</span> <span class="mi">100</span> <span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">effFlogOld</span><span class="p">(</span><span class="s">&quot;F_effective( x, Q2 = 10) old&quot;</span><span class="p">,</span> <span class="mi">80</span> <span class="p">,</span> <span class="o">-</span><span class="mf">8.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">effFlogNew</span><span class="p">(</span><span class="s">&quot;F_effective( x, Q2 = 10) new&quot;</span><span class="p">,</span> <span class="mi">80</span> <span class="p">,</span> <span class="o">-</span><span class="mf">8.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">effFlogRat</span><span class="p">(</span><span class="s">&quot;F_effective( x, Q2 = 10) new/old&quot;</span><span class="p">,</span> <span class="mi">80</span> <span class="p">,</span> <span class="o">-</span><span class="mf">8.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">);</span>
  <span class="c1">// Loop over x values, in a linear scale.</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iX</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iX</span> <span class="o">&lt;</span> <span class="mi">99</span><span class="p">;</span> <span class="o">++</span><span class="n">iX</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">double</span> <span class="n">x</span> <span class="o">=</span> <span class="mf">0.005</span> <span class="o">+</span> <span class="mf">0.01</span> <span class="o">*</span> <span class="n">iX</span><span class="p">;</span>
    <span class="c1">// Evaluate old summed PDF.</span>
    <span class="kt">double</span> <span class="n">oldSum</span> <span class="o">=</span> <span class="mf">2.25</span> <span class="o">*</span> <span class="n">oldPDF</span><span class="o">-&gt;</span><span class="n">xf</span><span class="p">(</span> <span class="mi">21</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">Q2</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
      <span class="n">oldSum</span> <span class="o">+=</span> <span class="n">oldPDF</span><span class="o">-&gt;</span><span class="n">xf</span><span class="p">(</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">Q2</span><span class="p">)</span> <span class="o">+</span> <span class="n">oldPDF</span><span class="o">-&gt;</span><span class="n">xf</span><span class="p">(</span> <span class="o">-</span><span class="n">i</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">Q2</span><span class="p">);</span>
    <span class="n">effFlinOld</span><span class="p">.</span><span class="n">fill</span> <span class="p">(</span> <span class="n">x</span><span class="p">,</span> <span class="n">oldSum</span> <span class="p">);</span>
    <span class="c1">// Evaluate new summed PDF.</span>
    <span class="kt">double</span> <span class="n">newSum</span> <span class="o">=</span> <span class="mf">2.25</span> <span class="o">*</span> <span class="n">newPDF</span><span class="o">-&gt;</span><span class="n">xf</span><span class="p">(</span> <span class="mi">21</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">Q2</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
      <span class="n">newSum</span> <span class="o">+=</span> <span class="n">newPDF</span><span class="o">-&gt;</span><span class="n">xf</span><span class="p">(</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">Q2</span><span class="p">)</span> <span class="o">+</span> <span class="n">newPDF</span><span class="o">-&gt;</span><span class="n">xf</span><span class="p">(</span> <span class="o">-</span><span class="n">i</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">Q2</span><span class="p">);</span>
    <span class="n">effFlinNew</span><span class="p">.</span><span class="n">fill</span> <span class="p">(</span> <span class="n">x</span><span class="p">,</span> <span class="n">newSum</span> <span class="p">);</span>
  <span class="c1">//End loop over x values, in a linear scale.</span>
  <span class="p">}</span>
  <span class="c1">// Loop over x values, in a logarithmic scale</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iX</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iX</span> <span class="o">&lt;</span> <span class="mi">80</span><span class="p">;</span> <span class="o">++</span><span class="n">iX</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">double</span> <span class="n">xLog</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="mf">0.1</span> <span class="o">*</span> <span class="n">iX</span> <span class="o">+</span> <span class="mf">0.05</span><span class="p">);</span>
    <span class="kt">double</span> <span class="n">x</span> <span class="o">=</span> <span class="n">pow</span><span class="p">(</span> <span class="mf">10.</span><span class="p">,</span> <span class="n">xLog</span><span class="p">);</span>
    <span class="c1">// Evaluate old summed PDF.</span>
    <span class="kt">double</span> <span class="n">oldSum</span> <span class="o">=</span> <span class="mf">2.25</span> <span class="o">*</span> <span class="n">oldPDF</span><span class="o">-&gt;</span><span class="n">xf</span><span class="p">(</span> <span class="mi">21</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">Q2</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
      <span class="n">oldSum</span> <span class="o">+=</span> <span class="n">oldPDF</span><span class="o">-&gt;</span><span class="n">xf</span><span class="p">(</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">Q2</span><span class="p">)</span> <span class="o">+</span> <span class="n">oldPDF</span><span class="o">-&gt;</span><span class="n">xf</span><span class="p">(</span> <span class="o">-</span><span class="n">i</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">Q2</span><span class="p">);</span>
    <span class="n">effFlogOld</span><span class="p">.</span><span class="n">fill</span> <span class="p">(</span> <span class="n">xLog</span><span class="p">,</span> <span class="n">oldSum</span> <span class="p">);</span>
    <span class="c1">// Evaluate new summed PDF.</span>
    <span class="kt">double</span> <span class="n">newSum</span> <span class="o">=</span> <span class="mf">2.25</span> <span class="o">*</span> <span class="n">newPDF</span><span class="o">-&gt;</span><span class="n">xf</span><span class="p">(</span> <span class="mi">21</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">Q2</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
      <span class="n">newSum</span> <span class="o">+=</span> <span class="n">newPDF</span><span class="o">-&gt;</span><span class="n">xf</span><span class="p">(</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">Q2</span><span class="p">)</span> <span class="o">+</span> <span class="n">newPDF</span><span class="o">-&gt;</span><span class="n">xf</span><span class="p">(</span> <span class="o">-</span><span class="n">i</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">Q2</span><span class="p">);</span>
    <span class="n">effFlogNew</span><span class="p">.</span><span class="n">fill</span> <span class="p">(</span> <span class="n">xLog</span><span class="p">,</span> <span class="n">newSum</span> <span class="p">);</span>
  <span class="c1">//End loop over x values, in a logarithmic scale.</span>
  <span class="p">}</span>
  <span class="c1">// Take ratios of new to old distributions.</span>
  <span class="n">effFlinRat</span>   <span class="o">=</span> <span class="n">effFlinNew</span>  <span class="o">/</span> <span class="n">effFlinOld</span><span class="p">;</span>
  <span class="n">effFlogRat</span>   <span class="o">=</span> <span class="n">effFlogNew</span>  <span class="o">/</span> <span class="n">effFlogOld</span><span class="p">;</span>
  <span class="c1">// Print histograms.</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">effFlinOld</span>  <span class="o">&lt;&lt;</span> <span class="n">effFlinNew</span>  <span class="o">&lt;&lt;</span> <span class="n">effFlinRat</span>
       <span class="o">&lt;&lt;</span> <span class="n">effFlogOld</span>  <span class="o">&lt;&lt;</span> <span class="n">effFlogNew</span>  <span class="o">&lt;&lt;</span> <span class="n">effFlogRat</span><span class="p">;</span>
  <span class="c1">// Done.</span>
  <span class="k">delete</span> <span class="n">oldPDF</span><span class="p">;</span>
  <span class="k">delete</span> <span class="n">newPDF</span><span class="p">;</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
    </div>
  </div>
</div>

</div> <div class="well well-sm"> <h1 id="main53cc">main53.cc</h1><hr>
<div class="codehilite"><pre><span class="c1">// main53.cc is a part of the PYTHIA event generator.</span>
<span class="c1">// Copyright (C) 2016 Peter Skands, Torbjorn Sjostrand.</span>
<span class="c1">// PYTHIA is licenced under the GNU GPL version 2, see COPYING for details.</span>
<span class="c1">// Please respect the MCnet Guidelines, see GUIDELINES for details.</span>
<span class="c1">// This is a simple test program.</span>
<span class="c1">// It illustrates how to interface an external process with an incoming photon</span>
<span class="c1">// in a hadron beam, using the MRST2004QED PDF set.</span>
<span class="c1">// All input apart from the name of the external LHEF file is specified in the</span>
<span class="c1">// main53.cmnd file.</span>
</pre></div>


<div class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" href="#fileid43">Rest of the main53.cc code</a>
    </h4>
  </div>
  <div id="fileid43" class="panel-collapse collapse">
    <div class="panel-body">
<div class="codehilite"><pre><span class="cp">#include</span> <span class="cpf">&quot;Pythia8/Pythia.h&quot;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">Pythia8</span><span class="p">;</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Generator. Shorthand for the event.</span>
  <span class="n">Pythia</span> <span class="n">pythia</span><span class="p">;</span>
  <span class="n">Event</span><span class="o">&amp;</span> <span class="n">event</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">;</span>
  <span class="c1">// Read in commands from external file.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readFile</span><span class="p">(</span><span class="s">&quot;main53.cmnd&quot;</span><span class="p">);</span>
  <span class="c1">// Extract settings to be used in the main program.</span>
  <span class="kt">int</span> <span class="n">nEvent</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Main:numberOfEvents&quot;</span><span class="p">);</span>
  <span class="c1">// Initialize. Either of two opions, to be picked in main53.cmnd.</span>
  <span class="c1">// 1) Read in external event with incoming photon in the ME,</span>
  <span class="c1">// from pre-generated .lhe file (thanks to SANC and R. Sadykov).</span>
  <span class="c1">// 2) Use internal fermion gamma -&gt; W+- fermion&#39; process.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
  <span class="c1">// Histograms for pT distribution in gluon production vertex.</span>
  <span class="n">Hist</span> <span class="n">pTprim</span><span class="p">(</span> <span class="s">&quot;pT of photon production, no ISR&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">100.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">pTwith</span><span class="p">(</span> <span class="s">&quot;pT of photon production, with ISR&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">100.</span><span class="p">);</span>
  <span class="c1">// Begin event loop.</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iEvent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iEvent</span> <span class="o">&lt;</span> <span class="n">nEvent</span><span class="p">;</span> <span class="o">++</span><span class="n">iEvent</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Generate events. Quit if failure.</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">())</span> <span class="p">{</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// Analyze event to find branching where photon is produced.</span>
    <span class="kt">int</span> <span class="n">iGam</span> <span class="o">=</span> <span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">id</span><span class="p">()</span> <span class="o">==</span> <span class="mi">22</span><span class="p">)</span> <span class="o">?</span> <span class="mi">3</span> <span class="o">:</span> <span class="mi">4</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">iGamMother</span> <span class="o">=</span> <span class="n">iGam</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span> <span class="p">;</span> <span class="p">;</span> <span class="p">)</span> <span class="p">{</span>
      <span class="n">iGamMother</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="n">iGam</span><span class="p">].</span><span class="n">mother1</span><span class="p">();</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">iGamMother</span> <span class="o">&lt;</span> <span class="n">iGam</span> <span class="o">||</span> <span class="n">event</span><span class="p">[</span><span class="n">iGamMother</span><span class="p">].</span><span class="n">id</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">22</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
      <span class="n">iGam</span> <span class="o">=</span> <span class="n">iGamMother</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// Find and histogram pT in this branching.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">iGamMother</span> <span class="o">&lt;</span> <span class="n">iGam</span><span class="p">)</span> <span class="n">pTprim</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">event</span><span class="p">[</span><span class="n">iGam</span><span class="p">].</span><span class="n">pT</span><span class="p">()</span> <span class="p">);</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="kt">int</span> <span class="n">iQ</span> <span class="o">=</span> <span class="n">iGamMother</span><span class="p">;</span>
      <span class="kt">int</span> <span class="n">size</span> <span class="o">=</span> <span class="n">event</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
      <span class="k">do</span> <span class="o">++</span><span class="n">iQ</span><span class="p">;</span>
      <span class="k">while</span> <span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="n">iQ</span><span class="p">].</span><span class="n">status</span><span class="p">()</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">43</span> <span class="o">&amp;&amp;</span> <span class="n">iQ</span> <span class="o">&lt;</span> <span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="n">iQ</span><span class="p">].</span><span class="n">status</span><span class="p">()</span> <span class="o">==</span> <span class="o">-</span><span class="mi">43</span><span class="p">)</span> <span class="n">pTwith</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">event</span><span class="p">[</span><span class="n">iQ</span><span class="p">].</span><span class="n">pT</span><span class="p">()</span> <span class="p">);</span>
    <span class="p">}</span>
  <span class="c1">// End of event loop.</span>
  <span class="p">}</span>
  <span class="c1">// Final statistics and histogram output.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">pTprim</span> <span class="o">&lt;&lt;</span> <span class="n">pTwith</span><span class="p">;</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
    </div>
  </div>
</div>

</div> <div class="well well-sm"> <h1 id="main54cc">main54.cc</h1><hr>
<div class="codehilite"><pre><span class="c1">// main54.cc is a part of the PYTHIA event generator.</span>
<span class="c1">// Copyright (C) 2016 Torbjorn Sjostrand.</span>
<span class="c1">// PYTHIA is licenced under the GNU GPL version 2, see COPYING for details.</span>
<span class="c1">// Please respect the MCnet Guidelines, see GUIDELINES for details.</span>
<span class="c1">// This program compares the internal and LHAPDF implementations of the</span>
<span class="c1">// NNPDF 2.3 QCD+QED sets, for results and for timing.</span>
<span class="c1">// Author: Juan Rojo.</span>
</pre></div>


<div class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" href="#fileid44">Rest of the main54.cc code</a>
    </h4>
  </div>
  <div id="fileid44" class="panel-collapse collapse">
    <div class="panel-body">
<div class="codehilite"><pre><span class="cp">#include</span> <span class="cpf">&quot;Pythia8/Pythia.h&quot;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">Pythia8</span><span class="p">;</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">&quot;</span><span class="se">\n</span><span class="s"> NNPDF2.3 QED LO phenomenology </span><span class="se">\n</span><span class="s"> &quot;</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">&quot;</span><span class="se">\n</span><span class="s"> Check access to NNPDF2.3 LO QED sets </span><span class="se">\n</span><span class="s"> &quot;</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
  <span class="c1">// Generator.</span>
  <span class="n">Pythia</span> <span class="n">pythia</span><span class="p">;</span>
  <span class="c1">// Access the PDFs.</span>
  <span class="kt">int</span> <span class="n">idBeamIn</span> <span class="o">=</span> <span class="mi">2212</span><span class="p">;</span>
  <span class="n">string</span> <span class="n">xmlPath</span> <span class="o">=</span> <span class="s">&quot;../xmldoc/&quot;</span><span class="p">;</span>
  <span class="n">Info</span> <span class="n">info</span><span class="p">;</span>
  <span class="c1">// Grid of studied points.</span>
  <span class="n">string</span> <span class="n">xpdf</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;x*g&quot;</span><span class="p">,</span><span class="s">&quot;x*d&quot;</span><span class="p">,</span><span class="s">&quot;x*u&quot;</span><span class="p">,</span><span class="s">&quot;x*s&quot;</span><span class="p">};</span>
  <span class="kt">double</span> <span class="n">xlha</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="mf">1e-5</span><span class="p">,</span> <span class="mf">1e-1</span><span class="p">};</span>
  <span class="kt">double</span> <span class="n">Q2</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">10000.0</span> <span class="p">};</span>
  <span class="n">string</span> <span class="n">setName</span><span class="p">;</span>
  <span class="n">string</span> <span class="n">setName_lha</span><span class="p">;</span>
  <span class="c1">// For timing checks.</span>
  <span class="kt">int</span> <span class="k">const</span> <span class="n">nq</span> <span class="o">=</span> <span class="mi">200</span><span class="p">;</span>
  <span class="kt">int</span> <span class="k">const</span> <span class="n">nx</span> <span class="o">=</span> <span class="mi">200</span><span class="p">;</span>
  <span class="c1">// Loop over all internal PDF sets in Pythia8</span>
  <span class="c1">// and compare with their LHAPDF5 correspondents.</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iFitIn</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span> <span class="n">iFitIn</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="n">iFitIn</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Constructor for internal PDFs.</span>
    <span class="n">NNPDF</span> <span class="n">pdfs_nnpdf</span><span class="p">(</span> <span class="n">idBeamIn</span><span class="p">,</span> <span class="n">iFitIn</span><span class="p">,</span> <span class="n">xmlPath</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">info</span><span class="p">);</span>
    <span class="c1">// Constructor for LHAPDF.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">iFitIn</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="n">setName</span> <span class="o">=</span> <span class="s">&quot;LHAPDF5:NNPDF23_nlo_as_0119_qed.LHgrid&quot;</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">iFitIn</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span> <span class="n">setName</span> <span class="o">=</span> <span class="s">&quot;LHAPDF5:NNPDF23_nnlo_as_0119_qed.LHgrid&quot;</span><span class="p">;</span>
    <span class="n">LHAPDF</span> <span class="n">pdfs_nnpdf_lha</span><span class="p">(</span> <span class="n">idBeamIn</span><span class="p">,</span> <span class="n">setName</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">info</span><span class="p">);</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s"> PDF set = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">setName</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; </span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="c1">// Check quarks and gluons.</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">f</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">f</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="n">f</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iq</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iq</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">;</span> <span class="n">iq</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;  &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">xpdf</span><span class="p">[</span><span class="n">f</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;, Q2 = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">Q2</span><span class="p">[</span><span class="n">iq</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;   x </span><span class="se">\t</span><span class="s">     Pythia8</span><span class="se">\t</span><span class="s">   LHAPDF</span><span class="se">\t</span><span class="s">   diff(%) &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">ix</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">ix</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">;</span> <span class="n">ix</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="kt">double</span> <span class="n">a</span> <span class="o">=</span> <span class="n">pdfs_nnpdf</span><span class="p">.</span><span class="n">xf</span><span class="p">(</span> <span class="n">f</span><span class="p">,</span> <span class="n">xlha</span><span class="p">[</span><span class="n">ix</span><span class="p">],</span> <span class="n">Q2</span><span class="p">[</span><span class="n">iq</span><span class="p">]);</span>
          <span class="kt">double</span> <span class="n">b</span> <span class="o">=</span> <span class="n">pdfs_nnpdf_lha</span><span class="p">.</span><span class="n">xf</span><span class="p">(</span> <span class="n">f</span><span class="p">,</span> <span class="n">xlha</span><span class="p">[</span><span class="n">ix</span><span class="p">],</span> <span class="n">Q2</span><span class="p">[</span><span class="n">iq</span><span class="p">]);</span>
          <span class="kt">double</span> <span class="n">diff</span> <span class="o">=</span> <span class="mf">1e2</span> <span class="o">*</span> <span class="n">fabs</span><span class="p">((</span><span class="n">a</span><span class="o">-</span><span class="n">b</span><span class="p">)</span><span class="o">/</span><span class="n">b</span><span class="p">);</span>
          <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">scientific</span> <span class="o">&lt;&lt;</span> <span class="n">xlha</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">a</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">b</span>
               <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">diff</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
          <span class="k">if</span> <span class="p">(</span><span class="n">diff</span> <span class="o">&gt;</span> <span class="mf">1e-8</span><span class="p">)</span> <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="c1">// Check photon.</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s"> Now checking the photon PDF </span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iq</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iq</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">;</span> <span class="n">iq</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;  &quot;</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;x*gamma&quot;</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;, Q2 = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">Q2</span><span class="p">[</span><span class="n">iq</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;   x </span><span class="se">\t</span><span class="s">     Pythia8</span><span class="se">\t</span><span class="s"> LHAPDF</span><span class="se">\t</span><span class="s"> diff(%)&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">ix</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">ix</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">;</span> <span class="n">ix</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">double</span> <span class="n">a</span> <span class="o">=</span> <span class="n">pdfs_nnpdf</span><span class="p">.</span><span class="n">xf</span><span class="p">(</span> <span class="mi">22</span><span class="p">,</span> <span class="n">xlha</span><span class="p">[</span><span class="n">ix</span><span class="p">],</span> <span class="n">Q2</span><span class="p">[</span><span class="n">iq</span><span class="p">]);</span>
        <span class="kt">double</span> <span class="n">b</span> <span class="o">=</span> <span class="n">pdfs_nnpdf_lha</span><span class="p">.</span><span class="n">xf</span><span class="p">(</span> <span class="mi">22</span><span class="p">,</span> <span class="n">xlha</span><span class="p">[</span><span class="n">ix</span><span class="p">],</span> <span class="n">Q2</span><span class="p">[</span><span class="n">iq</span><span class="p">]);</span>
        <span class="kt">double</span> <span class="n">diff</span> <span class="o">=</span> <span class="mf">1e2</span> <span class="o">*</span> <span class="n">fabs</span><span class="p">((</span><span class="n">a</span><span class="o">-</span><span class="n">b</span><span class="p">)</span><span class="o">/</span><span class="n">b</span><span class="p">);</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">scientific</span> <span class="o">&lt;&lt;</span> <span class="n">xlha</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">a</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">b</span>
             <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">diff</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">diff</span> <span class="o">&gt;</span> <span class="mf">1e-8</span><span class="p">)</span> <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="c1">// Now check the timings for evolution.</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s"> Checking timings &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="kt">clock_t</span> <span class="n">t1</span> <span class="o">=</span> <span class="n">clock</span><span class="p">();</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">f</span> <span class="o">=</span> <span class="o">-</span><span class="mi">4</span><span class="p">;</span> <span class="n">f</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="n">f</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iq</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iq</span> <span class="o">&lt;</span> <span class="n">nq</span><span class="p">;</span> <span class="n">iq</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">double</span> <span class="n">qq2</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">pow</span><span class="p">(</span> <span class="mf">1e6</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span> <span class="kt">double</span><span class="p">(</span><span class="n">iq</span><span class="p">)</span><span class="o">/</span><span class="n">nq</span><span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">ix</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">ix</span> <span class="o">&lt;</span> <span class="n">nx</span><span class="p">;</span> <span class="n">ix</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="kt">double</span> <span class="n">xx</span> <span class="o">=</span> <span class="mf">1e-6</span> <span class="o">*</span> <span class="n">pow</span><span class="p">(</span> <span class="mf">9e-1</span> <span class="o">/</span> <span class="mf">1e-6</span><span class="p">,</span> <span class="kt">double</span><span class="p">(</span><span class="n">ix</span><span class="p">)</span><span class="o">/</span><span class="n">nx</span><span class="p">);</span>
          <span class="n">pdfs_nnpdf</span><span class="p">.</span><span class="n">xf</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">xx</span><span class="p">,</span><span class="n">qq2</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="kt">clock_t</span> <span class="n">t2</span> <span class="o">=</span> <span class="n">clock</span><span class="p">();</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; NNPDF internal timing = &quot;</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">t2</span><span class="o">-</span><span class="n">t1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">CLOCKS_PER_SEC</span>
         <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="n">t1</span><span class="o">=</span><span class="n">clock</span><span class="p">();</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">f</span> <span class="o">=</span> <span class="o">-</span><span class="mi">4</span><span class="p">;</span> <span class="n">f</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="n">f</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iq</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iq</span> <span class="o">&lt;</span> <span class="n">nq</span><span class="p">;</span> <span class="n">iq</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">double</span> <span class="n">qq2</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">pow</span><span class="p">(</span><span class="mf">1e6</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span> <span class="kt">double</span><span class="p">(</span><span class="n">iq</span><span class="p">)</span><span class="o">/</span><span class="n">nq</span><span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">ix</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">ix</span> <span class="o">&lt;</span> <span class="n">nx</span><span class="p">;</span> <span class="n">ix</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="kt">double</span> <span class="n">xx</span> <span class="o">=</span> <span class="mf">1e-6</span> <span class="o">*</span> <span class="n">pow</span><span class="p">(</span> <span class="mf">9e-1</span> <span class="o">/</span> <span class="mf">1e-6</span><span class="p">,</span> <span class="kt">double</span><span class="p">(</span><span class="n">ix</span><span class="p">)</span><span class="o">/</span><span class="n">nx</span><span class="p">);</span>
          <span class="n">pdfs_nnpdf_lha</span><span class="p">.</span><span class="n">xf</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">xx</span><span class="p">,</span><span class="n">qq2</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">t2</span><span class="o">=</span><span class="n">clock</span><span class="p">();</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; NNPDF LHAPDF   timing = &quot;</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">t2</span><span class="o">-</span><span class="n">t1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">CLOCKS_PER_SEC</span>
         <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="p">}</span> <span class="c1">// End loop over NNPDF internal sets</span>
  <span class="c1">// Done.</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s"> Checked that LHAPDF and Internal Pythia8 give identical&quot;</span>
       <span class="o">&lt;&lt;</span> <span class="s">&quot; results</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
    </div>
  </div>
</div>

</div> <div class="well well-sm"> <h1 id="main61cc">main61.cc</h1><hr>
<div class="codehilite"><pre><span class="c1">// main61.cc is a part of the PYTHIA event generator.</span>
<span class="c1">// Copyright (C) 2016 Torbjorn Sjostrand.</span>
<span class="c1">// PYTHIA is licenced under the GNU GPL version 2, see COPYING for details.</span>
<span class="c1">// Please respect the MCnet Guidelines, see GUIDELINES for details.</span>
<span class="c1">// Author: Christine O. Rasmussen.</span>
<span class="c1">// The y, pT, x_Pomeron and t distributions for forward Z bosons at the LHC,</span>
<span class="c1">// within the hard diffraction framework for an inclusive event sample.</span>
<span class="c1">// Tests the impact of successive requirements.</span>
</pre></div>


<div class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" href="#fileid45">Rest of the main61.cc code</a>
    </h4>
  </div>
  <div id="fileid45" class="panel-collapse collapse">
    <div class="panel-body">
<div class="codehilite"><pre><span class="cp">#include</span> <span class="cpf">&quot;Pythia8/Pythia.h&quot;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">Pythia8</span><span class="p">;</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Create Pythia instance. Shorthand for event and info.</span>
  <span class="n">Pythia</span> <span class="n">pythia</span><span class="p">;</span>
  <span class="n">Event</span><span class="o">&amp;</span> <span class="n">event</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">;</span>
  <span class="n">Info</span><span class="o">&amp;</span>  <span class="n">info</span>  <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">;</span>
  <span class="c1">// Set it up to generate Z&#39;s at 8 TeV.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Beams:eCM = 8000.&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;WeakSingleBoson:ffbar2gmZ = on&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;23:mMin = 70.&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;23:mMax = 110.&quot;</span><span class="p">);</span>
  <span class="c1">// Setup of diffractive framework.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Diffraction:doHard = on&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Diffraction:sampleType = 1&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Diffraction:PomFlux = 5&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;PDF:PomSet = 6&quot;</span><span class="p">);</span>
  <span class="c1">// Simplify printout.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Init:showChangedSettings = off&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Init:showChangedParticleData = off&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Init:showMultipartonInteractions = off&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Next:numberShowInfo = 0&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Next:numberShowProcess = 0&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Next:numberShowEvent = 0&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Next:showScaleAndVertex = off&quot;</span><span class="p">);</span>
  <span class="c1">// Switch off hadronization, since not used here.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;HadronLevel:all = off&quot;</span><span class="p">);</span>
  <span class="c1">// Initialize.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
  <span class="c1">// Collect information on the number of diffractive events</span>
  <span class="kt">int</span> <span class="n">maxEvent</span>      <span class="o">=</span> <span class="mi">10000</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">nDiffA</span>        <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">nDiffB</span>        <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">nReducedDiffA</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">nReducedDiffB</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="c1">// Histograms.</span>
  <span class="n">Hist</span> <span class="n">y0</span><span class="p">(</span><span class="s">&quot;dN/dy inclusive&quot;</span><span class="p">,</span>               <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.</span><span class="p">,</span>   <span class="mf">5.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">y1</span><span class="p">(</span><span class="s">&quot;dN/dy after PDF selection&quot;</span><span class="p">,</span>     <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.</span><span class="p">,</span>   <span class="mf">5.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">y2</span><span class="p">(</span><span class="s">&quot;dN/dy after MPI selection&quot;</span><span class="p">,</span>     <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.</span><span class="p">,</span>   <span class="mf">5.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">pT0</span><span class="p">(</span><span class="s">&quot;dN/dpTZ inclusive&quot;</span><span class="p">,</span>            <span class="mi">100</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span> <span class="mf">100.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">pT1</span><span class="p">(</span><span class="s">&quot;dN/dpTZ after PDF selection&quot;</span><span class="p">,</span>  <span class="mi">100</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span> <span class="mf">100.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">pT2</span><span class="p">(</span><span class="s">&quot;dN/dpTZ after MPI selection&quot;</span><span class="p">,</span>  <span class="mi">100</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span> <span class="mf">100.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">xP1</span><span class="p">(</span><span class="s">&quot;dN/dxPom after PDF selection&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span>   <span class="mf">1.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">xP2</span><span class="p">(</span><span class="s">&quot;dN/dxPom after MPI selection&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span>   <span class="mf">1.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">tP1</span><span class="p">(</span><span class="s">&quot;dN/dt after PDF selection&quot;</span><span class="p">,</span>    <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">tP2</span><span class="p">(</span><span class="s">&quot;dN/dt after MPI selection&quot;</span><span class="p">,</span>    <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.</span><span class="p">,</span>   <span class="mf">0.</span><span class="p">);</span>
  <span class="c1">// Begin event loop. Generate event; skip if generation failed.</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iEvent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iEvent</span> <span class="o">&lt;</span> <span class="n">maxEvent</span><span class="p">;</span> <span class="o">++</span><span class="n">iEvent</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">())</span> <span class="k">continue</span><span class="p">;</span>
    <span class="c1">// Locate the Z0 and find its y and pT.</span>
    <span class="kt">int</span> <span class="n">iZ</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">event</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">id</span><span class="p">()</span> <span class="o">==</span> <span class="mi">23</span><span class="p">)</span> <span class="n">iZ</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">yZ</span>  <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="n">iZ</span><span class="p">].</span><span class="n">y</span><span class="p">();</span>
    <span class="kt">double</span> <span class="n">pTZ</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="n">iZ</span><span class="p">].</span><span class="n">pT</span><span class="p">();</span>
    <span class="n">y0</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">yZ</span> <span class="p">);</span>
    <span class="n">pT0</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">pTZ</span> <span class="p">);</span>
    <span class="c1">// Find diffractive events. Histogram y and pT.</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">info</span><span class="p">.</span><span class="n">isHardDiffractiveA</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">||</span> <span class="n">info</span><span class="p">.</span><span class="n">isHardDiffractiveB</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">y1</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">yZ</span> <span class="p">);</span>
      <span class="n">pT1</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">pTZ</span> <span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">nMPI</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">y2</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">yZ</span> <span class="p">);</span>
        <span class="n">pT2</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">pTZ</span> <span class="p">);</span>
      <span class="p">}</span>
      <span class="c1">// Statistics and histogram on x_Pomeron and t.</span>
      <span class="k">if</span> <span class="p">(</span> <span class="n">info</span><span class="p">.</span><span class="n">isHardDiffractiveA</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="o">++</span><span class="n">nDiffA</span><span class="p">;</span>
        <span class="n">xP1</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">info</span><span class="p">.</span><span class="n">xPomeronB</span><span class="p">()</span> <span class="p">);</span>
        <span class="n">tP1</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">info</span><span class="p">.</span><span class="n">tPomeronB</span><span class="p">()</span> <span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">nMPI</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
          <span class="o">++</span><span class="n">nReducedDiffA</span><span class="p">;</span>
          <span class="n">xP2</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">info</span><span class="p">.</span><span class="n">xPomeronB</span><span class="p">()</span> <span class="p">);</span>
          <span class="n">tP2</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">info</span><span class="p">.</span><span class="n">tPomeronB</span><span class="p">()</span> <span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="n">info</span><span class="p">.</span><span class="n">isHardDiffractiveB</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="o">++</span><span class="n">nDiffB</span><span class="p">;</span>
        <span class="n">xP1</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">info</span><span class="p">.</span><span class="n">xPomeronA</span><span class="p">()</span> <span class="p">);</span>
        <span class="n">tP1</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">info</span><span class="p">.</span><span class="n">tPomeronA</span><span class="p">()</span> <span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">nMPI</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
          <span class="o">++</span><span class="n">nReducedDiffB</span><span class="p">;</span>
          <span class="n">xP2</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">info</span><span class="p">.</span><span class="n">xPomeronA</span><span class="p">()</span> <span class="p">);</span>
          <span class="n">tP2</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">info</span><span class="p">.</span><span class="n">tPomeronA</span><span class="p">()</span> <span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="c1">// End of event loop. Statistics on event generation.</span>
  <span class="p">}</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
  <span class="c1">// Statistics on diffraction.</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Side A is MPI-unchecked diffractive : &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">nDiffA</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Side A is MPI-checked diffractive   : &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">nReducedDiffA</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Side B is MPI-unchecked diffractive : &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">nDiffB</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Side B is MPI-checked diffractive   : &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">nReducedDiffB</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Total MPI-unchecked diffractive events : &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">fixed</span>
       <span class="o">&lt;&lt;</span> <span class="n">setprecision</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">nDiffA</span> <span class="o">+</span> <span class="n">nDiffB</span><span class="p">)</span> <span class="o">/</span> <span class="kt">double</span><span class="p">(</span><span class="n">maxEvent</span><span class="p">)</span> <span class="o">*</span> <span class="mf">100.</span>
       <span class="o">&lt;&lt;</span> <span class="s">&quot;%&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Total MPI-checked diffractive events : &quot;</span>
       <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">nReducedDiffA</span> <span class="o">+</span> <span class="n">nReducedDiffB</span><span class="p">)</span> <span class="o">/</span> <span class="kt">double</span><span class="p">(</span><span class="n">maxEvent</span><span class="p">)</span> <span class="o">*</span> <span class="mf">100.</span>
       <span class="o">&lt;&lt;</span> <span class="s">&quot;%&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="c1">// Histograms.</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">y0</span> <span class="o">&lt;&lt;</span> <span class="n">y1</span> <span class="o">&lt;&lt;</span> <span class="n">y2</span> <span class="o">&lt;&lt;</span> <span class="n">pT0</span> <span class="o">&lt;&lt;</span> <span class="n">pT1</span> <span class="o">&lt;&lt;</span> <span class="n">pT2</span> <span class="o">&lt;&lt;</span> <span class="n">xP1</span> <span class="o">&lt;&lt;</span> <span class="n">xP2</span> <span class="o">&lt;&lt;</span> <span class="n">tP1</span> <span class="o">&lt;&lt;</span> <span class="n">tP2</span><span class="p">;</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
    </div>
  </div>
</div>

</div> <div class="well well-sm"> <h1 id="main62cc">main62.cc</h1><hr>
<div class="codehilite"><pre><span class="c1">// main62.cc is a part of the PYTHIA event generator.</span>
<span class="c1">// Copyright (C) 2016 Torbjorn Sjostrand.</span>
<span class="c1">// PYTHIA is licenced under the GNU GPL version 2, see COPYING for details.</span>
<span class="c1">// Please respect the MCnet Guidelines, see GUIDELINES for details.</span>
<span class="c1">// Example how you can use UserHooks to set angular decay distributions</span>
<span class="c1">// for undecayed resonances from Les Houches input using the polarization</span>
<span class="c1">// information of the boson defined in its rest frame.</span>
</pre></div>


<div class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" href="#fileid46">Rest of the main62.cc code</a>
    </h4>
  </div>
  <div id="fileid46" class="panel-collapse collapse">
    <div class="panel-body">
<div class="codehilite"><pre><span class="cp">#include</span> <span class="cpf">&quot;Pythia8/Pythia.h&quot;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">Pythia8</span><span class="p">;</span>
<span class="c1">//==========================================================================</span>
<span class="c1">// Book a histogram to test the angular distribution in the UserHook.</span>
<span class="c1">// It is booked here so that it is global.</span>
<span class="n">Hist</span> <span class="nf">cosRaw</span><span class="p">(</span><span class="s">&quot;cos(the*)</span> <span class="n">raw</span><span class="s">&quot;,100,-1.,1.)</span><span class="p">;</span>
<span class="c1">//==========================================================================</span>
<span class="c1">// Write own derived UserHooks class.</span>
<span class="c1">// Assumptions in this particular case:</span>
<span class="c1">// The W+- bosons were undecayed in the Les Houches Events input file,</span>
<span class="c1">// and subsequently decayed isotropically by the Pythia machinery.</span>
<span class="c1">// Now the angular distribution will be corrected for each W,</span>
<span class="c1">// based on the polarization value stored in the LHEF.</span>
<span class="c1">// For W- this is (1 -+ cos(theta))^2 for +-1, sin^2(theta) for 0,</span>
<span class="c1">// and isotropic for 9. For W+ it is flipped (i.e. theta-&gt;pi-theta).</span>
<span class="c1">// The Pythia decay products (i.e. the branching ratios) are retained.</span>
<span class="k">class</span> <span class="nc">MyUserHooks</span> <span class="o">:</span> <span class="k">public</span> <span class="n">UserHooks</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="c1">// Constructor can set helicity definition. Destructor does nothing.</span>
  <span class="n">MyUserHooks</span><span class="p">(</span><span class="n">Info</span><span class="o">*</span> <span class="n">infoPtrIn</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">inputOption</span> <span class="o">=</span> <span class="nb">true</span><span class="p">)</span>
    <span class="o">:</span> <span class="n">infoPtr</span><span class="p">(</span><span class="n">infoPtrIn</span><span class="p">),</span> <span class="n">helicityDefinedByMother</span><span class="p">(</span><span class="n">inputOption</span><span class="p">)</span> <span class="p">{}</span>
  <span class="o">~</span><span class="n">MyUserHooks</span><span class="p">()</span> <span class="p">{}</span>
  <span class="c1">// Allow a veto for the process level, to gain access to decays.</span>
  <span class="kt">bool</span> <span class="n">canVetoProcessLevel</span><span class="p">()</span> <span class="p">{</span><span class="k">return</span> <span class="nb">true</span><span class="p">;}</span>
  <span class="c1">// Access the event after resonance decays.</span>
  <span class="kt">bool</span> <span class="n">doVetoProcessLevel</span><span class="p">(</span><span class="n">Event</span><span class="o">&amp;</span> <span class="n">process</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Identify decayed W+- bosons for study.</span>
    <span class="c1">// Assume isotropic decay if polarization is unphysically big (|pol|&gt;2)</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">process</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">process</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">idAbs</span><span class="p">()</span> <span class="o">==</span> <span class="mi">24</span> <span class="o">&amp;&amp;</span> <span class="n">process</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">status</span><span class="p">()</span> <span class="o">==</span> <span class="o">-</span><span class="mi">22</span>
          <span class="o">&amp;&amp;</span> <span class="n">abs</span><span class="p">(</span><span class="n">process</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pol</span><span class="p">())</span> <span class="o">&lt;</span> <span class="mf">2.</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Pick decay angles according to desired distribution</span>
        <span class="c1">// based on polarization and particle/antiparticle.</span>
        <span class="kt">double</span> <span class="n">cosThe</span> <span class="o">=</span> <span class="n">selectAngle</span><span class="p">(</span> <span class="n">process</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pol</span><span class="p">(),</span> <span class="n">process</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">id</span><span class="p">()</span> <span class="p">);</span>
        <span class="c1">// Accumulate the raw angular distribution.</span>
        <span class="n">cosRaw</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">cosThe</span> <span class="p">);</span>
        <span class="kt">double</span> <span class="n">sinThe</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">pow2</span><span class="p">(</span><span class="n">cosThe</span><span class="p">));</span>
        <span class="kt">double</span> <span class="n">phi</span>    <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">M_PI</span> <span class="o">*</span> <span class="n">rndmPtr</span><span class="o">-&gt;</span><span class="n">flat</span><span class="p">();</span>
        <span class="c1">// Identify W+- daughters, properly ordered.</span>
        <span class="kt">int</span> <span class="n">idV</span> <span class="o">=</span> <span class="n">process</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">id</span><span class="p">();</span>
        <span class="kt">int</span> <span class="n">i1</span>  <span class="o">=</span> <span class="n">process</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">daughter1</span><span class="p">();</span>
        <span class="kt">int</span> <span class="n">i2</span>  <span class="o">=</span> <span class="n">process</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">daughter2</span><span class="p">();</span>
        <span class="c1">// The current distributions are for the particle with the</span>
        <span class="c1">// same charge sign as the mother, i.e. W- -&gt; e-.</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">process</span><span class="p">[</span><span class="n">i1</span><span class="p">].</span><span class="n">id</span><span class="p">()</span> <span class="o">*</span> <span class="n">idV</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="n">swap</span><span class="p">(</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">);</span>
        <span class="c1">// Set up decay in rest frame of W+-.</span>
        <span class="kt">double</span> <span class="n">mV</span> <span class="o">=</span> <span class="n">process</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">m</span><span class="p">();</span>
        <span class="kt">double</span> <span class="n">m1</span> <span class="o">=</span> <span class="n">process</span><span class="p">[</span><span class="n">i1</span><span class="p">].</span><span class="n">m</span><span class="p">();</span>
        <span class="kt">double</span> <span class="n">m2</span> <span class="o">=</span> <span class="n">process</span><span class="p">[</span><span class="n">i2</span><span class="p">].</span><span class="n">m</span><span class="p">();</span>
        <span class="c1">// Energy and absolute momentum of first decay product in W rest frame.</span>
        <span class="kt">double</span> <span class="n">e1</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span> <span class="p">(</span><span class="n">pow2</span><span class="p">(</span><span class="n">mV</span><span class="p">)</span> <span class="o">+</span> <span class="n">pow2</span><span class="p">(</span><span class="n">m1</span><span class="p">)</span> <span class="o">-</span> <span class="n">pow2</span><span class="p">(</span><span class="n">m2</span><span class="p">))</span><span class="o">/</span><span class="n">mV</span><span class="p">;</span>
        <span class="kt">double</span> <span class="n">pA</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">pow2</span><span class="p">(</span><span class="n">e1</span><span class="p">)</span> <span class="o">-</span> <span class="n">pow2</span><span class="p">(</span><span class="n">m1</span><span class="p">));</span>
        <span class="c1">// Four-vectors for the two decay products.</span>
        <span class="n">Vec4</span> <span class="nf">p1</span><span class="p">(</span> <span class="n">pA</span> <span class="o">*</span> <span class="n">sinThe</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">),</span> <span class="n">pA</span> <span class="o">*</span><span class="n">sinThe</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">),</span>
          <span class="n">pA</span> <span class="o">*</span> <span class="n">cosThe</span><span class="p">,</span> <span class="n">e1</span><span class="p">);</span>
        <span class="n">Vec4</span> <span class="n">p2</span>   <span class="o">=</span> <span class="n">Vec4</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">mV</span><span class="p">)</span> <span class="o">-</span> <span class="n">p1</span><span class="p">;</span>
        <span class="c1">// Reference four-vector for helicity definition.</span>
        <span class="n">Vec4</span> <span class="n">pM</span><span class="p">;</span>
        <span class="c1">// Helicity is defined in the mother frame.</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">helicityDefinedByMother</span> <span class="p">)</span> <span class="p">{</span>
          <span class="n">pM</span> <span class="o">=</span> <span class="n">process</span><span class="p">[</span><span class="n">process</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">mother1</span><span class="p">()].</span><span class="n">p</span><span class="p">();</span>
        <span class="c1">// Helicity is defined in the process CMS frame.</span>
        <span class="c1">// This is the convention for MadGraph.</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="n">pM</span> <span class="o">=</span> <span class="n">Vec4</span><span class="p">(</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">infoPtr</span><span class="o">-&gt;</span><span class="n">mHat</span><span class="p">());</span>
        <span class="p">}</span>
        <span class="c1">// Angular reference axis defined as opposite the mother</span>
        <span class="c1">// direction in W rest frame.</span>
        <span class="n">pM</span><span class="p">.</span><span class="n">bstback</span><span class="p">(</span> <span class="n">process</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">p</span><span class="p">()</span> <span class="p">);</span>
        <span class="n">pM</span><span class="p">.</span><span class="n">flip3</span><span class="p">();</span>
        <span class="n">RotBstMatrix</span> <span class="n">Mrotbst</span><span class="p">;</span>
        <span class="n">Mrotbst</span><span class="p">.</span><span class="n">rot</span><span class="p">(</span> <span class="n">pM</span><span class="p">);</span>
        <span class="c1">// Rotate and boost W decay products.</span>
        <span class="n">Mrotbst</span><span class="p">.</span><span class="n">bst</span><span class="p">(</span> <span class="n">process</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">p</span><span class="p">()</span> <span class="p">);</span>
        <span class="n">p1</span><span class="p">.</span><span class="n">rotbst</span><span class="p">(</span><span class="n">Mrotbst</span><span class="p">);</span>
        <span class="n">p2</span><span class="p">.</span><span class="n">rotbst</span><span class="p">(</span><span class="n">Mrotbst</span><span class="p">);</span>
        <span class="n">process</span><span class="p">[</span><span class="n">i1</span><span class="p">].</span><span class="n">p</span><span class="p">(</span> <span class="n">p1</span> <span class="p">);</span>
        <span class="n">process</span><span class="p">[</span><span class="n">i2</span><span class="p">].</span><span class="n">p</span><span class="p">(</span> <span class="n">p2</span> <span class="p">);</span>
      <span class="p">}</span>
      <span class="c1">// End of loop over W&#39;s. Do not veto any events.</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// Select polar angle for the W decay.</span>
  <span class="kt">double</span> <span class="n">selectAngle</span><span class="p">(</span> <span class="kt">double</span> <span class="n">inputSpin</span><span class="p">,</span> <span class="kt">double</span> <span class="n">inputId</span> <span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Set up initial angles.</span>
    <span class="kt">double</span> <span class="n">rdNow</span> <span class="o">=</span> <span class="n">rndmPtr</span><span class="o">-&gt;</span><span class="n">flat</span><span class="p">();</span>
    <span class="kt">double</span> <span class="n">cosThe</span><span class="p">;</span>
    <span class="c1">// Small number to distinguish -1, 1, and 0 with round-off.</span>
    <span class="kt">double</span> <span class="n">eps</span> <span class="o">=</span> <span class="mf">1e-10</span><span class="p">;</span>
    <span class="c1">// W+ distribution is &quot;opposite&quot; of W-.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">inputId</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="n">inputSpin</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="c1">// Different decay angular distributions.</span>
    <span class="c1">// 3/8 * (1 - cos(theta))^2  ++</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">inputSpin</span> <span class="o">&gt;</span> <span class="n">eps</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">cosThe</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">pow</span><span class="p">(</span><span class="n">rdNow</span><span class="p">,</span> <span class="mf">1.</span><span class="o">/</span><span class="mf">3.</span><span class="p">),</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">);</span>
    <span class="c1">// 3/8 * (1 + cos(theta))^2  --</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">inputSpin</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">eps</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">cosThe</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">pow</span><span class="p">(</span><span class="n">rdNow</span><span class="p">,</span> <span class="mf">1.</span><span class="o">/</span><span class="mf">3.</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">,</span>  <span class="mf">1.0</span><span class="p">);</span>
    <span class="c1">// 3/4 * sin(theta)^2        00</span>
    <span class="c1">// Solution of cubic equation that yields the correct result.</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="kt">double</span> <span class="n">theA</span> <span class="o">=</span> <span class="p">(</span><span class="n">acos</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">rdNow</span><span class="p">)</span> <span class="o">+</span> <span class="mf">4.0</span> <span class="o">*</span> <span class="n">M_PI</span><span class="p">)</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">;</span>
      <span class="n">cosThe</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">theA</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="c1">// Return the selected cos(theta) value.</span>
    <span class="k">return</span> <span class="n">cosThe</span><span class="p">;</span>
  <span class="p">}</span>
<span class="k">private</span><span class="o">:</span>
  <span class="n">Info</span><span class="o">*</span> <span class="n">infoPtr</span><span class="p">;</span>
   <span class="c1">// bool to define the frame for helicity.</span>
  <span class="kt">bool</span> <span class="n">helicityDefinedByMother</span><span class="p">;</span>
<span class="p">};</span>
<span class="c1">//==========================================================================</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Generator. Shorthand for the event.</span>
  <span class="n">Pythia</span> <span class="n">pythia</span><span class="p">;</span>
  <span class="n">Event</span><span class="o">&amp;</span> <span class="n">event</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">;</span>
  <span class="c1">// Set up to do a user veto and send it in. Initialize.</span>
  <span class="c1">//  Use this line for CMS definition of helicity.</span>
  <span class="c1">//  MyUserHooks* myUserHooks = new MyUserHooks(&amp;pythia.info,false);</span>
  <span class="c1">// Default constructor uses mother frame for helicity.</span>
  <span class="n">MyUserHooks</span><span class="o">*</span> <span class="n">myUserHooks</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MyUserHooks</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">setUserHooksPtr</span><span class="p">(</span> <span class="n">myUserHooks</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readFile</span><span class="p">(</span><span class="s">&quot;main62.cmnd&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
  <span class="c1">// Histograms.</span>
  <span class="n">Hist</span> <span class="n">polarization</span><span class="p">(</span><span class="s">&quot;W polarization&quot;</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.9</span><span class="p">,</span> <span class="mf">9.9</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">cosPlus</span><span class="p">(</span> <span class="s">&quot;cos(theta) W- -&gt; f&quot;</span><span class="p">,</span>    <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">cosMinus</span><span class="p">(</span><span class="s">&quot;cos(theta) W+ -&gt; fbar&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">energy</span><span class="p">(</span><span class="s">&quot;daughter energy in W rest frame&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">);</span>
  <span class="c1">// Extract settings to be used in the main program.</span>
  <span class="kt">int</span> <span class="n">nEvent</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Main:numberOfEvents&quot;</span><span class="p">);</span>
  <span class="c1">// Begin event loop.</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iEvent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iEvent</span> <span class="o">&lt;</span> <span class="n">nEvent</span><span class="p">;</span> <span class="o">++</span><span class="n">iEvent</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Generate events.</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
    <span class="c1">// Loop through event, looking for a W and its daughters.</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">event</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Select W boson when it decays to two partons,</span>
      <span class="c1">// not when it is a recoil in FSR.</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">idAbs</span><span class="p">()</span> <span class="o">==</span> <span class="mi">24</span>
          <span class="o">&amp;&amp;</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">daughter1</span><span class="p">()</span> <span class="o">!=</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">daughter2</span><span class="p">()</span> <span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">i1</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">daughter1</span><span class="p">();</span>
        <span class="c1">// Angular distribution is defined with respect to the decay product</span>
        <span class="c1">// with the same sign charge as the W boson.</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="n">i1</span><span class="p">].</span><span class="n">id</span><span class="p">()</span> <span class="o">*</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">id</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="n">i1</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">daughter2</span><span class="p">();</span>
        <span class="c1">// Reconstruct W+- decay angle by boosting daughter and mother to W</span>
        <span class="c1">// rest frame. W direction in mother rest frame opposite to mother now.</span>
        <span class="n">RotBstMatrix</span> <span class="n">Mrotbst</span><span class="p">;</span>
        <span class="n">Mrotbst</span><span class="p">.</span><span class="n">bstback</span><span class="p">(</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">p</span><span class="p">()</span> <span class="p">);</span>
        <span class="n">Vec4</span> <span class="n">p1</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="n">i1</span><span class="p">].</span><span class="n">p</span><span class="p">();</span>
        <span class="n">p1</span><span class="p">.</span><span class="n">rotbst</span><span class="p">(</span> <span class="n">Mrotbst</span> <span class="p">);</span>
        <span class="n">Vec4</span> <span class="n">pM</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">mother1</span><span class="p">()].</span><span class="n">p</span><span class="p">();</span>
        <span class="n">pM</span><span class="p">.</span><span class="n">rotbst</span><span class="p">(</span> <span class="n">Mrotbst</span> <span class="p">);</span>
        <span class="n">pM</span><span class="p">.</span><span class="n">flip3</span><span class="p">();</span>
        <span class="kt">double</span> <span class="n">costhe</span> <span class="o">=</span> <span class="n">costheta</span><span class="p">(</span> <span class="n">p1</span><span class="p">,</span> <span class="n">pM</span> <span class="p">);</span>
        <span class="c1">// Histogram information.</span>
        <span class="n">polarization</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pol</span><span class="p">()</span> <span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">id</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="n">cosPlus</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">costhe</span> <span class="p">);</span>
        <span class="k">else</span>                    <span class="n">cosMinus</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">costhe</span> <span class="p">);</span>
        <span class="n">energy</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">p1</span><span class="p">.</span><span class="n">e</span><span class="p">()</span> <span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="c1">// End of event loop.</span>
  <span class="p">}</span>
  <span class="c1">// Statistics. Histograms.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">polarization</span> <span class="o">&lt;&lt;</span> <span class="n">cosPlus</span> <span class="o">&lt;&lt;</span> <span class="n">cosMinus</span> <span class="o">&lt;&lt;</span> <span class="n">energy</span> <span class="o">&lt;&lt;</span> <span class="n">cosRaw</span><span class="p">;</span>
  <span class="c1">// Done.</span>
  <span class="k">delete</span> <span class="n">myUserHooks</span><span class="p">;</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
    </div>
  </div>
</div>

</div> <div class="well well-sm"> <h1 id="main63cc">main63.cc</h1><hr>
<div class="codehilite"><pre><span class="c1">// main63.cc is a part of the PYTHIA event generator.</span>
<span class="c1">// Copyright (C) 2016 Torbjorn Sjostrand.</span>
<span class="c1">// PYTHIA is licenced under the GNU GPL version 2, see COPYING for details.</span>
<span class="c1">// Please respect the MCnet Guidelines, see GUIDELINES for details.</span>
<span class="c1">// Example how you can use UserHooks to enhance rare emission rates,</span>
<span class="c1">// in this case q -&gt; q gamma.</span>
<span class="c1">// To concentrate on the photons from the showers, MPI and hadronization</span>
<span class="c1">// are switched off by default.</span>
</pre></div>


<div class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" href="#fileid47">Rest of the main63.cc code</a>
    </h4>
  </div>
  <div id="fileid47" class="panel-collapse collapse">
    <div class="panel-body">
<div class="codehilite"><pre><span class="cp">#include</span> <span class="cpf">&quot;Pythia8/Pythia.h&quot;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">Pythia8</span><span class="p">;</span>
<span class="c1">//==========================================================================</span>
<span class="c1">// Write own derived UserHooks class.</span>
<span class="k">class</span> <span class="nc">EnhanceHooks</span> <span class="o">:</span> <span class="k">public</span> <span class="n">UserHooks</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="c1">// Constructor and destructor do nothing.</span>
  <span class="n">EnhanceHooks</span><span class="p">()</span> <span class="p">{}</span>
  <span class="o">~</span><span class="n">EnhanceHooks</span><span class="p">()</span> <span class="p">{}</span>
  <span class="c1">// Enhance real-emission rate. Thus no trial-emission enhancement.</span>
  <span class="kt">bool</span> <span class="n">canEnhanceEmission</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="nb">true</span><span class="p">;}</span>
  <span class="kt">bool</span> <span class="n">canEnhanceTrial</span><span class="p">()</span>    <span class="p">{</span> <span class="k">return</span> <span class="nb">false</span><span class="p">;}</span>
  <span class="c1">// Function to return the weight enhance factor.</span>
  <span class="kt">double</span> <span class="n">enhanceFactor</span><span class="p">(</span><span class="n">string</span> <span class="n">name</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">name</span> <span class="o">==</span> <span class="s">&quot;isr:Q2QA&quot;</span><span class="p">)</span> <span class="k">return</span> <span class="mf">50.</span><span class="p">;</span>
    <span class="k">return</span> <span class="mf">1.0</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// Function to return the vetoing probability.</span>
  <span class="kt">double</span> <span class="n">vetoProbability</span><span class="p">(</span><span class="n">string</span> <span class="n">name</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">name</span> <span class="o">==</span> <span class="s">&quot;isr:Q2QA&quot;</span><span class="p">)</span> <span class="k">return</span> <span class="mf">0.5</span><span class="p">;</span>
    <span class="k">return</span> <span class="mf">0.0</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span>
<span class="c1">//==========================================================================</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Histogram pT spectrum of photons and event weights.</span>
  <span class="n">Hist</span> <span class="n">gamNoEnh</span><span class="p">(</span>   <span class="s">&quot;gamma pT spectrum, no enhancement&quot;</span><span class="p">,</span>   <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">100.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">gamWithEnh</span><span class="p">(</span> <span class="s">&quot;gamma pT spectrum, with enhancement&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">100.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">gamRatio</span><span class="p">(</span><span class="s">&quot;gamma pT spectrum, with/no enhancement&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">100.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">gamBefWt</span><span class="p">(</span>   <span class="s">&quot;gamma pT spectrum, without weight&quot;</span><span class="p">,</span>   <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">100.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">eventWt</span><span class="p">(</span>    <span class="s">&quot;log10(event weight)&quot;</span><span class="p">,</span>                 <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">);</span>
  <span class="c1">// Compare generation without and with enhanced q -&gt; q gamma emission.</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iCase</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iCase</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">;</span> <span class="o">++</span><span class="n">iCase</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Generator.</span>
    <span class="n">Pythia</span> <span class="n">pythia</span><span class="p">;</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readFile</span><span class="p">(</span><span class="s">&quot;main63.cmnd&quot;</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">nEvent</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Main:numberOfEvents&quot;</span><span class="p">);</span>
    <span class="c1">// Set up a user hook and send it in.</span>
    <span class="n">UserHooks</span><span class="o">*</span> <span class="n">enhanceHooks</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">iCase</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">enhanceHooks</span> <span class="o">=</span> <span class="k">new</span> <span class="n">EnhanceHooks</span><span class="p">();</span>
      <span class="n">pythia</span><span class="p">.</span><span class="n">setUserHooksPtr</span><span class="p">(</span> <span class="n">enhanceHooks</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="c1">// LHC initialization.</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
    <span class="c1">// Begin event loop.</span>
    <span class="kt">double</span> <span class="n">sumWt</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iEvent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iEvent</span> <span class="o">&lt;</span> <span class="n">nEvent</span><span class="p">;</span> <span class="o">++</span><span class="n">iEvent</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Generate events. Find and histogram event weight.</span>
      <span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
      <span class="kt">double</span> <span class="n">weight</span> <span class="o">=</span> <span class="p">(</span><span class="n">iCase</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="o">?</span> <span class="n">enhanceHooks</span><span class="o">-&gt;</span><span class="n">getEnhancedEventWeight</span><span class="p">()</span> <span class="o">:</span> <span class="mf">1.</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">iCase</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="n">eventWt</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">log10</span><span class="p">(</span><span class="n">weight</span><span class="p">)</span> <span class="p">);</span>
      <span class="n">sumWt</span> <span class="o">+=</span> <span class="n">weight</span><span class="p">;</span>
      <span class="c1">// Find all final-state photons and histogram them.</span>
      <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">isFinal</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">id</span><span class="p">()</span> <span class="o">==</span> <span class="mi">22</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">double</span> <span class="n">pT</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pT</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">iCase</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="n">gamNoEnh</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span>   <span class="n">pT</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">iCase</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="n">gamBefWt</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span>   <span class="n">pT</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">iCase</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="n">gamWithEnh</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">pT</span><span class="p">,</span> <span class="n">weight</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="c1">// End of event loop.</span>
    <span class="p">}</span>
    <span class="c1">// Statistics.</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s"> Average event weight = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">scientific</span>
         <span class="o">&lt;&lt;</span> <span class="n">sumWt</span> <span class="o">/</span> <span class="n">nEvent</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="c1">// End of case loop.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">iCase</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="k">delete</span> <span class="n">enhanceHooks</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// Write histograms to output stream.</span>
  <span class="n">gamRatio</span> <span class="o">=</span> <span class="n">gamWithEnh</span> <span class="o">/</span> <span class="n">gamNoEnh</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">gamNoEnh</span> <span class="o">&lt;&lt;</span> <span class="n">gamWithEnh</span> <span class="o">&lt;&lt;</span> <span class="n">gamRatio</span> <span class="o">&lt;&lt;</span> <span class="n">gamBefWt</span> <span class="o">&lt;&lt;</span> <span class="n">eventWt</span><span class="p">;</span>
  <span class="c1">// Write histogram data to files.</span>
  <span class="n">ofstream</span> <span class="n">write</span><span class="p">;</span>
  <span class="n">write</span><span class="p">.</span><span class="n">open</span><span class="p">(</span><span class="s">&quot;PTA_0&quot;</span><span class="p">);</span>
  <span class="n">gamNoEnh</span><span class="p">.</span><span class="n">table</span><span class="p">(</span><span class="n">write</span><span class="p">);</span>
  <span class="n">write</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
  <span class="n">write</span><span class="p">.</span><span class="n">open</span><span class="p">(</span><span class="s">&quot;PTA_1&quot;</span><span class="p">);</span>
  <span class="n">gamWithEnh</span><span class="p">.</span><span class="n">table</span><span class="p">(</span><span class="n">write</span><span class="p">);</span>
  <span class="n">write</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
  <span class="c1">// Done.</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
    </div>
  </div>
</div>

</div> <div class="well well-sm"> <h1 id="main64cc">main64.cc</h1><hr>
<div class="codehilite"><pre><span class="c1">// main64.cc is a part of the PYTHIA event generator.</span>
<span class="c1">// Copyright (C) 2016 Torbjorn Sjostrand.</span>
<span class="c1">// PYTHIA is licenced under the GNU GPL version 2, see COPYING for details.</span>
<span class="c1">// Please respect the MCnet Guidelines, see GUIDELINES for details.</span>
<span class="c1">// This is a simple test program. It shows how PYTHIA 8 can write</span>
<span class="c1">// a Les Houches Event File v. 3.0 based on its process-level events.</span>
</pre></div>


<div class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" href="#fileid48">Rest of the main64.cc code</a>
    </h4>
  </div>
  <div id="fileid48" class="panel-collapse collapse">
    <div class="panel-body">
<div class="codehilite"><pre><span class="cp">#include</span> <span class="cpf">&quot;Pythia8/Pythia.h&quot;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">Pythia8</span><span class="p">;</span>
<span class="c1">//==========================================================================</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Set up for external input of LHEF 3.0 events.</span>
  <span class="n">Pythia</span> <span class="n">pythia</span><span class="p">;</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Beams:frameType = 4&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Beams:LHEF = wbj_lhef3.lhe&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
  <span class="c1">// Create and open file for LHEF 3.0 output.</span>
  <span class="n">LHEF3FromPythia8</span> <span class="n">myLHEF3</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">,</span>
    <span class="o">&amp;</span><span class="n">pythia</span><span class="p">.</span><span class="n">particleData</span><span class="p">);</span>
  <span class="n">myLHEF3</span><span class="p">.</span><span class="n">openLHEF</span><span class="p">(</span><span class="s">&quot;weakbosons.lhe&quot;</span><span class="p">);</span>
  <span class="c1">// Write out initialization info on the file.</span>
  <span class="n">myLHEF3</span><span class="p">.</span><span class="n">setInit</span><span class="p">();</span>
  <span class="c1">// Event generation loop.</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iEvent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iEvent</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="o">++</span><span class="n">iEvent</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Generate next event.</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">())</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">atEndOfFile</span><span class="p">()</span> <span class="p">)</span> <span class="k">break</span><span class="p">;</span>
      <span class="k">else</span> <span class="k">continue</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// Store and write event info.</span>
    <span class="n">myLHEF3</span><span class="p">.</span><span class="n">setEvent</span><span class="p">();</span>
  <span class="p">}</span> <span class="c1">// End loop over events to generate.</span>
  <span class="c1">// Statistics: full printout.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
  <span class="c1">// Write endtag. Overwrite initialization info with new cross sections.</span>
  <span class="n">myLHEF3</span><span class="p">.</span><span class="n">closeLHEF</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
  <span class="c1">// Done.</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
    </div>
  </div>
</div>

</div> <div class="well well-sm"> <h1 id="main71cc">main71.cc</h1><hr>
<div class="codehilite"><pre><span class="c1">// main71.cc is a part of the PYTHIA event generator.</span>
<span class="c1">// Copyright (C) 2016 Richard Corke.</span>
<span class="c1">// PYTHIA is licenced under the GNU GPL version 2, see COPYING for details.</span>
<span class="c1">// Please respect the MCnet Guidelines, see GUIDELINES for details.</span>
<span class="cm">/*</span>
<span class="cm"> * Simple example of fastjet analysis. Roughly follows analysis of:</span>
<span class="cm"> * T. Aaltonen et al. [CDF Collaboration],</span>
<span class="cm"> * Measurement of the cross section for W-boson production in association</span>
<span class="cm"> * with jets in ppbar collisions at sqrt(s)=1.96$ TeV</span>
<span class="cm"> * Phys. Rev. D 77 (2008) 011108</span>
<span class="cm"> * arXiv:0711.4044 [hep-ex]</span>
<span class="cm"> *</span>
<span class="cm"> * Cuts:</span>
<span class="cm"> *   ET(elec)     &gt; 20GeV</span>
<span class="cm"> *   |eta(elec)|  &lt; 1.1</span>
<span class="cm"> *   ET(missing)  &gt; 30GeV</span>
<span class="cm"> *   ET(jet)      &gt; 20GeV</span>
<span class="cm"> *   |eta(jet)|   &lt; 2.0</span>
<span class="cm"> *   deltaR(elec, jet) &gt; 0.52</span>
<span class="cm"> * Not used:</span>
<span class="cm"> *   mT(W)        &gt; 20GeV</span>
<span class="cm"> */</span>
</pre></div>


<div class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" href="#fileid49">Rest of the main71.cc code</a>
    </h4>
  </div>
  <div id="fileid49" class="panel-collapse collapse">
    <div class="panel-body">
<div class="codehilite"><pre><span class="cp">#include</span> <span class="cpf">&quot;Pythia8/Pythia.h&quot;</span><span class="cp"></span>
<span class="c1">// This is the minimal interface needed to access FastJet.</span>
<span class="c1">// A more sophisticated interface is demonstrated in main72.cc.</span>
<span class="cp">#include</span> <span class="cpf">&quot;fastjet/PseudoJet.hh&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;fastjet/ClusterSequence.hh&quot;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">Pythia8</span><span class="p">;</span>
<span class="c1">// Experimental cross section</span>
<span class="c1">// sigma(W -&gt; ev + &gt;= n-jet; ET(n&#39;th-jet) &gt; 25GeV), n = 0, 1, 2, 3, 4</span>
<span class="k">const</span> <span class="kt">double</span> <span class="n">expCrossSec</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="mf">798.0</span><span class="p">,</span> <span class="mf">53.5</span><span class="p">,</span> <span class="mf">6.8</span><span class="p">,</span> <span class="mf">0.84</span><span class="p">,</span> <span class="mf">0.074</span> <span class="p">};</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Settings</span>
  <span class="kt">int</span>  <span class="n">nEvent</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">;</span>
  <span class="kt">bool</span> <span class="n">doMPI</span>  <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
  <span class="c1">// Generator</span>
  <span class="n">Pythia</span> <span class="n">pythia</span><span class="p">;</span>
  <span class="c1">// Single W production</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;WeakSingleBoson:ffbar2W = on&quot;</span><span class="p">);</span>
  <span class="c1">// Force decay W-&gt;ev</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;24:onMode = off&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;24:onIfAny = 11 12&quot;</span><span class="p">);</span>
  <span class="c1">// Multiparton Interactions</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">doMPI</span> <span class="o">==</span> <span class="nb">false</span><span class="p">)</span> <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;PartonLevel:MPI = off&quot;</span><span class="p">);</span>
  <span class="c1">// Initialisation, p pbar @ 1.96 TeV</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Beams:idB = -2212&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Beams:eCM = 1960.&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
  <span class="c1">// Histograms</span>
  <span class="n">Hist</span> <span class="n">dSigma1</span><span class="p">(</span><span class="s">&quot;1-jet cross-section (E_jet1 &gt; 20 GeV)&quot;</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">350.0</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">dSigma2</span><span class="p">(</span><span class="s">&quot;2-jet cross-section (E_jet2 &gt; 20 GeV)&quot;</span><span class="p">,</span> <span class="mi">38</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">190.0</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">dSigma3</span><span class="p">(</span><span class="s">&quot;3-jet cross-section (E_jet3 &gt; 20 GeV)&quot;</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">80.0</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">dSigma4</span><span class="p">(</span><span class="s">&quot;4-jet cross-section (E_jet4 &gt; 20 GeV)&quot;</span><span class="p">,</span>  <span class="mi">7</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">35.0</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="o">*</span><span class="n">dSigmaHist</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dSigma1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dSigma2</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dSigma3</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dSigma4</span> <span class="p">};</span>
  <span class="kt">double</span> <span class="n">dSigmaBin</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">350.0</span> <span class="o">/</span> <span class="mf">70.0</span><span class="p">,</span> <span class="mf">190.0</span> <span class="o">/</span> <span class="mf">38.0</span><span class="p">,</span>
                          <span class="mf">80.0</span> <span class="o">/</span> <span class="mf">16.0</span><span class="p">,</span> <span class="mf">35.0</span> <span class="o">/</span> <span class="mf">7.0</span> <span class="p">};</span>
  <span class="c1">// Fastjet analysis - select algorithm and parameters</span>
  <span class="kt">double</span> <span class="n">Rparam</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">;</span>
  <span class="n">fastjet</span><span class="o">::</span><span class="n">Strategy</span>               <span class="n">strategy</span> <span class="o">=</span> <span class="n">fastjet</span><span class="o">::</span><span class="n">Best</span><span class="p">;</span>
  <span class="n">fastjet</span><span class="o">::</span><span class="n">RecombinationScheme</span>    <span class="n">recombScheme</span> <span class="o">=</span> <span class="n">fastjet</span><span class="o">::</span><span class="n">E_scheme</span><span class="p">;</span>
  <span class="n">fastjet</span><span class="o">::</span><span class="n">JetDefinition</span>         <span class="o">*</span><span class="n">jetDef</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
  <span class="n">jetDef</span> <span class="o">=</span> <span class="k">new</span> <span class="n">fastjet</span><span class="o">::</span><span class="n">JetDefinition</span><span class="p">(</span><span class="n">fastjet</span><span class="o">::</span><span class="n">kt_algorithm</span><span class="p">,</span> <span class="n">Rparam</span><span class="p">,</span>
                                      <span class="n">recombScheme</span><span class="p">,</span> <span class="n">strategy</span><span class="p">);</span>
  <span class="c1">// Fastjet input</span>
  <span class="n">std</span><span class="o">::</span><span class="n">vector</span> <span class="o">&lt;</span><span class="n">fastjet</span><span class="o">::</span><span class="n">PseudoJet</span><span class="o">&gt;</span> <span class="n">fjInputs</span><span class="p">;</span>
  <span class="c1">// Statistics for later</span>
  <span class="kt">int</span> <span class="n">nEventAccept25</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">};</span>
  <span class="kt">int</span> <span class="n">vetoCount</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">};</span>
  <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">vetoStr</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&quot;ET(elec)&quot;</span><span class="p">,</span> <span class="s">&quot;|eta(elec)|&quot;</span><span class="p">,</span>
                            <span class="s">&quot;ET(missing)&quot;</span><span class="p">,</span> <span class="s">&quot;deltaR(elec, jet)&quot;</span> <span class="p">};</span>
  <span class="kt">bool</span> <span class="n">firstEvent</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
  <span class="c1">// Begin event loop. Generate event. Skip if error.</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iEvent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iEvent</span> <span class="o">&lt;</span> <span class="n">nEvent</span><span class="p">;</span> <span class="o">++</span><span class="n">iEvent</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">())</span> <span class="k">continue</span><span class="p">;</span>
    <span class="c1">// Need to find the electron from the W decay - cheat a bit here</span>
    <span class="c1">// and find it from the W in the event record</span>
    <span class="kt">int</span> <span class="n">idxW</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">idAbs</span><span class="p">()</span> <span class="o">==</span> <span class="mi">24</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">idxW</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">idxW</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Error: Could not find W&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
      <span class="k">continue</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// Find the electron from the W decay</span>
    <span class="kt">int</span> <span class="n">idxElec</span> <span class="o">=</span> <span class="n">idxW</span><span class="p">;</span>
    <span class="k">while</span><span class="p">(</span><span class="nb">true</span><span class="p">)</span> <span class="p">{</span>
      <span class="kt">int</span> <span class="n">daughter</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">idxElec</span><span class="p">].</span><span class="n">daughter1</span><span class="p">();</span>
      <span class="k">if</span>   <span class="p">(</span><span class="n">daughter</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
      <span class="k">else</span>                 <span class="n">idxElec</span> <span class="o">=</span> <span class="n">daughter</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">idxElec</span><span class="p">].</span><span class="n">idAbs</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">11</span> <span class="o">||</span>
       <span class="o">!</span><span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">idxElec</span><span class="p">].</span><span class="n">isFinal</span><span class="p">())</span> <span class="p">{</span>
      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Error: Found incorrect decay product of the W&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
      <span class="k">continue</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// Electron cuts</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">idxElec</span><span class="p">].</span><span class="n">pT</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">20.0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">vetoCount</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
      <span class="k">continue</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">idxElec</span><span class="p">].</span><span class="n">eta</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mf">1.1</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">vetoCount</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
      <span class="k">continue</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// Reset Fastjet input</span>
    <span class="n">fjInputs</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="c1">// Keep track of missing ET</span>
    <span class="n">Vec4</span> <span class="n">missingETvec</span><span class="p">;</span>
    <span class="c1">// Loop over event record to decide what to pass to FastJet</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Final state only</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">isFinal</span><span class="p">())</span>        <span class="k">continue</span><span class="p">;</span>
      <span class="c1">// No neutrinos</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">idAbs</span><span class="p">()</span> <span class="o">==</span> <span class="mi">12</span> <span class="o">||</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">idAbs</span><span class="p">()</span> <span class="o">==</span> <span class="mi">14</span> <span class="o">||</span>
          <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">idAbs</span><span class="p">()</span> <span class="o">==</span> <span class="mi">16</span><span class="p">)</span>     <span class="k">continue</span><span class="p">;</span>
      <span class="c1">// Only |eta| &lt; 3.6</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">fabs</span><span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">eta</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mf">3.6</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
      <span class="c1">// Missing ET</span>
      <span class="n">missingETvec</span> <span class="o">+=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">p</span><span class="p">();</span>
      <span class="c1">// Do not include the electron from the W decay</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">idxElec</span><span class="p">)</span>                      <span class="k">continue</span><span class="p">;</span>
      <span class="c1">// Store as input to Fastjet</span>
      <span class="n">fjInputs</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span> <span class="n">fastjet</span><span class="o">::</span><span class="n">PseudoJet</span><span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">px</span><span class="p">(),</span>
        <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">py</span><span class="p">(),</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pz</span><span class="p">(),</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">e</span><span class="p">()</span> <span class="p">)</span> <span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">fjInputs</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Error: event with no final state particles&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
      <span class="k">continue</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// Run Fastjet algorithm</span>
    <span class="n">vector</span> <span class="o">&lt;</span><span class="n">fastjet</span><span class="o">::</span><span class="n">PseudoJet</span><span class="o">&gt;</span> <span class="n">inclusiveJets</span><span class="p">,</span> <span class="n">sortedJets</span><span class="p">;</span>
    <span class="n">fastjet</span><span class="o">::</span><span class="n">ClusterSequence</span> <span class="n">clustSeq</span><span class="p">(</span><span class="n">fjInputs</span><span class="p">,</span> <span class="o">*</span><span class="n">jetDef</span><span class="p">);</span>
    <span class="c1">// For the first event, print the FastJet details</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">firstEvent</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Ran &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">jetDef</span><span class="o">-&gt;</span><span class="n">description</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Strategy adopted by FastJet was &quot;</span>
           <span class="o">&lt;&lt;</span> <span class="n">clustSeq</span><span class="p">.</span><span class="n">strategy_string</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
      <span class="n">firstEvent</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// Extract inclusive jets sorted by pT (note minimum pT of 20.0 GeV)</span>
    <span class="n">inclusiveJets</span> <span class="o">=</span> <span class="n">clustSeq</span><span class="p">.</span><span class="n">inclusive_jets</span><span class="p">(</span><span class="mf">20.0</span><span class="p">);</span>
    <span class="n">sortedJets</span>    <span class="o">=</span> <span class="n">sorted_by_pt</span><span class="p">(</span><span class="n">inclusiveJets</span><span class="p">);</span>
    <span class="c1">// Missing ET cut</span>
    <span class="kt">double</span> <span class="n">missingET</span> <span class="o">=</span> <span class="n">missingETvec</span><span class="p">.</span><span class="n">pT</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">missingET</span> <span class="o">&lt;</span> <span class="mf">30.0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">vetoCount</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
      <span class="k">continue</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// Keep track of jets with pT &gt; 20/25 GeV</span>
    <span class="kt">int</span>  <span class="n">jetCount20</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">jetCount25</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="c1">// For the deltaR calculation below</span>
    <span class="kt">bool</span> <span class="n">vetoEvent</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="n">fastjet</span><span class="o">::</span><span class="n">PseudoJet</span> <span class="n">fjElec</span><span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">idxElec</span><span class="p">].</span><span class="n">px</span><span class="p">(),</span>
                              <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">idxElec</span><span class="p">].</span><span class="n">py</span><span class="p">(),</span>
                              <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">idxElec</span><span class="p">].</span><span class="n">pz</span><span class="p">(),</span>
                              <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">idxElec</span><span class="p">].</span><span class="n">e</span><span class="p">());</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">sortedJets</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Only count jets that have |eta| &lt; 2.0</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">fabs</span><span class="p">(</span><span class="n">sortedJets</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">rap</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mf">2.0</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
      <span class="c1">// Check distance between W decay electron and jets</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">fjElec</span><span class="p">.</span><span class="n">squared_distance</span><span class="p">(</span><span class="n">sortedJets</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mf">0.52</span> <span class="o">*</span> <span class="mf">0.52</span><span class="p">)</span>
        <span class="p">{</span> <span class="n">vetoEvent</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span> <span class="p">}</span>
      <span class="c1">// Fill dSigma histograms and count jets with ET &gt; 25.0</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">sortedJets</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">perp</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">25.0</span><span class="p">)</span>
        <span class="n">jetCount25</span><span class="o">++</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">jetCount20</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">dSigmaHist</span><span class="p">[</span><span class="o">++</span><span class="n">jetCount20</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">fill</span><span class="p">(</span><span class="n">sortedJets</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">perp</span><span class="p">());</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">vetoEvent</span><span class="p">)</span> <span class="p">{</span> <span class="n">vetoCount</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">++</span><span class="p">;</span> <span class="k">continue</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">jetCount25</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="n">jetCount25</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">jetCount25</span><span class="p">;</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">--</span><span class="p">)</span>
      <span class="n">nEventAccept25</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="c1">// End of event loop.</span>
  <span class="p">}</span>
  <span class="c1">// Statistics</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
  <span class="c1">// Output histograms</span>
  <span class="kt">double</span> <span class="n">sigmapb</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">sigmaGen</span><span class="p">()</span> <span class="o">*</span> <span class="mf">1.0E9</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">4</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="p">(</span><span class="o">*</span><span class="n">dSigmaHist</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">=</span> <span class="p">((</span><span class="o">*</span><span class="n">dSigmaHist</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">sigmapb</span><span class="p">)</span> <span class="o">/</span> <span class="n">nEvent</span> <span class="o">/</span> <span class="n">dSigmaBin</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">dSigma1</span> <span class="o">&lt;&lt;</span> <span class="n">dSigma2</span> <span class="o">&lt;&lt;</span> <span class="n">dSigma3</span> <span class="o">&lt;&lt;</span> <span class="n">dSigma4</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="c1">// Output cross-sections</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Jet algorithm is kT&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Multiparton interactions are switched &quot;</span>
       <span class="o">&lt;&lt;</span> <span class="p">(</span> <span class="p">(</span><span class="n">doMPI</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot;on&quot;</span> <span class="o">:</span> <span class="s">&quot;off&quot;</span> <span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">nEvent</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; events generated. &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">nEventAccept25</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
       <span class="o">&lt;&lt;</span> <span class="s">&quot; events passed cuts.&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Vetos:&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;  &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">vetoStr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">vetoCount</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Inclusive cross-sections (pb):&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">scientific</span> <span class="o">&lt;&lt;</span> <span class="n">setprecision</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot;  &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;-jet - Pythia = &quot;</span>
         <span class="o">&lt;&lt;</span> <span class="p">((</span><span class="kt">double</span><span class="p">)</span> <span class="n">nEventAccept25</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span> <span class="n">nEvent</span><span class="p">)</span> <span class="o">*</span> <span class="n">sigmapb</span><span class="p">;</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;, Experimental = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">expCrossSec</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">scientific</span> <span class="o">&lt;&lt;</span> <span class="n">setprecision</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
           <span class="o">&lt;&lt;</span> <span class="s">&quot;, Pythia ratio to &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;-jet = &quot;</span>
           <span class="o">&lt;&lt;</span> <span class="p">((</span><span class="kt">double</span><span class="p">)</span> <span class="n">nEventAccept25</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span> <span class="n">nEventAccept25</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]);</span>
      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">scientific</span> <span class="o">&lt;&lt;</span> <span class="n">setprecision</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
           <span class="o">&lt;&lt;</span> <span class="s">&quot;, Experimental ratio to &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;-jet = &quot;</span>
           <span class="o">&lt;&lt;</span> <span class="n">expCrossSec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">expCrossSec</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// Done.</span>
  <span class="k">delete</span> <span class="n">jetDef</span><span class="p">;</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
    </div>
  </div>
</div>

</div> <div class="well well-sm"> <h1 id="main72cc">main72.cc</h1><hr>
<div class="codehilite"><pre><span class="c1">// main72.cc is a part of the PYTHIA event generator.</span>
<span class="c1">// Copyright (C) 2016 Torbjorn Sjostrand.</span>
<span class="c1">// PYTHIA is licenced under the GNU GPL version 2, see COPYING for details.</span>
<span class="c1">// Please respect the MCnet Guidelines, see GUIDELINES for details.</span>
<span class="c1">// This is a simple test program.</span>
<span class="c1">// It compares SlowJet, FJcore and FastJet, showing that they</span>
<span class="c1">// find the same jets.</span>
</pre></div>


<div class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" href="#fileid50">Rest of the main72.cc code</a>
    </h4>
  </div>
  <div id="fileid50" class="panel-collapse collapse">
    <div class="panel-body">
<div class="codehilite"><pre><span class="cp">#include</span> <span class="cpf">&quot;Pythia8/Pythia.h&quot;</span><span class="cp"></span>
<span class="c1">// The FastJet3.h header enables automatic initialisation of</span>
<span class="c1">// fastjet::PseudoJet objects from Pythia8 Particle and Vec4 objects,</span>
<span class="c1">// as well as advanced features such as access to (a copy of)</span>
<span class="c1">// the original Pythia 8 Particle directly from the PseudoJet,</span>
<span class="c1">// and fastjet selectors that make use of the Particle properties.</span>
<span class="c1">// See the extensive comments in the header file for further details</span>
<span class="c1">// and examples.</span>
<span class="cp">#include</span> <span class="cpf">&quot;Pythia8Plugins/FastJet3.h&quot;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">Pythia8</span><span class="p">;</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Number of events, generated and listed ones (for jets).</span>
  <span class="kt">int</span> <span class="n">nEvent</span>    <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">nListJets</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
  <span class="c1">// Select common parameters for SlowJet and FastJet analyses.</span>
  <span class="kt">int</span>    <span class="n">power</span>   <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>     <span class="c1">// -1 = anti-kT; 0 = C/A; 1 = kT.</span>
  <span class="kt">double</span> <span class="n">R</span>       <span class="o">=</span> <span class="mf">0.7</span><span class="p">;</span>    <span class="c1">// Jet size.</span>
  <span class="kt">double</span> <span class="n">pTMin</span>   <span class="o">=</span> <span class="mf">5.0</span><span class="p">;</span>    <span class="c1">// Min jet pT.</span>
  <span class="kt">double</span> <span class="n">etaMax</span>  <span class="o">=</span> <span class="mf">5.0</span><span class="p">;</span>    <span class="c1">// Pseudorapidity range of detector.</span>
  <span class="kt">int</span>    <span class="n">select</span>  <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>      <span class="c1">// Which particles are included?</span>
  <span class="kt">int</span>    <span class="n">massSet</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>      <span class="c1">// Which mass are they assumed to have?</span>
  <span class="c1">// Generator. Shorthand for event.</span>
  <span class="n">Pythia</span> <span class="n">pythia</span><span class="p">;</span>
  <span class="n">Event</span><span class="o">&amp;</span> <span class="n">event</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">;</span>
  <span class="c1">// Process selection.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;HardQCD:all = on&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;PhaseSpace:pTHatMin = 200.&quot;</span><span class="p">);</span>
  <span class="c1">// No event record printout.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Next:numberShowInfo = 0&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Next:numberShowProcess = 0&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Next:numberShowEvent = 0&quot;</span><span class="p">);</span>
  <span class="c1">// LHC initialization.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Beams:eCM = 14000.&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
  <span class="c1">// Set up SlowJet jet finder in native mode.</span>
  <span class="n">SlowJet</span> <span class="n">slowJet</span><span class="p">(</span> <span class="n">power</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">pTMin</span><span class="p">,</span> <span class="n">etaMax</span><span class="p">,</span> <span class="n">select</span><span class="p">,</span> <span class="n">massSet</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span>
  <span class="c1">// Set up SlowJet jet finder as a wrapper to the fjcore package.</span>
  <span class="c1">// Note that this is now the default SlowJet constructor choice.</span>
  <span class="n">SlowJet</span> <span class="n">fjCore</span><span class="p">(</span> <span class="n">power</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">pTMin</span><span class="p">,</span> <span class="n">etaMax</span><span class="p">,</span> <span class="n">select</span><span class="p">,</span> <span class="n">massSet</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
  <span class="c1">// Set up FastJet jet finder.</span>
  <span class="c1">//   one can use either explicitly use antikt, cambridge, etc., or</span>
  <span class="c1">//   just use genkt_algorithm with specification of power</span>
  <span class="c1">//fastjet::JetAlgorithm algorithm;</span>
  <span class="c1">//if (power == -1)      algorithm = fastjet::antikt_algorithm;</span>
  <span class="c1">//if (power ==  0)      algorithm = fastjet::cambridge_algorithm;</span>
  <span class="c1">//if (power ==  1)      algorithm = fastjet::kt_algorithm;</span>
  <span class="c1">//fastjet::JetDefinition jetDef(algorithm, R);</span>
  <span class="c1">// there&#39;s no need for a pointer to the jetDef (it&#39;s a fairly small object)</span>
  <span class="n">fastjet</span><span class="o">::</span><span class="n">JetDefinition</span> <span class="n">jetDef</span><span class="p">(</span><span class="n">fastjet</span><span class="o">::</span><span class="n">genkt_algorithm</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">power</span><span class="p">);</span>
  <span class="n">std</span><span class="o">::</span><span class="n">vector</span> <span class="o">&lt;</span><span class="n">fastjet</span><span class="o">::</span><span class="n">PseudoJet</span><span class="o">&gt;</span> <span class="n">fjInputs</span><span class="p">;</span>
  <span class="c1">// Histograms.</span>
  <span class="n">Hist</span> <span class="n">nJetsS</span><span class="p">(</span><span class="s">&quot;number of jets (SlowJet)&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">99.5</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">nJetsC</span><span class="p">(</span><span class="s">&quot;number of jets, FJcore - SlowJet &quot;</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="o">-</span><span class="mf">49.5</span><span class="p">,</span> <span class="mf">49.5</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">nJetsF</span><span class="p">(</span><span class="s">&quot;number of jets, FastJet - SlowJet&quot;</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="o">-</span><span class="mf">49.5</span><span class="p">,</span> <span class="mf">49.5</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">pTjetsS</span><span class="p">(</span><span class="s">&quot;pT for jets (SlowJet)&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">500.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">pTjetsC</span><span class="p">(</span><span class="s">&quot;pT for jets, FJcore - SlowJet &quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.</span><span class="p">,</span> <span class="mf">10.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">pTjetsF</span><span class="p">(</span><span class="s">&quot;pT for jets, FastJet - SlowJet&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.</span><span class="p">,</span> <span class="mf">10.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">etaJetsS</span><span class="p">(</span><span class="s">&quot;eta for jets (SlowJet)&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.</span><span class="p">,</span> <span class="mf">5.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">phiJetsS</span><span class="p">(</span><span class="s">&quot;phi for jets (SlowJet)&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="n">M_PI</span><span class="p">,</span> <span class="n">M_PI</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">RdistC</span><span class="p">(</span><span class="s">&quot;R distance FJcore to SlowJet &quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">RdistF</span><span class="p">(</span><span class="s">&quot;R distance FastJet to SlowJet&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">distJets</span><span class="p">(</span><span class="s">&quot;R distance between jets&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">10.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">pTdiff</span><span class="p">(</span><span class="s">&quot;pT difference between consecutive jets&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">100.</span><span class="p">,</span> <span class="mf">400.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">nAna</span><span class="p">(</span><span class="s">&quot;multiplicity of analyzed event&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">999.5</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">tGen</span><span class="p">(</span><span class="s">&quot;generation time as fn of multiplicity&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">999.5</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">tSlow</span><span class="p">(</span><span class="s">&quot;SlowJet time as fn of multiplicity&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">999.5</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">tCore</span><span class="p">(</span><span class="s">&quot;FJcore time as fn of multiplicity &quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">999.5</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">tFast</span><span class="p">(</span><span class="s">&quot;FastJet time as fn of multiplicity&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">999.5</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">tSlowGen</span><span class="p">(</span><span class="s">&quot;SlowJet/generation time as fn of multiplicity&quot;</span><span class="p">,</span>
    <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">999.5</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">tCoreGen</span><span class="p">(</span><span class="s">&quot;FJcore/generation time as fn of multiplicity&quot;</span><span class="p">,</span>
    <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">999.5</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">tFastGen</span><span class="p">(</span><span class="s">&quot;FastJet/generation time as fn of multiplicity&quot;</span><span class="p">,</span>
    <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">999.5</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">tFastCore</span><span class="p">(</span><span class="s">&quot;FastJet/FJcore time as fn of multiplicity&quot;</span><span class="p">,</span>
    <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">999.5</span><span class="p">);</span>
  <span class="c1">// Begin event loop. Generate event. Skip if error.</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iEvent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iEvent</span> <span class="o">&lt;</span> <span class="n">nEvent</span><span class="p">;</span> <span class="o">++</span><span class="n">iEvent</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">clock_t</span> <span class="n">befGen</span> <span class="o">=</span> <span class="n">clock</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">())</span> <span class="k">continue</span><span class="p">;</span>
    <span class="kt">clock_t</span> <span class="n">aftGen</span> <span class="o">=</span> <span class="n">clock</span><span class="p">();</span>
    <span class="c1">// Begin SlowJet analysis of jet properties. List first few.</span>
    <span class="kt">clock_t</span> <span class="n">befSlow</span> <span class="o">=</span> <span class="n">clock</span><span class="p">();</span>
    <span class="n">slowJet</span><span class="p">.</span><span class="n">analyze</span><span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span> <span class="p">);</span>
    <span class="kt">clock_t</span> <span class="n">aftSlow</span> <span class="o">=</span> <span class="n">clock</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">iEvent</span> <span class="o">&lt;</span> <span class="n">nListJets</span><span class="p">)</span> <span class="n">slowJet</span><span class="p">.</span><span class="n">list</span><span class="p">();</span>
    <span class="c1">// Fill inclusive SlowJet jet distributions.</span>
    <span class="kt">int</span> <span class="n">nSlow</span> <span class="o">=</span> <span class="n">slowJet</span><span class="p">.</span><span class="n">sizeJet</span><span class="p">();</span>
    <span class="n">nJetsS</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">nSlow</span> <span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">nSlow</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">pTjetsS</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">slowJet</span><span class="p">.</span><span class="n">pT</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">);</span>
      <span class="n">etaJetsS</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">slowJet</span><span class="p">.</span><span class="n">y</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">);</span>
      <span class="n">phiJetsS</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">slowJet</span><span class="p">.</span><span class="n">phi</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">);</span>
    <span class="p">}</span>
    <span class="c1">// Fill distance between SlowJet jets.</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">nSlow</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">nSlow</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
      <span class="kt">double</span> <span class="n">dY</span> <span class="o">=</span> <span class="n">slowJet</span><span class="p">.</span><span class="n">y</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>  <span class="o">-</span> <span class="n">slowJet</span><span class="p">.</span><span class="n">y</span><span class="p">(</span><span class="n">j</span><span class="p">);</span>
      <span class="kt">double</span> <span class="n">dPhi</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span> <span class="n">slowJet</span><span class="p">.</span><span class="n">phi</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">-</span> <span class="n">slowJet</span><span class="p">.</span><span class="n">phi</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">dPhi</span> <span class="o">&gt;</span> <span class="n">M_PI</span><span class="p">)</span> <span class="n">dPhi</span> <span class="o">=</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">M_PI</span> <span class="o">-</span> <span class="n">dPhi</span><span class="p">;</span>
      <span class="kt">double</span> <span class="n">dR</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span> <span class="n">pow2</span><span class="p">(</span><span class="n">dY</span><span class="p">)</span> <span class="o">+</span> <span class="n">pow2</span><span class="p">(</span><span class="n">dPhi</span><span class="p">)</span> <span class="p">);</span>
      <span class="n">distJets</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">dR</span> <span class="p">);</span>
    <span class="p">}</span>
    <span class="c1">// Fill pT-difference between SlowJet jets (to check ordering of list).</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">nSlow</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
      <span class="n">pTdiff</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">slowJet</span><span class="p">.</span><span class="n">pT</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span> <span class="n">slowJet</span><span class="p">.</span><span class="n">pT</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">);</span>
    <span class="c1">// Begin FJcore analysis of jet properties. List first few.</span>
    <span class="kt">clock_t</span> <span class="n">befCore</span> <span class="o">=</span> <span class="n">clock</span><span class="p">();</span>
    <span class="n">fjCore</span><span class="p">.</span><span class="n">analyze</span><span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span> <span class="p">);</span>
    <span class="kt">clock_t</span> <span class="n">aftCore</span> <span class="o">=</span> <span class="n">clock</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">iEvent</span> <span class="o">&lt;</span> <span class="n">nListJets</span><span class="p">)</span> <span class="n">fjCore</span><span class="p">.</span><span class="n">list</span><span class="p">();</span>
    <span class="c1">// Fill distribution of fjCore jets relative to SlowJet ones.</span>
    <span class="kt">int</span> <span class="n">nCore</span> <span class="o">=</span> <span class="n">fjCore</span><span class="p">.</span><span class="n">sizeJet</span><span class="p">();</span>
    <span class="n">nJetsC</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">nCore</span> <span class="o">-</span> <span class="n">nSlow</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">nCore</span> <span class="o">==</span> <span class="n">nSlow</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">nCore</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">pTjetsC</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">fjCore</span><span class="p">.</span><span class="n">pT</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">-</span> <span class="n">slowJet</span><span class="p">.</span><span class="n">pT</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">);</span>
        <span class="kt">double</span> <span class="n">dist2</span> <span class="o">=</span> <span class="n">pow2</span><span class="p">(</span> <span class="n">fjCore</span><span class="p">.</span><span class="n">y</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">-</span> <span class="n">slowJet</span><span class="p">.</span><span class="n">y</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
          <span class="o">+</span> <span class="n">pow2</span><span class="p">(</span> <span class="n">fjCore</span><span class="p">.</span><span class="n">phi</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">-</span> <span class="n">slowJet</span><span class="p">.</span><span class="n">phi</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">);</span>
        <span class="n">RdistC</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">dist2</span><span class="p">)</span> <span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="c1">// Begin FastJet analysis: extract particles from event record.</span>
    <span class="kt">clock_t</span> <span class="n">befFast</span> <span class="o">=</span> <span class="n">clock</span><span class="p">();</span>
    <span class="n">fjInputs</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="n">Vec4</span>   <span class="n">pTemp</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">mTemp</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">nAnalyze</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">event</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">isFinal</span><span class="p">())</span> <span class="p">{</span>
      <span class="c1">// Require visible/charged particles inside detector.</span>
      <span class="k">if</span>      <span class="p">(</span><span class="n">select</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="o">&amp;&amp;</span>  <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">isNeutral</span><span class="p">()</span> <span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">select</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">isVisible</span><span class="p">()</span> <span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">etaMax</span> <span class="o">&lt;</span> <span class="mf">20.</span> <span class="o">&amp;&amp;</span> <span class="n">abs</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">eta</span><span class="p">())</span> <span class="o">&gt;</span> <span class="n">etaMax</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
      <span class="c1">// Create a PseudoJet from the complete Pythia particle.</span>
      <span class="n">fastjet</span><span class="o">::</span><span class="n">PseudoJet</span> <span class="n">particleTemp</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
      <span class="c1">// Optionally modify mass and energy.</span>
      <span class="n">pTemp</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">p</span><span class="p">();</span>
      <span class="n">mTemp</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">m</span><span class="p">();</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">massSet</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">mTemp</span> <span class="o">=</span> <span class="p">(</span><span class="n">massSet</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">id</span><span class="p">()</span> <span class="o">==</span> <span class="mi">22</span><span class="p">)</span> <span class="o">?</span> <span class="mf">0.</span> <span class="o">:</span> <span class="mf">0.13957</span><span class="p">;</span>
        <span class="n">pTemp</span><span class="p">.</span><span class="n">e</span><span class="p">(</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">pTemp</span><span class="p">.</span><span class="n">pAbs2</span><span class="p">()</span> <span class="o">+</span> <span class="n">mTemp</span><span class="o">*</span><span class="n">mTemp</span><span class="p">)</span> <span class="p">);</span>
        <span class="n">particleTemp</span><span class="p">.</span><span class="n">reset_momentum</span><span class="p">(</span> <span class="n">pTemp</span><span class="p">.</span><span class="n">px</span><span class="p">(),</span> <span class="n">pTemp</span><span class="p">.</span><span class="n">py</span><span class="p">(),</span>
           <span class="n">pTemp</span><span class="p">.</span><span class="n">pz</span><span class="p">(),</span> <span class="n">pTemp</span><span class="p">.</span><span class="n">e</span><span class="p">()</span> <span class="p">);</span>
      <span class="p">}</span>
      <span class="c1">// Store acceptable particles as input to Fastjet.</span>
      <span class="c1">// Conversion to PseudoJet is performed automatically</span>
      <span class="c1">// with the help of the code in FastJet3.h.</span>
      <span class="n">fjInputs</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span> <span class="n">particleTemp</span><span class="p">);</span>
      <span class="o">++</span><span class="n">nAnalyze</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// Run Fastjet algorithm and sort jets in pT order.</span>
    <span class="n">vector</span> <span class="o">&lt;</span><span class="n">fastjet</span><span class="o">::</span><span class="n">PseudoJet</span><span class="o">&gt;</span> <span class="n">inclusiveJets</span><span class="p">,</span> <span class="n">sortedJets</span><span class="p">;</span>
    <span class="n">fastjet</span><span class="o">::</span><span class="n">ClusterSequence</span> <span class="n">clustSeq</span><span class="p">(</span><span class="n">fjInputs</span><span class="p">,</span> <span class="n">jetDef</span><span class="p">);</span>
    <span class="n">inclusiveJets</span> <span class="o">=</span> <span class="n">clustSeq</span><span class="p">.</span><span class="n">inclusive_jets</span><span class="p">(</span><span class="n">pTMin</span><span class="p">);</span>
    <span class="n">sortedJets</span>    <span class="o">=</span> <span class="n">sorted_by_pt</span><span class="p">(</span><span class="n">inclusiveJets</span><span class="p">);</span>
    <span class="kt">clock_t</span> <span class="n">aftFast</span> <span class="o">=</span> <span class="n">clock</span><span class="p">();</span>
    <span class="c1">// List first few FastJet jets and some info about them.</span>
    <span class="c1">// Note: the final few columns are illustrative of what information</span>
    <span class="c1">// can be extracted, but does not exhaust the possibilities.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">iEvent</span> <span class="o">&lt;</span> <span class="n">nListJets</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s"> --------  FastJet jets, p = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">setw</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">power</span>
           <span class="o">&lt;&lt;</span> <span class="s">&quot;  --------------------------------------------------</span><span class="se">\n\n</span><span class="s"> &quot;</span>
           <span class="o">&lt;&lt;</span> <span class="s">&quot;  i         pT        y      phi  mult chgmult photons&quot;</span>
           <span class="o">&lt;&lt;</span> <span class="s">&quot;      hardest  pT in neutral &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span>
           <span class="o">&lt;&lt;</span> <span class="s">&quot;                                                       &quot;</span>
           <span class="o">&lt;&lt;</span> <span class="s">&quot;  constituent        hadrons &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="kt">int</span><span class="p">(</span><span class="n">sortedJets</span><span class="p">.</span><span class="n">size</span><span class="p">());</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">vector</span><span class="o">&lt;</span><span class="n">fastjet</span><span class="o">::</span><span class="n">PseudoJet</span><span class="o">&gt;</span> <span class="n">constituents</span>
          <span class="o">=</span> <span class="n">sortedJets</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">constituents</span><span class="p">();</span>
        <span class="n">fastjet</span><span class="o">::</span><span class="n">PseudoJet</span> <span class="n">hardest</span>
          <span class="o">=</span> <span class="n">fastjet</span><span class="o">::</span><span class="n">SelectorNHardest</span><span class="p">(</span><span class="mi">1</span><span class="p">)(</span><span class="n">constituents</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
        <span class="n">vector</span><span class="o">&lt;</span><span class="n">fastjet</span><span class="o">::</span><span class="n">PseudoJet</span><span class="o">&gt;</span> <span class="n">neutral_hadrons</span>
          <span class="o">=</span> <span class="p">(</span> <span class="n">fastjet</span><span class="o">::</span><span class="n">SelectorIsHadron</span><span class="p">()</span>
           <span class="o">&amp;&amp;</span> <span class="n">fastjet</span><span class="o">::</span><span class="n">SelectorIsNeutral</span><span class="p">())(</span><span class="n">constituents</span><span class="p">);</span>
        <span class="kt">double</span> <span class="n">neutral_hadrons_pt</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">neutral_hadrons</span><span class="p">).</span><span class="n">perp</span><span class="p">();</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">setw</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="n">fixed</span> <span class="o">&lt;&lt;</span> <span class="n">setprecision</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">setw</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>
             <span class="o">&lt;&lt;</span> <span class="n">sortedJets</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">perp</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">setw</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>  <span class="o">&lt;&lt;</span> <span class="n">sortedJets</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">rap</span><span class="p">()</span>
             <span class="o">&lt;&lt;</span> <span class="n">setw</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">sortedJets</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">phi_std</span><span class="p">()</span>
             <span class="o">&lt;&lt;</span> <span class="n">setw</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">constituents</span><span class="p">.</span><span class="n">size</span><span class="p">()</span>
             <span class="o">&lt;&lt;</span> <span class="n">setw</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">fastjet</span><span class="o">::</span><span class="n">SelectorIsCharged</span><span class="p">().</span><span class="n">count</span><span class="p">(</span><span class="n">constituents</span><span class="p">)</span>
             <span class="o">&lt;&lt;</span> <span class="n">setw</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">fastjet</span><span class="o">::</span><span class="n">SelectorId</span><span class="p">(</span><span class="mi">22</span><span class="p">).</span><span class="n">count</span><span class="p">(</span><span class="n">constituents</span><span class="p">)</span>
             <span class="o">&lt;&lt;</span> <span class="n">setw</span><span class="p">(</span><span class="mi">13</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">hardest</span><span class="p">.</span><span class="n">user_info</span><span class="o">&lt;</span><span class="n">Particle</span><span class="o">&gt;</span><span class="p">().</span><span class="n">name</span><span class="p">()</span>
             <span class="o">&lt;&lt;</span> <span class="s">&quot;     &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">setw</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">neutral_hadrons_pt</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s"> --------  End FastJet Listing  ------------------&quot;</span>
           <span class="o">&lt;&lt;</span> <span class="s">&quot;---------------------------------&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// Fill distribution of FastJet jets relative to SlowJet ones.</span>
    <span class="kt">int</span> <span class="n">nFast</span> <span class="o">=</span> <span class="n">sortedJets</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
    <span class="n">nJetsF</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">nFast</span> <span class="o">-</span> <span class="n">nSlow</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">nFast</span> <span class="o">==</span> <span class="n">nSlow</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">nFast</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">pTjetsF</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">sortedJets</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">perp</span><span class="p">()</span> <span class="o">-</span> <span class="n">slowJet</span><span class="p">.</span><span class="n">pT</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">);</span>
        <span class="kt">double</span> <span class="n">dist2</span> <span class="o">=</span> <span class="n">pow2</span><span class="p">(</span> <span class="n">sortedJets</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">rap</span><span class="p">()</span> <span class="o">-</span> <span class="n">slowJet</span><span class="p">.</span><span class="n">y</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
          <span class="o">+</span> <span class="n">pow2</span><span class="p">(</span> <span class="n">sortedJets</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">phi_std</span><span class="p">()</span> <span class="o">-</span> <span class="n">slowJet</span><span class="p">.</span><span class="n">phi</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
        <span class="n">RdistF</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">dist2</span><span class="p">)</span> <span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="c1">// Comparison of time consumption by analyzed multiplicity.</span>
    <span class="n">nAna</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">nAnalyze</span><span class="p">);</span>
    <span class="n">tGen</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">nAnalyze</span><span class="p">,</span> <span class="n">aftGen</span> <span class="o">-</span> <span class="n">befGen</span><span class="p">);</span>
    <span class="n">tSlow</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">nAnalyze</span><span class="p">,</span> <span class="n">aftSlow</span> <span class="o">-</span> <span class="n">befSlow</span><span class="p">);</span>
    <span class="n">tCore</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">nAnalyze</span><span class="p">,</span> <span class="n">aftCore</span> <span class="o">-</span> <span class="n">befCore</span><span class="p">);</span>
    <span class="n">tFast</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">nAnalyze</span><span class="p">,</span> <span class="n">aftFast</span> <span class="o">-</span> <span class="n">befFast</span><span class="p">);</span>
  <span class="c1">// End of event loop.</span>
  <span class="p">}</span>
  <span class="c1">// Statistics. Histograms.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
  <span class="n">tSlowGen</span>  <span class="o">=</span> <span class="n">tSlow</span> <span class="o">/</span> <span class="n">tGen</span><span class="p">;</span>
  <span class="n">tCoreGen</span>  <span class="o">=</span> <span class="n">tCore</span> <span class="o">/</span> <span class="n">tGen</span><span class="p">;</span>
  <span class="n">tFastGen</span>  <span class="o">=</span> <span class="n">tFast</span> <span class="o">/</span> <span class="n">tGen</span><span class="p">;</span>
  <span class="n">tFastCore</span> <span class="o">=</span> <span class="n">tFast</span> <span class="o">/</span> <span class="n">tCore</span><span class="p">;</span>
  <span class="n">tGen</span>     <span class="o">/=</span> <span class="n">nAna</span><span class="p">;</span>
  <span class="n">tSlow</span>    <span class="o">/=</span> <span class="n">nAna</span><span class="p">;</span>
  <span class="n">tCore</span>    <span class="o">/=</span> <span class="n">nAna</span><span class="p">;</span>
  <span class="n">tFast</span>    <span class="o">/=</span> <span class="n">nAna</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">nJetsS</span> <span class="o">&lt;&lt;</span> <span class="n">nJetsC</span> <span class="o">&lt;&lt;</span> <span class="n">nJetsF</span> <span class="o">&lt;&lt;</span> <span class="n">pTjetsS</span> <span class="o">&lt;&lt;</span> <span class="n">pTjetsC</span> <span class="o">&lt;&lt;</span> <span class="n">pTjetsF</span>
       <span class="o">&lt;&lt;</span> <span class="n">etaJetsS</span> <span class="o">&lt;&lt;</span> <span class="n">phiJetsS</span> <span class="o">&lt;&lt;</span> <span class="n">RdistC</span> <span class="o">&lt;&lt;</span> <span class="n">RdistF</span> <span class="o">&lt;&lt;</span> <span class="n">distJets</span> <span class="o">&lt;&lt;</span> <span class="n">pTdiff</span>
       <span class="o">&lt;&lt;</span> <span class="n">nAna</span> <span class="o">&lt;&lt;</span> <span class="n">tGen</span> <span class="o">&lt;&lt;</span> <span class="n">tSlow</span> <span class="o">&lt;&lt;</span> <span class="n">tCore</span> <span class="o">&lt;&lt;</span> <span class="n">tFast</span> <span class="o">&lt;&lt;</span> <span class="n">tSlowGen</span> <span class="o">&lt;&lt;</span> <span class="n">tCoreGen</span>
       <span class="o">&lt;&lt;</span> <span class="n">tFastGen</span> <span class="o">&lt;&lt;</span> <span class="n">tFastCore</span><span class="p">;</span>
  <span class="c1">// Done.</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
    </div>
  </div>
</div>

</div> <div class="well well-sm"> <h1 id="main73cc">main73.cc</h1><hr>
<div class="codehilite"><pre><span class="c1">// main73.cc is a part of the PYTHIA event generator.</span>
<span class="c1">// Copyright (C) 2016 Torbjorn Sjostrand.</span>
<span class="c1">// PYTHIA is licenced under the GNU GPL version 2, see COPYING for details.</span>
<span class="c1">// Please respect the MCnet Guidelines, see GUIDELINES for details.</span>
<span class="c1">// Example how to compare &quot;parton-level&quot; and &quot;hadron-level&quot; properties.</span>
</pre></div>


<div class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" href="#fileid51">Rest of the main73.cc code</a>
    </h4>
  </div>
  <div id="fileid51" class="panel-collapse collapse">
    <div class="panel-body">
<div class="codehilite"><pre><span class="cp">#include</span> <span class="cpf">&quot;Pythia8/Pythia.h&quot;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">Pythia8</span><span class="p">;</span>
<span class="c1">//--------------------------------------------------------------------------</span>
<span class="c1">// Generic routine to extract the particles that existed right before</span>
<span class="c1">// the hadronization machinery was invoked.</span>
<span class="kt">void</span> <span class="nf">getPartonLevelEvent</span><span class="p">(</span> <span class="n">Event</span><span class="o">&amp;</span> <span class="n">event</span><span class="p">,</span> <span class="n">Event</span><span class="o">&amp;</span> <span class="n">partonLevelEvent</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Copy over all particles that existed right before hadronization.</span>
  <span class="n">partonLevelEvent</span><span class="p">.</span><span class="n">reset</span><span class="p">();</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">event</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">isFinalPartonLevel</span><span class="p">())</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">iNew</span> <span class="o">=</span> <span class="n">partonLevelEvent</span><span class="p">.</span><span class="n">append</span><span class="p">(</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">);</span>
    <span class="c1">// Set copied properties more appropriately: positive status,</span>
    <span class="c1">// original location as &quot;mother&quot;, and with no daughters.</span>
    <span class="n">partonLevelEvent</span><span class="p">[</span><span class="n">iNew</span><span class="p">].</span><span class="n">statusPos</span><span class="p">();</span>
    <span class="n">partonLevelEvent</span><span class="p">[</span><span class="n">iNew</span><span class="p">].</span><span class="n">mothers</span><span class="p">(</span> <span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
    <span class="n">partonLevelEvent</span><span class="p">[</span><span class="n">iNew</span><span class="p">].</span><span class="n">daughters</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="c1">//--------------------------------------------------------------------------</span>
<span class="c1">// Generic routine to extract the particles that exist after the</span>
<span class="c1">// hadronization machinery. Normally not needed, since SlowJet</span>
<span class="c1">// contains the standard possibilities preprogrammed, but this</span>
<span class="c1">// method illustrates further discrimination.</span>
<span class="kt">void</span> <span class="nf">getHadronLevelEvent</span><span class="p">(</span> <span class="n">Event</span><span class="o">&amp;</span> <span class="n">event</span><span class="p">,</span> <span class="n">Event</span><span class="o">&amp;</span> <span class="n">hadronLevelEvent</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Iterate over all final particles.</span>
  <span class="n">hadronLevelEvent</span><span class="p">.</span><span class="n">reset</span><span class="p">();</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">event</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">bool</span> <span class="n">accept</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">isFinal</span><span class="p">())</span> <span class="n">accept</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
    <span class="c1">// Example 1: reject neutrinos (standard option).</span>
    <span class="kt">int</span> <span class="n">idAbs</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">idAbs</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">idAbs</span> <span class="o">==</span> <span class="mi">12</span> <span class="o">||</span> <span class="n">idAbs</span> <span class="o">==</span> <span class="mi">14</span> <span class="o">||</span> <span class="n">idAbs</span> <span class="o">==</span> <span class="mi">16</span><span class="p">)</span> <span class="n">accept</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="c1">// Example 2: reject particles with pT &lt; 0.1 GeV (new possibility).</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pT</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.1</span><span class="p">)</span> <span class="n">accept</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="c1">// Copy over accepted particles, with original location as &quot;mother&quot;.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">accept</span><span class="p">)</span> <span class="p">{</span>
      <span class="kt">int</span> <span class="n">iNew</span> <span class="o">=</span> <span class="n">hadronLevelEvent</span><span class="p">.</span><span class="n">append</span><span class="p">(</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">);</span>
      <span class="n">hadronLevelEvent</span><span class="p">[</span><span class="n">iNew</span><span class="p">].</span><span class="n">mothers</span><span class="p">(</span> <span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="c1">//--------------------------------------------------------------------------</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Number of events, generated and listed ones.</span>
  <span class="kt">int</span> <span class="n">nEvent</span>    <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">nListEvts</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">nListJets</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
  <span class="c1">// Generator. LHC process and output selection. Initialization.</span>
  <span class="n">Pythia</span> <span class="n">pythia</span><span class="p">;</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Beams:eCM = 13000.&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;HardQCD:all = on&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;PhaseSpace:pTHatMin = 200.&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Next:numberShowInfo = 0&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Next:numberShowProcess = 0&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Next:numberShowEvent = 0&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
  <span class="c1">// Parton and Hadron Level event records. Remeber to initalize.</span>
  <span class="n">Event</span> <span class="n">partonLevelEvent</span><span class="p">;</span>
  <span class="n">partonLevelEvent</span><span class="p">.</span><span class="n">init</span><span class="p">(</span><span class="s">&quot;Parton Level event record&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pythia</span><span class="p">.</span><span class="n">particleData</span><span class="p">);</span>
  <span class="n">Event</span> <span class="n">hadronLevelEvent</span><span class="p">;</span>
  <span class="n">hadronLevelEvent</span><span class="p">.</span><span class="n">init</span><span class="p">(</span><span class="s">&quot;Hadron Level event record&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pythia</span><span class="p">.</span><span class="n">particleData</span><span class="p">);</span>
  <span class="c1">//  Parameters for the jet finders. Need select = 1 to catch partons.</span>
  <span class="kt">double</span> <span class="n">radius</span>   <span class="o">=</span> <span class="mf">0.5</span><span class="p">;</span>
  <span class="kt">double</span> <span class="n">pTjetMin</span> <span class="o">=</span> <span class="mf">10.</span><span class="p">;</span>
  <span class="kt">double</span> <span class="n">etaMax</span>   <span class="o">=</span> <span class="mf">4.</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">select</span>      <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="c1">// Set up anti-kT clustering, comparing parton and hadron levels.</span>
  <span class="n">SlowJet</span> <span class="n">antiKTpartons</span><span class="p">(</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">pTjetMin</span><span class="p">,</span> <span class="n">etaMax</span><span class="p">,</span> <span class="n">select</span><span class="p">);</span>
  <span class="n">SlowJet</span> <span class="n">antiKThadrons</span><span class="p">(</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">pTjetMin</span><span class="p">,</span> <span class="n">etaMax</span><span class="p">,</span> <span class="n">select</span><span class="p">);</span>
  <span class="c1">// Histograms.</span>
  <span class="n">Hist</span> <span class="n">nJetsP</span><span class="p">(</span><span class="s">&quot;number of jets, parton level&quot;</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">49.5</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">nJetsH</span><span class="p">(</span><span class="s">&quot;number of jets, hadron level&quot;</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">49.5</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">pTallP</span><span class="p">(</span><span class="s">&quot;pT for jets, parton level&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">500.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">pTallH</span><span class="p">(</span><span class="s">&quot;pT for jets, hadron level&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">500.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">pThardP</span><span class="p">(</span><span class="s">&quot;pT for hardest jet, parton level&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">500.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">pThardH</span><span class="p">(</span><span class="s">&quot;pT for hardest jet, hadron level&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">500.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">pTdiff</span><span class="p">(</span><span class="s">&quot;pT for hardest jet, hadron - parton&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">100.</span><span class="p">,</span> <span class="mf">100.</span><span class="p">);</span>
  <span class="c1">// Begin event loop. Generate event. Skip if error.</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iEvent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iEvent</span> <span class="o">&lt;</span> <span class="n">nEvent</span><span class="p">;</span> <span class="o">++</span><span class="n">iEvent</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">())</span> <span class="k">continue</span><span class="p">;</span>
    <span class="c1">// Construct parton and hadron level event.</span>
    <span class="n">getPartonLevelEvent</span><span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">,</span> <span class="n">partonLevelEvent</span><span class="p">);</span>
    <span class="n">getHadronLevelEvent</span><span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">,</span> <span class="n">hadronLevelEvent</span><span class="p">);</span>
    <span class="c1">// List first few events.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">iEvent</span> <span class="o">&lt;</span> <span class="n">nListEvts</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="n">list</span><span class="p">();</span>
      <span class="n">partonLevelEvent</span><span class="p">.</span><span class="n">list</span><span class="p">();</span>
      <span class="n">hadronLevelEvent</span><span class="p">.</span><span class="n">list</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="c1">// Analyze jet properties and list first few analyses.</span>
    <span class="n">antiKTpartons</span><span class="p">.</span><span class="n">analyze</span><span class="p">(</span> <span class="n">partonLevelEvent</span> <span class="p">);</span>
    <span class="n">antiKThadrons</span><span class="p">.</span><span class="n">analyze</span><span class="p">(</span> <span class="n">hadronLevelEvent</span> <span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">iEvent</span> <span class="o">&lt;</span> <span class="n">nListJets</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">antiKTpartons</span><span class="p">.</span><span class="n">list</span><span class="p">();</span>
      <span class="n">antiKThadrons</span><span class="p">.</span><span class="n">list</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="c1">// Fill jet properties distributions.</span>
    <span class="n">nJetsP</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">antiKTpartons</span><span class="p">.</span><span class="n">sizeJet</span><span class="p">()</span> <span class="p">);</span>
    <span class="n">nJetsH</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">antiKThadrons</span><span class="p">.</span><span class="n">sizeJet</span><span class="p">()</span> <span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">antiKTpartons</span><span class="p">.</span><span class="n">sizeJet</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
      <span class="n">pTallP</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">antiKTpartons</span><span class="p">.</span><span class="n">pT</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">antiKThadrons</span><span class="p">.</span><span class="n">sizeJet</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
      <span class="n">pTallH</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">antiKThadrons</span><span class="p">.</span><span class="n">pT</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">antiKTpartons</span><span class="p">.</span><span class="n">sizeJet</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">antiKThadrons</span><span class="p">.</span><span class="n">sizeJet</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">pThardP</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">antiKTpartons</span><span class="p">.</span><span class="n">pT</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">);</span>
      <span class="n">pThardH</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">antiKThadrons</span><span class="p">.</span><span class="n">pT</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">);</span>
      <span class="n">pTdiff</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">antiKThadrons</span><span class="p">.</span><span class="n">pT</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="n">antiKTpartons</span><span class="p">.</span><span class="n">pT</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">);</span>
    <span class="p">}</span>
  <span class="c1">// End of event loop. Statistics. Histograms.</span>
  <span class="p">}</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">nJetsP</span> <span class="o">&lt;&lt;</span> <span class="n">nJetsH</span> <span class="o">&lt;&lt;</span> <span class="n">pTallP</span> <span class="o">&lt;&lt;</span> <span class="n">pTallH</span>
       <span class="o">&lt;&lt;</span>  <span class="n">pThardP</span> <span class="o">&lt;&lt;</span> <span class="n">pThardH</span> <span class="o">&lt;&lt;</span> <span class="n">pTdiff</span><span class="p">;</span>
  <span class="c1">// Done.</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
    </div>
  </div>
</div>

</div> <div class="well well-sm"> <h1 id="main80cc">main80.cc</h1><hr>
<div class="codehilite"><pre><span class="c1">// main80.cc is a part of the PYTHIA event generator.</span>
<span class="c1">// Copyright (C) 2016 Torbjorn Sjostrand.</span>
<span class="c1">// PYTHIA is licenced under the GNU GPL version 2, see COPYING for details.</span>
<span class="c1">// Please respect the MCnet Guidelines, see GUIDELINES for details.</span>
<span class="c1">// This program is written by Stefan Prestel.</span>
<span class="c1">// It illustrates how to do CKKW-L merging,</span>
<span class="c1">// see the Matrix Element Merging page in the online manual.</span>
</pre></div>


<div class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" href="#fileid52">Rest of the main80.cc code</a>
    </h4>
  </div>
  <div id="fileid52" class="panel-collapse collapse">
    <div class="panel-body">
<div class="codehilite"><pre><span class="cp">#include</span> <span class="cpf">&quot;Pythia8/Pythia.h&quot;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">Pythia8</span><span class="p">;</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Generator. Input parameters.</span>
  <span class="n">Pythia</span> <span class="n">pythia</span><span class="p">;</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readFile</span><span class="p">(</span><span class="s">&quot;main80.cmnd&quot;</span><span class="p">);</span>
  <span class="c1">// Extract number of events and max number of jets in merging.</span>
  <span class="kt">int</span> <span class="n">nEvent</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Main:numberOfEvents&quot;</span><span class="p">);</span>
  <span class="kt">int</span> <span class="n">nMerge</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Merging:nJetMax&quot;</span><span class="p">);</span>
  <span class="c1">// Histograms combined over all jet multiplicities.</span>
  <span class="n">Hist</span> <span class="n">pTWsum</span><span class="p">(</span><span class="s">&quot;pT of W, summed over all subruns&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">200.</span><span class="p">);</span>
  <span class="c1">// Merged total cross section, summed over subruns.</span>
  <span class="kt">double</span> <span class="n">sigmaTotal</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">;</span>
  <span class="c1">// Loop over subruns with varying number of jets.</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iMerge</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iMerge</span> <span class="o">&lt;=</span> <span class="n">nMerge</span><span class="p">;</span> <span class="o">++</span><span class="n">iMerge</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">double</span> <span class="n">sigmaSample</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">;</span>
    <span class="c1">// Read in name of LHE file for current subrun and initialize.</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readFile</span><span class="p">(</span><span class="s">&quot;main80.cmnd&quot;</span><span class="p">,</span> <span class="n">iMerge</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
    <span class="c1">// Histograms for current jet multiplicity.</span>
    <span class="n">Hist</span> <span class="n">weightNow</span><span class="p">(</span><span class="s">&quot;event weights, current subrun&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">);</span>
    <span class="n">Hist</span> <span class="n">pTWnow</span><span class="p">(</span><span class="s">&quot;pT of W, current subrun&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">200.</span><span class="p">);</span>
    <span class="c1">// Start event generation loop.</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iEvent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iEvent</span> <span class="o">&lt;</span> <span class="n">nEvent</span><span class="p">;</span> <span class="o">++</span><span class="n">iEvent</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Generate next event. Break out of event loop if at end of LHE file.</span>
      <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">atEndOfFile</span><span class="p">()</span> <span class="p">)</span> <span class="k">break</span><span class="p">;</span>
        <span class="k">else</span> <span class="k">continue</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="c1">// Get CKKWL weight of current event. Histogram and accumulate it.</span>
      <span class="kt">double</span> <span class="n">weight</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">mergingWeight</span><span class="p">();</span>
      <span class="n">weightNow</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">weight</span><span class="p">);</span>
      <span class="n">sigmaSample</span> <span class="o">+=</span> <span class="n">weight</span><span class="p">;</span>
      <span class="c1">// Find the final copy of the W+, which is after the full shower.</span>
      <span class="kt">int</span> <span class="n">iW</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">id</span><span class="p">()</span> <span class="o">==</span> <span class="mi">24</span><span class="p">)</span> <span class="n">iW</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
      <span class="c1">// Fill the pT of the W histogram, with CKKWL weight.</span>
      <span class="kt">double</span> <span class="n">pTW</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">iW</span><span class="p">].</span><span class="n">pT</span><span class="p">();</span>
      <span class="n">pTWnow</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">pTW</span><span class="p">,</span> <span class="n">weight</span><span class="p">);</span>
    <span class="c1">// End of event loop.</span>
    <span class="p">}</span>
    <span class="c1">// Normalize pTW histogram, convert mb -&gt; pb, and correct for bin width.</span>
    <span class="n">pTWnow</span> <span class="o">*=</span> <span class="mf">1e9</span> <span class="o">*</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">sigmaGen</span><span class="p">()</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.</span> <span class="o">*</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">nAccepted</span><span class="p">());</span>
    <span class="c1">// Print cross section and histograms for current subrun.</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">weightNow</span> <span class="o">&lt;&lt;</span> <span class="n">pTWnow</span><span class="p">;</span>
    <span class="c1">// Sum up merged cross section of current run.</span>
    <span class="n">sigmaSample</span> <span class="o">*=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">sigmaGen</span><span class="p">()</span> <span class="o">/</span> <span class="kt">double</span><span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">nAccepted</span><span class="p">());</span>
    <span class="n">sigmaTotal</span>  <span class="o">+=</span> <span class="n">sigmaSample</span><span class="p">;</span>
    <span class="c1">// Add current histogram to the combined one. End of subrun loop.</span>
    <span class="n">pTWsum</span> <span class="o">+=</span> <span class="n">pTWnow</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// Print final histograms and info on merged cross section..</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">pTWsum</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n\n</span><span class="s"> The inclusive cross section after merging is: &quot;</span>
       <span class="o">&lt;&lt;</span> <span class="n">scientific</span> <span class="o">&lt;&lt;</span> <span class="n">setprecision</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">sigmaTotal</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; mb &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="c1">// Done</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
    </div>
  </div>
</div>

</div> <div class="well well-sm"> <h1 id="main81cc">main81.cc</h1><hr>
<div class="codehilite"><pre><span class="c1">// main81.cc is a part of the PYTHIA event generator.</span>
<span class="c1">// Copyright (C) 2016 Torbjorn Sjostrand.</span>
<span class="c1">// PYTHIA is licenced under the GNU GPL version 2, see COPYING for details.</span>
<span class="c1">// Please respect the MCnet Guidelines, see GUIDELINES for details.</span>
<span class="c1">// This program is written by Stefan Prestel.</span>
<span class="c1">// It illustrates how to do CKKW-L merging, see the Matrix Element</span>
<span class="c1">// Merging page in the online manual. An example command is</span>
<span class="c1">//     ./main81 main81.cmnd w+_production_lhc_0.lhe histout81.dat</span>
<span class="c1">// where main81.cmnd supplies the commands, w+_production_lhc_0.lhe</span>
<span class="c1">// provides the input LHE events, and histout81.dat is the output</span>
<span class="c1">// file. This example requires FastJet.</span>
</pre></div>


<div class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" href="#fileid53">Rest of the main81.cc code</a>
    </h4>
  </div>
  <div id="fileid53" class="panel-collapse collapse">
    <div class="panel-body">
<div class="codehilite"><pre><span class="cp">#include</span> <span class="cpf">&quot;Pythia8/Pythia.h&quot;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">Pythia8</span><span class="p">;</span>
<span class="c1">// Functions for histogramming</span>
<span class="cp">#include</span> <span class="cpf">&quot;fastjet/PseudoJet.hh&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;fastjet/ClusterSequence.hh&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;fastjet/CDFMidPointPlugin.hh&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;fastjet/CDFJetCluPlugin.hh&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;fastjet/D0RunIIConePlugin.hh&quot;</span><span class="cp"></span>
<span class="c1">//==========================================================================</span>
<span class="c1">// Find the Durham kT separation of the clustering from</span>
<span class="c1">// nJetMin --&gt; nJetMin-1 jets in the input event</span>
<span class="kt">double</span> <span class="nf">pTfirstJet</span><span class="p">(</span> <span class="k">const</span> <span class="n">Event</span><span class="o">&amp;</span> <span class="n">event</span><span class="p">,</span> <span class="kt">int</span> <span class="n">nJetMin</span><span class="p">,</span> <span class="kt">double</span> <span class="n">Rparam</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">double</span> <span class="n">yPartonMax</span> <span class="o">=</span> <span class="mf">4.</span><span class="p">;</span>
  <span class="c1">// Fastjet analysis - select algorithm and parameters</span>
  <span class="n">fastjet</span><span class="o">::</span><span class="n">Strategy</span>               <span class="n">strategy</span> <span class="o">=</span> <span class="n">fastjet</span><span class="o">::</span><span class="n">Best</span><span class="p">;</span>
  <span class="n">fastjet</span><span class="o">::</span><span class="n">RecombinationScheme</span>    <span class="n">recombScheme</span> <span class="o">=</span> <span class="n">fastjet</span><span class="o">::</span><span class="n">E_scheme</span><span class="p">;</span>
  <span class="n">fastjet</span><span class="o">::</span><span class="n">JetDefinition</span>         <span class="o">*</span><span class="n">jetDef</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
  <span class="c1">// For hadronic collision, use hadronic Durham kT measure</span>
  <span class="k">if</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">colType</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">event</span><span class="p">[</span><span class="mi">4</span><span class="p">].</span><span class="n">colType</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">jetDef</span> <span class="o">=</span> <span class="k">new</span> <span class="n">fastjet</span><span class="o">::</span><span class="n">JetDefinition</span><span class="p">(</span><span class="n">fastjet</span><span class="o">::</span><span class="n">kt_algorithm</span><span class="p">,</span> <span class="n">Rparam</span><span class="p">,</span>
                                      <span class="n">recombScheme</span><span class="p">,</span> <span class="n">strategy</span><span class="p">);</span>
  <span class="c1">// For e+e- collision, use e+e- Durham kT measure</span>
  <span class="k">else</span>
    <span class="n">jetDef</span> <span class="o">=</span> <span class="k">new</span> <span class="n">fastjet</span><span class="o">::</span><span class="n">JetDefinition</span><span class="p">(</span><span class="n">fastjet</span><span class="o">::</span><span class="n">ee_kt_algorithm</span><span class="p">,</span>
                                      <span class="n">recombScheme</span><span class="p">,</span> <span class="n">strategy</span><span class="p">);</span>
  <span class="c1">// Fastjet input</span>
  <span class="n">std</span><span class="o">::</span><span class="n">vector</span> <span class="o">&lt;</span><span class="n">fastjet</span><span class="o">::</span><span class="n">PseudoJet</span><span class="o">&gt;</span> <span class="n">fjInputs</span><span class="p">;</span>
  <span class="c1">// Reset Fastjet input</span>
  <span class="n">fjInputs</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="c1">// Loop over event record to decide what to pass to FastJet</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">event</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// (Final state &amp;&amp; coloured+photons) only!</span>
    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">isFinal</span><span class="p">()</span>
      <span class="o">||</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">isLepton</span><span class="p">()</span>
      <span class="o">||</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">id</span><span class="p">()</span> <span class="o">==</span> <span class="mi">23</span>
      <span class="o">||</span> <span class="n">abs</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">id</span><span class="p">())</span> <span class="o">==</span> <span class="mi">24</span>
      <span class="o">||</span> <span class="n">abs</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">y</span><span class="p">())</span> <span class="o">&gt;</span> <span class="n">yPartonMax</span><span class="p">)</span>
      <span class="k">continue</span><span class="p">;</span>
    <span class="c1">// Store as input to Fastjet</span>
    <span class="n">fjInputs</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span> <span class="n">fastjet</span><span class="o">::</span><span class="n">PseudoJet</span> <span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">px</span><span class="p">(),</span>
            <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">py</span><span class="p">(),</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pz</span><span class="p">(),</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">e</span><span class="p">()</span> <span class="p">)</span> <span class="p">);</span>
  <span class="p">}</span>
  <span class="c1">// Do nothing for empty input</span>
  <span class="k">if</span> <span class="p">(</span><span class="kt">int</span><span class="p">(</span><span class="n">fjInputs</span><span class="p">.</span><span class="n">size</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">delete</span> <span class="n">jetDef</span><span class="p">;</span>
    <span class="k">return</span> <span class="mf">0.0</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// Run Fastjet algorithm</span>
  <span class="n">fastjet</span><span class="o">::</span><span class="n">ClusterSequence</span> <span class="n">clustSeq</span><span class="p">(</span><span class="n">fjInputs</span><span class="p">,</span> <span class="o">*</span><span class="n">jetDef</span><span class="p">);</span>
  <span class="c1">// Extract kT of first clustering</span>
  <span class="kt">double</span> <span class="n">pTFirst</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">clustSeq</span><span class="p">.</span><span class="n">exclusive_dmerge_max</span><span class="p">(</span><span class="n">nJetMin</span><span class="o">-</span><span class="mi">1</span><span class="p">));</span>
  <span class="k">delete</span> <span class="n">jetDef</span><span class="p">;</span>
  <span class="c1">// Return kT</span>
  <span class="k">return</span> <span class="n">pTFirst</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">//==========================================================================</span>
<span class="c1">// Example main programm to illustrate merging</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span> <span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[]</span> <span class="p">){</span>
  <span class="c1">// Check that correct number of command-line arguments</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; Unexpected number of command-line arguments (&quot;</span><span class="o">&lt;&lt;</span><span class="n">argc</span><span class="o">&lt;&lt;</span><span class="s">&quot;). </span><span class="se">\n</span><span class="s">&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; You are expected to provide the arguments&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; 1. Input file for settings&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; 2. Full name of the input LHE file (with path)&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; 3. Path for output histogram files&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; Program stopped. &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">Pythia</span> <span class="n">pythia</span><span class="p">;</span>
  <span class="c1">// Input parameters:</span>
  <span class="c1">//  1. Input file for settings</span>
  <span class="c1">//  2. Path to input LHE file</span>
  <span class="c1">//  3. Output histogram path</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readFile</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
  <span class="n">string</span> <span class="n">iPath</span> <span class="o">=</span> <span class="n">string</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
  <span class="n">string</span> <span class="n">oPath</span> <span class="o">=</span> <span class="n">string</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>
  <span class="c1">// Number of events</span>
  <span class="kt">int</span> <span class="n">nEvent</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Main:numberOfEvents&quot;</span><span class="p">);</span>
  <span class="c1">// For ISR regularisation off</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">forceParm</span><span class="p">(</span><span class="s">&quot;SpaceShower:pT0Ref&quot;</span><span class="p">,</span><span class="mf">0.</span><span class="p">);</span>
  <span class="c1">// Declare histograms</span>
  <span class="n">Hist</span> <span class="n">histPTFirst</span><span class="p">(</span><span class="s">&quot;pT of first jet&quot;</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">100.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">histPTSecond</span><span class="p">(</span><span class="s">&quot;pT of second jet&quot;</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">100.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">histPTThird</span><span class="p">(</span><span class="s">&quot;pT of third jet&quot;</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">100.</span><span class="p">);</span>
  <span class="c1">// Read in ME configurations</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Beams:frameType = 4&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Beams:LHEF = &quot;</span> <span class="o">+</span> <span class="n">iPath</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
  <span class="c1">// Start generation loop</span>
  <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">iEvent</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">iEvent</span><span class="o">&lt;</span><span class="n">nEvent</span><span class="p">;</span> <span class="o">++</span><span class="n">iEvent</span> <span class="p">){</span>
    <span class="c1">// Generate next event</span>
    <span class="k">if</span><span class="p">(</span> <span class="o">!</span> <span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">())</span> <span class="k">continue</span><span class="p">;</span>
    <span class="c1">// Get CKKWL weight of current event</span>
    <span class="kt">double</span> <span class="n">weight</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">mergingWeight</span><span class="p">();</span>
    <span class="c1">// Fill bins with CKKWL weight</span>
    <span class="c1">// Functions use fastjet to get first / second jet</span>
    <span class="kt">double</span> <span class="n">pTfirst</span> <span class="o">=</span> <span class="n">pTfirstJet</span><span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">);</span>
    <span class="kt">double</span> <span class="n">pTsecnd</span> <span class="o">=</span> <span class="n">pTfirstJet</span><span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">);</span>
    <span class="kt">double</span> <span class="n">pTthird</span> <span class="o">=</span> <span class="n">pTfirstJet</span><span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">);</span>
    <span class="n">histPTFirst</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">pTfirst</span><span class="p">,</span> <span class="n">weight</span><span class="p">);</span>
    <span class="n">histPTSecond</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">pTsecnd</span><span class="p">,</span> <span class="n">weight</span><span class="p">);</span>
    <span class="n">histPTThird</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">pTthird</span><span class="p">,</span> <span class="n">weight</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">iEvent</span><span class="o">%</span><span class="mi">1000</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">iEvent</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="p">}</span> <span class="c1">// end loop over events to generate</span>
  <span class="c1">// print cross section, errors</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
  <span class="c1">// Normalise histograms</span>
  <span class="kt">double</span> <span class="n">norm</span> <span class="o">=</span> <span class="mf">1.</span>
              <span class="o">*</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">sigmaGen</span><span class="p">()</span>
              <span class="o">*</span> <span class="mf">1.</span><span class="o">/</span> <span class="kt">double</span><span class="p">(</span><span class="n">nEvent</span><span class="p">);</span>
  <span class="n">histPTFirst</span>           <span class="o">*=</span> <span class="n">norm</span><span class="p">;</span>
  <span class="n">histPTSecond</span>          <span class="o">*=</span> <span class="n">norm</span><span class="p">;</span>
  <span class="n">histPTThird</span>           <span class="o">*=</span> <span class="n">norm</span><span class="p">;</span>
  <span class="c1">// Get the number of jets in the LHE file from the file name</span>
  <span class="n">string</span> <span class="n">jetsInLHEF</span> <span class="o">=</span> <span class="n">iPath</span><span class="p">.</span><span class="n">substr</span><span class="p">(</span><span class="n">iPath</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="n">iPath</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
  <span class="n">jetsInLHEF</span> <span class="o">=</span> <span class="n">jetsInLHEF</span><span class="p">.</span><span class="n">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">jetsInLHEF</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="o">-</span><span class="mi">4</span><span class="p">);</span>
  <span class="c1">// Write histograms to dat file. Use &quot;jetsInLHEF&quot; to label the files</span>
  <span class="c1">// Once all the samples up to the maximal desired jet multiplicity from the</span>
  <span class="c1">// matrix element are run, add all histograms to produce a</span>
  <span class="c1">// matrix-element-merged prediction</span>
  <span class="n">ofstream</span> <span class="n">write</span><span class="p">;</span>
  <span class="n">stringstream</span> <span class="n">suffix</span><span class="p">;</span>
  <span class="n">suffix</span> <span class="o">&lt;&lt;</span> <span class="n">jetsInLHEF</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;_wv.dat&quot;</span><span class="p">;</span>
  <span class="c1">// Write histograms to file</span>
  <span class="n">write</span><span class="p">.</span><span class="n">open</span><span class="p">(</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)(</span><span class="n">oPath</span> <span class="o">+</span> <span class="s">&quot;PTjet1_&quot;</span> <span class="o">+</span> <span class="n">suffix</span><span class="p">.</span><span class="n">str</span><span class="p">()).</span><span class="n">c_str</span><span class="p">());</span>
  <span class="n">histPTFirst</span><span class="p">.</span><span class="n">table</span><span class="p">(</span><span class="n">write</span><span class="p">);</span>
  <span class="n">write</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
  <span class="n">write</span><span class="p">.</span><span class="n">open</span><span class="p">(</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)(</span><span class="n">oPath</span> <span class="o">+</span> <span class="s">&quot;PTjet2_&quot;</span> <span class="o">+</span> <span class="n">suffix</span><span class="p">.</span><span class="n">str</span><span class="p">()).</span><span class="n">c_str</span><span class="p">());</span>
  <span class="n">histPTSecond</span><span class="p">.</span><span class="n">table</span><span class="p">(</span><span class="n">write</span><span class="p">);</span>
  <span class="n">write</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
  <span class="n">write</span><span class="p">.</span><span class="n">open</span><span class="p">(</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)(</span><span class="n">oPath</span> <span class="o">+</span> <span class="s">&quot;PTjet3_&quot;</span> <span class="o">+</span> <span class="n">suffix</span><span class="p">.</span><span class="n">str</span><span class="p">()).</span><span class="n">c_str</span><span class="p">());</span>
  <span class="n">histPTThird</span><span class="p">.</span><span class="n">table</span><span class="p">(</span><span class="n">write</span><span class="p">);</span>
  <span class="n">write</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
  <span class="c1">// Done</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
    </div>
  </div>
</div>

</div> <div class="well well-sm"> <h1 id="main82cc">main82.cc</h1><hr>
<div class="codehilite"><pre><span class="c1">// main82.cc is a part of the PYTHIA event generator.</span>
<span class="c1">// Copyright (C) 2016 Torbjorn Sjostrand.</span>
<span class="c1">// PYTHIA is licenced under the GNU GPL version 2, see COPYING for details.</span>
<span class="c1">// Please respect the MCnet Guidelines, see GUIDELINES for details.</span>
<span class="c1">// This program is written by Stefan Prestel.</span>
<span class="c1">// It illustrates how to do CKKW-L merging, see the Matrix Element</span>
<span class="c1">// Merging page in the online manual. An example command is</span>
<span class="c1">//     ./main82 main82.cmnd w+_production_lhc_0.lhe histout82.dat</span>
<span class="c1">// where main82.cmnd supplies the commands, w+_production_lhc_0.lhe</span>
<span class="c1">// provides the input LHE events, and histout82.dat is the output</span>
<span class="c1">// file. This example requires FastJet.</span>
</pre></div>


<div class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" href="#fileid54">Rest of the main82.cc code</a>
    </h4>
  </div>
  <div id="fileid54" class="panel-collapse collapse">
    <div class="panel-body">
<div class="codehilite"><pre><span class="cp">#include</span> <span class="cpf">&quot;Pythia8/Pythia.h&quot;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">Pythia8</span><span class="p">;</span>
<span class="c1">// Functions for histogramming</span>
<span class="cp">#include</span> <span class="cpf">&quot;fastjet/PseudoJet.hh&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;fastjet/ClusterSequence.hh&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;fastjet/CDFMidPointPlugin.hh&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;fastjet/CDFJetCluPlugin.hh&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;fastjet/D0RunIIConePlugin.hh&quot;</span><span class="cp"></span>
<span class="c1">//==========================================================================</span>
<span class="c1">// Find the Durham kT separation of the clustering from</span>
<span class="c1">// nJetMin --&gt; nJetMin-1 jets in te input event</span>
<span class="kt">double</span> <span class="nf">pTfirstJet</span><span class="p">(</span> <span class="k">const</span> <span class="n">Event</span><span class="o">&amp;</span> <span class="n">event</span><span class="p">,</span> <span class="kt">int</span> <span class="n">nJetMin</span><span class="p">,</span> <span class="kt">double</span> <span class="n">Rparam</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">double</span> <span class="n">yPartonMax</span> <span class="o">=</span> <span class="mf">4.</span><span class="p">;</span>
  <span class="c1">// Fastjet analysis - select algorithm and parameters</span>
  <span class="n">fastjet</span><span class="o">::</span><span class="n">Strategy</span>               <span class="n">strategy</span> <span class="o">=</span> <span class="n">fastjet</span><span class="o">::</span><span class="n">Best</span><span class="p">;</span>
  <span class="n">fastjet</span><span class="o">::</span><span class="n">RecombinationScheme</span>    <span class="n">recombScheme</span> <span class="o">=</span> <span class="n">fastjet</span><span class="o">::</span><span class="n">E_scheme</span><span class="p">;</span>
  <span class="n">fastjet</span><span class="o">::</span><span class="n">JetDefinition</span>         <span class="o">*</span><span class="n">jetDef</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
  <span class="c1">// For hadronic collision, use hadronic Durham kT measure</span>
  <span class="k">if</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">colType</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">event</span><span class="p">[</span><span class="mi">4</span><span class="p">].</span><span class="n">colType</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">jetDef</span> <span class="o">=</span> <span class="k">new</span> <span class="n">fastjet</span><span class="o">::</span><span class="n">JetDefinition</span><span class="p">(</span><span class="n">fastjet</span><span class="o">::</span><span class="n">kt_algorithm</span><span class="p">,</span> <span class="n">Rparam</span><span class="p">,</span>
                                      <span class="n">recombScheme</span><span class="p">,</span> <span class="n">strategy</span><span class="p">);</span>
  <span class="c1">// For e+e- collision, use e+e- Durham kT measure</span>
  <span class="k">else</span>
    <span class="n">jetDef</span> <span class="o">=</span> <span class="k">new</span> <span class="n">fastjet</span><span class="o">::</span><span class="n">JetDefinition</span><span class="p">(</span><span class="n">fastjet</span><span class="o">::</span><span class="n">ee_kt_algorithm</span><span class="p">,</span>
                                      <span class="n">recombScheme</span><span class="p">,</span> <span class="n">strategy</span><span class="p">);</span>
  <span class="c1">// Fastjet input</span>
  <span class="n">std</span><span class="o">::</span><span class="n">vector</span> <span class="o">&lt;</span><span class="n">fastjet</span><span class="o">::</span><span class="n">PseudoJet</span><span class="o">&gt;</span> <span class="n">fjInputs</span><span class="p">;</span>
  <span class="c1">// Reset Fastjet input</span>
  <span class="n">fjInputs</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="c1">// Loop over event record to decide what to pass to FastJet</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">event</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// (Final state &amp;&amp; coloured+photons) only!</span>
    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">isFinal</span><span class="p">()</span>
      <span class="o">||</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">isLepton</span><span class="p">()</span>
      <span class="o">||</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">id</span><span class="p">()</span> <span class="o">==</span> <span class="mi">23</span>
      <span class="o">||</span> <span class="n">abs</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">id</span><span class="p">())</span> <span class="o">==</span> <span class="mi">24</span>
      <span class="o">||</span> <span class="n">abs</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">y</span><span class="p">())</span> <span class="o">&gt;</span> <span class="n">yPartonMax</span><span class="p">)</span>
      <span class="k">continue</span><span class="p">;</span>
    <span class="c1">// Store as input to Fastjet</span>
    <span class="n">fjInputs</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span> <span class="n">fastjet</span><span class="o">::</span><span class="n">PseudoJet</span> <span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">px</span><span class="p">(),</span>
            <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">py</span><span class="p">(),</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pz</span><span class="p">(),</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">e</span><span class="p">()</span> <span class="p">)</span> <span class="p">);</span>
  <span class="p">}</span>
  <span class="c1">// Do nothing for empty input</span>
  <span class="k">if</span> <span class="p">(</span><span class="kt">int</span><span class="p">(</span><span class="n">fjInputs</span><span class="p">.</span><span class="n">size</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">delete</span> <span class="n">jetDef</span><span class="p">;</span>
    <span class="k">return</span> <span class="mf">0.0</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// Run Fastjet algorithm</span>
  <span class="n">fastjet</span><span class="o">::</span><span class="n">ClusterSequence</span> <span class="n">clustSeq</span><span class="p">(</span><span class="n">fjInputs</span><span class="p">,</span> <span class="o">*</span><span class="n">jetDef</span><span class="p">);</span>
  <span class="c1">// Extract kT of first clustering</span>
  <span class="kt">double</span> <span class="n">pTFirst</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">clustSeq</span><span class="p">.</span><span class="n">exclusive_dmerge_max</span><span class="p">(</span><span class="n">nJetMin</span><span class="o">-</span><span class="mi">1</span><span class="p">));</span>
  <span class="k">delete</span> <span class="n">jetDef</span><span class="p">;</span>
  <span class="c1">// Return kT</span>
  <span class="k">return</span> <span class="n">pTFirst</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">//==========================================================================</span>
<span class="c1">// Class for user interaction with the merging</span>
<span class="k">class</span> <span class="nc">MyMergingHooks</span> <span class="o">:</span> <span class="k">public</span> <span class="n">MergingHooks</span> <span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
<span class="k">public</span><span class="o">:</span>
  <span class="c1">// Default constructor</span>
  <span class="n">MyMergingHooks</span><span class="p">();</span>
  <span class="c1">// Destructor</span>
  <span class="o">~</span><span class="n">MyMergingHooks</span><span class="p">();</span>
  <span class="c1">// Functional definition of the merging scale</span>
  <span class="k">virtual</span> <span class="kt">double</span> <span class="nf">tmsDefinition</span><span class="p">(</span> <span class="k">const</span> <span class="n">Event</span><span class="o">&amp;</span> <span class="n">event</span><span class="p">);</span>
  <span class="c1">// Helper function for tms definition</span>
  <span class="kt">double</span> <span class="nf">myKTdurham</span><span class="p">(</span><span class="k">const</span> <span class="n">Particle</span><span class="o">&amp;</span> <span class="n">RadAfterBranch</span><span class="p">,</span>
           <span class="k">const</span> <span class="n">Particle</span><span class="o">&amp;</span> <span class="n">EmtAfterBranch</span><span class="p">,</span> <span class="kt">int</span> <span class="n">Type</span><span class="p">,</span> <span class="kt">double</span> <span class="n">D</span> <span class="p">);</span>
<span class="p">};</span>
<span class="c1">//--------------------------------------------------------------------------</span>
<span class="c1">// Constructor</span>
<span class="n">MyMergingHooks</span><span class="o">::</span><span class="n">MyMergingHooks</span><span class="p">()</span> <span class="p">{}</span>
<span class="c1">// Destructor</span>
<span class="n">MyMergingHooks</span><span class="o">::~</span><span class="n">MyMergingHooks</span><span class="p">()</span> <span class="p">{}</span>
<span class="c1">//--------------------------------------------------------------------------</span>
<span class="c1">// Definition of the merging scale</span>
<span class="kt">double</span> <span class="n">MyMergingHooks</span><span class="o">::</span><span class="n">tmsDefinition</span><span class="p">(</span> <span class="k">const</span> <span class="n">Event</span><span class="o">&amp;</span> <span class="n">event</span><span class="p">){</span>
  <span class="c1">// Cut only on QCD partons!</span>
  <span class="c1">// Count particle types</span>
  <span class="kt">int</span> <span class="n">nFinalColoured</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">nFinalNow</span> <span class="o">=</span><span class="mi">0</span><span class="p">;</span>
  <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">event</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">isFinal</span><span class="p">()){</span>
      <span class="k">if</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">id</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">23</span> <span class="o">&amp;&amp;</span> <span class="n">abs</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">id</span><span class="p">())</span> <span class="o">!=</span> <span class="mi">24</span><span class="p">)</span>
        <span class="n">nFinalNow</span><span class="o">++</span><span class="p">;</span>
      <span class="k">if</span><span class="p">(</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">colType</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">nFinalColoured</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="c1">// Use MergingHooks in-built functions to get information on the hard process</span>
  <span class="kt">int</span> <span class="n">nLeptons</span> <span class="o">=</span> <span class="n">nHardOutLeptons</span><span class="p">();</span>
  <span class="kt">int</span> <span class="n">nQuarks</span>  <span class="o">=</span> <span class="n">nHardOutPartons</span><span class="p">();</span>
  <span class="kt">int</span> <span class="n">nResNow</span>  <span class="o">=</span> <span class="n">nResInCurrent</span><span class="p">();</span>
  <span class="c1">// Check if photons, electrons etc. have been produced. If so, do not veto</span>
  <span class="k">if</span><span class="p">(</span><span class="n">nFinalNow</span> <span class="o">-</span> <span class="p">(</span> <span class="p">(</span><span class="n">nLeptons</span><span class="o">+</span><span class="n">nQuarks</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">nResNow</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span> <span class="o">!=</span> <span class="n">nFinalColoured</span><span class="p">){</span>
    <span class="c1">// Sometimes, Pythia detaches the decay products even though no</span>
    <span class="c1">// resonance was put into the LHE file, to catch this, add another</span>
    <span class="c1">// if statement</span>
    <span class="k">if</span><span class="p">(</span><span class="n">nFinalNow</span> <span class="o">!=</span> <span class="n">nFinalColoured</span><span class="p">)</span> <span class="k">return</span> <span class="mf">0.</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// Check that one parton has been produced. If not (e.g. in MPI), do not veto</span>
  <span class="kt">int</span> <span class="n">nMPI</span> <span class="o">=</span> <span class="n">infoPtr</span><span class="o">-&gt;</span><span class="n">nMPI</span><span class="p">();</span>
  <span class="k">if</span><span class="p">(</span><span class="n">nMPI</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="k">return</span> <span class="mf">0.</span><span class="p">;</span>
  <span class="c1">// Declare kT algorithm parameters</span>
  <span class="kt">double</span> <span class="n">Dparam</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">kTtype</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="c1">// Declare final parton vector</span>
  <span class="n">vector</span> <span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">FinalPartPos</span><span class="p">;</span>
  <span class="n">FinalPartPos</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
  <span class="c1">// Search event record for final state partons</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">event</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
    <span class="k">if</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">isFinal</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">colType</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
      <span class="n">FinalPartPos</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
  <span class="c1">// Find minimal Durham kT in event, using own function: Check</span>
  <span class="c1">// definition of separation</span>
  <span class="kt">int</span> <span class="n">type</span> <span class="o">=</span> <span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">colType</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">event</span><span class="p">[</span><span class="mi">4</span><span class="p">].</span><span class="n">colType</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="n">kTtype</span><span class="p">;</span>
  <span class="c1">// Find minimal kT</span>
  <span class="kt">double</span> <span class="n">ktmin</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">e</span><span class="p">();</span>
  <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="kt">int</span><span class="p">(</span><span class="n">FinalPartPos</span><span class="p">.</span><span class="n">size</span><span class="p">());</span> <span class="o">++</span><span class="n">i</span><span class="p">){</span>
    <span class="kt">double</span> <span class="n">kt12</span>  <span class="o">=</span> <span class="n">ktmin</span><span class="p">;</span>
    <span class="c1">// Compute separation to the beam axis for hadronic collisions</span>
    <span class="k">if</span><span class="p">(</span><span class="n">type</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="o">||</span> <span class="n">type</span> <span class="o">==</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
      <span class="kt">double</span> <span class="n">temp</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="n">FinalPartPos</span><span class="p">[</span><span class="n">i</span><span class="p">]].</span><span class="n">pT</span><span class="p">();</span>
      <span class="n">kt12</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">kt12</span><span class="p">,</span> <span class="n">temp</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="c1">// Compute separation to other final state jets</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="kt">int</span><span class="p">(</span><span class="n">FinalPartPos</span><span class="p">.</span><span class="n">size</span><span class="p">());</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
      <span class="kt">double</span> <span class="n">temp</span> <span class="o">=</span> <span class="n">kTdurham</span><span class="p">(</span> <span class="n">event</span><span class="p">[</span><span class="n">FinalPartPos</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span> <span class="n">event</span><span class="p">[</span><span class="n">FinalPartPos</span><span class="p">[</span><span class="n">j</span><span class="p">]],</span>
                      <span class="n">type</span><span class="p">,</span> <span class="n">Dparam</span><span class="p">);</span>
      <span class="n">kt12</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">kt12</span><span class="p">,</span> <span class="n">temp</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="c1">// Keep the minimal Durham separation</span>
    <span class="n">ktmin</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">ktmin</span><span class="p">,</span><span class="n">kt12</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="c1">// Return minimal Durham kT</span>
  <span class="k">return</span> <span class="n">ktmin</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">//--------------------------------------------------------------------------</span>
<span class="c1">// Function to compute durham y separation from Particle input</span>
<span class="kt">double</span> <span class="n">MyMergingHooks</span><span class="o">::</span><span class="n">myKTdurham</span><span class="p">(</span><span class="k">const</span> <span class="n">Particle</span><span class="o">&amp;</span> <span class="n">RadAfterBranch</span><span class="p">,</span>
  <span class="k">const</span> <span class="n">Particle</span><span class="o">&amp;</span> <span class="n">EmtAfterBranch</span><span class="p">,</span> <span class="kt">int</span> <span class="n">Type</span><span class="p">,</span> <span class="kt">double</span> <span class="n">D</span> <span class="p">){</span>
  <span class="c1">// Declare return variable</span>
  <span class="kt">double</span> <span class="n">ktdur</span><span class="p">;</span>
  <span class="c1">// Save 4-momenta of final state particles</span>
  <span class="n">Vec4</span> <span class="n">jet1</span> <span class="o">=</span> <span class="n">RadAfterBranch</span><span class="p">.</span><span class="n">p</span><span class="p">();</span>
  <span class="n">Vec4</span> <span class="n">jet2</span> <span class="o">=</span> <span class="n">EmtAfterBranch</span><span class="p">.</span><span class="n">p</span><span class="p">();</span>
  <span class="k">if</span><span class="p">(</span> <span class="n">Type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Get angle between jets for e+e- collisions, make sure that</span>
    <span class="c1">// -1 &lt;= cos(theta) &lt;= 1</span>
    <span class="kt">double</span> <span class="n">costh</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">jet1</span><span class="p">.</span><span class="n">pAbs</span><span class="p">()</span><span class="o">*</span><span class="n">jet2</span><span class="p">.</span><span class="n">pAbs</span><span class="p">()</span> <span class="o">&lt;=</span><span class="mf">0.</span><span class="p">)</span> <span class="n">costh</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">;</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="n">costh</span> <span class="o">=</span> <span class="n">costheta</span><span class="p">(</span><span class="n">jet1</span><span class="p">,</span><span class="n">jet2</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="c1">// Calculate kt durham separation between jets for e+e- collisions</span>
    <span class="n">ktdur</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">min</span><span class="p">(</span> <span class="n">pow</span><span class="p">(</span><span class="n">jet1</span><span class="p">.</span><span class="n">e</span><span class="p">(),</span><span class="mi">2</span><span class="p">)</span> <span class="p">,</span> <span class="p">(</span><span class="n">pow</span><span class="p">(</span><span class="n">jet2</span><span class="p">.</span><span class="n">e</span><span class="p">(),</span><span class="mi">2</span><span class="p">))</span> <span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">costh</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span> <span class="n">Type</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="p">){</span>
    <span class="c1">// Get delta_eta and cosh(Delta_eta) for hadronic collisions</span>
    <span class="kt">double</span> <span class="n">eta1</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">log</span><span class="p">(</span> <span class="p">(</span><span class="n">jet1</span><span class="p">.</span><span class="n">e</span><span class="p">()</span> <span class="o">+</span> <span class="n">jet1</span><span class="p">.</span><span class="n">pz</span><span class="p">())</span> <span class="o">/</span> <span class="p">(</span><span class="n">jet1</span><span class="p">.</span><span class="n">e</span><span class="p">()</span> <span class="o">-</span> <span class="n">jet1</span><span class="p">.</span><span class="n">pz</span><span class="p">())</span> <span class="p">);</span>
    <span class="kt">double</span> <span class="n">eta2</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">log</span><span class="p">(</span> <span class="p">(</span><span class="n">jet2</span><span class="p">.</span><span class="n">e</span><span class="p">()</span> <span class="o">+</span> <span class="n">jet2</span><span class="p">.</span><span class="n">pz</span><span class="p">())</span> <span class="o">/</span> <span class="p">(</span><span class="n">jet2</span><span class="p">.</span><span class="n">e</span><span class="p">()</span> <span class="o">-</span> <span class="n">jet2</span><span class="p">.</span><span class="n">pz</span><span class="p">())</span> <span class="p">);</span>
    <span class="c1">// Get delta_phi and cos(Delta_phi) for hadronic collisions</span>
    <span class="kt">double</span> <span class="n">pt1</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span> <span class="n">pow</span><span class="p">(</span><span class="n">jet1</span><span class="p">.</span><span class="n">px</span><span class="p">(),</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">pow</span><span class="p">(</span><span class="n">jet1</span><span class="p">.</span><span class="n">py</span><span class="p">(),</span><span class="mi">2</span><span class="p">)</span> <span class="p">);</span>
    <span class="kt">double</span> <span class="n">pt2</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span> <span class="n">pow</span><span class="p">(</span><span class="n">jet2</span><span class="p">.</span><span class="n">px</span><span class="p">(),</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">pow</span><span class="p">(</span><span class="n">jet2</span><span class="p">.</span><span class="n">py</span><span class="p">(),</span><span class="mi">2</span><span class="p">)</span> <span class="p">);</span>
    <span class="kt">double</span> <span class="n">cosdPhi</span> <span class="o">=</span> <span class="p">(</span> <span class="n">jet1</span><span class="p">.</span><span class="n">px</span><span class="p">()</span><span class="o">*</span><span class="n">jet2</span><span class="p">.</span><span class="n">px</span><span class="p">()</span> <span class="o">+</span> <span class="n">jet1</span><span class="p">.</span><span class="n">py</span><span class="p">()</span><span class="o">*</span><span class="n">jet2</span><span class="p">.</span><span class="n">py</span><span class="p">()</span> <span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">pt1</span><span class="o">*</span><span class="n">pt2</span><span class="p">);</span>
    <span class="kt">double</span> <span class="n">dPhi</span> <span class="o">=</span> <span class="n">acos</span><span class="p">(</span> <span class="n">cosdPhi</span> <span class="p">);</span>
    <span class="c1">// Calculate kT durham like fastjet</span>
     <span class="n">ktdur</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span> <span class="n">pow</span><span class="p">(</span><span class="n">pt1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">pow</span><span class="p">(</span><span class="n">pt2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="p">)</span>
           <span class="o">*</span> <span class="p">(</span> <span class="n">pow</span><span class="p">(</span><span class="n">eta1</span><span class="o">-</span><span class="n">eta2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">pow</span><span class="p">(</span><span class="n">dPhi</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="p">)</span> <span class="o">/</span> <span class="n">pow</span><span class="p">(</span><span class="n">D</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span> <span class="n">Type</span> <span class="o">==</span> <span class="o">-</span><span class="mi">2</span> <span class="p">){</span>
    <span class="c1">// Get delta_eta and cosh(Delta_eta) for hadronic collisions</span>
    <span class="kt">double</span> <span class="n">eta1</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">log</span><span class="p">(</span> <span class="p">(</span><span class="n">jet1</span><span class="p">.</span><span class="n">e</span><span class="p">()</span> <span class="o">+</span> <span class="n">jet1</span><span class="p">.</span><span class="n">pz</span><span class="p">())</span> <span class="o">/</span> <span class="p">(</span><span class="n">jet1</span><span class="p">.</span><span class="n">e</span><span class="p">()</span> <span class="o">-</span> <span class="n">jet1</span><span class="p">.</span><span class="n">pz</span><span class="p">())</span> <span class="p">);</span>
    <span class="kt">double</span> <span class="n">eta2</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">log</span><span class="p">(</span> <span class="p">(</span><span class="n">jet2</span><span class="p">.</span><span class="n">e</span><span class="p">()</span> <span class="o">+</span> <span class="n">jet2</span><span class="p">.</span><span class="n">pz</span><span class="p">())</span> <span class="o">/</span> <span class="p">(</span><span class="n">jet2</span><span class="p">.</span><span class="n">e</span><span class="p">()</span> <span class="o">-</span> <span class="n">jet2</span><span class="p">.</span><span class="n">pz</span><span class="p">())</span> <span class="p">);</span>
     <span class="kt">double</span> <span class="n">coshdEta</span> <span class="o">=</span> <span class="n">cosh</span><span class="p">(</span> <span class="n">eta1</span> <span class="o">-</span> <span class="n">eta2</span> <span class="p">);</span>
    <span class="c1">// Get delta_phi and cos(Delta_phi) for hadronic collisions</span>
    <span class="kt">double</span> <span class="n">pt1</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span> <span class="n">pow</span><span class="p">(</span><span class="n">jet1</span><span class="p">.</span><span class="n">px</span><span class="p">(),</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">pow</span><span class="p">(</span><span class="n">jet1</span><span class="p">.</span><span class="n">py</span><span class="p">(),</span><span class="mi">2</span><span class="p">)</span> <span class="p">);</span>
    <span class="kt">double</span> <span class="n">pt2</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span> <span class="n">pow</span><span class="p">(</span><span class="n">jet2</span><span class="p">.</span><span class="n">px</span><span class="p">(),</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">pow</span><span class="p">(</span><span class="n">jet2</span><span class="p">.</span><span class="n">py</span><span class="p">(),</span><span class="mi">2</span><span class="p">)</span> <span class="p">);</span>
    <span class="kt">double</span> <span class="n">cosdPhi</span> <span class="o">=</span> <span class="p">(</span> <span class="n">jet1</span><span class="p">.</span><span class="n">px</span><span class="p">()</span><span class="o">*</span><span class="n">jet2</span><span class="p">.</span><span class="n">px</span><span class="p">()</span> <span class="o">+</span> <span class="n">jet1</span><span class="p">.</span><span class="n">py</span><span class="p">()</span><span class="o">*</span><span class="n">jet2</span><span class="p">.</span><span class="n">py</span><span class="p">()</span> <span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">pt1</span><span class="o">*</span><span class="n">pt2</span><span class="p">);</span>
    <span class="c1">// Calculate kT durham separation &quot;SHERPA-like&quot;</span>
     <span class="n">ktdur</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">min</span><span class="p">(</span> <span class="n">pow</span><span class="p">(</span><span class="n">pt1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">pow</span><span class="p">(</span><span class="n">pt2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="p">)</span>
           <span class="o">*</span> <span class="p">(</span> <span class="n">coshdEta</span> <span class="o">-</span> <span class="n">cosdPhi</span> <span class="p">)</span> <span class="o">/</span> <span class="n">pow</span><span class="p">(</span><span class="n">D</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="n">ktdur</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// Return kT</span>
  <span class="k">return</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">ktdur</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">//==========================================================================</span>
<span class="c1">// Example main programm to illustrate merging</span>
<span class="kt">int</span> <span class="n">main</span><span class="p">(</span> <span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[]</span> <span class="p">){</span>
  <span class="c1">// Check that correct number of command-line arguments</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; Unexpected number of command-line arguments. </span><span class="se">\n</span><span class="s"> You are&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; expected to provide the arguments </span><span class="se">\n</span><span class="s">&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; 1. Input file for settings </span><span class="se">\n</span><span class="s">&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; 2. Full name of the input LHE file (with path) </span><span class="se">\n</span><span class="s">&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; 3. Path for output histogram files </span><span class="se">\n</span><span class="s">&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; Program stopped. &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">Pythia</span> <span class="n">pythia</span><span class="p">;</span>
  <span class="c1">// Input parameters:</span>
  <span class="c1">//  1. Input file for settings</span>
  <span class="c1">//  2. Path to input LHE file</span>
  <span class="c1">//  3. Output histogram path</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readFile</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
  <span class="n">string</span> <span class="n">iPath</span> <span class="o">=</span> <span class="n">string</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
  <span class="n">string</span> <span class="n">oPath</span> <span class="o">=</span> <span class="n">string</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>
  <span class="c1">// Number of events</span>
  <span class="kt">int</span> <span class="n">nEvent</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Main:numberOfEvents&quot;</span><span class="p">);</span>
  <span class="c1">// Construct user inut for merging</span>
  <span class="n">MergingHooks</span><span class="o">*</span> <span class="n">myMergingHooks</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MyMergingHooks</span><span class="p">();</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">setMergingHooksPtr</span><span class="p">(</span> <span class="n">myMergingHooks</span> <span class="p">);</span>
  <span class="c1">// For ISR regularisation off</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">forceParm</span><span class="p">(</span><span class="s">&quot;SpaceShower:pT0Ref&quot;</span><span class="p">,</span><span class="mf">0.</span><span class="p">);</span>
  <span class="c1">// Declare histograms</span>
  <span class="n">Hist</span> <span class="nf">histPTFirst</span><span class="p">(</span><span class="s">&quot;pT of first jet&quot;</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">100.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="nf">histPTSecond</span><span class="p">(</span><span class="s">&quot;pT of second jet&quot;</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">100.</span><span class="p">);</span>
  <span class="c1">// Read in ME configurations</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Beams:frameType = 4&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Beams:LHEF = &quot;</span> <span class="o">+</span> <span class="n">iPath</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
  <span class="c1">// Start generation loop</span>
  <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">iEvent</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">iEvent</span><span class="o">&lt;</span><span class="n">nEvent</span><span class="p">;</span> <span class="o">++</span><span class="n">iEvent</span> <span class="p">){</span>
    <span class="c1">// Generate next event</span>
    <span class="k">if</span><span class="p">(</span> <span class="o">!</span> <span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">())</span> <span class="k">continue</span><span class="p">;</span>
    <span class="c1">// Get CKKWL weight of current event</span>
    <span class="kt">double</span> <span class="n">weight</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">mergingWeight</span><span class="p">();</span>
    <span class="c1">// Fill bins with CKKWL weight</span>
    <span class="kt">double</span> <span class="n">pTfirst</span> <span class="o">=</span> <span class="n">pTfirstJet</span><span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">);</span>
    <span class="kt">double</span> <span class="n">pTsecnd</span> <span class="o">=</span> <span class="n">pTfirstJet</span><span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">);</span>
    <span class="n">histPTFirst</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">pTfirst</span><span class="p">,</span> <span class="n">weight</span><span class="p">);</span>
    <span class="n">histPTSecond</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">pTsecnd</span><span class="p">,</span> <span class="n">weight</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">iEvent</span><span class="o">%</span><span class="mi">1000</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">iEvent</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="p">}</span> <span class="c1">// end loop over events to generate</span>
  <span class="c1">// print cross section, errors</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
  <span class="c1">// Normalise histograms</span>
  <span class="kt">double</span> <span class="n">norm</span> <span class="o">=</span> <span class="mf">1.</span>
              <span class="o">*</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">sigmaGen</span><span class="p">()</span>
              <span class="o">*</span> <span class="mf">1.</span><span class="o">/</span> <span class="kt">double</span><span class="p">(</span><span class="n">nEvent</span><span class="p">);</span>
  <span class="n">histPTFirst</span>           <span class="o">*=</span> <span class="n">norm</span><span class="p">;</span>
  <span class="n">histPTSecond</span>          <span class="o">*=</span> <span class="n">norm</span><span class="p">;</span>
  <span class="c1">// Get the number of jets in the LHE file from the file name</span>
  <span class="n">string</span> <span class="n">jetsInLHEF</span> <span class="o">=</span> <span class="n">iPath</span><span class="p">.</span><span class="n">substr</span><span class="p">(</span><span class="n">iPath</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="n">iPath</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
  <span class="n">jetsInLHEF</span> <span class="o">=</span> <span class="n">jetsInLHEF</span><span class="p">.</span><span class="n">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">jetsInLHEF</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="o">-</span><span class="mi">4</span><span class="p">);</span>
  <span class="c1">// Write histograms to dat file. Use &quot;jetsInLHEF&quot; to label the files</span>
  <span class="c1">// Once all the samples up to the maximal desired jet multiplicity from the</span>
  <span class="c1">// matrix element are run, add all histograms to produce a</span>
  <span class="c1">// matrix-element-merged prediction</span>
  <span class="n">ofstream</span> <span class="n">write</span><span class="p">;</span>
  <span class="n">stringstream</span> <span class="n">suffix</span><span class="p">;</span>
  <span class="n">suffix</span> <span class="o">&lt;&lt;</span> <span class="n">jetsInLHEF</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;_wv.dat&quot;</span><span class="p">;</span>
  <span class="c1">// Write histograms to file</span>
  <span class="n">write</span><span class="p">.</span><span class="n">open</span><span class="p">(</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)(</span><span class="n">oPath</span> <span class="o">+</span> <span class="s">&quot;PTjet1_&quot;</span> <span class="o">+</span> <span class="n">suffix</span><span class="p">.</span><span class="n">str</span><span class="p">()).</span><span class="n">c_str</span><span class="p">());</span>
  <span class="n">histPTFirst</span><span class="p">.</span><span class="n">table</span><span class="p">(</span><span class="n">write</span><span class="p">);</span>
  <span class="n">write</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
  <span class="n">write</span><span class="p">.</span><span class="n">open</span><span class="p">(</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)(</span><span class="n">oPath</span> <span class="o">+</span> <span class="s">&quot;PTjet2_&quot;</span> <span class="o">+</span> <span class="n">suffix</span><span class="p">.</span><span class="n">str</span><span class="p">()).</span><span class="n">c_str</span><span class="p">());</span>
  <span class="n">histPTSecond</span><span class="p">.</span><span class="n">table</span><span class="p">(</span><span class="n">write</span><span class="p">);</span>
  <span class="n">write</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
  <span class="k">delete</span> <span class="n">myMergingHooks</span><span class="p">;</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
  <span class="c1">// Done</span>
<span class="p">}</span>
</pre></div>
    </div>
  </div>
</div>

</div> <div class="well well-sm"> <h1 id="main83cc">main83.cc</h1><hr>
<div class="codehilite"><pre><span class="c1">// main83.cc is a part of the PYTHIA event generator.</span>
<span class="c1">// Copyright (C) 2016 Torbjorn Sjostrand.</span>
<span class="c1">// PYTHIA is licenced under the GNU GPL version 2, see COPYING for details.</span>
<span class="c1">// Please respect the MCnet Guidelines, see GUIDELINES for details.</span>
<span class="c1">// This program is written by Stefan Prestel.</span>
<span class="c1">// It illustrates how to do CKKW-L merging, see the Matrix Element</span>
<span class="c1">// Merging page in the online manual. An example command is</span>
<span class="c1">//     ./main83 main83.cmnd w+_production_lhc_0.lhe histout83.dat</span>
<span class="c1">// where main83.cmnd supplies the commands, w+_production_lhc_0.lhe</span>
<span class="c1">// provides the input LHE events, and histout83.dat is the output</span>
<span class="c1">// file. This example requires FastJet.</span>
</pre></div>


<div class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" href="#fileid55">Rest of the main83.cc code</a>
    </h4>
  </div>
  <div id="fileid55" class="panel-collapse collapse">
    <div class="panel-body">
<div class="codehilite"><pre><span class="cp">#include</span> <span class="cpf">&quot;Pythia8/Pythia.h&quot;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">Pythia8</span><span class="p">;</span>
<span class="c1">// Functions for histogramming</span>
<span class="cp">#include</span> <span class="cpf">&quot;fastjet/PseudoJet.hh&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;fastjet/ClusterSequence.hh&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;fastjet/CDFMidPointPlugin.hh&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;fastjet/CDFJetCluPlugin.hh&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;fastjet/D0RunIIConePlugin.hh&quot;</span><span class="cp"></span>
<span class="c1">//==========================================================================</span>
<span class="c1">// Find the Durham kT separation of the clustering from</span>
<span class="c1">// nJetMin --&gt; nJetMin-1 jets in te input event</span>
<span class="kt">double</span> <span class="nf">pTfirstJet</span><span class="p">(</span> <span class="k">const</span> <span class="n">Event</span><span class="o">&amp;</span> <span class="n">event</span><span class="p">,</span> <span class="kt">int</span> <span class="n">nJetMin</span><span class="p">,</span> <span class="kt">double</span> <span class="n">Rparam</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">double</span> <span class="n">yPartonMax</span> <span class="o">=</span> <span class="mf">4.</span><span class="p">;</span>
  <span class="c1">// Fastjet analysis - select algorithm and parameters</span>
  <span class="n">fastjet</span><span class="o">::</span><span class="n">Strategy</span>               <span class="n">strategy</span> <span class="o">=</span> <span class="n">fastjet</span><span class="o">::</span><span class="n">Best</span><span class="p">;</span>
  <span class="n">fastjet</span><span class="o">::</span><span class="n">RecombinationScheme</span>    <span class="n">recombScheme</span> <span class="o">=</span> <span class="n">fastjet</span><span class="o">::</span><span class="n">E_scheme</span><span class="p">;</span>
  <span class="n">fastjet</span><span class="o">::</span><span class="n">JetDefinition</span>         <span class="o">*</span><span class="n">jetDef</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
  <span class="c1">// For hadronic collision, use hadronic Durham kT measure</span>
  <span class="k">if</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">colType</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">event</span><span class="p">[</span><span class="mi">4</span><span class="p">].</span><span class="n">colType</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">jetDef</span> <span class="o">=</span> <span class="k">new</span> <span class="n">fastjet</span><span class="o">::</span><span class="n">JetDefinition</span><span class="p">(</span><span class="n">fastjet</span><span class="o">::</span><span class="n">kt_algorithm</span><span class="p">,</span> <span class="n">Rparam</span><span class="p">,</span>
                                      <span class="n">recombScheme</span><span class="p">,</span> <span class="n">strategy</span><span class="p">);</span>
  <span class="c1">// For e+e- collision, use e+e- Durham kT measure</span>
  <span class="k">else</span>
    <span class="n">jetDef</span> <span class="o">=</span> <span class="k">new</span> <span class="n">fastjet</span><span class="o">::</span><span class="n">JetDefinition</span><span class="p">(</span><span class="n">fastjet</span><span class="o">::</span><span class="n">ee_kt_algorithm</span><span class="p">,</span>
                                      <span class="n">recombScheme</span><span class="p">,</span> <span class="n">strategy</span><span class="p">);</span>
  <span class="c1">// Fastjet input</span>
  <span class="n">std</span><span class="o">::</span><span class="n">vector</span> <span class="o">&lt;</span><span class="n">fastjet</span><span class="o">::</span><span class="n">PseudoJet</span><span class="o">&gt;</span> <span class="n">fjInputs</span><span class="p">;</span>
  <span class="c1">// Reset Fastjet input</span>
  <span class="n">fjInputs</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="c1">// Loop over event record to decide what to pass to FastJet</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">event</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// (Final state &amp;&amp; coloured+photons) only!</span>
    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">isFinal</span><span class="p">()</span>
      <span class="o">||</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">isLepton</span><span class="p">()</span>
      <span class="o">||</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">id</span><span class="p">()</span> <span class="o">==</span> <span class="mi">23</span>
      <span class="o">||</span> <span class="n">abs</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">id</span><span class="p">())</span> <span class="o">==</span> <span class="mi">24</span>
      <span class="o">||</span> <span class="n">abs</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">y</span><span class="p">())</span> <span class="o">&gt;</span> <span class="n">yPartonMax</span><span class="p">)</span>
      <span class="k">continue</span><span class="p">;</span>
    <span class="c1">// Store as input to Fastjet</span>
    <span class="n">fjInputs</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span> <span class="n">fastjet</span><span class="o">::</span><span class="n">PseudoJet</span> <span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">px</span><span class="p">(),</span>
            <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">py</span><span class="p">(),</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pz</span><span class="p">(),</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">e</span><span class="p">()</span> <span class="p">)</span> <span class="p">);</span>
  <span class="p">}</span>
  <span class="c1">// Do nothing for empty input</span>
  <span class="k">if</span> <span class="p">(</span><span class="kt">int</span><span class="p">(</span><span class="n">fjInputs</span><span class="p">.</span><span class="n">size</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">delete</span> <span class="n">jetDef</span><span class="p">;</span>
    <span class="k">return</span> <span class="mf">0.0</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// Run Fastjet algorithm</span>
  <span class="n">fastjet</span><span class="o">::</span><span class="n">ClusterSequence</span> <span class="n">clustSeq</span><span class="p">(</span><span class="n">fjInputs</span><span class="p">,</span> <span class="o">*</span><span class="n">jetDef</span><span class="p">);</span>
  <span class="c1">// Extract kT of first clustering</span>
  <span class="kt">double</span> <span class="n">pTFirst</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">clustSeq</span><span class="p">.</span><span class="n">exclusive_dmerge_max</span><span class="p">(</span><span class="n">nJetMin</span><span class="o">-</span><span class="mi">1</span><span class="p">));</span>
  <span class="k">delete</span> <span class="n">jetDef</span><span class="p">;</span>
  <span class="c1">// Return kT</span>
  <span class="k">return</span> <span class="n">pTFirst</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">//==========================================================================</span>
<span class="c1">// Class for user interaction with the merging</span>
<span class="k">class</span> <span class="nc">MyMergingHooks</span> <span class="o">:</span> <span class="k">public</span> <span class="n">MergingHooks</span> <span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
<span class="k">public</span><span class="o">:</span>
  <span class="c1">// Default constructor</span>
  <span class="n">MyMergingHooks</span><span class="p">();</span>
  <span class="c1">// Destructor</span>
  <span class="o">~</span><span class="n">MyMergingHooks</span><span class="p">();</span>
  <span class="c1">// Functional definition of the merging scale</span>
  <span class="k">virtual</span> <span class="kt">double</span> <span class="nf">tmsDefinition</span><span class="p">(</span> <span class="k">const</span> <span class="n">Event</span><span class="o">&amp;</span> <span class="n">event</span><span class="p">);</span>
  <span class="c1">// Function to dampen weights calculated from histories with lowest</span>
  <span class="c1">// multiplicity reclustered events that do not pass the ME cuts</span>
  <span class="k">virtual</span> <span class="kt">double</span> <span class="nf">dampenIfFailCuts</span><span class="p">(</span> <span class="k">const</span> <span class="n">Event</span><span class="o">&amp;</span> <span class="n">inEvent</span> <span class="p">);</span>
  <span class="c1">// Helper function for tms definition</span>
  <span class="kt">double</span> <span class="nf">myKTdurham</span><span class="p">(</span><span class="k">const</span> <span class="n">Particle</span><span class="o">&amp;</span> <span class="n">RadAfterBranch</span><span class="p">,</span>
           <span class="k">const</span> <span class="n">Particle</span><span class="o">&amp;</span> <span class="n">EmtAfterBranch</span><span class="p">,</span> <span class="kt">int</span> <span class="n">Type</span><span class="p">,</span> <span class="kt">double</span> <span class="n">D</span> <span class="p">);</span>
<span class="p">};</span>
<span class="c1">//--------------------------------------------------------------------------</span>
<span class="c1">// Constructor</span>
<span class="n">MyMergingHooks</span><span class="o">::</span><span class="n">MyMergingHooks</span><span class="p">()</span> <span class="p">{}</span>
<span class="c1">// Desctructor</span>
<span class="n">MyMergingHooks</span><span class="o">::~</span><span class="n">MyMergingHooks</span><span class="p">()</span> <span class="p">{}</span>
<span class="c1">//--------------------------------------------------------------------------</span>
<span class="kt">double</span> <span class="n">MyMergingHooks</span><span class="o">::</span><span class="n">dampenIfFailCuts</span><span class="p">(</span> <span class="k">const</span> <span class="n">Event</span><span class="o">&amp;</span> <span class="n">inEvent</span> <span class="p">){</span>
  <span class="c1">// Get pT for pure QCD 2-&gt;2 state</span>
  <span class="kt">double</span> <span class="n">pT</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">;</span>
  <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">inEvent</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
    <span class="k">if</span><span class="p">(</span><span class="n">inEvent</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">isFinal</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">inEvent</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">colType</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">pT</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">pow</span><span class="p">(</span><span class="n">inEvent</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">px</span><span class="p">(),</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">pow</span><span class="p">(</span><span class="n">inEvent</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">py</span><span class="p">(),</span><span class="mi">2</span><span class="p">));</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="c1">// Veto history if lowest multiplicity event does not pass ME cuts</span>
  <span class="k">if</span><span class="p">(</span><span class="n">pT</span> <span class="o">&lt;</span> <span class="mf">10.</span><span class="p">)</span> <span class="k">return</span> <span class="mf">0.</span><span class="p">;</span>
  <span class="k">return</span> <span class="mf">1.</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">//--------------------------------------------------------------------------</span>
<span class="c1">// Definition of the merging scale</span>
<span class="kt">double</span> <span class="n">MyMergingHooks</span><span class="o">::</span><span class="n">tmsDefinition</span><span class="p">(</span> <span class="k">const</span> <span class="n">Event</span><span class="o">&amp;</span> <span class="n">event</span><span class="p">){</span>
  <span class="c1">// Cut only on QCD partons!</span>
  <span class="c1">// Count particle types</span>
  <span class="kt">int</span> <span class="n">nFinalColoured</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">nFinalNow</span> <span class="o">=</span><span class="mi">0</span><span class="p">;</span>
  <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">event</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">isFinal</span><span class="p">()){</span>
      <span class="k">if</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">id</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">23</span> <span class="o">&amp;&amp;</span> <span class="n">abs</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">id</span><span class="p">())</span> <span class="o">!=</span> <span class="mi">24</span><span class="p">)</span>
        <span class="n">nFinalNow</span><span class="o">++</span><span class="p">;</span>
      <span class="k">if</span><span class="p">(</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">colType</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">nFinalColoured</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="c1">// Use MergingHooks in-built functions to get information on the hard process</span>
  <span class="kt">int</span> <span class="n">nLeptons</span> <span class="o">=</span> <span class="n">nHardOutLeptons</span><span class="p">();</span>
  <span class="kt">int</span> <span class="n">nQuarks</span>  <span class="o">=</span> <span class="n">nHardOutPartons</span><span class="p">();</span>
  <span class="kt">int</span> <span class="n">nResNow</span>  <span class="o">=</span> <span class="n">nResInCurrent</span><span class="p">();</span>
  <span class="c1">// Check if photons, electrons etc. have been produced. If so, do not veto</span>
  <span class="k">if</span><span class="p">(</span><span class="n">nFinalNow</span> <span class="o">-</span> <span class="p">(</span> <span class="p">(</span><span class="n">nLeptons</span><span class="o">+</span><span class="n">nQuarks</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">nResNow</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span> <span class="o">!=</span> <span class="n">nFinalColoured</span><span class="p">){</span>
    <span class="c1">// Sometimes, Pythia detaches the decay products even though no</span>
    <span class="c1">// resonance was put into the LHE file, to catch this, add another</span>
    <span class="c1">// if statement</span>
    <span class="k">if</span><span class="p">(</span><span class="n">nFinalNow</span> <span class="o">!=</span> <span class="n">nFinalColoured</span><span class="p">)</span> <span class="k">return</span> <span class="mf">0.</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// Check that one parton has been produced. If not (e.g. in MPI), do not veto</span>
  <span class="kt">int</span> <span class="n">nMPI</span> <span class="o">=</span> <span class="n">infoPtr</span><span class="o">-&gt;</span><span class="n">nMPI</span><span class="p">();</span>
  <span class="k">if</span><span class="p">(</span><span class="n">nMPI</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="k">return</span> <span class="mf">0.</span><span class="p">;</span>
  <span class="c1">// Declare kT algorithm parameters</span>
  <span class="kt">double</span> <span class="n">Dparam</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">kTtype</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="c1">// Declare final parton vector</span>
  <span class="n">vector</span> <span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">FinalPartPos</span><span class="p">;</span>
  <span class="n">FinalPartPos</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
  <span class="c1">// Search event record for final state partons</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">event</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
    <span class="k">if</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">isFinal</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">colType</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
      <span class="n">FinalPartPos</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
  <span class="c1">// Find minimal Durham kT in event, using own function: Check</span>
  <span class="c1">// definition of separation</span>
  <span class="kt">int</span> <span class="n">type</span> <span class="o">=</span> <span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">colType</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">event</span><span class="p">[</span><span class="mi">4</span><span class="p">].</span><span class="n">colType</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="n">kTtype</span><span class="p">;</span>
  <span class="c1">// Find minimal kT</span>
  <span class="kt">double</span> <span class="n">ktmin</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">e</span><span class="p">();</span>
  <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="kt">int</span><span class="p">(</span><span class="n">FinalPartPos</span><span class="p">.</span><span class="n">size</span><span class="p">());</span> <span class="o">++</span><span class="n">i</span><span class="p">){</span>
    <span class="kt">double</span> <span class="n">kt12</span>  <span class="o">=</span> <span class="n">ktmin</span><span class="p">;</span>
    <span class="c1">// Compute separation to the beam axis for hadronic collisions</span>
    <span class="k">if</span><span class="p">(</span><span class="n">type</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="o">||</span> <span class="n">type</span> <span class="o">==</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
      <span class="kt">double</span> <span class="n">temp</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="n">FinalPartPos</span><span class="p">[</span><span class="n">i</span><span class="p">]].</span><span class="n">pT</span><span class="p">();</span>
      <span class="n">kt12</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">kt12</span><span class="p">,</span> <span class="n">temp</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="c1">// Compute separation to other final state jets</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="kt">int</span><span class="p">(</span><span class="n">FinalPartPos</span><span class="p">.</span><span class="n">size</span><span class="p">());</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
      <span class="kt">double</span> <span class="n">temp</span> <span class="o">=</span> <span class="n">kTdurham</span><span class="p">(</span> <span class="n">event</span><span class="p">[</span><span class="n">FinalPartPos</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span> <span class="n">event</span><span class="p">[</span><span class="n">FinalPartPos</span><span class="p">[</span><span class="n">j</span><span class="p">]],</span>
                      <span class="n">type</span><span class="p">,</span> <span class="n">Dparam</span><span class="p">);</span>
      <span class="n">kt12</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">kt12</span><span class="p">,</span> <span class="n">temp</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="c1">// Keep the minimal Durham separation</span>
    <span class="n">ktmin</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">ktmin</span><span class="p">,</span><span class="n">kt12</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="c1">// Return minimal Durham kT</span>
  <span class="k">return</span> <span class="n">ktmin</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">//--------------------------------------------------------------------------</span>
<span class="c1">// Function to compute durham y separation from Particle input</span>
<span class="kt">double</span> <span class="n">MyMergingHooks</span><span class="o">::</span><span class="n">myKTdurham</span><span class="p">(</span><span class="k">const</span> <span class="n">Particle</span><span class="o">&amp;</span> <span class="n">RadAfterBranch</span><span class="p">,</span>
  <span class="k">const</span> <span class="n">Particle</span><span class="o">&amp;</span> <span class="n">EmtAfterBranch</span><span class="p">,</span> <span class="kt">int</span> <span class="n">Type</span><span class="p">,</span> <span class="kt">double</span> <span class="n">D</span> <span class="p">){</span>
  <span class="c1">// Declare return variable</span>
  <span class="kt">double</span> <span class="n">ktdur</span><span class="p">;</span>
  <span class="c1">// Save 4-momenta of final state particles</span>
  <span class="n">Vec4</span> <span class="n">jet1</span> <span class="o">=</span> <span class="n">RadAfterBranch</span><span class="p">.</span><span class="n">p</span><span class="p">();</span>
  <span class="n">Vec4</span> <span class="n">jet2</span> <span class="o">=</span> <span class="n">EmtAfterBranch</span><span class="p">.</span><span class="n">p</span><span class="p">();</span>
  <span class="k">if</span><span class="p">(</span> <span class="n">Type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Get angle between jets for e+e- collisions, make sure that</span>
    <span class="c1">// -1 &lt;= cos(theta) &lt;= 1</span>
    <span class="kt">double</span> <span class="n">costh</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">jet1</span><span class="p">.</span><span class="n">pAbs</span><span class="p">()</span><span class="o">*</span><span class="n">jet2</span><span class="p">.</span><span class="n">pAbs</span><span class="p">()</span> <span class="o">&lt;=</span><span class="mf">0.</span><span class="p">)</span> <span class="n">costh</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">;</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="n">costh</span> <span class="o">=</span> <span class="n">costheta</span><span class="p">(</span><span class="n">jet1</span><span class="p">,</span><span class="n">jet2</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="c1">// Calculate kt durham separation between jets for e+e- collisions</span>
    <span class="n">ktdur</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">min</span><span class="p">(</span> <span class="n">pow</span><span class="p">(</span><span class="n">jet1</span><span class="p">.</span><span class="n">e</span><span class="p">(),</span><span class="mi">2</span><span class="p">)</span> <span class="p">,</span> <span class="p">(</span><span class="n">pow</span><span class="p">(</span><span class="n">jet2</span><span class="p">.</span><span class="n">e</span><span class="p">(),</span><span class="mi">2</span><span class="p">))</span> <span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">costh</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span> <span class="n">Type</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="p">){</span>
    <span class="c1">// Get delta_eta and cosh(Delta_eta) for hadronic collisions</span>
    <span class="kt">double</span> <span class="n">eta1</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">log</span><span class="p">(</span> <span class="p">(</span><span class="n">jet1</span><span class="p">.</span><span class="n">e</span><span class="p">()</span> <span class="o">+</span> <span class="n">jet1</span><span class="p">.</span><span class="n">pz</span><span class="p">())</span> <span class="o">/</span> <span class="p">(</span><span class="n">jet1</span><span class="p">.</span><span class="n">e</span><span class="p">()</span> <span class="o">-</span> <span class="n">jet1</span><span class="p">.</span><span class="n">pz</span><span class="p">())</span> <span class="p">);</span>
    <span class="kt">double</span> <span class="n">eta2</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">log</span><span class="p">(</span> <span class="p">(</span><span class="n">jet2</span><span class="p">.</span><span class="n">e</span><span class="p">()</span> <span class="o">+</span> <span class="n">jet2</span><span class="p">.</span><span class="n">pz</span><span class="p">())</span> <span class="o">/</span> <span class="p">(</span><span class="n">jet2</span><span class="p">.</span><span class="n">e</span><span class="p">()</span> <span class="o">-</span> <span class="n">jet2</span><span class="p">.</span><span class="n">pz</span><span class="p">())</span> <span class="p">);</span>
    <span class="c1">// Get delta_phi and cos(Delta_phi) for hadronic collisions</span>
    <span class="kt">double</span> <span class="n">pt1</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span> <span class="n">pow</span><span class="p">(</span><span class="n">jet1</span><span class="p">.</span><span class="n">px</span><span class="p">(),</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">pow</span><span class="p">(</span><span class="n">jet1</span><span class="p">.</span><span class="n">py</span><span class="p">(),</span><span class="mi">2</span><span class="p">)</span> <span class="p">);</span>
    <span class="kt">double</span> <span class="n">pt2</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span> <span class="n">pow</span><span class="p">(</span><span class="n">jet2</span><span class="p">.</span><span class="n">px</span><span class="p">(),</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">pow</span><span class="p">(</span><span class="n">jet2</span><span class="p">.</span><span class="n">py</span><span class="p">(),</span><span class="mi">2</span><span class="p">)</span> <span class="p">);</span>
    <span class="kt">double</span> <span class="n">cosdPhi</span> <span class="o">=</span> <span class="p">(</span> <span class="n">jet1</span><span class="p">.</span><span class="n">px</span><span class="p">()</span><span class="o">*</span><span class="n">jet2</span><span class="p">.</span><span class="n">px</span><span class="p">()</span> <span class="o">+</span> <span class="n">jet1</span><span class="p">.</span><span class="n">py</span><span class="p">()</span><span class="o">*</span><span class="n">jet2</span><span class="p">.</span><span class="n">py</span><span class="p">()</span> <span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">pt1</span><span class="o">*</span><span class="n">pt2</span><span class="p">);</span>
    <span class="kt">double</span> <span class="n">dPhi</span> <span class="o">=</span> <span class="n">acos</span><span class="p">(</span> <span class="n">cosdPhi</span> <span class="p">);</span>
    <span class="c1">// Calculate kT durham like fastjet</span>
     <span class="n">ktdur</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span> <span class="n">pow</span><span class="p">(</span><span class="n">pt1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">pow</span><span class="p">(</span><span class="n">pt2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="p">)</span>
           <span class="o">*</span> <span class="p">(</span> <span class="n">pow</span><span class="p">(</span><span class="n">eta1</span><span class="o">-</span><span class="n">eta2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">pow</span><span class="p">(</span><span class="n">dPhi</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="p">)</span> <span class="o">/</span> <span class="n">pow</span><span class="p">(</span><span class="n">D</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span> <span class="n">Type</span> <span class="o">==</span> <span class="o">-</span><span class="mi">2</span> <span class="p">){</span>
    <span class="c1">// Get delta_eta and cosh(Delta_eta) for hadronic collisions</span>
    <span class="kt">double</span> <span class="n">eta1</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">log</span><span class="p">(</span> <span class="p">(</span><span class="n">jet1</span><span class="p">.</span><span class="n">e</span><span class="p">()</span> <span class="o">+</span> <span class="n">jet1</span><span class="p">.</span><span class="n">pz</span><span class="p">())</span> <span class="o">/</span> <span class="p">(</span><span class="n">jet1</span><span class="p">.</span><span class="n">e</span><span class="p">()</span> <span class="o">-</span> <span class="n">jet1</span><span class="p">.</span><span class="n">pz</span><span class="p">())</span> <span class="p">);</span>
    <span class="kt">double</span> <span class="n">eta2</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">log</span><span class="p">(</span> <span class="p">(</span><span class="n">jet2</span><span class="p">.</span><span class="n">e</span><span class="p">()</span> <span class="o">+</span> <span class="n">jet2</span><span class="p">.</span><span class="n">pz</span><span class="p">())</span> <span class="o">/</span> <span class="p">(</span><span class="n">jet2</span><span class="p">.</span><span class="n">e</span><span class="p">()</span> <span class="o">-</span> <span class="n">jet2</span><span class="p">.</span><span class="n">pz</span><span class="p">())</span> <span class="p">);</span>
     <span class="kt">double</span> <span class="n">coshdEta</span> <span class="o">=</span> <span class="n">cosh</span><span class="p">(</span> <span class="n">eta1</span> <span class="o">-</span> <span class="n">eta2</span> <span class="p">);</span>
    <span class="c1">// Get delta_phi and cos(Delta_phi) for hadronic collisions</span>
    <span class="kt">double</span> <span class="n">pt1</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span> <span class="n">pow</span><span class="p">(</span><span class="n">jet1</span><span class="p">.</span><span class="n">px</span><span class="p">(),</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">pow</span><span class="p">(</span><span class="n">jet1</span><span class="p">.</span><span class="n">py</span><span class="p">(),</span><span class="mi">2</span><span class="p">)</span> <span class="p">);</span>
    <span class="kt">double</span> <span class="n">pt2</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span> <span class="n">pow</span><span class="p">(</span><span class="n">jet2</span><span class="p">.</span><span class="n">px</span><span class="p">(),</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">pow</span><span class="p">(</span><span class="n">jet2</span><span class="p">.</span><span class="n">py</span><span class="p">(),</span><span class="mi">2</span><span class="p">)</span> <span class="p">);</span>
    <span class="kt">double</span> <span class="n">cosdPhi</span> <span class="o">=</span> <span class="p">(</span> <span class="n">jet1</span><span class="p">.</span><span class="n">px</span><span class="p">()</span><span class="o">*</span><span class="n">jet2</span><span class="p">.</span><span class="n">px</span><span class="p">()</span> <span class="o">+</span> <span class="n">jet1</span><span class="p">.</span><span class="n">py</span><span class="p">()</span><span class="o">*</span><span class="n">jet2</span><span class="p">.</span><span class="n">py</span><span class="p">()</span> <span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">pt1</span><span class="o">*</span><span class="n">pt2</span><span class="p">);</span>
    <span class="c1">// Calculate kT durham separation &quot;SHERPA-like&quot;</span>
     <span class="n">ktdur</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">min</span><span class="p">(</span> <span class="n">pow</span><span class="p">(</span><span class="n">pt1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">pow</span><span class="p">(</span><span class="n">pt2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="p">)</span>
           <span class="o">*</span> <span class="p">(</span> <span class="n">coshdEta</span> <span class="o">-</span> <span class="n">cosdPhi</span> <span class="p">)</span> <span class="o">/</span> <span class="n">pow</span><span class="p">(</span><span class="n">D</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="n">ktdur</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// Return kT</span>
  <span class="k">return</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">ktdur</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">//==========================================================================</span>
<span class="c1">// Example main programm to illustrate merging</span>
<span class="kt">int</span> <span class="n">main</span><span class="p">(</span> <span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[]</span> <span class="p">){</span>
  <span class="c1">// Check that correct number of command-line arguments</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; Unexpected number of command-line arguments. </span><span class="se">\n</span><span class="s"> You are&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; expected to provide the arguments </span><span class="se">\n</span><span class="s">&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; 1. Input file for settings </span><span class="se">\n</span><span class="s">&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; 2. Full name of the input LHE file (with path) </span><span class="se">\n</span><span class="s">&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; 3. Path for output histogram files </span><span class="se">\n</span><span class="s">&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; Program stopped. &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">Pythia</span> <span class="n">pythia</span><span class="p">;</span>
  <span class="c1">// Input parameters:</span>
  <span class="c1">//  1. Input file for settings</span>
  <span class="c1">//  2. Path to input LHE file</span>
  <span class="c1">//  3. Output histogram path</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readFile</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
  <span class="n">string</span> <span class="n">iPath</span> <span class="o">=</span> <span class="n">string</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
  <span class="n">string</span> <span class="n">oPath</span> <span class="o">=</span> <span class="n">string</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>
  <span class="c1">// Number of events</span>
  <span class="kt">int</span> <span class="n">nEvent</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Main:numberOfEvents&quot;</span><span class="p">);</span>
  <span class="c1">// Construct user inut for merging</span>
  <span class="n">MergingHooks</span><span class="o">*</span> <span class="n">myMergingHooks</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MyMergingHooks</span><span class="p">();</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">setMergingHooksPtr</span><span class="p">(</span> <span class="n">myMergingHooks</span> <span class="p">);</span>
  <span class="c1">// For ISR regularisation off</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">forceParm</span><span class="p">(</span><span class="s">&quot;SpaceShower:pT0Ref&quot;</span><span class="p">,</span><span class="mf">0.</span><span class="p">);</span>
  <span class="c1">// Declare histograms</span>
  <span class="n">Hist</span> <span class="nf">histPTFirst</span><span class="p">(</span><span class="s">&quot;pT of first jet&quot;</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">100.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="nf">histPTSecond</span><span class="p">(</span><span class="s">&quot;pT of second jet&quot;</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">100.</span><span class="p">);</span>
  <span class="c1">// Read in ME configurations</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Beams:frameType = 4&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Beams:LHEF = &quot;</span> <span class="o">+</span> <span class="n">iPath</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
  <span class="c1">// Start generation loop</span>
  <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">iEvent</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">iEvent</span><span class="o">&lt;</span><span class="n">nEvent</span><span class="p">;</span> <span class="o">++</span><span class="n">iEvent</span> <span class="p">){</span>
    <span class="c1">// Generate next event</span>
    <span class="k">if</span><span class="p">(</span> <span class="o">!</span> <span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">())</span> <span class="k">continue</span><span class="p">;</span>
    <span class="c1">// Get CKKWL weight of current event</span>
    <span class="kt">double</span> <span class="n">weight</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">mergingWeight</span><span class="p">();</span>
    <span class="c1">// Fill bins with CKKWL weight</span>
    <span class="kt">double</span> <span class="n">pTfirst</span> <span class="o">=</span> <span class="n">pTfirstJet</span><span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">);</span>
    <span class="kt">double</span> <span class="n">pTsecnd</span> <span class="o">=</span> <span class="n">pTfirstJet</span><span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">);</span>
    <span class="n">histPTFirst</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">pTfirst</span><span class="p">,</span> <span class="n">weight</span><span class="p">);</span>
    <span class="n">histPTSecond</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">pTsecnd</span><span class="p">,</span> <span class="n">weight</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">iEvent</span><span class="o">%</span><span class="mi">1000</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">iEvent</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="p">}</span> <span class="c1">// end loop over events to generate</span>
  <span class="c1">// print cross section, errors</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
  <span class="c1">// Normalise histograms</span>
  <span class="kt">double</span> <span class="n">norm</span> <span class="o">=</span> <span class="mf">1.</span>
              <span class="o">*</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">sigmaGen</span><span class="p">()</span>
              <span class="o">*</span> <span class="mf">1.</span><span class="o">/</span> <span class="kt">double</span><span class="p">(</span><span class="n">nEvent</span><span class="p">);</span>
  <span class="n">histPTFirst</span>           <span class="o">*=</span> <span class="n">norm</span><span class="p">;</span>
  <span class="n">histPTSecond</span>          <span class="o">*=</span> <span class="n">norm</span><span class="p">;</span>
  <span class="c1">// Get the number of jets in the LHE file from the file name</span>
  <span class="n">string</span> <span class="n">jetsInLHEF</span> <span class="o">=</span> <span class="n">iPath</span><span class="p">.</span><span class="n">substr</span><span class="p">(</span><span class="n">iPath</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="n">iPath</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
  <span class="n">jetsInLHEF</span> <span class="o">=</span> <span class="n">jetsInLHEF</span><span class="p">.</span><span class="n">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">jetsInLHEF</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="o">-</span><span class="mi">4</span><span class="p">);</span>
  <span class="c1">// Write histograms to dat file. Use &quot;jetsInLHEF&quot; to label the files</span>
  <span class="c1">// Once all the samples up to the maximal desired jet multiplicity from the</span>
  <span class="c1">// matrix element are run, add all histograms to produce a</span>
  <span class="c1">// matrix-element-merged prediction</span>
  <span class="n">ofstream</span> <span class="n">write</span><span class="p">;</span>
  <span class="n">stringstream</span> <span class="n">suffix</span><span class="p">;</span>
  <span class="n">suffix</span> <span class="o">&lt;&lt;</span> <span class="n">jetsInLHEF</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;_wv.dat&quot;</span><span class="p">;</span>
  <span class="c1">// Write histograms to file</span>
  <span class="n">write</span><span class="p">.</span><span class="n">open</span><span class="p">(</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)(</span><span class="n">oPath</span> <span class="o">+</span> <span class="s">&quot;PTjet1_&quot;</span> <span class="o">+</span> <span class="n">suffix</span><span class="p">.</span><span class="n">str</span><span class="p">()).</span><span class="n">c_str</span><span class="p">());</span>
  <span class="n">histPTFirst</span><span class="p">.</span><span class="n">table</span><span class="p">(</span><span class="n">write</span><span class="p">);</span>
  <span class="n">write</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
  <span class="n">write</span><span class="p">.</span><span class="n">open</span><span class="p">(</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)(</span><span class="n">oPath</span> <span class="o">+</span> <span class="s">&quot;PTjet2_&quot;</span> <span class="o">+</span> <span class="n">suffix</span><span class="p">.</span><span class="n">str</span><span class="p">()).</span><span class="n">c_str</span><span class="p">());</span>
  <span class="n">histPTSecond</span><span class="p">.</span><span class="n">table</span><span class="p">(</span><span class="n">write</span><span class="p">);</span>
  <span class="n">write</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
  <span class="k">delete</span> <span class="n">myMergingHooks</span><span class="p">;</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
  <span class="c1">// Done</span>
<span class="p">}</span>
</pre></div>
    </div>
  </div>
</div>

</div> <div class="well well-sm"> <h1 id="main84cc">main84.cc</h1><hr>
<div class="codehilite"><pre><span class="c1">// main84.cc is a part of the PYTHIA event generator.</span>
<span class="c1">// Copyright (C) 2016 Torbjorn Sjostrand.</span>
<span class="c1">// PYTHIA is licenced under the GNU GPL version 2, see COPYING for details.</span>
<span class="c1">// Please respect the MCnet Guidelines, see GUIDELINES for details.</span>
<span class="c1">// This program is written by Stefan Prestel.</span>
<span class="c1">// It illustrates how to do CKKW-L merging, see the Matrix Element</span>
<span class="c1">// Merging page in the online manual. An example command is</span>
<span class="c1">//     ./main84 main84.cmnd hepmcout84.dat 2 w+_production_lhc histout84.dat</span>
<span class="c1">// where main84.cmnd supplies the commands, hepmcout84.dat is the</span>
<span class="c1">// HepMC output, 2 is the maximial number of jets, w+_production_lhc</span>
<span class="c1">// provides the input LHE events, and histout84.dat is the output</span>
<span class="c1">// histogram file. This example requires FastJet and HepMC.</span>
</pre></div>


<div class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" href="#fileid56">Rest of the main84.cc code</a>
    </h4>
  </div>
  <div id="fileid56" class="panel-collapse collapse">
    <div class="panel-body">
<div class="codehilite"><pre><span class="cp">#include</span> <span class="cpf">&lt;time.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;Pythia8/Pythia.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;Pythia8Plugins/HepMC2.h&quot;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">Pythia8</span><span class="p">;</span>
<span class="c1">// Functions for histogramming</span>
<span class="cp">#include</span> <span class="cpf">&quot;fastjet/PseudoJet.hh&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;fastjet/ClusterSequence.hh&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;fastjet/CDFMidPointPlugin.hh&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;fastjet/CDFJetCluPlugin.hh&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;fastjet/D0RunIIConePlugin.hh&quot;</span><span class="cp"></span>
<span class="c1">//==========================================================================</span>
<span class="c1">// Find the Durham kT separation of the clustering from</span>
<span class="c1">// nJetMin --&gt; nJetMin-1 jets in te input event</span>
<span class="kt">double</span> <span class="nf">pTfirstJet</span><span class="p">(</span> <span class="k">const</span> <span class="n">Event</span><span class="o">&amp;</span> <span class="n">event</span><span class="p">,</span> <span class="kt">int</span> <span class="n">nJetMin</span><span class="p">,</span> <span class="kt">double</span> <span class="n">Rparam</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">double</span> <span class="n">yPartonMax</span> <span class="o">=</span> <span class="mf">4.</span><span class="p">;</span>
  <span class="c1">// Fastjet analysis - select algorithm and parameters</span>
  <span class="n">fastjet</span><span class="o">::</span><span class="n">Strategy</span>               <span class="n">strategy</span> <span class="o">=</span> <span class="n">fastjet</span><span class="o">::</span><span class="n">Best</span><span class="p">;</span>
  <span class="n">fastjet</span><span class="o">::</span><span class="n">RecombinationScheme</span>    <span class="n">recombScheme</span> <span class="o">=</span> <span class="n">fastjet</span><span class="o">::</span><span class="n">E_scheme</span><span class="p">;</span>
  <span class="n">fastjet</span><span class="o">::</span><span class="n">JetDefinition</span>         <span class="o">*</span><span class="n">jetDef</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
  <span class="c1">// For hadronic collision, use hadronic Durham kT measure</span>
  <span class="k">if</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">colType</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">event</span><span class="p">[</span><span class="mi">4</span><span class="p">].</span><span class="n">colType</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">jetDef</span> <span class="o">=</span> <span class="k">new</span> <span class="n">fastjet</span><span class="o">::</span><span class="n">JetDefinition</span><span class="p">(</span><span class="n">fastjet</span><span class="o">::</span><span class="n">kt_algorithm</span><span class="p">,</span> <span class="n">Rparam</span><span class="p">,</span>
                                      <span class="n">recombScheme</span><span class="p">,</span> <span class="n">strategy</span><span class="p">);</span>
  <span class="c1">// For e+e- collision, use e+e- Durham kT measure</span>
  <span class="k">else</span>
    <span class="n">jetDef</span> <span class="o">=</span> <span class="k">new</span> <span class="n">fastjet</span><span class="o">::</span><span class="n">JetDefinition</span><span class="p">(</span><span class="n">fastjet</span><span class="o">::</span><span class="n">ee_kt_algorithm</span><span class="p">,</span>
                                      <span class="n">recombScheme</span><span class="p">,</span> <span class="n">strategy</span><span class="p">);</span>
  <span class="c1">// Fastjet input</span>
  <span class="n">std</span><span class="o">::</span><span class="n">vector</span> <span class="o">&lt;</span><span class="n">fastjet</span><span class="o">::</span><span class="n">PseudoJet</span><span class="o">&gt;</span> <span class="n">fjInputs</span><span class="p">;</span>
  <span class="c1">// Reset Fastjet input</span>
  <span class="n">fjInputs</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="c1">// Loop over event record to decide what to pass to FastJet</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">event</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// (Final state &amp;&amp; coloured+photons) only!</span>
    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">isFinal</span><span class="p">()</span>
      <span class="o">||</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">isLepton</span><span class="p">()</span>
      <span class="o">||</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">id</span><span class="p">()</span> <span class="o">==</span> <span class="mi">23</span>
      <span class="o">||</span> <span class="n">abs</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">id</span><span class="p">())</span> <span class="o">==</span> <span class="mi">24</span>
      <span class="o">||</span> <span class="n">abs</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">y</span><span class="p">())</span> <span class="o">&gt;</span> <span class="n">yPartonMax</span><span class="p">)</span>
      <span class="k">continue</span><span class="p">;</span>
    <span class="c1">// Store as input to Fastjet</span>
    <span class="n">fjInputs</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span> <span class="n">fastjet</span><span class="o">::</span><span class="n">PseudoJet</span> <span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">px</span><span class="p">(),</span>
            <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">py</span><span class="p">(),</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pz</span><span class="p">(),</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">e</span><span class="p">()</span> <span class="p">)</span> <span class="p">);</span>
  <span class="p">}</span>
  <span class="c1">// Do nothing for empty input</span>
  <span class="k">if</span> <span class="p">(</span><span class="kt">int</span><span class="p">(</span><span class="n">fjInputs</span><span class="p">.</span><span class="n">size</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">delete</span> <span class="n">jetDef</span><span class="p">;</span>
    <span class="k">return</span> <span class="mf">0.0</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// Run Fastjet algorithm</span>
  <span class="n">fastjet</span><span class="o">::</span><span class="n">ClusterSequence</span> <span class="n">clustSeq</span><span class="p">(</span><span class="n">fjInputs</span><span class="p">,</span> <span class="o">*</span><span class="n">jetDef</span><span class="p">);</span>
  <span class="c1">// Extract kT of first clustering</span>
  <span class="kt">double</span> <span class="n">pTFirst</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">clustSeq</span><span class="p">.</span><span class="n">exclusive_dmerge_max</span><span class="p">(</span><span class="n">nJetMin</span><span class="o">-</span><span class="mi">1</span><span class="p">));</span>
  <span class="k">delete</span> <span class="n">jetDef</span><span class="p">;</span>
  <span class="c1">// Return kT</span>
  <span class="k">return</span> <span class="n">pTFirst</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">//==========================================================================</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span> <span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[]</span> <span class="p">){</span>
  <span class="c1">// Check that correct number of command-line arguments</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">!=</span> <span class="mi">6</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; Unexpected number of command-line arguments. </span><span class="se">\n</span><span class="s"> You are&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; expected to provide the arguments&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; 1. Input file for settings&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; 2. Name of output HepMC file&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; 3. Maximal number of additional jets&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; (not used internally in Pythia, only used to construct the full&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; name of lhe files with additional jets, and to label output&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; histograms)&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; 4. Full name of the input LHE file (with path&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; , without any _0.lhe suffix)&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; 5. Path for output histogram files&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; Program stopped. &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">Pythia</span> <span class="n">pythia</span><span class="p">;</span>
  <span class="c1">// First argument: Get input from an input file</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readFile</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
  <span class="kt">int</span> <span class="n">nEvent</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Main:numberOfEvents&quot;</span><span class="p">);</span>
  <span class="c1">// Interface for conversion from Pythia8::Event to HepMC event.</span>
  <span class="c1">// Will fill cross section and event weight directly in this program,</span>
  <span class="c1">// so switch it off for normal conversion routine.</span>
  <span class="n">HepMC</span><span class="o">::</span><span class="n">Pythia8ToHepMC</span> <span class="n">ToHepMC</span><span class="p">;</span>
  <span class="n">ToHepMC</span><span class="p">.</span><span class="n">set_store_xsec</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
  <span class="c1">// Specify file where HepMC events will be stored.</span>
  <span class="n">HepMC</span><span class="o">::</span><span class="n">IO_GenEvent</span> <span class="n">ascii_io</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">std</span><span class="o">::</span><span class="n">ios</span><span class="o">::</span><span class="n">out</span><span class="p">);</span>
  <span class="c1">// Third argument: Maximal number of additional jets</span>
  <span class="kt">int</span> <span class="n">njet</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>
  <span class="c1">// Read input and output paths</span>
  <span class="n">string</span> <span class="n">iPath</span> <span class="o">=</span> <span class="n">string</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">4</span><span class="p">]);</span>
  <span class="n">string</span> <span class="n">oPath</span> <span class="o">=</span> <span class="n">string</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">5</span><span class="p">]);</span>
  <span class="c1">// To write correctly normalized events to hepmc file, first get</span>
  <span class="c1">// a reasonable accurate of the cross section</span>
  <span class="kt">int</span> <span class="n">njetCounterEstimate</span> <span class="o">=</span> <span class="n">njet</span><span class="p">;</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">xsecEstimate</span><span class="p">;</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">nTrialEstimate</span><span class="p">;</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">nAcceptEstimate</span><span class="p">;</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Random:setSeed = on&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Random:seed = 42390964&quot;</span><span class="p">);</span>
  <span class="k">while</span><span class="p">(</span><span class="n">njetCounterEstimate</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Number of runs</span>
    <span class="kt">int</span> <span class="n">nRun</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">nTrial</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">nAccept</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">countEvents</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="c1">// Run pythia nRun times with the same lhe file to get nRun times</span>
    <span class="c1">// higher statistics in the histograms</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="n">nRun</span> <span class="p">;</span> <span class="o">++</span><span class="n">n</span> <span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Get process and events from LHE file, initialize only the</span>
      <span class="c1">// first time</span>
      <span class="k">if</span><span class="p">(</span><span class="n">n</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Main:LHEFskipInit = on&quot;</span><span class="p">);</span>
      <span class="c1">// From njet, choose LHE file</span>
      <span class="n">stringstream</span> <span class="n">in</span><span class="p">;</span>
      <span class="n">in</span>   <span class="o">&lt;&lt;</span> <span class="s">&quot;_&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">njetCounterEstimate</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;.lhe&quot;</span><span class="p">;</span>
      <span class="n">string</span> <span class="n">LHEfile</span> <span class="o">=</span> <span class="n">iPath</span> <span class="o">+</span> <span class="n">in</span><span class="p">.</span><span class="n">str</span><span class="p">();</span>
      <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;HadronLevel:all = off&quot;</span><span class="p">);</span>
      <span class="c1">// Read in ME configurations</span>
      <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Beams:frameType = 4&quot;</span><span class="p">);</span>
      <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Beams:LHEF = &quot;</span> <span class="o">+</span> <span class="n">LHEfile</span><span class="p">);</span>
      <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
      <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">iEvent</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">iEvent</span><span class="o">&lt;</span><span class="n">nEvent</span><span class="p">;</span> <span class="o">++</span><span class="n">iEvent</span> <span class="p">){</span>
        <span class="n">countEvents</span><span class="o">++</span><span class="p">;</span>
        <span class="n">nTrial</span> <span class="o">+=</span> <span class="mf">1.</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">iEvent</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
        <span class="c1">// Generate next event</span>
        <span class="k">if</span><span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">())</span> <span class="n">nAccept</span> <span class="o">+=</span> <span class="mf">1.</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">countEvents</span> <span class="o">==</span> <span class="n">nEvent</span><span class="o">*</span><span class="n">nRun</span><span class="o">-</span><span class="mi">1</span><span class="p">){</span>
          <span class="n">xsecEstimate</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">sigmaGen</span><span class="p">());</span>
          <span class="n">nTrialEstimate</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">nTrial</span><span class="o">+</span><span class="mf">1.</span><span class="p">);</span>
          <span class="n">nAcceptEstimate</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">nAccept</span><span class="o">+</span><span class="mf">1.</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span> <span class="c1">// end loop over events to generate</span>
    <span class="p">}</span> <span class="c1">// end outer loop to rerun pythia with the same lhe file</span>
    <span class="c1">// Restart with ME of a reduced the number of jets</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">njetCounterEstimate</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span>
      <span class="n">njetCounterEstimate</span><span class="o">--</span><span class="p">;</span>
    <span class="k">else</span>
      <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span> <span class="c1">// end loop over different jet multiplicities</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Finished estimating cross section&quot;</span>
    <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="kt">int</span><span class="p">(</span><span class="n">xsecEstimate</span><span class="p">.</span><span class="n">size</span><span class="p">());</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;  Cross section estimate for &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">njet</span><span class="o">-</span><span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; jets :&quot;</span>
      <span class="o">&lt;&lt;</span> <span class="n">scientific</span> <span class="o">&lt;&lt;</span> <span class="n">setprecision</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">xsecEstimate</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
      <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="kt">int</span><span class="p">(</span><span class="n">nTrialEstimate</span><span class="p">.</span><span class="n">size</span><span class="p">());</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;  Trial events for &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">njet</span><span class="o">-</span><span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; jets :&quot;</span>
      <span class="o">&lt;&lt;</span> <span class="n">scientific</span> <span class="o">&lt;&lt;</span> <span class="n">setprecision</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">nTrialEstimate</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
      <span class="o">&lt;&lt;</span> <span class="s">&quot;  Accepted events for &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">njet</span><span class="o">-</span><span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; jets :&quot;</span>
      <span class="o">&lt;&lt;</span> <span class="n">scientific</span> <span class="o">&lt;&lt;</span> <span class="n">setprecision</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">nAcceptEstimate</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
      <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="c1">// Now start merging procedure</span>
  <span class="kt">int</span> <span class="n">njetCounter</span> <span class="o">=</span> <span class="n">njet</span><span class="p">;</span>
  <span class="n">Hist</span> <span class="n">histPTFirstSum</span><span class="p">(</span><span class="s">&quot;pT of first jet&quot;</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">100.</span><span class="p">);</span>
  <span class="n">Hist</span> <span class="n">histPTSecondSum</span><span class="p">(</span><span class="s">&quot;pT of second jet&quot;</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">100.</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Random:setSeed = on&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Random:seed = 42390964&quot;</span><span class="p">);</span>
  <span class="c1">// Sum of event weights</span>
  <span class="kt">double</span> <span class="n">sigma</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
  <span class="kt">double</span> <span class="n">sigma2</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
  <span class="k">while</span><span class="p">(</span><span class="n">njetCounter</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;   Path to lhe files: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">iPath</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;_*&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;   Output written to: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">oPath</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;&#39;name&#39;.dat&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="c1">// Set up histograms of pT of the first jet</span>
    <span class="n">Hist</span> <span class="n">histPTFirst</span><span class="p">(</span><span class="s">&quot;pT of first jet&quot;</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">200.</span><span class="p">);</span>
    <span class="n">Hist</span> <span class="n">histPTSecond</span><span class="p">(</span><span class="s">&quot;pT of second jet&quot;</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">200.</span><span class="p">);</span>
    <span class="n">Hist</span> <span class="n">histPTThird</span><span class="p">(</span><span class="s">&quot;pT of third jet&quot;</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">200.</span><span class="p">);</span>
    <span class="n">Hist</span> <span class="n">histPTFourth</span><span class="p">(</span><span class="s">&quot;pT of fourth jet&quot;</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">100.</span><span class="p">);</span>
    <span class="n">Hist</span> <span class="n">histPTFifth</span><span class="p">(</span><span class="s">&quot;pT of fifth jet&quot;</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">50.</span><span class="p">);</span>
    <span class="n">Hist</span> <span class="n">histPTSixth</span><span class="p">(</span><span class="s">&quot;pT of sixth jet&quot;</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">50.</span><span class="p">);</span>
    <span class="c1">// Number of runs</span>
    <span class="kt">int</span> <span class="n">nRun</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="c1">// Number of tried events</span>
    <span class="kt">int</span> <span class="n">nTriedEvents</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="c1">// Number of accepted events</span>
    <span class="kt">int</span> <span class="n">nAccepEvents</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="c1">// Run pythia nRun times with the same lhe file to get nRun times</span>
    <span class="c1">// higher statistics in the histograms</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="n">nRun</span> <span class="p">;</span> <span class="o">++</span><span class="n">n</span> <span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Get process and events from LHE file, initialize only the</span>
      <span class="c1">// first time</span>
      <span class="k">if</span><span class="p">(</span><span class="n">n</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Main:LHEFskipInit = on&quot;</span><span class="p">);</span>
      <span class="c1">// From njet, choose LHE file</span>
      <span class="n">stringstream</span> <span class="n">in</span><span class="p">;</span>
      <span class="n">in</span>   <span class="o">&lt;&lt;</span> <span class="s">&quot;_&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">njetCounter</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;.lhe&quot;</span><span class="p">;</span>
      <span class="n">string</span> <span class="n">LHEfile</span> <span class="o">=</span> <span class="n">iPath</span> <span class="o">+</span> <span class="n">in</span><span class="p">.</span><span class="n">str</span><span class="p">();</span>
      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span>
        <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s"> LHE FILE FOR + &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">njetCounter</span>
        <span class="o">&lt;&lt;</span> <span class="s">&quot; JET SAMPLE READ FROM &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">LHEfile</span>
        <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Normalise with xsection &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">xsecEstimate</span><span class="p">[</span><span class="n">njet</span><span class="o">-</span><span class="n">njetCounter</span><span class="p">]</span>
        <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
      <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;HadronLevel:all = on&quot;</span><span class="p">);</span>
      <span class="c1">// Read in ME configurations</span>
      <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Beams:frameType = 4&quot;</span><span class="p">);</span>
      <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Beams:LHEF = &quot;</span> <span class="o">+</span> <span class="n">LHEfile</span><span class="p">);</span>
      <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
      <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">iEvent</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">iEvent</span><span class="o">&lt;</span><span class="n">nEvent</span><span class="p">;</span> <span class="o">++</span><span class="n">iEvent</span> <span class="p">){</span>
        <span class="n">nTriedEvents</span><span class="o">++</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">iEvent</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
        <span class="c1">// Generate next event</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">())</span> <span class="p">{</span>
          <span class="kt">double</span> <span class="n">weight</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">mergingWeight</span><span class="p">();</span>
          <span class="n">nAccepEvents</span><span class="o">++</span><span class="p">;</span>
          <span class="c1">// Jet pT&#39;s</span>
          <span class="kt">double</span> <span class="n">D</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">;</span>
          <span class="kt">double</span> <span class="n">pTfirst</span> <span class="o">=</span> <span class="n">pTfirstJet</span><span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">D</span><span class="p">);</span>
          <span class="kt">double</span> <span class="n">pTsecnd</span> <span class="o">=</span> <span class="n">pTfirstJet</span><span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">D</span><span class="p">);</span>
          <span class="kt">double</span> <span class="n">pTthird</span> <span class="o">=</span> <span class="n">pTfirstJet</span><span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span> <span class="n">D</span><span class="p">);</span>
          <span class="kt">double</span> <span class="n">pTfourt</span> <span class="o">=</span> <span class="n">pTfirstJet</span><span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span> <span class="n">D</span><span class="p">);</span>
          <span class="kt">double</span> <span class="n">pTfifth</span> <span class="o">=</span> <span class="n">pTfirstJet</span><span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span> <span class="n">D</span><span class="p">);</span>
          <span class="kt">double</span> <span class="n">pTsixth</span> <span class="o">=</span> <span class="n">pTfirstJet</span><span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span> <span class="n">D</span><span class="p">);</span>
          <span class="n">histPTFirst</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">pTfirst</span><span class="p">,</span> <span class="n">weight</span><span class="p">);</span>
          <span class="n">histPTSecond</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">pTsecnd</span><span class="p">,</span> <span class="n">weight</span><span class="p">);</span>
          <span class="n">histPTThird</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">pTthird</span><span class="p">,</span> <span class="n">weight</span><span class="p">);</span>
          <span class="n">histPTFourth</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">pTfourt</span><span class="p">,</span> <span class="n">weight</span><span class="p">);</span>
          <span class="n">histPTFifth</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">pTfifth</span><span class="p">,</span> <span class="n">weight</span><span class="p">);</span>
          <span class="n">histPTSixth</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">pTsixth</span><span class="p">,</span> <span class="n">weight</span><span class="p">);</span>
          <span class="k">if</span><span class="p">(</span><span class="n">weight</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">){</span>
            <span class="c1">// Construct new empty HepMC event and fill it.</span>
            <span class="c1">// Units will be as chosen for HepMC build, but can be changed</span>
            <span class="c1">// by arguments, e.g. GenEvt( HepMC::Units::GEV, HepMC::Units::MM)</span>
            <span class="n">HepMC</span><span class="o">::</span><span class="n">GenEvent</span><span class="o">*</span> <span class="n">hepmcevt</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HepMC</span><span class="o">::</span><span class="n">GenEvent</span><span class="p">();</span>
            <span class="kt">double</span> <span class="n">normhepmc</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">*</span> <span class="n">xsecEstimate</span><span class="p">[</span><span class="n">njet</span><span class="o">-</span><span class="n">njetCounter</span><span class="p">]</span>
                <span class="o">*</span> <span class="n">nTrialEstimate</span><span class="p">[</span><span class="n">njet</span><span class="o">-</span><span class="n">njetCounter</span><span class="p">]</span>
                <span class="o">/</span> <span class="n">nAcceptEstimate</span><span class="p">[</span><span class="n">njet</span><span class="o">-</span><span class="n">njetCounter</span><span class="p">]</span>
                <span class="o">*</span> <span class="mf">1.</span><span class="o">/</span> <span class="p">(</span><span class="kt">double</span><span class="p">(</span><span class="n">nRun</span><span class="p">)</span><span class="o">*</span><span class="kt">double</span><span class="p">(</span><span class="n">nEvent</span><span class="p">));</span>
            <span class="n">sigma</span> <span class="o">+=</span> <span class="n">weight</span><span class="o">*</span><span class="n">normhepmc</span><span class="p">;</span>
            <span class="n">sigma2</span> <span class="o">+=</span> <span class="n">pow</span><span class="p">(</span><span class="n">weight</span><span class="o">*</span><span class="n">normhepmc</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
            <span class="c1">// Set event weight</span>
            <span class="n">hepmcevt</span><span class="o">-&gt;</span><span class="n">weights</span><span class="p">().</span><span class="n">push_back</span><span class="p">(</span><span class="n">weight</span><span class="o">*</span><span class="n">normhepmc</span><span class="p">);</span>
            <span class="c1">// Fill summed histograms</span>
            <span class="n">histPTFirstSum</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">pTfirst</span><span class="p">,</span> <span class="n">weight</span><span class="o">*</span><span class="n">normhepmc</span><span class="p">);</span>
            <span class="n">histPTSecondSum</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span> <span class="n">pTsecnd</span><span class="p">,</span> <span class="n">weight</span><span class="o">*</span><span class="n">normhepmc</span><span class="p">);</span>
            <span class="c1">// Fill HepMC event, with PDF info.</span>
            <span class="n">ToHepMC</span><span class="p">.</span><span class="n">fill_next_event</span><span class="p">(</span> <span class="n">pythia</span><span class="p">,</span> <span class="n">hepmcevt</span> <span class="p">);</span>
            <span class="c1">// Report cross section to hepmc</span>
            <span class="n">HepMC</span><span class="o">::</span><span class="n">GenCrossSection</span> <span class="n">xsec</span><span class="p">;</span>
            <span class="n">xsec</span><span class="p">.</span><span class="n">set_cross_section</span><span class="p">(</span> <span class="n">sigma</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span>
              <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">sigmaErr</span><span class="p">()</span><span class="o">*</span><span class="mf">1e9</span> <span class="p">);</span>
            <span class="n">hepmcevt</span><span class="o">-&gt;</span><span class="n">set_cross_section</span><span class="p">(</span> <span class="n">xsec</span> <span class="p">);</span>
            <span class="c1">// Write the HepMC event to file. Done with it.</span>
            <span class="n">ascii_io</span> <span class="o">&lt;&lt;</span> <span class="n">hepmcevt</span><span class="p">;</span>
            <span class="k">delete</span> <span class="n">hepmcevt</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">}</span> <span class="c1">// if( pythia.next() )</span>
        <span class="k">if</span><span class="p">(</span><span class="n">nTriedEvents</span><span class="o">%</span><span class="mi">10000</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
          <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">nTriedEvents</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
      <span class="p">}</span> <span class="c1">// end loop over events to generate</span>
      <span class="c1">// print cross section, errors</span>
      <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
    <span class="p">}</span> <span class="c1">// end outer loop to rerun pythia with the same lhe file</span>
    <span class="c1">// Normalise histograms for this particular multiplicity</span>
    <span class="kt">double</span> <span class="n">norm</span> <span class="o">=</span> <span class="mf">1.</span>
                <span class="o">*</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">sigmaGen</span><span class="p">()</span>
                <span class="o">*</span> <span class="kt">double</span><span class="p">(</span><span class="n">nTriedEvents</span><span class="p">)</span><span class="o">/</span><span class="kt">double</span><span class="p">(</span><span class="n">nAccepEvents</span><span class="p">)</span>
                <span class="o">*</span> <span class="mf">1.</span><span class="o">/</span> <span class="p">(</span><span class="kt">double</span><span class="p">(</span><span class="n">nRun</span><span class="p">)</span><span class="o">*</span><span class="kt">double</span><span class="p">(</span><span class="n">nEvent</span><span class="p">));</span>
    <span class="n">histPTFirst</span>           <span class="o">*=</span> <span class="n">norm</span><span class="p">;</span>
    <span class="n">histPTSecond</span>          <span class="o">*=</span> <span class="n">norm</span><span class="p">;</span>
    <span class="n">histPTThird</span>           <span class="o">*=</span> <span class="n">norm</span><span class="p">;</span>
    <span class="n">histPTFourth</span>          <span class="o">*=</span> <span class="n">norm</span><span class="p">;</span>
    <span class="n">histPTFifth</span>           <span class="o">*=</span> <span class="n">norm</span><span class="p">;</span>
    <span class="n">histPTSixth</span>           <span class="o">*=</span> <span class="n">norm</span><span class="p">;</span>
    <span class="c1">// Write histograms for this particular multiplicity to file</span>
    <span class="n">ofstream</span> <span class="n">write</span><span class="p">;</span>
    <span class="n">stringstream</span> <span class="n">suffix</span><span class="p">;</span>
    <span class="n">suffix</span> <span class="o">&lt;&lt;</span> <span class="n">njet</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;_&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">njetCounter</span><span class="p">;</span>
    <span class="n">suffix</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;_wv.dat&quot;</span><span class="p">;</span>
    <span class="n">write</span><span class="p">.</span><span class="n">open</span><span class="p">(</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)(</span><span class="n">oPath</span> <span class="o">+</span> <span class="s">&quot;PTjet1_&quot;</span> <span class="o">+</span> <span class="n">suffix</span><span class="p">.</span><span class="n">str</span><span class="p">()).</span><span class="n">c_str</span><span class="p">());</span>
    <span class="n">histPTFirst</span><span class="p">.</span><span class="n">table</span><span class="p">(</span><span class="n">write</span><span class="p">);</span>
    <span class="n">write</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
    <span class="n">write</span><span class="p">.</span><span class="n">open</span><span class="p">(</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)(</span><span class="n">oPath</span> <span class="o">+</span> <span class="s">&quot;PTjet2_&quot;</span> <span class="o">+</span> <span class="n">suffix</span><span class="p">.</span><span class="n">str</span><span class="p">()).</span><span class="n">c_str</span><span class="p">());</span>
    <span class="n">histPTSecond</span><span class="p">.</span><span class="n">table</span><span class="p">(</span><span class="n">write</span><span class="p">);</span>
    <span class="n">write</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
    <span class="n">write</span><span class="p">.</span><span class="n">open</span><span class="p">(</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)(</span><span class="n">oPath</span> <span class="o">+</span> <span class="s">&quot;PTjet3_&quot;</span> <span class="o">+</span> <span class="n">suffix</span><span class="p">.</span><span class="n">str</span><span class="p">()).</span><span class="n">c_str</span><span class="p">());</span>
    <span class="n">histPTThird</span><span class="p">.</span><span class="n">table</span><span class="p">(</span><span class="n">write</span><span class="p">);</span>
    <span class="n">write</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
    <span class="n">write</span><span class="p">.</span><span class="n">open</span><span class="p">(</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)(</span><span class="n">oPath</span> <span class="o">+</span> <span class="s">&quot;PTjet4_&quot;</span> <span class="o">+</span> <span class="n">suffix</span><span class="p">.</span><span class="n">str</span><span class="p">()).</span><span class="n">c_str</span><span class="p">());</span>
    <span class="n">histPTFourth</span><span class="p">.</span><span class="n">table</span><span class="p">(</span><span class="n">write</span><span class="p">);</span>
    <span class="n">write</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
    <span class="n">write</span><span class="p">.</span><span class="n">open</span><span class="p">(</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)(</span><span class="n">oPath</span> <span class="o">+</span> <span class="s">&quot;PTjet5_&quot;</span> <span class="o">+</span> <span class="n">suffix</span><span class="p">.</span><span class="n">str</span><span class="p">()).</span><span class="n">c_str</span><span class="p">());</span>
    <span class="n">histPTFifth</span><span class="p">.</span><span class="n">table</span><span class="p">(</span><span class="n">write</span><span class="p">);</span>
    <span class="n">write</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
    <span class="n">write</span><span class="p">.</span><span class="n">open</span><span class="p">(</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)(</span><span class="n">oPath</span> <span class="o">+</span> <span class="s">&quot;PTjet6_&quot;</span> <span class="o">+</span> <span class="n">suffix</span><span class="p">.</span><span class="n">str</span><span class="p">()).</span><span class="n">c_str</span><span class="p">());</span>
    <span class="n">histPTSixth</span><span class="p">.</span><span class="n">table</span><span class="p">(</span><span class="n">write</span><span class="p">);</span>
    <span class="n">write</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
    <span class="n">histPTFirst</span><span class="p">.</span><span class="n">null</span><span class="p">();</span>
    <span class="n">histPTSecond</span><span class="p">.</span><span class="n">null</span><span class="p">();</span>
    <span class="n">histPTThird</span><span class="p">.</span><span class="n">null</span><span class="p">();</span>
    <span class="n">histPTFourth</span><span class="p">.</span><span class="n">null</span><span class="p">();</span>
    <span class="n">histPTFifth</span><span class="p">.</span><span class="n">null</span><span class="p">();</span>
    <span class="n">histPTSixth</span><span class="p">.</span><span class="n">null</span><span class="p">();</span>
    <span class="c1">// Restart with ME of a reduced the number of jets</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">njetCounter</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span>
      <span class="n">njetCounter</span><span class="o">--</span><span class="p">;</span>
    <span class="k">else</span>
      <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span> <span class="c1">// end loop over different jet multiplicities</span>
  <span class="c1">// Since the histograms have been filled with the correct weight for</span>
  <span class="c1">// each jet multiplicity, no normalisation is needed.</span>
  <span class="c1">// Write summed histograms to file.</span>
  <span class="n">ofstream</span> <span class="n">writeSum</span><span class="p">;</span>
  <span class="n">stringstream</span> <span class="n">suffixSum</span><span class="p">;</span>
  <span class="n">suffixSum</span> <span class="o">&lt;&lt;</span> <span class="n">njet</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;_wv.dat&quot;</span><span class="p">;</span>
  <span class="n">writeSum</span><span class="p">.</span><span class="n">open</span><span class="p">(</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)(</span><span class="n">oPath</span> <span class="o">+</span> <span class="s">&quot;PTjet1Sum_&quot;</span> <span class="o">+</span> <span class="n">suffixSum</span><span class="p">.</span><span class="n">str</span><span class="p">()).</span><span class="n">c_str</span><span class="p">());</span>
  <span class="n">histPTFirstSum</span><span class="p">.</span><span class="n">table</span><span class="p">(</span><span class="n">writeSum</span><span class="p">);</span>
  <span class="n">writeSum</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
  <span class="n">writeSum</span><span class="p">.</span><span class="n">open</span><span class="p">(</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)(</span><span class="n">oPath</span> <span class="o">+</span> <span class="s">&quot;PTjet2Sum_&quot;</span> <span class="o">+</span> <span class="n">suffixSum</span><span class="p">.</span><span class="n">str</span><span class="p">()).</span><span class="n">c_str</span><span class="p">());</span>
  <span class="n">histPTSecondSum</span><span class="p">.</span><span class="n">table</span><span class="p">(</span><span class="n">writeSum</span><span class="p">);</span>
  <span class="n">writeSum</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
  <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="kt">int</span><span class="p">(</span><span class="n">xsecEstimate</span><span class="p">.</span><span class="n">size</span><span class="p">());</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;  Cross section estimate for &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">njet</span><span class="o">-</span><span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; jets :&quot;</span>
      <span class="o">&lt;&lt;</span> <span class="n">scientific</span> <span class="o">&lt;&lt;</span> <span class="n">setprecision</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">xsecEstimate</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
      <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="kt">int</span><span class="p">(</span><span class="n">nTrialEstimate</span><span class="p">.</span><span class="n">size</span><span class="p">());</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;  Trial events for &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">njet</span><span class="o">-</span><span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; jets :&quot;</span>
      <span class="o">&lt;&lt;</span> <span class="n">scientific</span> <span class="o">&lt;&lt;</span> <span class="n">setprecision</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">nTrialEstimate</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
      <span class="o">&lt;&lt;</span> <span class="s">&quot;  Accepted events for &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">njet</span><span class="o">-</span><span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; jets :&quot;</span>
      <span class="o">&lt;&lt;</span> <span class="n">scientific</span> <span class="o">&lt;&lt;</span> <span class="n">setprecision</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">nAcceptEstimate</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
      <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Histogrammed cross section for &quot;</span>
     <span class="o">&lt;&lt;</span> <span class="n">iPath</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; with &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">njet</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; additional jets is &quot;</span>
     <span class="o">&lt;&lt;</span> <span class="n">scientific</span> <span class="o">&lt;&lt;</span> <span class="n">setprecision</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">sigma</span>
     <span class="o">&lt;&lt;</span> <span class="s">&quot; error &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">sigma2</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
    </div>
  </div>
</div>

</div> <div class="well well-sm"> <h1 id="main85cc">main85.cc</h1><hr>
<div class="codehilite"><pre><span class="c1">// main85.cc is a part of the PYTHIA event generator.</span>
<span class="c1">// Copyright (C) 2016 Torbjorn Sjostrand.</span>
<span class="c1">// PYTHIA is licenced under the GNU GPL version 2, see COPYING for details.</span>
<span class="c1">// Please respect the MCnet Guidelines, see GUIDELINES for details.</span>
<span class="c1">// This program is written by Stefan Prestel.</span>
<span class="c1">// It illustrates how to do CKKW-L merging, see the Matrix Element</span>
<span class="c1">// Merging page in the online manual. An example command is</span>
<span class="c1">//     ./main85 main85.cmnd w_production hepmcout85.dat</span>
<span class="c1">// where main85.cmnd supplies the commands, w_production provides the</span>
<span class="c1">// input LHE events, and hepmcout85.dat is the output file. This</span>
<span class="c1">// example requires HepMC.</span>
</pre></div>


<div class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" href="#fileid57">Rest of the main85.cc code</a>
    </h4>
  </div>
  <div id="fileid57" class="panel-collapse collapse">
    <div class="panel-body">
<div class="codehilite"><pre><span class="cp">#include</span> <span class="cpf">&quot;Pythia8/Pythia.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;Pythia8Plugins/HepMC2.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">Pythia8</span><span class="p">;</span>
<span class="c1">//==========================================================================</span>
<span class="c1">// Example main programm to illustrate merging</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span> <span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[]</span> <span class="p">){</span>
  <span class="c1">// Check that correct number of command-line arguments</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; Unexpected number of command-line arguments (&quot;</span><span class="o">&lt;&lt;</span><span class="n">argc</span><span class="o">&lt;&lt;</span><span class="s">&quot;). </span><span class="se">\n</span><span class="s">&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; You are expected to provide the arguments&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; 1. Input file for settings&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; 2. Name of the input LHE file (with path), up to the &#39;_tree&#39;&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; identifier&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; 3. Output hepmc file name&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; Program stopped. &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">Pythia</span> <span class="n">pythia</span><span class="p">;</span>
  <span class="c1">// Input parameters:</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readFile</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
  <span class="c1">// Interface for conversion from Pythia8::Event to HepMC one.</span>
  <span class="n">HepMC</span><span class="o">::</span><span class="n">Pythia8ToHepMC</span> <span class="n">ToHepMC</span><span class="p">;</span>
  <span class="c1">// Specify file where HepMC events will be stored.</span>
  <span class="n">HepMC</span><span class="o">::</span><span class="n">IO_GenEvent</span> <span class="n">ascii_io</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">std</span><span class="o">::</span><span class="n">ios</span><span class="o">::</span><span class="n">out</span><span class="p">);</span>
  <span class="c1">// Switch off warnings for parton-level events.</span>
  <span class="n">ToHepMC</span><span class="p">.</span><span class="n">set_print_inconsistency</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
  <span class="n">ToHepMC</span><span class="p">.</span><span class="n">set_free_parton_warnings</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
  <span class="c1">// Do not store cross section information, as this will be done manually.</span>
  <span class="n">ToHepMC</span><span class="p">.</span><span class="n">set_store_pdf</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
  <span class="n">ToHepMC</span><span class="p">.</span><span class="n">set_store_proc</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
  <span class="n">ToHepMC</span><span class="p">.</span><span class="n">set_store_xsec</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
  <span class="c1">// Path to input events, with name up to the &quot;_tree&quot; identifier included.</span>
  <span class="n">string</span> <span class="n">iPath</span> <span class="o">=</span> <span class="n">string</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
  <span class="c1">// Number of events.</span>
  <span class="kt">int</span> <span class="n">nEvent</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Main:numberOfEvents&quot;</span><span class="p">);</span>
  <span class="c1">// Maximal number of additional LO jets.</span>
  <span class="kt">int</span> <span class="n">nMaxLO</span> <span class="o">=</span>  <span class="n">pythia</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Merging:nJetMax&quot;</span><span class="p">);</span>
<span class="c1">//-----------------------------------------------------------------------------</span>
<span class="c1">//-----------------------------------------------------------------------------</span>
  <span class="c1">// Switch off all showering and MPI when estimating the cross section after</span>
  <span class="c1">// the merging scale cut.</span>
  <span class="kt">bool</span> <span class="n">fsr</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;PartonLevel:FSR&quot;</span><span class="p">);</span>
  <span class="kt">bool</span> <span class="n">isr</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;PartonLevel:ISR&quot;</span><span class="p">);</span>
  <span class="kt">bool</span> <span class="n">mpi</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;PartonLevel:MPI&quot;</span><span class="p">);</span>
  <span class="kt">bool</span> <span class="n">had</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;HadronLevel:all&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;PartonLevel:FSR&quot;</span><span class="p">,</span><span class="nb">false</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;PartonLevel:ISR&quot;</span><span class="p">,</span><span class="nb">false</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;HadronLevel:all&quot;</span><span class="p">,</span><span class="nb">false</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;PartonLevel:MPI&quot;</span><span class="p">,</span><span class="nb">false</span><span class="p">);</span>
  <span class="c1">// Switch on cross section estimation procedure.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;Merging:doXSectionEstimate&quot;</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
  <span class="kt">int</span> <span class="n">njetcounterLO</span>  <span class="o">=</span> <span class="n">nMaxLO</span><span class="p">;</span>
  <span class="n">string</span> <span class="n">iPathTree</span>   <span class="o">=</span> <span class="n">iPath</span> <span class="o">+</span> <span class="s">&quot;_tree&quot;</span><span class="p">;</span>
  <span class="c1">// Save estimates in vectors.</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">xsecLO</span><span class="p">;</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">nAcceptLO</span><span class="p">;</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">nSelectedLO</span><span class="p">;</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">strategyLO</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Start estimating ckkwl tree level cross section&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="k">while</span><span class="p">(</span><span class="n">njetcounterLO</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// From njetcounter, choose LHE file</span>
    <span class="n">stringstream</span> <span class="n">in</span><span class="p">;</span>
    <span class="n">in</span>   <span class="o">&lt;&lt;</span> <span class="s">&quot;_&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">njetcounterLO</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;.lhe&quot;</span><span class="p">;</span>
<span class="cp">#ifdef GZIPSUPPORT</span>
    <span class="k">if</span><span class="p">(</span><span class="n">access</span><span class="p">(</span> <span class="p">(</span><span class="n">iPathTree</span><span class="o">+</span><span class="n">in</span><span class="p">.</span><span class="n">str</span><span class="p">()</span><span class="o">+</span><span class="s">&quot;.gz&quot;</span><span class="p">).</span><span class="n">c_str</span><span class="p">(),</span> <span class="n">F_OK</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="n">in</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;.gz&quot;</span><span class="p">;</span>
<span class="cp">#endif</span>
    <span class="n">string</span> <span class="n">LHEfile</span> <span class="o">=</span> <span class="n">iPathTree</span> <span class="o">+</span> <span class="n">in</span><span class="p">.</span><span class="n">str</span><span class="p">();</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Merging:nRequested&quot;</span><span class="p">,</span> <span class="n">njetcounterLO</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Beams:frameType&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">word</span><span class="p">(</span><span class="s">&quot;Beams:LHEF&quot;</span><span class="p">,</span> <span class="n">LHEfile</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
    <span class="c1">// Start generation loop</span>
    <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">iEvent</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">iEvent</span><span class="o">&lt;</span><span class="n">nEvent</span><span class="p">;</span> <span class="o">++</span><span class="n">iEvent</span> <span class="p">){</span>
      <span class="c1">// Generate next event</span>
      <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">atEndOfFile</span><span class="p">()</span> <span class="p">){</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">continue</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="c1">// end loop over events to generate</span>
    <span class="c1">// print cross section, errors</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
    <span class="n">xsecLO</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">sigmaGen</span><span class="p">());</span>
    <span class="n">nSelectedLO</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">nSelected</span><span class="p">());</span>
    <span class="n">nAcceptLO</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">nAccepted</span><span class="p">());</span>
    <span class="n">strategyLO</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">lhaStrategy</span><span class="p">());</span>
    <span class="c1">// Restart with ME of a reduced the number of jets</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">njetcounterLO</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span>
      <span class="n">njetcounterLO</span><span class="o">--</span><span class="p">;</span>
    <span class="k">else</span>
      <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span> <span class="c1">// end loop over different jet multiplicities</span>
<span class="c1">//-----------------------------------------------------------------------------</span>
<span class="c1">//-----------------------------------------------------------------------------</span>
  <span class="c1">// Switch off cross section estimation.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;Merging:doXSectionEstimate&quot;</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span>
  <span class="c1">// Switch showering and multiple interaction back on.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;PartonLevel:FSR&quot;</span><span class="p">,</span><span class="n">fsr</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;PartonLevel:ISR&quot;</span><span class="p">,</span><span class="n">isr</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;HadronLevel:all&quot;</span><span class="p">,</span><span class="n">had</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;PartonLevel:MPI&quot;</span><span class="p">,</span><span class="n">mpi</span><span class="p">);</span>
  <span class="c1">// Declare sample cross section for output.</span>
  <span class="kt">double</span> <span class="n">sigmaTemp</span>  <span class="o">=</span> <span class="mf">0.</span><span class="p">;</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">sampleXStree</span><span class="p">;</span>
  <span class="c1">// Cross section an error.</span>
  <span class="kt">double</span> <span class="n">sigmaTotal</span>  <span class="o">=</span> <span class="mf">0.</span><span class="p">;</span>
  <span class="kt">double</span> <span class="n">errorTotal</span>  <span class="o">=</span> <span class="mf">0.</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">sizeLO</span>    <span class="o">=</span> <span class="kt">int</span><span class="p">(</span><span class="n">xsecLO</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
  <span class="n">njetcounterLO</span> <span class="o">=</span> <span class="n">nMaxLO</span><span class="p">;</span>
  <span class="n">iPathTree</span>     <span class="o">=</span> <span class="n">iPath</span> <span class="o">+</span> <span class="s">&quot;_tree&quot;</span><span class="p">;</span>
  <span class="k">while</span><span class="p">(</span><span class="n">njetcounterLO</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">){</span>
    <span class="c1">// From njetcounter, choose LHE file</span>
    <span class="n">stringstream</span> <span class="n">in</span><span class="p">;</span>
    <span class="n">in</span>   <span class="o">&lt;&lt;</span> <span class="s">&quot;_&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">njetcounterLO</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;.lhe&quot;</span><span class="p">;</span>
<span class="cp">#ifdef GZIPSUPPORT</span>
    <span class="k">if</span><span class="p">(</span><span class="n">access</span><span class="p">(</span> <span class="p">(</span><span class="n">iPathTree</span><span class="o">+</span><span class="n">in</span><span class="p">.</span><span class="n">str</span><span class="p">()</span><span class="o">+</span><span class="s">&quot;.gz&quot;</span><span class="p">).</span><span class="n">c_str</span><span class="p">(),</span> <span class="n">F_OK</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="n">in</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;.gz&quot;</span><span class="p">;</span>
<span class="cp">#endif</span>
    <span class="n">string</span> <span class="n">LHEfile</span> <span class="o">=</span> <span class="n">iPathTree</span> <span class="o">+</span> <span class="n">in</span><span class="p">.</span><span class="n">str</span><span class="p">();</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot;Start tree level treatment for &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">njetcounterLO</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; jets&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Merging:nRequested&quot;</span><span class="p">,</span> <span class="n">njetcounterLO</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Beams:frameType&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">word</span><span class="p">(</span><span class="s">&quot;Beams:LHEF&quot;</span><span class="p">,</span> <span class="n">LHEfile</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
    <span class="c1">// Remember position in vector of cross section estimates.</span>
    <span class="kt">int</span> <span class="n">iNow</span> <span class="o">=</span> <span class="n">sizeLO</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">njetcounterLO</span><span class="p">;</span>
    <span class="c1">// Start generation loop</span>
    <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">iEvent</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">iEvent</span><span class="o">&lt;</span><span class="n">nEvent</span><span class="p">;</span> <span class="o">++</span><span class="n">iEvent</span> <span class="p">){</span>
      <span class="c1">// Generate next event</span>
      <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">atEndOfFile</span><span class="p">()</span> <span class="p">)</span> <span class="k">break</span><span class="p">;</span>
        <span class="k">else</span> <span class="k">continue</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="c1">// Get event weight(s).</span>
      <span class="kt">double</span> <span class="n">weight</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">mergingWeight</span><span class="p">();</span>
      <span class="kt">double</span> <span class="n">evtweight</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">weight</span><span class="p">();</span>
      <span class="n">weight</span> <span class="o">*=</span> <span class="n">evtweight</span><span class="p">;</span>
      <span class="c1">// Do not print zero-weight events.</span>
      <span class="k">if</span> <span class="p">(</span> <span class="n">weight</span> <span class="o">==</span> <span class="mf">0.</span> <span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
      <span class="c1">// Construct new empty HepMC event.</span>
      <span class="n">HepMC</span><span class="o">::</span><span class="n">GenEvent</span><span class="o">*</span> <span class="n">hepmcevt</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HepMC</span><span class="o">::</span><span class="n">GenEvent</span><span class="p">();</span>
      <span class="c1">// Get correct cross section from previous estimate.</span>
      <span class="kt">double</span> <span class="n">normhepmc</span> <span class="o">=</span> <span class="n">xsecLO</span><span class="p">[</span><span class="n">iNow</span><span class="p">]</span> <span class="o">/</span> <span class="n">nAcceptLO</span><span class="p">[</span><span class="n">iNow</span><span class="p">];</span>
      <span class="c1">// weighted events</span>
      <span class="k">if</span><span class="p">(</span> <span class="n">abs</span><span class="p">(</span><span class="n">strategyLO</span><span class="p">[</span><span class="n">iNow</span><span class="p">])</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">normhepmc</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1e9</span><span class="o">*</span><span class="n">nSelectedLO</span><span class="p">[</span><span class="n">iNow</span><span class="p">]);</span>
      <span class="c1">// Set event weight</span>
      <span class="n">hepmcevt</span><span class="o">-&gt;</span><span class="n">weights</span><span class="p">().</span><span class="n">push_back</span><span class="p">(</span><span class="n">weight</span><span class="o">*</span><span class="n">normhepmc</span><span class="p">);</span>
      <span class="c1">// Fill HepMC event</span>
      <span class="n">ToHepMC</span><span class="p">.</span><span class="n">fill_next_event</span><span class="p">(</span> <span class="n">pythia</span><span class="p">,</span> <span class="n">hepmcevt</span> <span class="p">);</span>
      <span class="c1">// Add the weight of the current event to the cross section.</span>
      <span class="n">sigmaTotal</span> <span class="o">+=</span> <span class="n">weight</span><span class="o">*</span><span class="n">normhepmc</span><span class="p">;</span>
      <span class="n">sigmaTemp</span>  <span class="o">+=</span> <span class="n">weight</span><span class="o">*</span><span class="n">normhepmc</span><span class="p">;</span>
      <span class="n">errorTotal</span> <span class="o">+=</span> <span class="n">pow2</span><span class="p">(</span><span class="n">weight</span><span class="o">*</span><span class="n">normhepmc</span><span class="p">);</span>
      <span class="c1">// Report cross section to hepmc</span>
      <span class="n">HepMC</span><span class="o">::</span><span class="n">GenCrossSection</span> <span class="n">xsec</span><span class="p">;</span>
      <span class="n">xsec</span><span class="p">.</span><span class="n">set_cross_section</span><span class="p">(</span> <span class="n">sigmaTotal</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">sigmaErr</span><span class="p">()</span><span class="o">*</span><span class="mf">1e9</span> <span class="p">);</span>
      <span class="n">hepmcevt</span><span class="o">-&gt;</span><span class="n">set_cross_section</span><span class="p">(</span> <span class="n">xsec</span> <span class="p">);</span>
      <span class="c1">// Write the HepMC event to file. Done with it.</span>
      <span class="n">ascii_io</span> <span class="o">&lt;&lt;</span> <span class="n">hepmcevt</span><span class="p">;</span>
      <span class="k">delete</span> <span class="n">hepmcevt</span><span class="p">;</span>
    <span class="p">}</span> <span class="c1">// end loop over events to generate</span>
    <span class="c1">// print cross section, errors</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
    <span class="c1">// Save sample cross section for output.</span>
    <span class="n">sampleXStree</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">sigmaTemp</span><span class="p">);</span>
    <span class="n">sigmaTemp</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">;</span>
    <span class="c1">// Restart with ME of a reduced the number of jets</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">njetcounterLO</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span>
      <span class="n">njetcounterLO</span><span class="o">--</span><span class="p">;</span>
    <span class="k">else</span>
      <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// Print cross section information.</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; *---------------------------------------------------*&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; |                                                   |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; | Sample cross sections after CKKW-L merging        |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; |                                                   |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; | Leading order cross sections (mb):                |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="kt">int</span><span class="p">(</span><span class="n">sampleXStree</span><span class="p">.</span><span class="n">size</span><span class="p">());</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; |     &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">sampleXStree</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;-jet:  &quot;</span>
         <span class="o">&lt;&lt;</span> <span class="n">setw</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">scientific</span> <span class="o">&lt;&lt;</span> <span class="n">setprecision</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
         <span class="o">&lt;&lt;</span> <span class="n">sampleXStree</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;                     |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; |                                                   |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; |---------------------------------------------------|&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; |---------------------------------------------------|&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; | Inclusive cross sections:                         |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; |                                                   |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; | CKKW-L merged inclusive cross section:            |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; |    &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">setw</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">scientific</span> <span class="o">&lt;&lt;</span> <span class="n">setprecision</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
       <span class="o">&lt;&lt;</span> <span class="n">sigmaTotal</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;  +-  &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">setw</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">errorTotal</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; mb &quot;</span>
       <span class="o">&lt;&lt;</span> <span class="s">&quot;   |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; |                                                   |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; | LO inclusive cross section:                       |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; |    &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">setw</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">scientific</span> <span class="o">&lt;&lt;</span> <span class="n">setprecision</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
       <span class="o">&lt;&lt;</span> <span class="n">xsecLO</span><span class="p">.</span><span class="n">back</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; mb                           |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; |                                                   |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; *---------------------------------------------------*&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="c1">// Done</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
    </div>
  </div>
</div>

</div> <div class="well well-sm"> <h1 id="main86cc">main86.cc</h1><hr>
<div class="codehilite"><pre><span class="c1">// main86.cc is a part of the PYTHIA event generator.</span>
<span class="c1">// Copyright (C) 2016 Torbjorn Sjostrand.</span>
<span class="c1">// PYTHIA is licenced under the GNU GPL version 2, see COPYING for details.</span>
<span class="c1">// Please respect the MCnet Guidelines, see GUIDELINES for details.</span>
<span class="c1">// This program is written by Stefan Prestel.</span>
<span class="c1">// It illustrates how to do UMEPS merging, see the Matrix Element</span>
<span class="c1">// Merging page in the online manual. An example command is</span>
<span class="c1">//     ./main86 main86.cmnd w_production hepmcout86.dat</span>
<span class="c1">// where main86.cmnd supplies the commands, w_production provides the</span>
<span class="c1">// input LHE events, and hepmcout86.dat is the output file. This</span>
<span class="c1">// example requires HepMC.</span>
</pre></div>


<div class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" href="#fileid58">Rest of the main86.cc code</a>
    </h4>
  </div>
  <div id="fileid58" class="panel-collapse collapse">
    <div class="panel-body">
<div class="codehilite"><pre><span class="cp">#include</span> <span class="cpf">&quot;Pythia8/Pythia.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;Pythia8Plugins/HepMC2.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">Pythia8</span><span class="p">;</span>
<span class="c1">//==========================================================================</span>
<span class="c1">// Example main programm to illustrate merging</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span> <span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[]</span> <span class="p">){</span>
  <span class="c1">// Check that correct number of command-line arguments</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; Unexpected number of command-line arguments (&quot;</span><span class="o">&lt;&lt;</span><span class="n">argc</span><span class="o">&lt;&lt;</span><span class="s">&quot;). </span><span class="se">\n</span><span class="s">&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; You are expected to provide the arguments&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; 1. Input file for settings&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; 2. Name of the input LHE file (with path), up to the &#39;_tree&#39;&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; identifier&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; 3. Path for output HepMC&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; Program stopped. &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">Pythia</span> <span class="n">pythia</span><span class="p">;</span>
  <span class="c1">// Input parameters:</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readFile</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
  <span class="c1">// Interface for conversion from Pythia8::Event to HepMC one.</span>
  <span class="n">HepMC</span><span class="o">::</span><span class="n">Pythia8ToHepMC</span> <span class="n">ToHepMC</span><span class="p">;</span>
  <span class="c1">// Specify file where HepMC events will be stored.</span>
  <span class="n">HepMC</span><span class="o">::</span><span class="n">IO_GenEvent</span> <span class="n">ascii_io</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">std</span><span class="o">::</span><span class="n">ios</span><span class="o">::</span><span class="n">out</span><span class="p">);</span>
  <span class="c1">// Switch off warnings for parton-level events.</span>
  <span class="n">ToHepMC</span><span class="p">.</span><span class="n">set_print_inconsistency</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
  <span class="n">ToHepMC</span><span class="p">.</span><span class="n">set_free_parton_warnings</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
  <span class="c1">// Do not store cross section information, as this will be done manually.</span>
  <span class="n">ToHepMC</span><span class="p">.</span><span class="n">set_store_pdf</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
  <span class="n">ToHepMC</span><span class="p">.</span><span class="n">set_store_proc</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
  <span class="n">ToHepMC</span><span class="p">.</span><span class="n">set_store_xsec</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
  <span class="c1">// Path to input events, with name up to the &quot;_tree&quot; identifier included.</span>
  <span class="n">string</span> <span class="n">iPath</span> <span class="o">=</span> <span class="n">string</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
  <span class="c1">// Number of events</span>
  <span class="kt">int</span> <span class="n">nEvent</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Main:numberOfEvents&quot;</span><span class="p">);</span>
  <span class="c1">// Maximal number of additional LO jets.</span>
  <span class="kt">int</span> <span class="n">nMaxLO</span> <span class="o">=</span>  <span class="n">pythia</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Merging:nJetMax&quot;</span><span class="p">);</span>
<span class="c1">//-----------------------------------------------------------------------------</span>
<span class="c1">//-----------------------------------------------------------------------------</span>
  <span class="c1">// Switch off all showering and MPI when extimating the cross section after</span>
  <span class="c1">// the merging scale cut.</span>
  <span class="kt">bool</span> <span class="n">fsr</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;PartonLevel:FSR&quot;</span><span class="p">);</span>
  <span class="kt">bool</span> <span class="n">isr</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;PartonLevel:ISR&quot;</span><span class="p">);</span>
  <span class="kt">bool</span> <span class="n">mpi</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;PartonLevel:MPI&quot;</span><span class="p">);</span>
  <span class="kt">bool</span> <span class="n">had</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;HadronLevel:all&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;PartonLevel:FSR&quot;</span><span class="p">,</span><span class="nb">false</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;PartonLevel:ISR&quot;</span><span class="p">,</span><span class="nb">false</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;HadronLevel:all&quot;</span><span class="p">,</span><span class="nb">false</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;PartonLevel:MPI&quot;</span><span class="p">,</span><span class="nb">false</span><span class="p">);</span>
  <span class="c1">// Switch on cross section estimation procedure.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;Merging:doXSectionEstimate&quot;</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;Merging:doUMEPSTree&quot;</span><span class="p">,</span><span class="nb">true</span><span class="p">);</span>
  <span class="kt">int</span> <span class="n">njetcounterLO</span> <span class="o">=</span> <span class="n">nMaxLO</span><span class="p">;</span>
  <span class="n">string</span> <span class="n">iPathTree</span>  <span class="o">=</span> <span class="n">iPath</span> <span class="o">+</span> <span class="s">&quot;_tree&quot;</span><span class="p">;</span>
  <span class="c1">// Save estimates in vectors.</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">xsecLO</span><span class="p">;</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">nAcceptLO</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Start estimating umeps tree level cross section&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="k">while</span><span class="p">(</span><span class="n">njetcounterLO</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// From njet, choose LHE file</span>
    <span class="n">stringstream</span> <span class="n">in</span><span class="p">;</span>
    <span class="n">in</span>   <span class="o">&lt;&lt;</span> <span class="s">&quot;_&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">njetcounterLO</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;.lhe&quot;</span><span class="p">;</span>
<span class="cp">#ifdef GZIPSUPPORT</span>
    <span class="k">if</span><span class="p">(</span><span class="n">access</span><span class="p">(</span> <span class="p">(</span><span class="n">iPathTree</span><span class="o">+</span><span class="n">in</span><span class="p">.</span><span class="n">str</span><span class="p">()</span><span class="o">+</span><span class="s">&quot;.gz&quot;</span><span class="p">).</span><span class="n">c_str</span><span class="p">(),</span> <span class="n">F_OK</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="n">in</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;.gz&quot;</span><span class="p">;</span>
<span class="cp">#endif</span>
    <span class="n">string</span> <span class="n">LHEfile</span> <span class="o">=</span> <span class="n">iPathTree</span> <span class="o">+</span> <span class="n">in</span><span class="p">.</span><span class="n">str</span><span class="p">();</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Merging:nRequested&quot;</span><span class="p">,</span> <span class="n">njetcounterLO</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Beams:frameType&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">word</span><span class="p">(</span><span class="s">&quot;Beams:LHEF&quot;</span><span class="p">,</span> <span class="n">LHEfile</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
    <span class="c1">// Start generation loop</span>
    <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">iEvent</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">iEvent</span><span class="o">&lt;</span><span class="n">nEvent</span><span class="p">;</span> <span class="o">++</span><span class="n">iEvent</span> <span class="p">){</span>
      <span class="c1">// Generate next event</span>
      <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">atEndOfFile</span><span class="p">()</span> <span class="p">){</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">continue</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="c1">// end loop over events to generate</span>
    <span class="c1">// print cross section, errors</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
    <span class="n">xsecLO</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">sigmaGen</span><span class="p">());</span>
    <span class="n">nAcceptLO</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">nAccepted</span><span class="p">());</span>
    <span class="c1">// Restart with ME of a reduced the number of jets</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">njetcounterLO</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span>
      <span class="n">njetcounterLO</span><span class="o">--</span><span class="p">;</span>
    <span class="k">else</span>
      <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span> <span class="c1">// end loop over different jet multiplicities</span>
  <span class="c1">// Switch off cross section estimation.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;Merging:doXSectionEstimate&quot;</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span>
  <span class="c1">// Switch showering and multiple interaction back on.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;PartonLevel:FSR&quot;</span><span class="p">,</span><span class="n">fsr</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;PartonLevel:ISR&quot;</span><span class="p">,</span><span class="n">isr</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;HadronLevel:all&quot;</span><span class="p">,</span><span class="n">had</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;PartonLevel:MPI&quot;</span><span class="p">,</span><span class="n">mpi</span><span class="p">);</span>
  <span class="c1">// Declare sample cross section for output.</span>
  <span class="kt">double</span> <span class="n">sigmaTemp</span>  <span class="o">=</span> <span class="mf">0.</span><span class="p">;</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">sampleXStree</span><span class="p">;</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">sampleXSsubtTree</span><span class="p">;</span>
  <span class="c1">// Cross section an error.</span>
  <span class="kt">double</span> <span class="n">sigmaTotal</span>  <span class="o">=</span> <span class="mf">0.</span><span class="p">;</span>
  <span class="kt">double</span> <span class="n">errorTotal</span>  <span class="o">=</span> <span class="mf">0.</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">sizeLO</span>    <span class="o">=</span> <span class="kt">int</span><span class="p">(</span><span class="n">xsecLO</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
  <span class="n">njetcounterLO</span> <span class="o">=</span> <span class="n">nMaxLO</span><span class="p">;</span>
  <span class="n">iPathTree</span>     <span class="o">=</span> <span class="n">iPath</span> <span class="o">+</span> <span class="s">&quot;_tree&quot;</span><span class="p">;</span>
  <span class="k">while</span><span class="p">(</span><span class="n">njetcounterLO</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">){</span>
    <span class="c1">// From njet, choose LHE file</span>
    <span class="n">stringstream</span> <span class="n">in</span><span class="p">;</span>
    <span class="n">in</span>   <span class="o">&lt;&lt;</span> <span class="s">&quot;_&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">njetcounterLO</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;.lhe&quot;</span><span class="p">;</span>
<span class="cp">#ifdef GZIPSUPPORT</span>
    <span class="k">if</span><span class="p">(</span><span class="n">access</span><span class="p">(</span> <span class="p">(</span><span class="n">iPathTree</span><span class="o">+</span><span class="n">in</span><span class="p">.</span><span class="n">str</span><span class="p">()</span><span class="o">+</span><span class="s">&quot;.gz&quot;</span><span class="p">).</span><span class="n">c_str</span><span class="p">(),</span> <span class="n">F_OK</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="n">in</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;.gz&quot;</span><span class="p">;</span>
<span class="cp">#endif</span>
    <span class="n">string</span> <span class="n">LHEfile</span> <span class="o">=</span> <span class="n">iPathTree</span> <span class="o">+</span> <span class="n">in</span><span class="p">.</span><span class="n">str</span><span class="p">();</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;Merging:doUMEPSTree&quot;</span><span class="p">,</span><span class="nb">true</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;Merging:doUMEPSSubt&quot;</span><span class="p">,</span><span class="nb">false</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Merging:nRecluster&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot;Start tree level treatment for &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">njetcounterLO</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; jets&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Merging:nRequested&quot;</span><span class="p">,</span> <span class="n">njetcounterLO</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Beams:frameType&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">word</span><span class="p">(</span><span class="s">&quot;Beams:LHEF&quot;</span><span class="p">,</span> <span class="n">LHEfile</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
    <span class="c1">// Remember position in vector of cross section estimates.</span>
    <span class="kt">int</span> <span class="n">iNow</span> <span class="o">=</span> <span class="n">sizeLO</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">njetcounterLO</span><span class="p">;</span>
    <span class="c1">// Start generation loop</span>
    <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">iEvent</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">iEvent</span><span class="o">&lt;</span><span class="n">nEvent</span><span class="p">;</span> <span class="o">++</span><span class="n">iEvent</span> <span class="p">){</span>
      <span class="c1">// Generate next event</span>
      <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">atEndOfFile</span><span class="p">()</span> <span class="p">)</span> <span class="k">break</span><span class="p">;</span>
        <span class="k">else</span> <span class="k">continue</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="c1">// Get event weight(s).</span>
      <span class="kt">double</span> <span class="n">weight</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">mergingWeight</span><span class="p">();</span>
      <span class="kt">double</span> <span class="n">evtweight</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">weight</span><span class="p">();</span>
      <span class="n">weight</span> <span class="o">*=</span> <span class="n">evtweight</span><span class="p">;</span>
      <span class="c1">// Do not print zero-weight events.</span>
      <span class="k">if</span> <span class="p">(</span> <span class="n">weight</span> <span class="o">==</span> <span class="mf">0.</span> <span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
      <span class="c1">// Construct new empty HepMC event.</span>
      <span class="n">HepMC</span><span class="o">::</span><span class="n">GenEvent</span><span class="o">*</span> <span class="n">hepmcevt</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HepMC</span><span class="o">::</span><span class="n">GenEvent</span><span class="p">();</span>
      <span class="c1">// Get correct cross section from previous estimate.</span>
      <span class="kt">double</span> <span class="n">normhepmc</span> <span class="o">=</span> <span class="n">xsecLO</span><span class="p">[</span><span class="n">iNow</span><span class="p">]</span> <span class="o">/</span> <span class="n">nAcceptLO</span><span class="p">[</span><span class="n">iNow</span><span class="p">];</span>
      <span class="c1">// Set event weight</span>
      <span class="n">hepmcevt</span><span class="o">-&gt;</span><span class="n">weights</span><span class="p">().</span><span class="n">push_back</span><span class="p">(</span><span class="n">weight</span><span class="o">*</span><span class="n">normhepmc</span><span class="p">);</span>
      <span class="c1">// Fill HepMC event.</span>
      <span class="n">ToHepMC</span><span class="p">.</span><span class="n">fill_next_event</span><span class="p">(</span> <span class="n">pythia</span><span class="p">,</span> <span class="n">hepmcevt</span> <span class="p">);</span>
      <span class="c1">// Add the weight of the current event to the cross section.</span>
      <span class="n">sigmaTotal</span> <span class="o">+=</span> <span class="n">weight</span><span class="o">*</span><span class="n">normhepmc</span><span class="p">;</span>
      <span class="n">sigmaTemp</span>  <span class="o">+=</span> <span class="n">weight</span><span class="o">*</span><span class="n">normhepmc</span><span class="p">;</span>
      <span class="n">errorTotal</span> <span class="o">+=</span> <span class="n">pow2</span><span class="p">(</span><span class="n">weight</span><span class="o">*</span><span class="n">normhepmc</span><span class="p">);</span>
      <span class="c1">// Report cross section to hepmc</span>
      <span class="n">HepMC</span><span class="o">::</span><span class="n">GenCrossSection</span> <span class="n">xsec</span><span class="p">;</span>
      <span class="n">xsec</span><span class="p">.</span><span class="n">set_cross_section</span><span class="p">(</span> <span class="n">sigmaTotal</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">sigmaErr</span><span class="p">()</span><span class="o">*</span><span class="mf">1e9</span> <span class="p">);</span>
      <span class="n">hepmcevt</span><span class="o">-&gt;</span><span class="n">set_cross_section</span><span class="p">(</span> <span class="n">xsec</span> <span class="p">);</span>
      <span class="c1">// Write the HepMC event to file. Done with it.</span>
      <span class="n">ascii_io</span> <span class="o">&lt;&lt;</span> <span class="n">hepmcevt</span><span class="p">;</span>
      <span class="k">delete</span> <span class="n">hepmcevt</span><span class="p">;</span>
    <span class="p">}</span> <span class="c1">// end loop over events to generate</span>
    <span class="c1">// print cross section, errors</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
    <span class="c1">// Save sample cross section for output.</span>
    <span class="n">sampleXStree</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">sigmaTemp</span><span class="p">);</span>
    <span class="n">sigmaTemp</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">;</span>
    <span class="c1">// Restart with ME of a reduced the number of jets</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">njetcounterLO</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span>
      <span class="n">njetcounterLO</span><span class="o">--</span><span class="p">;</span>
    <span class="k">else</span>
      <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Do UMEPS subtraction&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">njetcounterLS</span>   <span class="o">=</span> <span class="n">nMaxLO</span><span class="p">;</span>
  <span class="n">string</span> <span class="n">iPathSubt</span>    <span class="o">=</span> <span class="n">iPath</span> <span class="o">+</span> <span class="s">&quot;_tree&quot;</span><span class="p">;</span>
  <span class="k">while</span><span class="p">(</span><span class="n">njetcounterLS</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">){</span>
    <span class="c1">// From njet, choose LHE file</span>
    <span class="n">stringstream</span> <span class="n">in</span><span class="p">;</span>
    <span class="n">in</span>   <span class="o">&lt;&lt;</span> <span class="s">&quot;_&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">njetcounterLS</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;.lhe&quot;</span><span class="p">;</span>
<span class="cp">#ifdef GZIPSUPPORT</span>
    <span class="k">if</span><span class="p">(</span><span class="n">access</span><span class="p">(</span> <span class="p">(</span><span class="n">iPathSubt</span><span class="o">+</span><span class="n">in</span><span class="p">.</span><span class="n">str</span><span class="p">()</span><span class="o">+</span><span class="s">&quot;.gz&quot;</span><span class="p">).</span><span class="n">c_str</span><span class="p">(),</span> <span class="n">F_OK</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="n">in</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;.gz&quot;</span><span class="p">;</span>
<span class="cp">#endif</span>
    <span class="n">string</span> <span class="n">LHEfile</span> <span class="o">=</span> <span class="n">iPathSubt</span> <span class="o">+</span> <span class="n">in</span><span class="p">.</span><span class="n">str</span><span class="p">();</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;Merging:doUMEPSTree&quot;</span><span class="p">,</span><span class="nb">false</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;Merging:doUMEPSSubt&quot;</span><span class="p">,</span><span class="nb">true</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Merging:nRecluster&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot;Start subtractive treatment for &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">njetcounterLS</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; jets&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Merging:nRequested&quot;</span><span class="p">,</span> <span class="n">njetcounterLS</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Beams:frameType&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">word</span><span class="p">(</span><span class="s">&quot;Beams:LHEF&quot;</span><span class="p">,</span> <span class="n">LHEfile</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
    <span class="c1">// Remember position in vector of cross section estimates.</span>
    <span class="kt">int</span> <span class="n">iNow</span> <span class="o">=</span> <span class="n">sizeLO</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">njetcounterLS</span><span class="p">;</span>
    <span class="c1">// Start generation loop</span>
    <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">iEvent</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">iEvent</span><span class="o">&lt;</span><span class="n">nEvent</span><span class="p">;</span> <span class="o">++</span><span class="n">iEvent</span> <span class="p">){</span>
      <span class="c1">// Generate next event</span>
      <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">atEndOfFile</span><span class="p">()</span> <span class="p">)</span> <span class="k">break</span><span class="p">;</span>
        <span class="k">else</span> <span class="k">continue</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="c1">// Get event weight(s).</span>
      <span class="kt">double</span> <span class="n">weight</span>    <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">mergingWeight</span><span class="p">();</span>
      <span class="kt">double</span> <span class="n">evtweight</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">weight</span><span class="p">();</span>
      <span class="n">weight</span> <span class="o">*=</span> <span class="n">evtweight</span><span class="p">;</span>
      <span class="c1">// Do not print zero-weight events.</span>
      <span class="k">if</span> <span class="p">(</span> <span class="n">weight</span> <span class="o">==</span> <span class="mf">0.</span> <span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
      <span class="c1">// Construct new empty HepMC event.</span>
      <span class="n">HepMC</span><span class="o">::</span><span class="n">GenEvent</span><span class="o">*</span> <span class="n">hepmcevt</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HepMC</span><span class="o">::</span><span class="n">GenEvent</span><span class="p">();</span>
      <span class="c1">// Get correct cross section from previous estimate.</span>
      <span class="kt">double</span> <span class="n">normhepmc</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">xsecLO</span><span class="p">[</span><span class="n">iNow</span><span class="p">]</span> <span class="o">/</span> <span class="n">nAcceptLO</span><span class="p">[</span><span class="n">iNow</span><span class="p">];</span>
      <span class="c1">// Set event weight</span>
      <span class="n">hepmcevt</span><span class="o">-&gt;</span><span class="n">weights</span><span class="p">().</span><span class="n">push_back</span><span class="p">(</span><span class="n">weight</span><span class="o">*</span><span class="n">normhepmc</span><span class="p">);</span>
      <span class="c1">// Fill HepMC event.</span>
      <span class="n">ToHepMC</span><span class="p">.</span><span class="n">fill_next_event</span><span class="p">(</span> <span class="n">pythia</span><span class="p">,</span> <span class="n">hepmcevt</span> <span class="p">);</span>
      <span class="c1">// Add the weight of the current event to the cross section.</span>
      <span class="n">sigmaTotal</span> <span class="o">+=</span> <span class="n">weight</span><span class="o">*</span><span class="n">normhepmc</span><span class="p">;</span>
      <span class="n">sigmaTemp</span>  <span class="o">+=</span> <span class="n">weight</span><span class="o">*</span><span class="n">normhepmc</span><span class="p">;</span>
      <span class="n">errorTotal</span> <span class="o">+=</span> <span class="n">pow2</span><span class="p">(</span><span class="n">weight</span><span class="o">*</span><span class="n">normhepmc</span><span class="p">);</span>
      <span class="c1">// Report cross section to hepmc.</span>
      <span class="n">HepMC</span><span class="o">::</span><span class="n">GenCrossSection</span> <span class="n">xsec</span><span class="p">;</span>
      <span class="n">xsec</span><span class="p">.</span><span class="n">set_cross_section</span><span class="p">(</span> <span class="n">sigmaTotal</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">sigmaErr</span><span class="p">()</span><span class="o">*</span><span class="mf">1e9</span> <span class="p">);</span>
      <span class="n">hepmcevt</span><span class="o">-&gt;</span><span class="n">set_cross_section</span><span class="p">(</span> <span class="n">xsec</span> <span class="p">);</span>
      <span class="c1">// Write the HepMC event to file. Done with it.</span>
      <span class="n">ascii_io</span> <span class="o">&lt;&lt;</span> <span class="n">hepmcevt</span><span class="p">;</span>
      <span class="k">delete</span> <span class="n">hepmcevt</span><span class="p">;</span>
    <span class="p">}</span> <span class="c1">// end loop over events to generate</span>
    <span class="c1">// print cross section, errors</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
    <span class="c1">// Save sample cross section for output.</span>
    <span class="n">sampleXSsubtTree</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">sigmaTemp</span><span class="p">);</span>
    <span class="n">sigmaTemp</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">;</span>
    <span class="c1">// Restart with ME of a reduced the number of jets</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">njetcounterLS</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="p">)</span>
      <span class="n">njetcounterLS</span><span class="o">--</span><span class="p">;</span>
    <span class="k">else</span>
      <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// Print cross section information.</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; *---------------------------------------------------*&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; |                                                   |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; | Sample cross sections after UMEPS merging         |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; |                                                   |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; | Leading order cross sections (mb):                |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="kt">int</span><span class="p">(</span><span class="n">sampleXStree</span><span class="p">.</span><span class="n">size</span><span class="p">());</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; |     &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">sampleXStree</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;-jet:  &quot;</span>
         <span class="o">&lt;&lt;</span> <span class="n">setw</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">scientific</span> <span class="o">&lt;&lt;</span> <span class="n">setprecision</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
         <span class="o">&lt;&lt;</span> <span class="n">sampleXStree</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;                     |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; |                                                   |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; | Leading-order subtractive cross sections (mb):    |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="kt">int</span><span class="p">(</span><span class="n">sampleXSsubtTree</span><span class="p">.</span><span class="n">size</span><span class="p">());</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; |     &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">sampleXSsubtTree</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;-jet:  &quot;</span>
         <span class="o">&lt;&lt;</span> <span class="n">setw</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">scientific</span> <span class="o">&lt;&lt;</span> <span class="n">setprecision</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
         <span class="o">&lt;&lt;</span> <span class="n">sampleXSsubtTree</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;                     |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; |                                                   |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; |---------------------------------------------------|&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; |---------------------------------------------------|&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; | Inclusive cross sections:                         |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; |                                                   |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; | UMEPS merged inclusive cross section:             |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; |    &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">setw</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">scientific</span> <span class="o">&lt;&lt;</span> <span class="n">setprecision</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
       <span class="o">&lt;&lt;</span> <span class="n">sigmaTotal</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;  +-  &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">setw</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">errorTotal</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; mb &quot;</span>
       <span class="o">&lt;&lt;</span> <span class="s">&quot;   |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; |                                                   |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; | LO inclusive cross section:                       |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; |    &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">setw</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">scientific</span> <span class="o">&lt;&lt;</span> <span class="n">setprecision</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
       <span class="o">&lt;&lt;</span> <span class="n">xsecLO</span><span class="p">.</span><span class="n">back</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; mb                           |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; |                                                   |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; *---------------------------------------------------*&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="c1">// Done</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
    </div>
  </div>
</div>

</div> <div class="well well-sm"> <h1 id="main87cc">main87.cc</h1><hr>
<div class="codehilite"><pre><span class="c1">// main87.cc is a part of the PYTHIA event generator.</span>
<span class="c1">// Copyright (C) 2016 Torbjorn Sjostrand.</span>
<span class="c1">// PYTHIA is licenced under the GNU GPL version 2, see COPYING for details.</span>
<span class="c1">// Please respect the MCnet Guidelines, see GUIDELINES for details.</span>
<span class="c1">// This program is written by Stefan Prestel.</span>
<span class="c1">// It illustrates how to do NL3 merging, see the Matrix Element</span>
<span class="c1">// Merging page in the online manual. An example command is</span>
<span class="c1">//     ./main87 main87.cmnd w_production hepmcout87.dat</span>
<span class="c1">// where main87.cmnd supplies the commands, w_production provides the</span>
<span class="c1">// input LHE events, and hepmcout87.dat is the output file. This</span>
<span class="c1">// example requires HepMC.</span>
</pre></div>


<div class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" href="#fileid59">Rest of the main87.cc code</a>
    </h4>
  </div>
  <div id="fileid59" class="panel-collapse collapse">
    <div class="panel-body">
<div class="codehilite"><pre><span class="cp">#include</span> <span class="cpf">&quot;Pythia8/Pythia.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;Pythia8Plugins/HepMC2.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">Pythia8</span><span class="p">;</span>
<span class="c1">//==========================================================================</span>
<span class="c1">// Example main programm to illustrate merging</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span> <span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[]</span> <span class="p">){</span>
  <span class="c1">// Check that correct number of command-line arguments</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; Unexpected number of command-line arguments (&quot;</span><span class="o">&lt;&lt;</span><span class="n">argc</span><span class="o">&lt;&lt;</span><span class="s">&quot;). </span><span class="se">\n</span><span class="s">&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; You are expected to provide the arguments&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; 1. Input file for settings&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; 2. Name of the input LHE file (with path), up to the &#39;_tree&#39;&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; or &#39;_powheg&#39; identifiers&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; 3. Output hepmc file name&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; Program stopped. &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">Pythia</span> <span class="n">pythia</span><span class="p">;</span>
  <span class="c1">// Input parameters:</span>
  <span class="c1">//  1. Input file for settings</span>
  <span class="c1">//  2. Path to input LHE file</span>
  <span class="c1">//  3. Output histogram path</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readFile</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
  <span class="c1">// Interface for conversion from Pythia8::Event to HepMC one.</span>
  <span class="n">HepMC</span><span class="o">::</span><span class="n">Pythia8ToHepMC</span> <span class="n">ToHepMC</span><span class="p">;</span>
  <span class="c1">// Specify file where HepMC events will be stored.</span>
  <span class="n">HepMC</span><span class="o">::</span><span class="n">IO_GenEvent</span> <span class="n">ascii_io</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">std</span><span class="o">::</span><span class="n">ios</span><span class="o">::</span><span class="n">out</span><span class="p">);</span>
  <span class="c1">// Switch off warnings for parton-level events.</span>
  <span class="n">ToHepMC</span><span class="p">.</span><span class="n">set_print_inconsistency</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
  <span class="n">ToHepMC</span><span class="p">.</span><span class="n">set_free_parton_warnings</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
  <span class="c1">// Do not store cross section information, as this will be done manually.</span>
  <span class="n">ToHepMC</span><span class="p">.</span><span class="n">set_store_pdf</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
  <span class="n">ToHepMC</span><span class="p">.</span><span class="n">set_store_proc</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
  <span class="n">ToHepMC</span><span class="p">.</span><span class="n">set_store_xsec</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
  <span class="c1">// Path to input events, with name up to the &quot;_tree&quot;, &quot;_powheg&quot; identifier</span>
  <span class="c1">// included.</span>
  <span class="n">string</span> <span class="n">iPath</span> <span class="o">=</span> <span class="n">string</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
  <span class="c1">// Number of events</span>
  <span class="kt">int</span> <span class="n">nEvent</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Main:numberOfEvents&quot;</span><span class="p">);</span>
  <span class="c1">// Maximal number of additional LO jets.</span>
  <span class="kt">int</span> <span class="n">nMaxLO</span>   <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Merging:nJetMax&quot;</span><span class="p">);</span>
  <span class="c1">// maximal number of additional NLO jets.</span>
  <span class="kt">int</span> <span class="n">nMaxNLO</span>  <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Merging:nJetMaxNLO&quot;</span><span class="p">);</span>
<span class="c1">//-----------------------------------------------------------------------------</span>
<span class="c1">//-----------------------------------------------------------------------------</span>
  <span class="c1">// Switch off all showering and MPI when extimating the cross section after</span>
  <span class="c1">// the merging scale cut.</span>
  <span class="kt">bool</span> <span class="n">fsr</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;PartonLevel:FSR&quot;</span><span class="p">);</span>
  <span class="kt">bool</span> <span class="n">isr</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;PartonLevel:ISR&quot;</span><span class="p">);</span>
  <span class="kt">bool</span> <span class="n">mpi</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;PartonLevel:MPI&quot;</span><span class="p">);</span>
  <span class="kt">bool</span> <span class="n">had</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;HadronLevel:all&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;PartonLevel:FSR&quot;</span><span class="p">,</span><span class="nb">false</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;PartonLevel:ISR&quot;</span><span class="p">,</span><span class="nb">false</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;HadronLevel:all&quot;</span><span class="p">,</span><span class="nb">false</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;PartonLevel:MPI&quot;</span><span class="p">,</span><span class="nb">false</span><span class="p">);</span>
  <span class="c1">// Switch on cross section estimation procedure.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;Merging:doXSectionEstimate&quot;</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;Merging:doNL3Tree&quot;</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
  <span class="kt">int</span> <span class="n">njetcounterLO</span> <span class="o">=</span> <span class="n">nMaxLO</span><span class="p">;</span>
  <span class="n">string</span> <span class="n">iPathTree</span>     <span class="o">=</span> <span class="n">iPath</span> <span class="o">+</span> <span class="s">&quot;_tree&quot;</span><span class="p">;</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">xsecLO</span><span class="p">;</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">nSelectedLO</span><span class="p">;</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">nAcceptLO</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Start estimating nl3 tree level cross section&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="k">while</span><span class="p">(</span><span class="n">njetcounterLO</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">){</span>
    <span class="c1">// From njetcounter, choose LHE file</span>
    <span class="n">stringstream</span> <span class="n">in</span><span class="p">;</span>
    <span class="n">in</span>   <span class="o">&lt;&lt;</span> <span class="s">&quot;_&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">njetcounterLO</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;.lhe&quot;</span><span class="p">;</span>
<span class="cp">#ifdef GZIPSUPPORT</span>
    <span class="k">if</span><span class="p">(</span><span class="n">access</span><span class="p">(</span> <span class="p">(</span><span class="n">iPathTree</span><span class="o">+</span><span class="n">in</span><span class="p">.</span><span class="n">str</span><span class="p">()</span><span class="o">+</span><span class="s">&quot;.gz&quot;</span><span class="p">).</span><span class="n">c_str</span><span class="p">(),</span> <span class="n">F_OK</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="n">in</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;.gz&quot;</span><span class="p">;</span>
<span class="cp">#endif</span>
    <span class="n">string</span> <span class="n">LHEfile</span> <span class="o">=</span> <span class="n">iPathTree</span> <span class="o">+</span> <span class="n">in</span><span class="p">.</span><span class="n">str</span><span class="p">();</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Merging:nRequested&quot;</span><span class="p">,</span> <span class="n">njetcounterLO</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Beams:frameType&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">word</span><span class="p">(</span><span class="s">&quot;Beams:LHEF&quot;</span><span class="p">,</span> <span class="n">LHEfile</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
    <span class="c1">// Start generation loop</span>
    <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">iEvent</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">iEvent</span><span class="o">&lt;</span><span class="n">nEvent</span><span class="p">;</span> <span class="o">++</span><span class="n">iEvent</span> <span class="p">){</span>
      <span class="c1">// Generate next event</span>
      <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">atEndOfFile</span><span class="p">()</span> <span class="p">){</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">continue</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="c1">// end loop over events to generate</span>
    <span class="c1">// print cross section, errors</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
    <span class="n">xsecLO</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">sigmaGen</span><span class="p">());</span>
    <span class="n">nSelectedLO</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">nSelected</span><span class="p">());</span>
    <span class="n">nAcceptLO</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">nAccepted</span><span class="p">());</span>
    <span class="c1">// Restart with ME of a reduced the number of jets</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">njetcounterLO</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span>
      <span class="n">njetcounterLO</span><span class="o">--</span><span class="p">;</span>
    <span class="k">else</span>
      <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
<span class="c1">//-----------------------------------------------------------------------------</span>
<span class="c1">//-----------------------------------------------------------------------------</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Start estimating nl3 virtual corrections cross section&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;Merging:doNL3Tree&quot;</span><span class="p">,</span><span class="nb">false</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;Merging:doNL3Loop&quot;</span><span class="p">,</span><span class="nb">true</span><span class="p">);</span>
  <span class="kt">int</span> <span class="n">njetcounterNLO</span> <span class="o">=</span> <span class="n">nMaxNLO</span><span class="p">;</span>
  <span class="n">string</span> <span class="n">iPathLoop</span><span class="o">=</span> <span class="n">iPath</span> <span class="o">+</span> <span class="s">&quot;_powheg&quot;</span><span class="p">;</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">xsecNLO</span><span class="p">;</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">nSelectedNLO</span><span class="p">;</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">nAcceptNLO</span><span class="p">;</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">strategyNLO</span><span class="p">;</span>
  <span class="k">while</span><span class="p">(</span><span class="n">njetcounterNLO</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">){</span>
    <span class="c1">// From njetcounter, choose LHE file</span>
    <span class="n">stringstream</span> <span class="n">in</span><span class="p">;</span>
    <span class="n">in</span>   <span class="o">&lt;&lt;</span> <span class="s">&quot;_&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">njetcounterNLO</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;.lhe&quot;</span><span class="p">;</span>
<span class="cp">#ifdef GZIPSUPPORT</span>
    <span class="k">if</span><span class="p">(</span><span class="n">access</span><span class="p">(</span> <span class="p">(</span><span class="n">iPathLoop</span><span class="o">+</span><span class="n">in</span><span class="p">.</span><span class="n">str</span><span class="p">()</span><span class="o">+</span><span class="s">&quot;.gz&quot;</span><span class="p">).</span><span class="n">c_str</span><span class="p">(),</span> <span class="n">F_OK</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="n">in</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;.gz&quot;</span><span class="p">;</span>
<span class="cp">#endif</span>
    <span class="n">string</span> <span class="n">LHEfile</span> <span class="o">=</span> <span class="n">iPathLoop</span> <span class="o">+</span> <span class="n">in</span><span class="p">.</span><span class="n">str</span><span class="p">();</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Merging:nRequested&quot;</span><span class="p">,</span> <span class="n">njetcounterNLO</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Beams:frameType&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">word</span><span class="p">(</span><span class="s">&quot;Beams:LHEF&quot;</span><span class="p">,</span> <span class="n">LHEfile</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
    <span class="c1">// Start generation loop</span>
    <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">iEvent</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">iEvent</span><span class="o">&lt;</span><span class="n">nEvent</span><span class="p">;</span> <span class="o">++</span><span class="n">iEvent</span> <span class="p">){</span>
      <span class="c1">// Generate next event</span>
      <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">atEndOfFile</span><span class="p">()</span> <span class="p">){</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">continue</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="c1">// end loop over events to generate</span>
    <span class="c1">// print cross section, errors</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
    <span class="n">xsecNLO</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">sigmaGen</span><span class="p">());</span>
    <span class="n">nSelectedNLO</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">nSelected</span><span class="p">());</span>
    <span class="n">nAcceptNLO</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">nAccepted</span><span class="p">());</span>
    <span class="n">strategyNLO</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">lhaStrategy</span><span class="p">());</span>
    <span class="c1">// Restart with ME of a reduced the number of jets</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">njetcounterNLO</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span>
      <span class="n">njetcounterNLO</span><span class="o">--</span><span class="p">;</span>
    <span class="k">else</span>
      <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// Set k-factors</span>
  <span class="kt">int</span> <span class="n">sizeLO</span>   <span class="o">=</span> <span class="kt">int</span><span class="p">(</span><span class="n">xsecLO</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
  <span class="kt">int</span> <span class="n">sizeNLO</span>  <span class="o">=</span> <span class="kt">int</span><span class="p">(</span><span class="n">xsecNLO</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
  <span class="kt">double</span> <span class="n">k0</span>    <span class="o">=</span> <span class="mf">1.</span><span class="p">;</span>
  <span class="kt">double</span> <span class="n">k1</span>    <span class="o">=</span> <span class="mf">1.</span><span class="p">;</span>
  <span class="kt">double</span> <span class="n">k2</span>    <span class="o">=</span> <span class="mf">1.</span><span class="p">;</span>
  <span class="c1">// Lowest order k-factor only</span>
  <span class="k">if</span> <span class="p">(</span> <span class="nb">false</span> <span class="p">)</span> <span class="n">k1</span> <span class="o">=</span> <span class="n">k2</span> <span class="o">=</span> <span class="n">k0</span> <span class="o">=</span> <span class="n">xsecNLO</span><span class="p">.</span><span class="n">back</span><span class="p">()</span> <span class="o">/</span> <span class="n">xsecLO</span><span class="p">.</span><span class="n">back</span><span class="p">();</span>
  <span class="c1">// No k-factors</span>
  <span class="k">if</span> <span class="p">(</span> <span class="nb">true</span> <span class="p">)</span> <span class="n">k0</span> <span class="o">=</span> <span class="n">k1</span> <span class="o">=</span> <span class="n">k2</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; K-Factors :&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;k0 = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">k0</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;k1 = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">k1</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;k2 = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">k2</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="c1">// Switch off cross section estimation.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;Merging:doXSectionEstimate&quot;</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span>
  <span class="c1">// Switch showering and multiple interaction back on.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;PartonLevel:FSR&quot;</span><span class="p">,</span><span class="n">fsr</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;PartonLevel:ISR&quot;</span><span class="p">,</span><span class="n">isr</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;HadronLevel:all&quot;</span><span class="p">,</span><span class="n">had</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;PartonLevel:MPI&quot;</span><span class="p">,</span><span class="n">mpi</span><span class="p">);</span>
<span class="c1">//-----------------------------------------------------------------------------</span>
<span class="c1">//-----------------------------------------------------------------------------</span>
  <span class="c1">// Declare sample cross section for output.</span>
  <span class="kt">double</span> <span class="n">sigmaTemp</span>  <span class="o">=</span> <span class="mf">0.</span><span class="p">;</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">sampleXStree</span><span class="p">;</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">sampleXSvirt</span><span class="p">;</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">sampleXSsubtTree</span><span class="p">;</span>
  <span class="c1">// Cross section an error.</span>
  <span class="kt">double</span> <span class="n">sigmaTotal</span>  <span class="o">=</span> <span class="mf">0.</span><span class="p">;</span>
  <span class="kt">double</span> <span class="n">errorTotal</span>  <span class="o">=</span> <span class="mf">0.</span><span class="p">;</span>
  <span class="c1">// Switch on tree-level processing.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;Merging:doNL3Tree&quot;</span><span class="p">,</span><span class="nb">true</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;Merging:doNL3Loop&quot;</span><span class="p">,</span><span class="nb">false</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;Merging:doNL3Subt&quot;</span><span class="p">,</span><span class="nb">false</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Merging:nRecluster&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Merging:nRequested&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
  <span class="n">njetcounterLO</span> <span class="o">=</span> <span class="n">nMaxLO</span><span class="p">;</span>
  <span class="n">iPathTree</span>     <span class="o">=</span> <span class="n">iPath</span> <span class="o">+</span> <span class="s">&quot;_tree&quot;</span><span class="p">;</span>
  <span class="k">while</span><span class="p">(</span><span class="n">njetcounterLO</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">){</span>
    <span class="c1">// Set k factors</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">parm</span><span class="p">(</span><span class="s">&quot;Merging:kFactor0j&quot;</span><span class="p">,</span> <span class="n">k0</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">parm</span><span class="p">(</span><span class="s">&quot;Merging:kFactor1j&quot;</span><span class="p">,</span> <span class="n">k1</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">parm</span><span class="p">(</span><span class="s">&quot;Merging:kFactor2j&quot;</span><span class="p">,</span> <span class="n">k2</span><span class="p">);</span>
    <span class="c1">// From njetcounter, choose LHE file</span>
    <span class="n">stringstream</span> <span class="n">in</span><span class="p">;</span>
    <span class="n">in</span>   <span class="o">&lt;&lt;</span> <span class="s">&quot;_&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">njetcounterLO</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;.lhe&quot;</span><span class="p">;</span>
<span class="cp">#ifdef GZIPSUPPORT</span>
    <span class="k">if</span><span class="p">(</span><span class="n">access</span><span class="p">(</span> <span class="p">(</span><span class="n">iPathTree</span><span class="o">+</span><span class="n">in</span><span class="p">.</span><span class="n">str</span><span class="p">()</span><span class="o">+</span><span class="s">&quot;.gz&quot;</span><span class="p">).</span><span class="n">c_str</span><span class="p">(),</span> <span class="n">F_OK</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="n">in</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;.gz&quot;</span><span class="p">;</span>
<span class="cp">#endif</span>
    <span class="n">string</span> <span class="n">LHEfile</span> <span class="o">=</span> <span class="n">iPathTree</span> <span class="o">+</span> <span class="n">in</span><span class="p">.</span><span class="n">str</span><span class="p">();</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot;Start tree level treatment for &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">njetcounterLO</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; jets&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Merging:nRequested&quot;</span><span class="p">,</span> <span class="n">njetcounterLO</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Beams:frameType&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">word</span><span class="p">(</span><span class="s">&quot;Beams:LHEF&quot;</span><span class="p">,</span> <span class="n">LHEfile</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
    <span class="c1">// Remember position in vector of cross section estimates.</span>
    <span class="kt">int</span> <span class="n">iNow</span> <span class="o">=</span> <span class="n">sizeLO</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">njetcounterLO</span><span class="p">;</span>
    <span class="c1">// Start generation loop</span>
    <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">iEvent</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">iEvent</span><span class="o">&lt;</span><span class="n">nEvent</span><span class="p">;</span> <span class="o">++</span><span class="n">iEvent</span> <span class="p">){</span>
      <span class="c1">// Generate next event</span>
      <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">atEndOfFile</span><span class="p">()</span> <span class="p">)</span> <span class="k">break</span><span class="p">;</span>
        <span class="k">else</span> <span class="k">continue</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="c1">// Get event weight(s).</span>
      <span class="kt">double</span> <span class="n">weightNLO</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">mergingWeightNLO</span><span class="p">();</span>
      <span class="kt">double</span> <span class="n">evtweight</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">weight</span><span class="p">();</span>
      <span class="n">weightNLO</span> <span class="o">*=</span> <span class="n">evtweight</span><span class="p">;</span>
      <span class="c1">// Do not print zero-weight events.</span>
      <span class="k">if</span> <span class="p">(</span> <span class="n">weightNLO</span> <span class="o">==</span> <span class="mf">0.</span> <span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
      <span class="c1">// Construct new empty HepMC event.</span>
      <span class="n">HepMC</span><span class="o">::</span><span class="n">GenEvent</span><span class="o">*</span> <span class="n">hepmcevt</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HepMC</span><span class="o">::</span><span class="n">GenEvent</span><span class="p">();</span>
      <span class="c1">// Get correct cross section from previous estimate.</span>
      <span class="kt">double</span> <span class="n">normhepmc</span> <span class="o">=</span> <span class="n">xsecLO</span><span class="p">[</span><span class="n">iNow</span><span class="p">]</span> <span class="o">/</span> <span class="n">nAcceptLO</span><span class="p">[</span><span class="n">iNow</span><span class="p">];</span>
      <span class="c1">// powheg box weighted events</span>
      <span class="k">if</span><span class="p">(</span> <span class="n">abs</span><span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">lhaStrategy</span><span class="p">())</span> <span class="o">==</span> <span class="mi">4</span> <span class="p">)</span>
        <span class="n">normhepmc</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1e9</span><span class="o">*</span><span class="n">nSelectedLO</span><span class="p">[</span><span class="n">iNow</span><span class="p">]);</span>
      <span class="c1">// Set event weight.</span>
      <span class="n">hepmcevt</span><span class="o">-&gt;</span><span class="n">weights</span><span class="p">().</span><span class="n">push_back</span><span class="p">(</span><span class="n">weightNLO</span><span class="o">*</span><span class="n">normhepmc</span><span class="p">);</span>
      <span class="c1">// Fill HepMC event.</span>
      <span class="n">ToHepMC</span><span class="p">.</span><span class="n">fill_next_event</span><span class="p">(</span> <span class="n">pythia</span><span class="p">,</span> <span class="n">hepmcevt</span> <span class="p">);</span>
      <span class="c1">// Add the weight of the current event to the cross section.</span>
      <span class="n">sigmaTotal</span> <span class="o">+=</span> <span class="n">weightNLO</span><span class="o">*</span><span class="n">normhepmc</span><span class="p">;</span>
      <span class="n">sigmaTemp</span>  <span class="o">+=</span> <span class="n">weightNLO</span><span class="o">*</span><span class="n">normhepmc</span><span class="p">;</span>
      <span class="n">errorTotal</span> <span class="o">+=</span> <span class="n">pow2</span><span class="p">(</span><span class="n">weightNLO</span><span class="o">*</span><span class="n">normhepmc</span><span class="p">);</span>
      <span class="c1">// Report cross section to hepmc</span>
      <span class="n">HepMC</span><span class="o">::</span><span class="n">GenCrossSection</span> <span class="n">xsec</span><span class="p">;</span>
      <span class="n">xsec</span><span class="p">.</span><span class="n">set_cross_section</span><span class="p">(</span> <span class="n">sigmaTotal</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">sigmaErr</span><span class="p">()</span><span class="o">*</span><span class="mf">1e9</span> <span class="p">);</span>
      <span class="n">hepmcevt</span><span class="o">-&gt;</span><span class="n">set_cross_section</span><span class="p">(</span> <span class="n">xsec</span> <span class="p">);</span>
      <span class="c1">// Write the HepMC event to file. Done with it.</span>
      <span class="n">ascii_io</span> <span class="o">&lt;&lt;</span> <span class="n">hepmcevt</span><span class="p">;</span>
      <span class="k">delete</span> <span class="n">hepmcevt</span><span class="p">;</span>
    <span class="p">}</span> <span class="c1">// end loop over events to generate</span>
    <span class="c1">// print cross section, errors</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
    <span class="c1">// Save sample cross section for output.</span>
    <span class="n">sampleXStree</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">sigmaTemp</span><span class="p">);</span>
    <span class="n">sigmaTemp</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">;</span>
    <span class="c1">// Restart with ME of a reduced the number of jets</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">njetcounterLO</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span>
      <span class="n">njetcounterLO</span><span class="o">--</span><span class="p">;</span>
    <span class="k">else</span>
      <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
<span class="c1">//-----------------------------------------------------------------------------</span>
<span class="c1">//-----------------------------------------------------------------------------</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Start nl3 virtual corrections part&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="c1">// Switch on loop-level processing.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;Merging:doNL3Tree&quot;</span><span class="p">,</span><span class="nb">false</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;Merging:doNL3Loop&quot;</span><span class="p">,</span><span class="nb">true</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;Merging:doNL3Subt&quot;</span><span class="p">,</span><span class="nb">false</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Merging:nRecluster&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
  <span class="n">njetcounterNLO</span> <span class="o">=</span> <span class="n">nMaxNLO</span><span class="p">;</span>
  <span class="n">iPathLoop</span>      <span class="o">=</span> <span class="n">iPath</span> <span class="o">+</span> <span class="s">&quot;_powheg&quot;</span><span class="p">;</span>
  <span class="k">while</span><span class="p">(</span><span class="n">njetcounterNLO</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">){</span>
    <span class="c1">// From njetcounter, choose LHE file</span>
    <span class="n">stringstream</span> <span class="n">in</span><span class="p">;</span>
    <span class="n">in</span>   <span class="o">&lt;&lt;</span> <span class="s">&quot;_&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">njetcounterNLO</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;.lhe&quot;</span><span class="p">;</span>
<span class="cp">#ifdef GZIPSUPPORT</span>
    <span class="k">if</span><span class="p">(</span><span class="n">access</span><span class="p">(</span> <span class="p">(</span><span class="n">iPathLoop</span><span class="o">+</span><span class="n">in</span><span class="p">.</span><span class="n">str</span><span class="p">()</span><span class="o">+</span><span class="s">&quot;.gz&quot;</span><span class="p">).</span><span class="n">c_str</span><span class="p">(),</span> <span class="n">F_OK</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="n">in</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;.gz&quot;</span><span class="p">;</span>
<span class="cp">#endif</span>
    <span class="n">string</span> <span class="n">LHEfile</span> <span class="o">=</span> <span class="n">iPathLoop</span> <span class="o">+</span> <span class="n">in</span><span class="p">.</span><span class="n">str</span><span class="p">();</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot;Start loop level treatment for &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">njetcounterNLO</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; jets&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Merging:nRequested&quot;</span><span class="p">,</span> <span class="n">njetcounterNLO</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Beams:frameType&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">word</span><span class="p">(</span><span class="s">&quot;Beams:LHEF&quot;</span><span class="p">,</span> <span class="n">LHEfile</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
    <span class="c1">// Remember position in vector of cross section estimates.</span>
    <span class="kt">int</span> <span class="n">iNow</span> <span class="o">=</span> <span class="n">sizeNLO</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">njetcounterNLO</span><span class="p">;</span>
    <span class="c1">// Start generation loop</span>
    <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">iEvent</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">iEvent</span><span class="o">&lt;</span><span class="n">nEvent</span><span class="p">;</span> <span class="o">++</span><span class="n">iEvent</span> <span class="p">){</span>
      <span class="c1">// Generate next event</span>
      <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">atEndOfFile</span><span class="p">()</span> <span class="p">)</span> <span class="k">break</span><span class="p">;</span>
        <span class="k">else</span> <span class="k">continue</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="c1">// Get event weight(s).</span>
      <span class="kt">double</span> <span class="n">weightNLO</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">mergingWeightNLO</span><span class="p">();</span>
      <span class="kt">double</span> <span class="n">evtweight</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">weight</span><span class="p">();</span>
      <span class="n">weightNLO</span> <span class="o">*=</span> <span class="n">evtweight</span><span class="p">;</span>
      <span class="c1">// Do not print zero-weight events.</span>
      <span class="k">if</span> <span class="p">(</span> <span class="n">weightNLO</span> <span class="o">==</span> <span class="mf">0.</span> <span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
      <span class="c1">// Construct new empty HepMC event.</span>
      <span class="n">HepMC</span><span class="o">::</span><span class="n">GenEvent</span><span class="o">*</span> <span class="n">hepmcevt</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HepMC</span><span class="o">::</span><span class="n">GenEvent</span><span class="p">();</span>
      <span class="c1">// Get correct cross section from previous estimate.</span>
      <span class="kt">double</span> <span class="n">normhepmc</span> <span class="o">=</span> <span class="n">xsecNLO</span><span class="p">[</span><span class="n">iNow</span><span class="p">]</span> <span class="o">/</span> <span class="n">nAcceptNLO</span><span class="p">[</span><span class="n">iNow</span><span class="p">];</span>
      <span class="c1">// powheg box weighted events</span>
      <span class="k">if</span><span class="p">(</span> <span class="n">abs</span><span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">lhaStrategy</span><span class="p">())</span> <span class="o">==</span> <span class="mi">4</span> <span class="p">)</span>
        <span class="n">normhepmc</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1e9</span><span class="o">*</span><span class="n">nSelectedNLO</span><span class="p">[</span><span class="n">iNow</span><span class="p">]);</span>
      <span class="c1">// Set event weight.</span>
      <span class="n">hepmcevt</span><span class="o">-&gt;</span><span class="n">weights</span><span class="p">().</span><span class="n">push_back</span><span class="p">(</span><span class="n">weightNLO</span><span class="o">*</span><span class="n">normhepmc</span><span class="p">);</span>
      <span class="c1">// Fill HepMC event.</span>
      <span class="n">ToHepMC</span><span class="p">.</span><span class="n">fill_next_event</span><span class="p">(</span> <span class="n">pythia</span><span class="p">,</span> <span class="n">hepmcevt</span> <span class="p">);</span>
      <span class="c1">// Add the weight of the current event to the cross section.</span>
      <span class="n">sigmaTotal</span> <span class="o">+=</span> <span class="n">weightNLO</span><span class="o">*</span><span class="n">normhepmc</span><span class="p">;</span>
      <span class="n">sigmaTemp</span>  <span class="o">+=</span> <span class="n">weightNLO</span><span class="o">*</span><span class="n">normhepmc</span><span class="p">;</span>
      <span class="n">errorTotal</span> <span class="o">+=</span> <span class="n">pow2</span><span class="p">(</span><span class="n">weightNLO</span><span class="o">*</span><span class="n">normhepmc</span><span class="p">);</span>
      <span class="c1">// Report cross section to hepmc</span>
      <span class="n">HepMC</span><span class="o">::</span><span class="n">GenCrossSection</span> <span class="n">xsec</span><span class="p">;</span>
      <span class="n">xsec</span><span class="p">.</span><span class="n">set_cross_section</span><span class="p">(</span> <span class="n">sigmaTotal</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">sigmaErr</span><span class="p">()</span><span class="o">*</span><span class="mf">1e9</span> <span class="p">);</span>
      <span class="n">hepmcevt</span><span class="o">-&gt;</span><span class="n">set_cross_section</span><span class="p">(</span> <span class="n">xsec</span> <span class="p">);</span>
      <span class="c1">// Write the HepMC event to file. Done with it.</span>
      <span class="n">ascii_io</span> <span class="o">&lt;&lt;</span> <span class="n">hepmcevt</span><span class="p">;</span>
      <span class="k">delete</span> <span class="n">hepmcevt</span><span class="p">;</span>
    <span class="p">}</span> <span class="c1">// end loop over events to generate</span>
    <span class="c1">// print cross section, errors</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
    <span class="c1">// Save sample cross section for output.</span>
    <span class="n">sampleXSvirt</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">sigmaTemp</span><span class="p">);</span>
    <span class="n">sigmaTemp</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">;</span>
    <span class="c1">// Restart with ME of a reduced the number of jets</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">njetcounterNLO</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
      <span class="n">njetcounterNLO</span><span class="o">--</span><span class="p">;</span>
    <span class="k">else</span>
      <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
<span class="c1">//-----------------------------------------------------------------------------</span>
<span class="c1">//-----------------------------------------------------------------------------</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Shower subtractive events&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="c1">// Switch on processing of counter-events.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;Merging:doNL3Tree&quot;</span><span class="p">,</span><span class="nb">false</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;Merging:doNL3Loop&quot;</span><span class="p">,</span><span class="nb">false</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;Merging:doNL3Subt&quot;</span><span class="p">,</span><span class="nb">true</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Merging:nRecluster&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Merging:nRequested&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
  <span class="kt">int</span> <span class="n">nMaxCT</span>        <span class="o">=</span> <span class="n">nMaxNLO</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">njetcounterCT</span> <span class="o">=</span> <span class="n">nMaxCT</span><span class="p">;</span>
  <span class="n">string</span> <span class="n">iPathSubt</span>  <span class="o">=</span> <span class="n">iPath</span> <span class="o">+</span> <span class="s">&quot;_tree&quot;</span><span class="p">;</span>
  <span class="k">while</span><span class="p">(</span><span class="n">njetcounterCT</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">){</span>
    <span class="c1">// From njetcounter, choose LHE file</span>
    <span class="n">stringstream</span> <span class="n">in</span><span class="p">;</span>
    <span class="n">in</span>   <span class="o">&lt;&lt;</span> <span class="s">&quot;_&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">njetcounterCT</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;.lhe&quot;</span><span class="p">;</span>
<span class="cp">#ifdef GZIPSUPPORT</span>
    <span class="k">if</span><span class="p">(</span><span class="n">access</span><span class="p">(</span> <span class="p">(</span><span class="n">iPathSubt</span><span class="o">+</span><span class="n">in</span><span class="p">.</span><span class="n">str</span><span class="p">()</span><span class="o">+</span><span class="s">&quot;.gz&quot;</span><span class="p">).</span><span class="n">c_str</span><span class="p">(),</span> <span class="n">F_OK</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="n">in</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;.gz&quot;</span><span class="p">;</span>
<span class="cp">#endif</span>
    <span class="n">string</span> <span class="n">LHEfile</span> <span class="o">=</span> <span class="n">iPathSubt</span> <span class="o">+</span> <span class="n">in</span><span class="p">.</span><span class="n">str</span><span class="p">();</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot;Start subtractive treatment for &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">njetcounterCT</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; jets&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Merging:nRequested&quot;</span><span class="p">,</span> <span class="n">njetcounterCT</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Beams:frameType&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">word</span><span class="p">(</span><span class="s">&quot;Beams:LHEF&quot;</span><span class="p">,</span> <span class="n">LHEfile</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
    <span class="c1">// Remember position in vector of cross section estimates.</span>
    <span class="kt">int</span> <span class="n">iNow</span> <span class="o">=</span> <span class="n">sizeLO</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">njetcounterCT</span><span class="p">;</span>
    <span class="c1">// Start generation loop</span>
    <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">iEvent</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">iEvent</span><span class="o">&lt;</span><span class="n">nEvent</span><span class="p">;</span> <span class="o">++</span><span class="n">iEvent</span> <span class="p">){</span>
      <span class="c1">// Generate next event</span>
      <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">atEndOfFile</span><span class="p">()</span> <span class="p">)</span> <span class="k">break</span><span class="p">;</span>
        <span class="k">else</span> <span class="k">continue</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="c1">// Get event weight(s).</span>
      <span class="kt">double</span> <span class="n">weightNLO</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">mergingWeightNLO</span><span class="p">();</span>
      <span class="kt">double</span> <span class="n">evtweight</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">weight</span><span class="p">();</span>
      <span class="n">weightNLO</span> <span class="o">*=</span> <span class="n">evtweight</span><span class="p">;</span>
      <span class="c1">// Do not print zero-weight events.</span>
      <span class="k">if</span> <span class="p">(</span> <span class="n">weightNLO</span> <span class="o">==</span> <span class="mf">0.</span> <span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
      <span class="c1">// Construct new empty HepMC event.</span>
      <span class="n">HepMC</span><span class="o">::</span><span class="n">GenEvent</span><span class="o">*</span> <span class="n">hepmcevt</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HepMC</span><span class="o">::</span><span class="n">GenEvent</span><span class="p">();</span>
      <span class="c1">// Get correct cross section from previous estimate.</span>
      <span class="kt">double</span> <span class="n">normhepmc</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.</span><span class="o">*</span><span class="n">xsecLO</span><span class="p">[</span><span class="n">iNow</span><span class="p">]</span> <span class="o">/</span> <span class="n">nAcceptLO</span><span class="p">[</span><span class="n">iNow</span><span class="p">];</span>
      <span class="c1">// powheg box weighted events</span>
      <span class="k">if</span><span class="p">(</span> <span class="n">abs</span><span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">lhaStrategy</span><span class="p">())</span> <span class="o">==</span> <span class="mi">4</span> <span class="p">)</span>
        <span class="n">normhepmc</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1e9</span><span class="o">*</span><span class="n">nSelectedLO</span><span class="p">[</span><span class="n">iNow</span><span class="p">]);</span>
      <span class="c1">// Set event weight.</span>
      <span class="n">hepmcevt</span><span class="o">-&gt;</span><span class="n">weights</span><span class="p">().</span><span class="n">push_back</span><span class="p">(</span> <span class="n">weightNLO</span><span class="o">*</span><span class="n">normhepmc</span><span class="p">);</span>
      <span class="c1">// Fill HepMC event.</span>
      <span class="n">ToHepMC</span><span class="p">.</span><span class="n">fill_next_event</span><span class="p">(</span> <span class="n">pythia</span><span class="p">,</span> <span class="n">hepmcevt</span> <span class="p">);</span>
      <span class="c1">// Add the weight of the current event to the cross section.</span>
      <span class="n">sigmaTotal</span> <span class="o">+=</span> <span class="n">weightNLO</span><span class="o">*</span><span class="n">normhepmc</span><span class="p">;</span>
      <span class="n">sigmaTemp</span>  <span class="o">+=</span> <span class="n">weightNLO</span><span class="o">*</span><span class="n">normhepmc</span><span class="p">;</span>
      <span class="n">errorTotal</span> <span class="o">+=</span> <span class="n">pow2</span><span class="p">(</span><span class="n">weightNLO</span><span class="o">*</span><span class="n">normhepmc</span><span class="p">);</span>
      <span class="c1">// Report cross section to hepmc</span>
      <span class="n">HepMC</span><span class="o">::</span><span class="n">GenCrossSection</span> <span class="n">xsec</span><span class="p">;</span>
      <span class="n">xsec</span><span class="p">.</span><span class="n">set_cross_section</span><span class="p">(</span> <span class="n">sigmaTotal</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">sigmaErr</span><span class="p">()</span><span class="o">*</span><span class="mf">1e9</span> <span class="p">);</span>
      <span class="n">hepmcevt</span><span class="o">-&gt;</span><span class="n">set_cross_section</span><span class="p">(</span> <span class="n">xsec</span> <span class="p">);</span>
      <span class="c1">// Write the HepMC event to file. Done with it.</span>
      <span class="n">ascii_io</span> <span class="o">&lt;&lt;</span> <span class="n">hepmcevt</span><span class="p">;</span>
      <span class="k">delete</span> <span class="n">hepmcevt</span><span class="p">;</span>
    <span class="p">}</span> <span class="c1">// end loop over events to generate</span>
    <span class="c1">// print cross section, errors</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
    <span class="c1">// Save sample cross section for output.</span>
    <span class="n">sampleXSsubtTree</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">sigmaTemp</span><span class="p">);</span>
    <span class="n">sigmaTemp</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">;</span>
    <span class="c1">// Restart with ME of a reduced the number of jets</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">njetcounterCT</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="p">)</span>
      <span class="n">njetcounterCT</span><span class="o">--</span><span class="p">;</span>
    <span class="k">else</span>
      <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// Print cross section information.</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; *---------------------------------------------------*&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; |                                                   |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; | Sample cross sections after NL3 merging           |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; |                                                   |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; | Leading order cross sections (mb):                |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="kt">int</span><span class="p">(</span><span class="n">sampleXStree</span><span class="p">.</span><span class="n">size</span><span class="p">());</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; |     &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">sampleXStree</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;-jet:  &quot;</span>
         <span class="o">&lt;&lt;</span> <span class="n">setw</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">scientific</span> <span class="o">&lt;&lt;</span> <span class="n">setprecision</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
         <span class="o">&lt;&lt;</span> <span class="n">sampleXStree</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;                     |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; |                                                   |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; | NLO order cross sections (mb):                    |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="kt">int</span><span class="p">(</span><span class="n">sampleXSvirt</span><span class="p">.</span><span class="n">size</span><span class="p">());</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; |     &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">sampleXSvirt</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;-jet:  &quot;</span>
         <span class="o">&lt;&lt;</span> <span class="n">setw</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">scientific</span> <span class="o">&lt;&lt;</span> <span class="n">setprecision</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
         <span class="o">&lt;&lt;</span> <span class="n">sampleXSvirt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;                     |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; |                                                   |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; | Leading-order subtractive cross sections (mb):    |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="kt">int</span><span class="p">(</span><span class="n">sampleXSsubtTree</span><span class="p">.</span><span class="n">size</span><span class="p">());</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; |     &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">sampleXSsubtTree</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;-jet:  &quot;</span>
         <span class="o">&lt;&lt;</span> <span class="n">setw</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">scientific</span> <span class="o">&lt;&lt;</span> <span class="n">setprecision</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
         <span class="o">&lt;&lt;</span> <span class="n">sampleXSsubtTree</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;                     |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; |                                                   |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; |---------------------------------------------------|&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; |---------------------------------------------------|&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; | Inclusive cross sections:                         |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; |                                                   |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; | NL3 merged inclusive cross section:               |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; |    &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">setw</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">scientific</span> <span class="o">&lt;&lt;</span> <span class="n">setprecision</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
       <span class="o">&lt;&lt;</span> <span class="n">sigmaTotal</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;  +-  &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">setw</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">errorTotal</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; mb &quot;</span>
       <span class="o">&lt;&lt;</span> <span class="s">&quot;   |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; |                                                   |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; | NLO inclusive cross section:                      |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; |    &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">setw</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">scientific</span> <span class="o">&lt;&lt;</span> <span class="n">setprecision</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
       <span class="o">&lt;&lt;</span> <span class="n">xsecNLO</span><span class="p">.</span><span class="n">back</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; mb                           |&quot;</span>  <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; |                                                   |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; | LO inclusive cross section:                       |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; |    &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">setw</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">scientific</span> <span class="o">&lt;&lt;</span> <span class="n">setprecision</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
       <span class="o">&lt;&lt;</span> <span class="n">xsecLO</span><span class="p">.</span><span class="n">back</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; mb                           |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; |                                                   |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; *---------------------------------------------------*&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="c1">// Done</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
    </div>
  </div>
</div>

</div> <div class="well well-sm"> <h1 id="main88cc">main88.cc</h1><hr>
<div class="codehilite"><pre><span class="c1">// main88.cc is a part of the PYTHIA event generator.</span>
<span class="c1">// Copyright (C) 2016 Torbjorn Sjostrand.</span>
<span class="c1">// PYTHIA is licenced under the GNU GPL version 2, see COPYING for details.</span>
<span class="c1">// Please respect the MCnet Guidelines, see GUIDELINES for details.</span>
<span class="c1">// This program is written by Stefan Prestel.</span>
<span class="c1">// It illustrates how to do UNLOPS merging, see the Matrix Element</span>
<span class="c1">// Merging page in the online manual. An example command is</span>
<span class="c1">//     ./main88 main88.cmnd w_production hepmcout88.dat</span>
<span class="c1">// where main88.cmnd supplies the commands, w_production provides the</span>
<span class="c1">// input LHE events, and hepmcout88.dat is the output file. This</span>
<span class="c1">// example requires HepMC.</span>
</pre></div>


<div class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" href="#fileid60">Rest of the main88.cc code</a>
    </h4>
  </div>
  <div id="fileid60" class="panel-collapse collapse">
    <div class="panel-body">
<div class="codehilite"><pre><span class="cp">#include</span> <span class="cpf">&quot;Pythia8/Pythia.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;Pythia8Plugins/HepMC2.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">Pythia8</span><span class="p">;</span>
<span class="c1">//==========================================================================</span>
<span class="c1">// Example main programm to illustrate UNLOPS merging</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span> <span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[]</span> <span class="p">){</span>
  <span class="c1">// Check that correct number of command-line arguments</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; Unexpected number of command-line arguments (&quot;</span><span class="o">&lt;&lt;</span><span class="n">argc</span><span class="o">&lt;&lt;</span><span class="s">&quot;). </span><span class="se">\n</span><span class="s">&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; You are expected to provide the arguments&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; 1. Input file for settings&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; 2. Name of the input LHE file (with path), up to the &#39;_tree&#39;&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; or &#39;_powheg&#39; identifiers&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; 3. Output hepmc file name&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; Program stopped. &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">Pythia</span> <span class="n">pythia</span><span class="p">;</span>
  <span class="c1">// Input parameters:</span>
  <span class="c1">//  1. Input file for settings</span>
  <span class="c1">//  2. Path to input LHE file</span>
  <span class="c1">//  3. Output histogram path</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readFile</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
  <span class="c1">// Interface for conversion from Pythia8::Event to HepMC one.</span>
  <span class="n">HepMC</span><span class="o">::</span><span class="n">Pythia8ToHepMC</span> <span class="n">ToHepMC</span><span class="p">;</span>
  <span class="c1">// Specify file where HepMC events will be stored.</span>
  <span class="n">HepMC</span><span class="o">::</span><span class="n">IO_GenEvent</span> <span class="n">ascii_io</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">std</span><span class="o">::</span><span class="n">ios</span><span class="o">::</span><span class="n">out</span><span class="p">);</span>
  <span class="c1">// Switch off warnings for parton-level events.</span>
  <span class="n">ToHepMC</span><span class="p">.</span><span class="n">set_print_inconsistency</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
  <span class="n">ToHepMC</span><span class="p">.</span><span class="n">set_free_parton_warnings</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
  <span class="c1">// Do not store cross section information, as this will be done manually.</span>
  <span class="n">ToHepMC</span><span class="p">.</span><span class="n">set_store_pdf</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
  <span class="n">ToHepMC</span><span class="p">.</span><span class="n">set_store_proc</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
  <span class="n">ToHepMC</span><span class="p">.</span><span class="n">set_store_xsec</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
  <span class="c1">// Path to input events, with name up to the &quot;_tree&quot;, &quot;_powheg&quot; identifier</span>
  <span class="c1">// included.</span>
  <span class="n">string</span> <span class="n">iPath</span> <span class="o">=</span> <span class="n">string</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
  <span class="c1">// Number of events</span>
  <span class="kt">int</span> <span class="n">nEvent</span>   <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Main:numberOfEvents&quot;</span><span class="p">);</span>
  <span class="c1">// Maximal number of additional LO jets.</span>
  <span class="kt">int</span> <span class="n">nMaxLO</span>   <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Merging:nJetMax&quot;</span><span class="p">);</span>
  <span class="c1">// maximal number of additional NLO jets.</span>
  <span class="kt">int</span> <span class="n">nMaxNLO</span>  <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Merging:nJetMaxNLO&quot;</span><span class="p">);</span>
<span class="c1">//----------------------------------------------------------------------------</span>
<span class="c1">//----------------------------------------------------------------------------</span>
  <span class="c1">// Switch off all showering and MPI when extimating the cross section after</span>
  <span class="c1">// the merging scale cut.</span>
  <span class="kt">bool</span> <span class="n">fsr</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;PartonLevel:FSR&quot;</span><span class="p">);</span>
  <span class="kt">bool</span> <span class="n">isr</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;PartonLevel:ISR&quot;</span><span class="p">);</span>
  <span class="kt">bool</span> <span class="n">mpi</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;PartonLevel:MPI&quot;</span><span class="p">);</span>
  <span class="kt">bool</span> <span class="n">had</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;HadronLevel:all&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;PartonLevel:FSR&quot;</span><span class="p">,</span><span class="nb">false</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;PartonLevel:ISR&quot;</span><span class="p">,</span><span class="nb">false</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;HadronLevel:all&quot;</span><span class="p">,</span><span class="nb">false</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;PartonLevel:MPI&quot;</span><span class="p">,</span><span class="nb">false</span><span class="p">);</span>
  <span class="c1">// Switch on cross section estimation procedure.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;Merging:doXSectionEstimate&quot;</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;Merging:doUNLOPSTree&quot;</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
  <span class="kt">int</span> <span class="n">njetcounterLO</span>  <span class="o">=</span> <span class="n">nMaxLO</span><span class="p">;</span>
  <span class="n">string</span> <span class="n">iPathTree</span>   <span class="o">=</span> <span class="n">iPath</span> <span class="o">+</span> <span class="s">&quot;_tree&quot;</span><span class="p">;</span>
  <span class="c1">// Save estimates in vectors.</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">xsecLO</span><span class="p">;</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">nSelectedLO</span><span class="p">;</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">nAcceptLO</span><span class="p">;</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">strategyLO</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Start estimating unlops tree level cross section&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="k">while</span><span class="p">(</span><span class="n">njetcounterLO</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">){</span>
    <span class="c1">// From njetcounter, choose LHE file</span>
    <span class="n">stringstream</span> <span class="n">in</span><span class="p">;</span>
    <span class="n">in</span>   <span class="o">&lt;&lt;</span> <span class="s">&quot;_&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">njetcounterLO</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;.lhe&quot;</span><span class="p">;</span>
<span class="cp">#ifdef GZIPSUPPORT</span>
    <span class="k">if</span><span class="p">(</span><span class="n">access</span><span class="p">(</span> <span class="p">(</span><span class="n">iPathTree</span><span class="o">+</span><span class="n">in</span><span class="p">.</span><span class="n">str</span><span class="p">()</span><span class="o">+</span><span class="s">&quot;.gz&quot;</span><span class="p">).</span><span class="n">c_str</span><span class="p">(),</span> <span class="n">F_OK</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="n">in</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;.gz&quot;</span><span class="p">;</span>
<span class="cp">#endif</span>
    <span class="n">string</span> <span class="n">LHEfile</span> <span class="o">=</span> <span class="n">iPathTree</span> <span class="o">+</span> <span class="n">in</span><span class="p">.</span><span class="n">str</span><span class="p">();</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Merging:nRequested&quot;</span><span class="p">,</span> <span class="n">njetcounterLO</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Beams:frameType&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">word</span><span class="p">(</span><span class="s">&quot;Beams:LHEF&quot;</span><span class="p">,</span> <span class="n">LHEfile</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
    <span class="c1">// Start generation loop</span>
    <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">iEvent</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">iEvent</span><span class="o">&lt;</span><span class="n">nEvent</span><span class="p">;</span> <span class="o">++</span><span class="n">iEvent</span> <span class="p">){</span>
      <span class="c1">// Generate next event</span>
      <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">atEndOfFile</span><span class="p">()</span> <span class="p">){</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">continue</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="c1">// end loop over events to generate</span>
    <span class="c1">// print cross section, errors</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
    <span class="n">xsecLO</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">sigmaGen</span><span class="p">());</span>
    <span class="n">nSelectedLO</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">nSelected</span><span class="p">());</span>
    <span class="n">nAcceptLO</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">nAccepted</span><span class="p">());</span>
    <span class="n">strategyLO</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">lhaStrategy</span><span class="p">());</span>
    <span class="c1">// Restart with ME of a reduced the number of jets</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">njetcounterLO</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span>
      <span class="n">njetcounterLO</span><span class="o">--</span><span class="p">;</span>
    <span class="k">else</span>
      <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
<span class="c1">//-----------------------------------------------------------------------------</span>
<span class="c1">//-----------------------------------------------------------------------------</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Start estimating unlops virtual corrections cross section&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;Merging:doUNLOPSTree&quot;</span><span class="p">,</span><span class="nb">false</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;Merging:doUNLOPSLoop&quot;</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
  <span class="kt">int</span> <span class="n">njetcounterNLO</span>  <span class="o">=</span> <span class="n">nMaxNLO</span><span class="p">;</span>
  <span class="n">string</span> <span class="n">iPathLoop</span>    <span class="o">=</span> <span class="n">iPath</span> <span class="o">+</span> <span class="s">&quot;_powheg&quot;</span><span class="p">;</span>
  <span class="c1">// Save estimates in vectors.</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">xsecNLO</span><span class="p">;</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">nSelectedNLO</span><span class="p">;</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">nAcceptNLO</span><span class="p">;</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">strategyNLO</span><span class="p">;</span>
  <span class="k">while</span><span class="p">(</span><span class="n">njetcounterNLO</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">){</span>
    <span class="c1">// From njetcounter, choose LHE file</span>
    <span class="n">stringstream</span> <span class="n">in</span><span class="p">;</span>
    <span class="n">in</span>   <span class="o">&lt;&lt;</span> <span class="s">&quot;_&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">njetcounterNLO</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;.lhe&quot;</span><span class="p">;</span>
<span class="cp">#ifdef GZIPSUPPORT</span>
    <span class="k">if</span><span class="p">(</span><span class="n">access</span><span class="p">(</span> <span class="p">(</span><span class="n">iPathLoop</span><span class="o">+</span><span class="n">in</span><span class="p">.</span><span class="n">str</span><span class="p">()</span><span class="o">+</span><span class="s">&quot;.gz&quot;</span><span class="p">).</span><span class="n">c_str</span><span class="p">(),</span> <span class="n">F_OK</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="n">in</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;.gz&quot;</span><span class="p">;</span>
<span class="cp">#endif</span>
    <span class="n">string</span> <span class="n">LHEfile</span> <span class="o">=</span> <span class="n">iPathLoop</span> <span class="o">+</span> <span class="n">in</span><span class="p">.</span><span class="n">str</span><span class="p">();</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Merging:nRequested&quot;</span><span class="p">,</span> <span class="n">njetcounterNLO</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Beams:frameType&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">word</span><span class="p">(</span><span class="s">&quot;Beams:LHEF&quot;</span><span class="p">,</span> <span class="n">LHEfile</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
    <span class="c1">// Start generation loop</span>
    <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">iEvent</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">iEvent</span><span class="o">&lt;</span><span class="n">nEvent</span><span class="p">;</span> <span class="o">++</span><span class="n">iEvent</span> <span class="p">){</span>
      <span class="c1">// Generate next event</span>
      <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">atEndOfFile</span><span class="p">()</span> <span class="p">){</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">continue</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="c1">// end loop over events to generate</span>
    <span class="c1">// print cross section, errors</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
    <span class="n">xsecNLO</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">sigmaGen</span><span class="p">());</span>
    <span class="n">nSelectedNLO</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">nSelected</span><span class="p">());</span>
    <span class="n">nAcceptNLO</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">nAccepted</span><span class="p">());</span>
    <span class="n">strategyNLO</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">lhaStrategy</span><span class="p">());</span>
    <span class="c1">// Restart with ME of a reduced the number of jets</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">njetcounterNLO</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span>
      <span class="n">njetcounterNLO</span><span class="o">--</span><span class="p">;</span>
    <span class="k">else</span>
      <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kt">int</span> <span class="n">sizeLO</span>   <span class="o">=</span> <span class="kt">int</span><span class="p">(</span><span class="n">xsecLO</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
  <span class="kt">int</span> <span class="n">sizeNLO</span>  <span class="o">=</span> <span class="kt">int</span><span class="p">(</span><span class="n">xsecNLO</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
  <span class="c1">// Switch off cross section estimation.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;Merging:doXSectionEstimate&quot;</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span>
  <span class="c1">// Switch showering and multiple interaction back on.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;PartonLevel:FSR&quot;</span><span class="p">,</span><span class="n">fsr</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;PartonLevel:ISR&quot;</span><span class="p">,</span><span class="n">isr</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;HadronLevel:all&quot;</span><span class="p">,</span><span class="n">had</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;PartonLevel:MPI&quot;</span><span class="p">,</span><span class="n">mpi</span><span class="p">);</span>
<span class="c1">//-----------------------------------------------------------------------------</span>
<span class="c1">//-----------------------------------------------------------------------------</span>
  <span class="c1">// Declare sample cross section for output.</span>
  <span class="kt">double</span> <span class="n">sigmaTemp</span>  <span class="o">=</span> <span class="mf">0.</span><span class="p">;</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">sampleXStree</span><span class="p">;</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">sampleXSvirt</span><span class="p">;</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">sampleXSsubtTree</span><span class="p">;</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">sampleXSsubtVirt</span><span class="p">;</span>
  <span class="c1">// Cross section an error.</span>
  <span class="kt">double</span> <span class="n">sigmaTotal</span>  <span class="o">=</span> <span class="mf">0.</span><span class="p">;</span>
  <span class="kt">double</span> <span class="n">errorTotal</span>  <span class="o">=</span> <span class="mf">0.</span><span class="p">;</span>
  <span class="c1">// Switch on tree-level processing.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;Merging:doUNLOPSTree&quot;</span><span class="p">,</span><span class="nb">true</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;Merging:doUNLOPSLoop&quot;</span><span class="p">,</span><span class="nb">false</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;Merging:doUNLOPSSubt&quot;</span><span class="p">,</span><span class="nb">false</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;Merging:doUNLOPSSubtNLO&quot;</span><span class="p">,</span><span class="nb">false</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Merging:nRecluster&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
  <span class="c1">// Start looping through input event files.</span>
  <span class="n">njetcounterLO</span> <span class="o">=</span> <span class="n">nMaxLO</span><span class="p">;</span>
  <span class="n">iPathTree</span>     <span class="o">=</span> <span class="n">iPath</span> <span class="o">+</span> <span class="s">&quot;_tree&quot;</span><span class="p">;</span>
  <span class="k">while</span><span class="p">(</span><span class="n">njetcounterLO</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">){</span>
    <span class="c1">// From njetcounter, choose LHE file</span>
    <span class="n">stringstream</span> <span class="n">in</span><span class="p">;</span>
    <span class="n">in</span>   <span class="o">&lt;&lt;</span> <span class="s">&quot;_&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">njetcounterLO</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;.lhe&quot;</span><span class="p">;</span>
<span class="cp">#ifdef GZIPSUPPORT</span>
    <span class="k">if</span><span class="p">(</span><span class="n">access</span><span class="p">(</span> <span class="p">(</span><span class="n">iPathTree</span><span class="o">+</span><span class="n">in</span><span class="p">.</span><span class="n">str</span><span class="p">()</span><span class="o">+</span><span class="s">&quot;.gz&quot;</span><span class="p">).</span><span class="n">c_str</span><span class="p">(),</span> <span class="n">F_OK</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="n">in</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;.gz&quot;</span><span class="p">;</span>
<span class="cp">#endif</span>
    <span class="n">string</span> <span class="n">LHEfile</span> <span class="o">=</span> <span class="n">iPathTree</span> <span class="o">+</span> <span class="n">in</span><span class="p">.</span><span class="n">str</span><span class="p">();</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot;Start tree level treatment for &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">njetcounterLO</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; jets&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="c1">// UNLOPS does not contain a zero-jet tree-level sample.</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">njetcounterLO</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="k">break</span><span class="p">;</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Merging:nRequested&quot;</span><span class="p">,</span> <span class="n">njetcounterLO</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Beams:frameType&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">word</span><span class="p">(</span><span class="s">&quot;Beams:LHEF&quot;</span><span class="p">,</span> <span class="n">LHEfile</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
    <span class="c1">// Remember position in vector of cross section estimates.</span>
    <span class="kt">int</span> <span class="n">iNow</span> <span class="o">=</span> <span class="n">sizeLO</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">njetcounterLO</span><span class="p">;</span>
    <span class="c1">// Start generation loop</span>
    <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">iEvent</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">iEvent</span><span class="o">&lt;</span><span class="n">nEvent</span><span class="p">;</span> <span class="o">++</span><span class="n">iEvent</span> <span class="p">){</span>
      <span class="c1">// Generate next event</span>
      <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">atEndOfFile</span><span class="p">()</span> <span class="p">)</span> <span class="k">break</span><span class="p">;</span>
        <span class="k">else</span> <span class="k">continue</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="c1">// Get event weight(s).</span>
      <span class="kt">double</span> <span class="n">weightNLO</span>  <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">mergingWeightNLO</span><span class="p">();</span>
      <span class="kt">double</span> <span class="n">evtweight</span>  <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">weight</span><span class="p">();</span>
      <span class="n">weightNLO</span>        <span class="o">*=</span> <span class="n">evtweight</span><span class="p">;</span>
      <span class="c1">// Do not print zero-weight events.</span>
      <span class="k">if</span> <span class="p">(</span> <span class="n">weightNLO</span> <span class="o">==</span> <span class="mf">0.</span> <span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
      <span class="c1">// Construct new empty HepMC event.</span>
      <span class="n">HepMC</span><span class="o">::</span><span class="n">GenEvent</span><span class="o">*</span> <span class="n">hepmcevt</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HepMC</span><span class="o">::</span><span class="n">GenEvent</span><span class="p">();</span>
      <span class="c1">// Get correct cross section from previous estimate.</span>
      <span class="kt">double</span> <span class="n">normhepmc</span> <span class="o">=</span> <span class="n">xsecLO</span><span class="p">[</span><span class="n">iNow</span><span class="p">]</span> <span class="o">/</span> <span class="n">nAcceptLO</span><span class="p">[</span><span class="n">iNow</span><span class="p">];</span>
      <span class="c1">// Set hepmc event weight.</span>
      <span class="n">hepmcevt</span><span class="o">-&gt;</span><span class="n">weights</span><span class="p">().</span><span class="n">push_back</span><span class="p">(</span><span class="n">weightNLO</span><span class="o">*</span><span class="n">normhepmc</span><span class="p">);</span>
      <span class="c1">// Fill HepMC event.</span>
      <span class="n">ToHepMC</span><span class="p">.</span><span class="n">fill_next_event</span><span class="p">(</span> <span class="n">pythia</span><span class="p">,</span> <span class="n">hepmcevt</span> <span class="p">);</span>
      <span class="c1">// Add the weight of the current event to the cross section.</span>
      <span class="n">sigmaTotal</span> <span class="o">+=</span> <span class="n">weightNLO</span><span class="o">*</span><span class="n">normhepmc</span><span class="p">;</span>
      <span class="n">sigmaTemp</span>  <span class="o">+=</span> <span class="n">weightNLO</span><span class="o">*</span><span class="n">normhepmc</span><span class="p">;</span>
      <span class="n">errorTotal</span> <span class="o">+=</span> <span class="n">pow2</span><span class="p">(</span><span class="n">weightNLO</span><span class="o">*</span><span class="n">normhepmc</span><span class="p">);</span>
      <span class="c1">// Report cross section to hepmc.</span>
      <span class="n">HepMC</span><span class="o">::</span><span class="n">GenCrossSection</span> <span class="n">xsec</span><span class="p">;</span>
      <span class="n">xsec</span><span class="p">.</span><span class="n">set_cross_section</span><span class="p">(</span> <span class="n">sigmaTotal</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">sigmaErr</span><span class="p">()</span><span class="o">*</span><span class="mf">1e9</span> <span class="p">);</span>
      <span class="n">hepmcevt</span><span class="o">-&gt;</span><span class="n">set_cross_section</span><span class="p">(</span> <span class="n">xsec</span> <span class="p">);</span>
      <span class="c1">// Write the HepMC event to file. Done with it.</span>
      <span class="n">ascii_io</span> <span class="o">&lt;&lt;</span> <span class="n">hepmcevt</span><span class="p">;</span>
      <span class="k">delete</span> <span class="n">hepmcevt</span><span class="p">;</span>
    <span class="p">}</span> <span class="c1">// end loop over events to generate</span>
    <span class="c1">// print cross section, errors</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
    <span class="c1">// Restart with ME of a reduced the number of jets</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">njetcounterLO</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span>
      <span class="n">njetcounterLO</span><span class="o">--</span><span class="p">;</span>
    <span class="k">else</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="c1">// Save sample cross section for output.</span>
    <span class="n">sampleXStree</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">sigmaTemp</span><span class="p">);</span>
    <span class="n">sigmaTemp</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">;</span>
  <span class="p">}</span>
<span class="c1">//-----------------------------------------------------------------------------</span>
<span class="c1">//-----------------------------------------------------------------------------</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Start unlops virtual corrections part&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="c1">// Switch on loop-level processing.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;Merging:doUNLOPSTree&quot;</span><span class="p">,</span><span class="nb">false</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;Merging:doUNLOPSLoop&quot;</span><span class="p">,</span><span class="nb">true</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;Merging:doUNLOPSSubt&quot;</span><span class="p">,</span><span class="nb">false</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;Merging:doUNLOPSSubtNLO&quot;</span><span class="p">,</span><span class="nb">false</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Merging:nRecluster&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
  <span class="n">njetcounterNLO</span> <span class="o">=</span> <span class="n">nMaxNLO</span><span class="p">;</span>
  <span class="n">iPathLoop</span><span class="o">=</span> <span class="n">iPath</span> <span class="o">+</span> <span class="s">&quot;_powheg&quot;</span><span class="p">;</span>
  <span class="k">while</span><span class="p">(</span><span class="n">njetcounterNLO</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">){</span>
    <span class="c1">// From njetcounter, choose LHE file</span>
    <span class="n">stringstream</span> <span class="n">in</span><span class="p">;</span>
    <span class="n">in</span>   <span class="o">&lt;&lt;</span> <span class="s">&quot;_&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">njetcounterNLO</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;.lhe&quot;</span><span class="p">;</span>
<span class="cp">#ifdef GZIPSUPPORT</span>
    <span class="k">if</span><span class="p">(</span><span class="n">access</span><span class="p">(</span> <span class="p">(</span><span class="n">iPathLoop</span><span class="o">+</span><span class="n">in</span><span class="p">.</span><span class="n">str</span><span class="p">()</span><span class="o">+</span><span class="s">&quot;.gz&quot;</span><span class="p">).</span><span class="n">c_str</span><span class="p">(),</span> <span class="n">F_OK</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="n">in</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;.gz&quot;</span><span class="p">;</span>
<span class="cp">#endif</span>
    <span class="n">string</span> <span class="n">LHEfile</span> <span class="o">=</span> <span class="n">iPathLoop</span> <span class="o">+</span> <span class="n">in</span><span class="p">.</span><span class="n">str</span><span class="p">();</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot;Start loop level treatment for &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">njetcounterNLO</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; jets&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Merging:nRequested&quot;</span><span class="p">,</span> <span class="n">njetcounterNLO</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Beams:frameType&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">word</span><span class="p">(</span><span class="s">&quot;Beams:LHEF&quot;</span><span class="p">,</span> <span class="n">LHEfile</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
    <span class="c1">// Remember position in vector of cross section estimates.</span>
    <span class="kt">int</span> <span class="n">iNow</span> <span class="o">=</span> <span class="n">sizeNLO</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">njetcounterNLO</span><span class="p">;</span>
    <span class="c1">// Start generation loop</span>
    <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">iEvent</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">iEvent</span><span class="o">&lt;</span><span class="n">nEvent</span><span class="p">;</span> <span class="o">++</span><span class="n">iEvent</span> <span class="p">){</span>
      <span class="c1">// Generate next event</span>
      <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">atEndOfFile</span><span class="p">()</span> <span class="p">)</span> <span class="k">break</span><span class="p">;</span>
        <span class="k">else</span> <span class="k">continue</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="c1">// Get event weight(s).</span>
      <span class="kt">double</span> <span class="n">weightNLO</span>  <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">mergingWeightNLO</span><span class="p">();</span>
      <span class="kt">double</span> <span class="n">evtweight</span>  <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">weight</span><span class="p">();</span>
      <span class="n">weightNLO</span>        <span class="o">*=</span> <span class="n">evtweight</span><span class="p">;</span>
      <span class="c1">// Do not print zero-weight events.</span>
      <span class="k">if</span> <span class="p">(</span> <span class="n">weightNLO</span> <span class="o">==</span> <span class="mf">0.</span> <span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
      <span class="c1">// Construct new empty HepMC event.</span>
      <span class="n">HepMC</span><span class="o">::</span><span class="n">GenEvent</span><span class="o">*</span> <span class="n">hepmcevt</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HepMC</span><span class="o">::</span><span class="n">GenEvent</span><span class="p">();</span>
      <span class="c1">// Get correct cross section from previous estimate.</span>
      <span class="kt">double</span> <span class="n">normhepmc</span> <span class="o">=</span> <span class="n">xsecNLO</span><span class="p">[</span><span class="n">iNow</span><span class="p">]</span> <span class="o">/</span> <span class="n">nAcceptNLO</span><span class="p">[</span><span class="n">iNow</span><span class="p">];</span>
      <span class="c1">// powheg weighted events</span>
      <span class="k">if</span><span class="p">(</span> <span class="n">abs</span><span class="p">(</span><span class="n">strategyNLO</span><span class="p">[</span><span class="n">iNow</span><span class="p">])</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">normhepmc</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1e9</span><span class="o">*</span><span class="n">nSelectedNLO</span><span class="p">[</span><span class="n">iNow</span><span class="p">]);</span>
      <span class="c1">// Set hepmc event weight.</span>
      <span class="n">hepmcevt</span><span class="o">-&gt;</span><span class="n">weights</span><span class="p">().</span><span class="n">push_back</span><span class="p">(</span><span class="n">weightNLO</span><span class="o">*</span><span class="n">normhepmc</span><span class="p">);</span>
      <span class="c1">// Fill HepMC event.</span>
      <span class="n">ToHepMC</span><span class="p">.</span><span class="n">fill_next_event</span><span class="p">(</span> <span class="n">pythia</span><span class="p">,</span> <span class="n">hepmcevt</span> <span class="p">);</span>
      <span class="c1">// Add the weight of the current event to the cross section.</span>
      <span class="n">sigmaTotal</span> <span class="o">+=</span> <span class="n">weightNLO</span><span class="o">*</span><span class="n">normhepmc</span><span class="p">;</span>
      <span class="n">sigmaTemp</span>  <span class="o">+=</span> <span class="n">weightNLO</span><span class="o">*</span><span class="n">normhepmc</span><span class="p">;</span>
      <span class="n">errorTotal</span> <span class="o">+=</span> <span class="n">pow2</span><span class="p">(</span><span class="n">weightNLO</span><span class="o">*</span><span class="n">normhepmc</span><span class="p">);</span>
      <span class="c1">// Report cross section to hepmc</span>
      <span class="n">HepMC</span><span class="o">::</span><span class="n">GenCrossSection</span> <span class="n">xsec</span><span class="p">;</span>
      <span class="n">xsec</span><span class="p">.</span><span class="n">set_cross_section</span><span class="p">(</span> <span class="n">sigmaTotal</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">sigmaErr</span><span class="p">()</span><span class="o">*</span><span class="mf">1e9</span> <span class="p">);</span>
      <span class="n">hepmcevt</span><span class="o">-&gt;</span><span class="n">set_cross_section</span><span class="p">(</span> <span class="n">xsec</span> <span class="p">);</span>
      <span class="c1">// Write the HepMC event to file. Done with it.</span>
      <span class="n">ascii_io</span> <span class="o">&lt;&lt;</span> <span class="n">hepmcevt</span><span class="p">;</span>
      <span class="k">delete</span> <span class="n">hepmcevt</span><span class="p">;</span>
    <span class="p">}</span> <span class="c1">// end loop over events to generate</span>
    <span class="c1">// print cross section, errors</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
    <span class="c1">// Save sample cross section for output.</span>
    <span class="n">sampleXSvirt</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">sigmaTemp</span><span class="p">);</span>
    <span class="n">sigmaTemp</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">;</span>
    <span class="c1">// Restart with ME of a reduced the number of jets</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">njetcounterNLO</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
      <span class="n">njetcounterNLO</span><span class="o">--</span><span class="p">;</span>
    <span class="k">else</span>
      <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
<span class="c1">//-----------------------------------------------------------------------------</span>
<span class="c1">//-----------------------------------------------------------------------------</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Shower subtractive events&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="c1">// Switch on processing of counter-events.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;Merging:doUNLOPSTree&quot;</span><span class="p">,</span><span class="nb">false</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;Merging:doUNLOPSLoop&quot;</span><span class="p">,</span><span class="nb">false</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;Merging:doUNLOPSSubt&quot;</span><span class="p">,</span><span class="nb">true</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;Merging:doUNLOPSSubtNLO&quot;</span><span class="p">,</span><span class="nb">false</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Merging:nRecluster&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
  <span class="kt">int</span> <span class="n">nMaxCT</span> <span class="o">=</span> <span class="n">nMaxLO</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">njetcounterCT</span> <span class="o">=</span> <span class="n">nMaxCT</span><span class="p">;</span>
  <span class="n">string</span> <span class="n">iPathSubt</span><span class="o">=</span> <span class="n">iPath</span> <span class="o">+</span> <span class="s">&quot;_tree&quot;</span><span class="p">;</span>
  <span class="k">while</span><span class="p">(</span><span class="n">njetcounterCT</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">){</span>
    <span class="c1">// From njetcounter, choose LHE file</span>
    <span class="n">stringstream</span> <span class="n">in</span><span class="p">;</span>
    <span class="n">in</span>   <span class="o">&lt;&lt;</span> <span class="s">&quot;_&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">njetcounterCT</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;.lhe&quot;</span><span class="p">;</span>
<span class="cp">#ifdef GZIPSUPPORT</span>
    <span class="k">if</span><span class="p">(</span><span class="n">access</span><span class="p">(</span> <span class="p">(</span><span class="n">iPathSubt</span><span class="o">+</span><span class="n">in</span><span class="p">.</span><span class="n">str</span><span class="p">()</span><span class="o">+</span><span class="s">&quot;.gz&quot;</span><span class="p">).</span><span class="n">c_str</span><span class="p">(),</span> <span class="n">F_OK</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="n">in</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;.gz&quot;</span><span class="p">;</span>
<span class="cp">#endif</span>
    <span class="n">string</span> <span class="n">LHEfile</span> <span class="o">=</span> <span class="n">iPathSubt</span> <span class="o">+</span> <span class="n">in</span><span class="p">.</span><span class="n">str</span><span class="p">();</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot;Start subtractive treatment for &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">njetcounterCT</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; jets&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Merging:nRequested&quot;</span><span class="p">,</span> <span class="n">njetcounterCT</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Beams:frameType&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">word</span><span class="p">(</span><span class="s">&quot;Beams:LHEF&quot;</span><span class="p">,</span> <span class="n">LHEfile</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
    <span class="c1">// Remember position in vector of cross section estimates.</span>
    <span class="kt">int</span> <span class="n">iNow</span> <span class="o">=</span> <span class="n">sizeLO</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">njetcounterCT</span><span class="p">;</span>
    <span class="c1">// Start generation loop</span>
    <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">iEvent</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">iEvent</span><span class="o">&lt;</span><span class="n">nEvent</span><span class="p">;</span> <span class="o">++</span><span class="n">iEvent</span> <span class="p">){</span>
      <span class="c1">// Generate next event</span>
      <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">atEndOfFile</span><span class="p">()</span> <span class="p">)</span> <span class="k">break</span><span class="p">;</span>
        <span class="k">else</span> <span class="k">continue</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="c1">// Get event weight(s).</span>
      <span class="kt">double</span> <span class="n">weightNLO</span>  <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">mergingWeightNLO</span><span class="p">();</span>
      <span class="kt">double</span> <span class="n">evtweight</span>  <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">weight</span><span class="p">();</span>
      <span class="n">weightNLO</span>        <span class="o">*=</span> <span class="n">evtweight</span><span class="p">;</span>
      <span class="c1">// Do not print zero-weight events.</span>
      <span class="k">if</span> <span class="p">(</span> <span class="n">weightNLO</span> <span class="o">==</span> <span class="mf">0.</span> <span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
      <span class="c1">// Construct new empty HepMC event.</span>
      <span class="n">HepMC</span><span class="o">::</span><span class="n">GenEvent</span><span class="o">*</span> <span class="n">hepmcevt</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HepMC</span><span class="o">::</span><span class="n">GenEvent</span><span class="p">();</span>
      <span class="c1">// Get correct cross section from previous estimate.</span>
      <span class="kt">double</span> <span class="n">normhepmc</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">xsecLO</span><span class="p">[</span><span class="n">iNow</span><span class="p">]</span> <span class="o">/</span> <span class="n">nAcceptLO</span><span class="p">[</span><span class="n">iNow</span><span class="p">];</span>
      <span class="c1">// Set hepmc event weight.</span>
      <span class="n">hepmcevt</span><span class="o">-&gt;</span><span class="n">weights</span><span class="p">().</span><span class="n">push_back</span><span class="p">(</span><span class="n">weightNLO</span><span class="o">*</span><span class="n">normhepmc</span><span class="p">);</span>
      <span class="c1">// Fill HepMC event.</span>
      <span class="n">ToHepMC</span><span class="p">.</span><span class="n">fill_next_event</span><span class="p">(</span> <span class="n">pythia</span><span class="p">,</span> <span class="n">hepmcevt</span> <span class="p">);</span>
      <span class="c1">// Add the weight of the current event to the cross section.</span>
      <span class="n">sigmaTotal</span> <span class="o">+=</span> <span class="n">weightNLO</span><span class="o">*</span><span class="n">normhepmc</span><span class="p">;</span>
      <span class="n">sigmaTemp</span>  <span class="o">+=</span> <span class="n">weightNLO</span><span class="o">*</span><span class="n">normhepmc</span><span class="p">;</span>
      <span class="n">errorTotal</span> <span class="o">+=</span> <span class="n">pow2</span><span class="p">(</span><span class="n">weightNLO</span><span class="o">*</span><span class="n">normhepmc</span><span class="p">);</span>
      <span class="c1">// Report cross section to hepmc.</span>
      <span class="n">HepMC</span><span class="o">::</span><span class="n">GenCrossSection</span> <span class="n">xsec</span><span class="p">;</span>
      <span class="n">xsec</span><span class="p">.</span><span class="n">set_cross_section</span><span class="p">(</span> <span class="n">sigmaTotal</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">sigmaErr</span><span class="p">()</span><span class="o">*</span><span class="mf">1e9</span> <span class="p">);</span>
      <span class="n">hepmcevt</span><span class="o">-&gt;</span><span class="n">set_cross_section</span><span class="p">(</span> <span class="n">xsec</span> <span class="p">);</span>
      <span class="c1">// Write the HepMC event to file. Done with it.</span>
      <span class="n">ascii_io</span> <span class="o">&lt;&lt;</span> <span class="n">hepmcevt</span><span class="p">;</span>
      <span class="k">delete</span> <span class="n">hepmcevt</span><span class="p">;</span>
    <span class="p">}</span> <span class="c1">// end loop over events to generate</span>
    <span class="c1">// print cross section, errors</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
    <span class="c1">// Save sample cross section for output.</span>
    <span class="n">sampleXSsubtTree</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">sigmaTemp</span><span class="p">);</span>
    <span class="n">sigmaTemp</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">;</span>
    <span class="c1">// Restart with ME of a reduced the number of jets</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">njetcounterCT</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="p">)</span>
      <span class="n">njetcounterCT</span><span class="o">--</span><span class="p">;</span>
    <span class="k">else</span>
      <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
<span class="c1">//-----------------------------------------------------------------------------</span>
<span class="c1">//-----------------------------------------------------------------------------</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Shower subtractive events&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;Merging:doUNLOPSTree&quot;</span><span class="p">,</span><span class="nb">false</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;Merging:doUNLOPSLoop&quot;</span><span class="p">,</span><span class="nb">false</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;Merging:doUNLOPSSubt&quot;</span><span class="p">,</span><span class="nb">false</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;Merging:doUNLOPSSubtNLO&quot;</span><span class="p">,</span><span class="nb">true</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Merging:nRecluster&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
  <span class="n">nMaxCT</span> <span class="o">=</span> <span class="n">nMaxNLO</span><span class="p">;</span>
  <span class="n">njetcounterCT</span> <span class="o">=</span> <span class="n">nMaxCT</span><span class="p">;</span>
  <span class="n">iPathSubt</span><span class="o">=</span> <span class="n">iPath</span> <span class="o">+</span> <span class="s">&quot;_powheg&quot;</span><span class="p">;</span>
  <span class="k">while</span><span class="p">(</span><span class="n">njetcounterCT</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">){</span>
    <span class="c1">// From njetcounter, choose LHE file</span>
    <span class="n">stringstream</span> <span class="n">in</span><span class="p">;</span>
    <span class="n">in</span>   <span class="o">&lt;&lt;</span> <span class="s">&quot;_&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">njetcounterCT</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;.lhe&quot;</span><span class="p">;</span>
<span class="cp">#ifdef GZIPSUPPORT</span>
    <span class="k">if</span><span class="p">(</span><span class="n">access</span><span class="p">(</span> <span class="p">(</span><span class="n">iPathSubt</span><span class="o">+</span><span class="n">in</span><span class="p">.</span><span class="n">str</span><span class="p">()</span><span class="o">+</span><span class="s">&quot;.gz&quot;</span><span class="p">).</span><span class="n">c_str</span><span class="p">(),</span> <span class="n">F_OK</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="n">in</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;.gz&quot;</span><span class="p">;</span>
<span class="cp">#endif</span>
    <span class="n">string</span> <span class="n">LHEfile</span> <span class="o">=</span> <span class="n">iPathSubt</span> <span class="o">+</span> <span class="n">in</span><span class="p">.</span><span class="n">str</span><span class="p">();</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot;Start subtractive treatment for &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">njetcounterCT</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; nlo jets&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Merging:nRequested&quot;</span><span class="p">,</span> <span class="n">njetcounterCT</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Beams:frameType&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">word</span><span class="p">(</span><span class="s">&quot;Beams:LHEF&quot;</span><span class="p">,</span> <span class="n">LHEfile</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
    <span class="c1">// Remember position in vector of cross section estimates.</span>
    <span class="kt">int</span> <span class="n">iNow</span> <span class="o">=</span> <span class="n">sizeNLO</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">njetcounterCT</span><span class="p">;</span>
    <span class="c1">// Start generation loop</span>
    <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">iEvent</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">iEvent</span><span class="o">&lt;</span><span class="n">nEvent</span><span class="p">;</span> <span class="o">++</span><span class="n">iEvent</span> <span class="p">){</span>
      <span class="c1">// Generate next event</span>
      <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">atEndOfFile</span><span class="p">()</span> <span class="p">)</span> <span class="k">break</span><span class="p">;</span>
        <span class="k">else</span> <span class="k">continue</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="c1">// Get event weight(s).</span>
      <span class="kt">double</span> <span class="n">weightNLO</span>  <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">mergingWeightNLO</span><span class="p">();</span>
      <span class="kt">double</span> <span class="n">evtweight</span>  <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">weight</span><span class="p">();</span>
      <span class="n">weightNLO</span>        <span class="o">*=</span> <span class="n">evtweight</span><span class="p">;</span>
      <span class="c1">// Do not print zero-weight events.</span>
      <span class="k">if</span> <span class="p">(</span> <span class="n">weightNLO</span> <span class="o">==</span> <span class="mf">0.</span> <span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
      <span class="c1">// Construct new empty HepMC event.</span>
      <span class="n">HepMC</span><span class="o">::</span><span class="n">GenEvent</span><span class="o">*</span> <span class="n">hepmcevt</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HepMC</span><span class="o">::</span><span class="n">GenEvent</span><span class="p">();</span>
      <span class="c1">// Get correct cross section from previous estimate.</span>
      <span class="kt">double</span> <span class="n">normhepmc</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">xsecNLO</span><span class="p">[</span><span class="n">iNow</span><span class="p">]</span> <span class="o">/</span> <span class="n">nAcceptNLO</span><span class="p">[</span><span class="n">iNow</span><span class="p">];</span>
      <span class="c1">// powheg weighted events</span>
      <span class="k">if</span><span class="p">(</span> <span class="n">abs</span><span class="p">(</span><span class="n">strategyNLO</span><span class="p">[</span><span class="n">iNow</span><span class="p">])</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">normhepmc</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1e9</span><span class="o">*</span><span class="n">nSelectedNLO</span><span class="p">[</span><span class="n">iNow</span><span class="p">]);</span>
      <span class="c1">// Set hepmc event weight.</span>
      <span class="n">hepmcevt</span><span class="o">-&gt;</span><span class="n">weights</span><span class="p">().</span><span class="n">push_back</span><span class="p">(</span><span class="n">weightNLO</span><span class="o">*</span><span class="n">normhepmc</span><span class="p">);</span>
      <span class="c1">// Fill HepMC event.</span>
      <span class="n">ToHepMC</span><span class="p">.</span><span class="n">fill_next_event</span><span class="p">(</span> <span class="n">pythia</span><span class="p">,</span> <span class="n">hepmcevt</span> <span class="p">);</span>
      <span class="c1">// Add the weight of the current event to the cross section.</span>
      <span class="n">sigmaTotal</span> <span class="o">+=</span> <span class="n">weightNLO</span><span class="o">*</span><span class="n">normhepmc</span><span class="p">;</span>
      <span class="n">sigmaTemp</span>  <span class="o">+=</span> <span class="n">weightNLO</span><span class="o">*</span><span class="n">normhepmc</span><span class="p">;</span>
      <span class="n">errorTotal</span> <span class="o">+=</span> <span class="n">pow2</span><span class="p">(</span><span class="n">weightNLO</span><span class="o">*</span><span class="n">normhepmc</span><span class="p">);</span>
      <span class="c1">// Report cross section to hepmc.</span>
      <span class="n">HepMC</span><span class="o">::</span><span class="n">GenCrossSection</span> <span class="n">xsec</span><span class="p">;</span>
      <span class="n">xsec</span><span class="p">.</span><span class="n">set_cross_section</span><span class="p">(</span> <span class="n">sigmaTotal</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">sigmaErr</span><span class="p">()</span><span class="o">*</span><span class="mf">1e9</span> <span class="p">);</span>
      <span class="n">hepmcevt</span><span class="o">-&gt;</span><span class="n">set_cross_section</span><span class="p">(</span> <span class="n">xsec</span> <span class="p">);</span>
      <span class="c1">// Write the HepMC event to file. Done with it.</span>
      <span class="n">ascii_io</span> <span class="o">&lt;&lt;</span> <span class="n">hepmcevt</span><span class="p">;</span>
      <span class="k">delete</span> <span class="n">hepmcevt</span><span class="p">;</span>
    <span class="p">}</span> <span class="c1">// end loop over events to generate</span>
    <span class="c1">// print cross section, errors</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
    <span class="c1">// Save sample cross section for output.</span>
    <span class="n">sampleXSsubtVirt</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">sigmaTemp</span><span class="p">);</span>
    <span class="n">sigmaTemp</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">;</span>
    <span class="c1">// Restart with ME of a reduced the number of jets</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">njetcounterCT</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="p">)</span>
      <span class="n">njetcounterCT</span><span class="o">--</span><span class="p">;</span>
    <span class="k">else</span>
      <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// Print cross section information.</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; *---------------------------------------------------*&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; |                                                   |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; | Sample cross sections after UNLOPS merging        |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; |                                                   |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; | Leading order cross sections (mb):                |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="kt">int</span><span class="p">(</span><span class="n">sampleXStree</span><span class="p">.</span><span class="n">size</span><span class="p">());</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; |     &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">sampleXStree</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;-jet:  &quot;</span>
         <span class="o">&lt;&lt;</span> <span class="n">setw</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">scientific</span> <span class="o">&lt;&lt;</span> <span class="n">setprecision</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
         <span class="o">&lt;&lt;</span> <span class="n">sampleXStree</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;                     |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; |     (No 0-jet tree-level sample in UNLOPS)        |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; |                                                   |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; | NLO order cross sections (mb):                    |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="kt">int</span><span class="p">(</span><span class="n">sampleXSvirt</span><span class="p">.</span><span class="n">size</span><span class="p">());</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; |     &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">sampleXSvirt</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;-jet:  &quot;</span>
         <span class="o">&lt;&lt;</span> <span class="n">setw</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">scientific</span> <span class="o">&lt;&lt;</span> <span class="n">setprecision</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
         <span class="o">&lt;&lt;</span> <span class="n">sampleXSvirt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;                     |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; |                                                   |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; | Leading-order subtractive cross sections (mb):    |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="kt">int</span><span class="p">(</span><span class="n">sampleXSsubtTree</span><span class="p">.</span><span class="n">size</span><span class="p">());</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; |     &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">sampleXSsubtTree</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;-jet:  &quot;</span>
         <span class="o">&lt;&lt;</span> <span class="n">setw</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">scientific</span> <span class="o">&lt;&lt;</span> <span class="n">setprecision</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
         <span class="o">&lt;&lt;</span> <span class="n">sampleXSsubtTree</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;                     |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; |                                                   |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">sampleXSsubtVirt</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; | NLO subtractive cross sections (mb):              |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="kt">int</span><span class="p">(</span><span class="n">sampleXSsubtVirt</span><span class="p">.</span><span class="n">size</span><span class="p">());</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; |     &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">sampleXSsubtVirt</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;-jet:  &quot;</span>
         <span class="o">&lt;&lt;</span> <span class="n">setw</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">scientific</span> <span class="o">&lt;&lt;</span> <span class="n">setprecision</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
         <span class="o">&lt;&lt;</span> <span class="n">sampleXSsubtVirt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;                     |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; |                                                   |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; |---------------------------------------------------|&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; |---------------------------------------------------|&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; | Inclusive cross sections:                         |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; |                                                   |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; | UNLOPS merged inclusive cross section:            |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; |    &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">setw</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">scientific</span> <span class="o">&lt;&lt;</span> <span class="n">setprecision</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
       <span class="o">&lt;&lt;</span> <span class="n">sigmaTotal</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;  +-  &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">setw</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">errorTotal</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; mb &quot;</span>
       <span class="o">&lt;&lt;</span> <span class="s">&quot;   |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; |                                                   |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; | NLO inclusive cross section:                      |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; |    &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">setw</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">scientific</span> <span class="o">&lt;&lt;</span> <span class="n">setprecision</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
       <span class="o">&lt;&lt;</span> <span class="n">xsecNLO</span><span class="p">.</span><span class="n">back</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; mb                           |&quot;</span>  <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; |                                                   |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; | LO inclusive cross section:                       |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; |    &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">setw</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">scientific</span> <span class="o">&lt;&lt;</span> <span class="n">setprecision</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
       <span class="o">&lt;&lt;</span> <span class="n">xsecLO</span><span class="p">.</span><span class="n">back</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; mb                           |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; |                                                   |&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; *---------------------------------------------------*&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="c1">// Done</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
    </div>
  </div>
</div>

</div> <div class="well well-sm"> <h1 id="main89cc">main89.cc</h1><hr>
<div class="codehilite"><pre><span class="c1">// main89.cc is a part of the PYTHIA event generator.</span>
<span class="c1">// Copyright (C) 2016 Torbjorn Sjostrand.</span>
<span class="c1">// PYTHIA is licenced under the GNU GPL version 2, see COPYING for details.</span>
<span class="c1">// Please respect the MCnet Guidelines, see GUIDELINES for details.</span>
<span class="c1">// This program is written by Stefan Prestel.</span>
<span class="c1">// It illustrates how to do run PYTHIA with LHEF input, allowing a</span>
<span class="c1">// sample-by-sample generation of</span>
<span class="c1">// a) Non-matched/non-merged events</span>
<span class="c1">// b) MLM jet-matched events (kT-MLM, shower-kT, FxFx)</span>
<span class="c1">// c) CKKW-L and UMEPS-merged events</span>
<span class="c1">// d) UNLOPS NLO merged events</span>
<span class="c1">// see the respective sections in the online manual for details.</span>
</pre></div>


<div class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" href="#fileid61">Rest of the main89.cc code</a>
    </h4>
  </div>
  <div id="fileid61" class="panel-collapse collapse">
    <div class="panel-body">
<div class="codehilite"><pre><span class="cp">#include</span> <span class="cpf">&quot;Pythia8/Pythia.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;Pythia8Plugins/HepMC2.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp"></span>
<span class="c1">// Include UserHooks for Jet Matching.</span>
<span class="cp">#include</span> <span class="cpf">&quot;Pythia8Plugins/CombineMatchingInput.h&quot;</span><span class="cp"></span>
<span class="c1">// Include UserHooks for randomly choosing between integrated and</span>
<span class="c1">// non-integrated treatment for unitarised merging.</span>
<span class="cp">#include</span> <span class="cpf">&quot;Pythia8Plugins/aMCatNLOHooks.h&quot;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">Pythia8</span><span class="p">;</span>
<span class="c1">//==========================================================================</span>
<span class="c1">// Example main programm to illustrate merging.</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span> <span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[]</span> <span class="p">){</span>
  <span class="c1">// Check that correct number of command-line arguments</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; Unexpected number of command-line arguments (&quot;</span><span class="o">&lt;&lt;</span><span class="n">argc</span><span class="o">&lt;&lt;</span><span class="s">&quot;). </span><span class="se">\n</span><span class="s">&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; You are expected to provide the arguments&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; 1. Input file for settings&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; 2. Output file for HepMC events&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; Program stopped. &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">Pythia</span> <span class="n">pythia</span><span class="p">;</span>
  <span class="c1">// New setting to allow processing of multiple input LHEFs.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">addMode</span><span class="p">(</span><span class="s">&quot;LHEFInputs:nSubruns&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nb">true</span><span class="p">,</span><span class="nb">false</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">);</span>
  <span class="c1">// Input parameters:</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readFile</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mi">0</span><span class="p">);</span>
  <span class="c1">// Interface for conversion from Pythia8::Event to HepMC one.</span>
  <span class="n">HepMC</span><span class="o">::</span><span class="n">Pythia8ToHepMC</span> <span class="n">ToHepMC</span><span class="p">;</span>
  <span class="c1">// Specify file where HepMC events will be stored.</span>
  <span class="n">HepMC</span><span class="o">::</span><span class="n">IO_GenEvent</span> <span class="n">ascii_io</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">std</span><span class="o">::</span><span class="n">ios</span><span class="o">::</span><span class="n">out</span><span class="p">);</span>
  <span class="c1">// Switch off warnings for parton-level events.</span>
  <span class="n">ToHepMC</span><span class="p">.</span><span class="n">set_print_inconsistency</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
  <span class="n">ToHepMC</span><span class="p">.</span><span class="n">set_free_parton_warnings</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
  <span class="c1">// Do not store cross section information, as this will be done manually.</span>
  <span class="n">ToHepMC</span><span class="p">.</span><span class="n">set_store_pdf</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
  <span class="n">ToHepMC</span><span class="p">.</span><span class="n">set_store_proc</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
  <span class="n">ToHepMC</span><span class="p">.</span><span class="n">set_store_xsec</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
  <span class="c1">// Check if jet matching should be applied.</span>
  <span class="kt">bool</span> <span class="n">doMatch</span>   <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;JetMatching:merge&quot;</span><span class="p">);</span>
  <span class="c1">// Check if internal merging should be applied.</span>
  <span class="kt">bool</span> <span class="n">doMerge</span>   <span class="o">=</span> <span class="o">!</span><span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">word</span><span class="p">(</span><span class="s">&quot;Merging:Process&quot;</span><span class="p">).</span><span class="n">compare</span><span class="p">(</span><span class="s">&quot;void&quot;</span><span class="p">)</span>
    <span class="o">==</span> <span class="mi">0</span><span class="p">);</span>
  <span class="c1">// Currently, only one scheme at a time is allowed.</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">doMatch</span> <span class="o">&amp;&amp;</span> <span class="n">doMerge</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; Jet matching and merging cannot be used simultaneously.</span><span class="se">\n</span><span class="s">&quot;</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; Program stopped.&quot;</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// Get number of subruns.</span>
  <span class="kt">int</span> <span class="n">nMerge</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;LHEFInputs:nSubruns&quot;</span><span class="p">);</span>
  <span class="c1">// Number of events. Negative numbers mean all events in the LHEF will be</span>
  <span class="c1">// used.</span>
  <span class="kt">long</span> <span class="n">nEvent</span> <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Main:numberOfEvents&quot;</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">nEvent</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="n">nEvent</span> <span class="o">=</span> <span class="mi">1000000000000000</span><span class="p">;</span>
  <span class="c1">// For jet matching, initialise the respective user hooks code.</span>
  <span class="n">CombineMatchingInput</span><span class="o">*</span> <span class="n">combined</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
  <span class="n">UserHooks</span><span class="o">*</span> <span class="n">matching</span>            <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
  <span class="c1">// Allow to set the number of addtional partons dynamically.</span>
  <span class="n">amcnlo_unitarised_interface</span><span class="o">*</span> <span class="n">setting</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">doMerge</span> <span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Store merging scheme.</span>
    <span class="kt">int</span> <span class="n">scheme</span> <span class="o">=</span> <span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;Merging:doUMEPSTree&quot;</span><span class="p">)</span>
                <span class="o">||</span> <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;Merging:doUMEPSSubt&quot;</span><span class="p">))</span> <span class="o">?</span>
                <span class="mi">1</span> <span class="o">:</span>
                 <span class="p">(</span> <span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;Merging:doUNLOPSTree&quot;</span><span class="p">)</span>
                <span class="o">||</span> <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;Merging:doUNLOPSSubt&quot;</span><span class="p">)</span>
                <span class="o">||</span> <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;Merging:doUNLOPSLoop&quot;</span><span class="p">)</span>
                <span class="o">||</span> <span class="n">pythia</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">flag</span><span class="p">(</span><span class="s">&quot;Merging:doUNLOPSSubtNLO&quot;</span><span class="p">))</span> <span class="o">?</span>
                <span class="mi">2</span> <span class="o">:</span>
                <span class="mi">0</span> <span class="p">);</span>
    <span class="n">setting</span> <span class="o">=</span> <span class="k">new</span> <span class="n">amcnlo_unitarised_interface</span><span class="p">(</span><span class="n">scheme</span><span class="p">);</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">setUserHooksPtr</span><span class="p">(</span><span class="n">setting</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="c1">// For jet matching, initialise the respective user hooks code.</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">doMatch</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">matching</span> <span class="o">=</span> <span class="n">combined</span><span class="o">-&gt;</span><span class="n">getHook</span><span class="p">(</span><span class="n">pythia</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">matching</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; Failed to initialise jet matching structures.</span><span class="se">\n</span><span class="s">&quot;</span>
           <span class="o">&lt;&lt;</span> <span class="s">&quot; Program stopped.&quot;</span><span class="p">;</span>
      <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">setUserHooksPtr</span><span class="p">(</span><span class="n">matching</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="c1">// Cross section and error.</span>
  <span class="kt">double</span> <span class="n">sigmaTotal</span>  <span class="o">=</span> <span class="mf">0.</span><span class="p">;</span>
  <span class="kt">double</span> <span class="n">errorTotal</span>  <span class="o">=</span> <span class="mf">0.</span><span class="p">;</span>
  <span class="c1">// Allow abort of run if many errors.</span>
  <span class="kt">int</span>  <span class="n">nAbort</span>  <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="s">&quot;Main:timesAllowErrors&quot;</span><span class="p">);</span>
  <span class="kt">int</span>  <span class="n">iAbort</span>  <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kt">bool</span> <span class="n">doAbort</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Start generating events&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="c1">// Loop over subruns with varying number of jets.</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iMerge</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iMerge</span> <span class="o">&lt;</span> <span class="n">nMerge</span><span class="p">;</span> <span class="o">++</span><span class="n">iMerge</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">double</span> <span class="n">sigmaSample</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">errorSample</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">;</span>
    <span class="c1">// Read in name of LHE file for current subrun and initialize.</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">readFile</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">iMerge</span><span class="p">);</span>
    <span class="c1">// Initialise.</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
    <span class="c1">// Get the inclusive x-section by summing over all process x-sections.</span>
    <span class="kt">double</span> <span class="n">xs</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">nProcessesLHEF</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
      <span class="n">xs</span> <span class="o">+=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">sigmaLHEF</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
    <span class="c1">// Start generation loop</span>
    <span class="k">while</span><span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">nSelected</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">nEvent</span> <span class="p">){</span>
      <span class="c1">// Generate next event</span>
      <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">atEndOfFile</span><span class="p">()</span> <span class="p">)</span> <span class="k">break</span><span class="p">;</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">++</span><span class="n">iAbort</span> <span class="o">&gt;</span> <span class="n">nAbort</span><span class="p">)</span> <span class="p">{</span><span class="n">doAbort</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span> <span class="k">break</span><span class="p">;}</span>
        <span class="k">else</span> <span class="k">continue</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="c1">// Get event weight(s).</span>
      <span class="kt">double</span> <span class="n">evtweight</span>         <span class="o">=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">weight</span><span class="p">();</span>
      <span class="c1">// Additional PDF/alphaS weight for internal merging.</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">doMerge</span><span class="p">)</span> <span class="n">evtweight</span>  <span class="o">*=</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">mergingWeightNLO</span><span class="p">()</span>
      <span class="c1">// Additional weight due to random choice of reclustered/non-reclustered</span>
      <span class="c1">// treatment. Also contains additional sign for subtractive samples.</span>
                                <span class="o">*</span><span class="n">setting</span><span class="o">-&gt;</span><span class="n">getNormFactor</span><span class="p">();</span>
      <span class="c1">// Do not print zero-weight events.</span>
      <span class="k">if</span> <span class="p">(</span> <span class="n">evtweight</span> <span class="o">==</span> <span class="mf">0.</span> <span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
      <span class="c1">// Construct new empty HepMC event.</span>
      <span class="n">HepMC</span><span class="o">::</span><span class="n">GenEvent</span><span class="o">*</span> <span class="n">hepmcevt</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HepMC</span><span class="o">::</span><span class="n">GenEvent</span><span class="p">();</span>
      <span class="c1">// Work with weighted (LHA strategy=-4) events.</span>
      <span class="kt">double</span> <span class="n">normhepmc</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">lhaStrategy</span><span class="p">())</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">normhepmc</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="kt">double</span><span class="p">(</span><span class="mf">1e9</span><span class="o">*</span><span class="n">nEvent</span><span class="p">);</span>
      <span class="c1">// Work with unweighted events.</span>
      <span class="k">else</span>
        <span class="n">normhepmc</span> <span class="o">=</span> <span class="n">xs</span> <span class="o">/</span> <span class="kt">double</span><span class="p">(</span><span class="mf">1e9</span><span class="o">*</span><span class="n">nEvent</span><span class="p">);</span>
      <span class="c1">// Set event weight</span>
      <span class="n">hepmcevt</span><span class="o">-&gt;</span><span class="n">weights</span><span class="p">().</span><span class="n">push_back</span><span class="p">(</span><span class="n">evtweight</span><span class="o">*</span><span class="n">normhepmc</span><span class="p">);</span>
      <span class="c1">// Fill HepMC event</span>
      <span class="n">ToHepMC</span><span class="p">.</span><span class="n">fill_next_event</span><span class="p">(</span> <span class="n">pythia</span><span class="p">,</span> <span class="n">hepmcevt</span> <span class="p">);</span>
      <span class="c1">// Add the weight of the current event to the cross section.</span>
      <span class="n">sigmaTotal</span>  <span class="o">+=</span> <span class="n">evtweight</span><span class="o">*</span><span class="n">normhepmc</span><span class="p">;</span>
      <span class="n">sigmaSample</span> <span class="o">+=</span> <span class="n">evtweight</span><span class="o">*</span><span class="n">normhepmc</span><span class="p">;</span>
      <span class="n">errorTotal</span>  <span class="o">+=</span> <span class="n">pow2</span><span class="p">(</span><span class="n">evtweight</span><span class="o">*</span><span class="n">normhepmc</span><span class="p">);</span>
      <span class="n">errorSample</span> <span class="o">+=</span> <span class="n">pow2</span><span class="p">(</span><span class="n">evtweight</span><span class="o">*</span><span class="n">normhepmc</span><span class="p">);</span>
      <span class="c1">// Report cross section to hepmc</span>
      <span class="n">HepMC</span><span class="o">::</span><span class="n">GenCrossSection</span> <span class="n">xsec</span><span class="p">;</span>
      <span class="n">xsec</span><span class="p">.</span><span class="n">set_cross_section</span><span class="p">(</span> <span class="n">sigmaTotal</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span> <span class="n">pythia</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">sigmaErr</span><span class="p">()</span><span class="o">*</span><span class="mf">1e9</span> <span class="p">);</span>
      <span class="n">hepmcevt</span><span class="o">-&gt;</span><span class="n">set_cross_section</span><span class="p">(</span> <span class="n">xsec</span> <span class="p">);</span>
      <span class="c1">// Write the HepMC event to file. Done with it.</span>
      <span class="n">ascii_io</span> <span class="o">&lt;&lt;</span> <span class="n">hepmcevt</span><span class="p">;</span>
      <span class="k">delete</span> <span class="n">hepmcevt</span><span class="p">;</span>
    <span class="p">}</span> <span class="c1">// end loop over events to generate.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">doAbort</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
    <span class="c1">// print cross section, errors</span>
    <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; Contribution of sample &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">iMerge</span>
         <span class="o">&lt;&lt;</span> <span class="s">&quot; to the inclusive cross section : &quot;</span>
         <span class="o">&lt;&lt;</span> <span class="n">scientific</span> <span class="o">&lt;&lt;</span> <span class="n">setprecision</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
         <span class="o">&lt;&lt;</span> <span class="n">sigmaSample</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;  +-  &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">errorSample</span><span class="p">)</span>  <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">doAbort</span><span class="p">)</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; Run was not completed owing to too many aborted events&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="k">else</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Inclusive cross section: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">scientific</span> <span class="o">&lt;&lt;</span> <span class="n">setprecision</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
         <span class="o">&lt;&lt;</span> <span class="n">sigmaTotal</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;  +-  &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">errorTotal</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; mb &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="c1">// Done</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
    </div>
  </div>
</div>

</div> <div class="well well-sm"> <h1 id="main91cc">main91.cc</h1><hr>
<div class="codehilite"><pre><span class="c1">// main91.cc is a part of the PYTHIA event generator.</span>
<span class="c1">// Copyright (C) 2016 Torbjorn Sjostrand.</span>
<span class="c1">// PYTHIA is licenced under the GNU GPL version 2, see COPYING for details.</span>
<span class="c1">// Please respect the MCnet Guidelines, see GUIDELINES for details.</span>
<span class="c1">// This is a simple test program.</span>
<span class="c1">// It studies the charged multiplicity distribution at the LHC.</span>
<span class="c1">// Modified by Rene Brun, Axel Naumann and Bernhard Meirose</span>
<span class="c1">// to use ROOT for histogramming.</span>
<span class="c1">// Stdlib header file for input and output.</span>
</pre></div>


<div class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" href="#fileid62">Rest of the main91.cc code</a>
    </h4>
  </div>
  <div id="fileid62" class="panel-collapse collapse">
    <div class="panel-body">
<div class="codehilite"><pre><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="c1">// Header file to access Pythia 8 program elements.</span>
<span class="cp">#include</span> <span class="cpf">&quot;Pythia8/Pythia.h&quot;</span><span class="cp"></span>
<span class="c1">// ROOT, for histogramming.</span>
<span class="cp">#include</span> <span class="cpf">&quot;TH1.h&quot;</span><span class="cp"></span>
<span class="c1">// ROOT, for interactive graphics.</span>
<span class="cp">#include</span> <span class="cpf">&quot;TVirtualPad.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;TApplication.h&quot;</span><span class="cp"></span>
<span class="c1">// ROOT, for saving file.</span>
<span class="cp">#include</span> <span class="cpf">&quot;TFile.h&quot;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">Pythia8</span><span class="p">;</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
  <span class="c1">// Create the ROOT application environment.</span>
  <span class="n">TApplication</span> <span class="n">theApp</span><span class="p">(</span><span class="s">&quot;hist&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">);</span>
  <span class="c1">// Create Pythia instance and set it up to generate hard QCD processes</span>
  <span class="c1">// above pTHat = 20 GeV for pp collisions at 14 TeV.</span>
  <span class="n">Pythia</span> <span class="n">pythia</span><span class="p">;</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;HardQCD:all = on&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;PhaseSpace:pTHatMin = 20.&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Beams:eCM = 14000.&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
  <span class="c1">// Create file on which histogram(s) can be saved.</span>
  <span class="n">TFile</span><span class="o">*</span> <span class="n">outFile</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TFile</span><span class="p">(</span><span class="s">&quot;hist.root&quot;</span><span class="p">,</span> <span class="s">&quot;RECREATE&quot;</span><span class="p">);</span>
  <span class="c1">// Book histogram.</span>
  <span class="n">TH1F</span> <span class="o">*</span><span class="n">mult</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TH1F</span><span class="p">(</span><span class="s">&quot;mult&quot;</span><span class="p">,</span><span class="s">&quot;charged multiplicity&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">799.5</span><span class="p">);</span>
  <span class="c1">// Begin event loop. Generate event; skip if generation aborted.</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iEvent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iEvent</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">;</span> <span class="o">++</span><span class="n">iEvent</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">())</span> <span class="k">continue</span><span class="p">;</span>
    <span class="c1">// Find number of all final charged particles.</span>
    <span class="kt">int</span> <span class="n">nCharged</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">isFinal</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">isCharged</span><span class="p">())</span>
        <span class="o">++</span><span class="n">nCharged</span><span class="p">;</span>
    <span class="c1">// Fill charged multiplicity in histogram. End event loop.</span>
    <span class="n">mult</span><span class="o">-&gt;</span><span class="n">Fill</span><span class="p">(</span> <span class="n">nCharged</span> <span class="p">);</span>
  <span class="p">}</span>
  <span class="c1">// Statistics on event generation.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
  <span class="c1">// Show histogram. Possibility to close it.</span>
  <span class="n">mult</span><span class="o">-&gt;</span><span class="n">Draw</span><span class="p">();</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">Double click on the histogram window to quit.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
  <span class="n">gPad</span><span class="o">-&gt;</span><span class="n">WaitPrimitive</span><span class="p">();</span>
  <span class="c1">// Save histogram on file and close file.</span>
  <span class="n">mult</span><span class="o">-&gt;</span><span class="n">Write</span><span class="p">();</span>
  <span class="k">delete</span> <span class="n">outFile</span><span class="p">;</span>
  <span class="c1">// Done.</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
    </div>
  </div>
</div>

</div> <div class="well well-sm"> <h1 id="main92cc">main92.cc</h1><hr>
<div class="codehilite"><pre><span class="c1">// main92.cc is a part of the PYTHIA event generator.</span>
<span class="c1">// Copyright (C) 2016 Torbjorn Sjostrand.</span>
<span class="c1">// PYTHIA is licenced under the GNU GPL version 2, see COPYING for details.</span>
<span class="c1">// Please respect the MCnet Guidelines, see GUIDELINES for details.</span>
<span class="c1">// This is a simple test program.</span>
<span class="c1">// Modified by Rene Brun and Axel Naumann to put the Pythia::event</span>
<span class="c1">// into a TTree.</span>
<span class="c1">// Header file to access Pythia 8 program elements.</span>
</pre></div>


<div class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" href="#fileid63">Rest of the main92.cc code</a>
    </h4>
  </div>
  <div id="fileid63" class="panel-collapse collapse">
    <div class="panel-body">
<div class="codehilite"><pre><span class="cp">#include</span> <span class="cpf">&quot;Pythia8/Pythia.h&quot;</span><span class="cp"></span>
<span class="c1">// ROOT, for saving Pythia events as trees in a file.</span>
<span class="cp">#include</span> <span class="cpf">&quot;TTree.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;TFile.h&quot;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">Pythia8</span><span class="p">;</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Create Pythia instance and set it up to generate hard QCD processes</span>
  <span class="c1">// above pTHat = 20 GeV for pp collisions at 14 TeV.</span>
  <span class="n">Pythia</span> <span class="n">pythia</span><span class="p">;</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;HardQCD:all = on&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;PhaseSpace:pTHatMin = 20.&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="s">&quot;Beams:eCM = 14000.&quot;</span><span class="p">);</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
  <span class="c1">// Set up the ROOT TFile and TTree.</span>
  <span class="n">TFile</span> <span class="o">*</span><span class="n">file</span> <span class="o">=</span> <span class="n">TFile</span><span class="o">::</span><span class="n">Open</span><span class="p">(</span><span class="s">&quot;pytree.root&quot;</span><span class="p">,</span><span class="s">&quot;recreate&quot;</span><span class="p">);</span>
  <span class="n">Event</span> <span class="o">*</span><span class="n">event</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">pythia</span><span class="p">.</span><span class="n">event</span><span class="p">;</span>
  <span class="n">TTree</span> <span class="o">*</span><span class="n">T</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TTree</span><span class="p">(</span><span class="s">&quot;T&quot;</span><span class="p">,</span><span class="s">&quot;ev1 Tree&quot;</span><span class="p">);</span>
  <span class="n">T</span><span class="o">-&gt;</span><span class="n">Branch</span><span class="p">(</span><span class="s">&quot;event&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">event</span><span class="p">);</span>
 <span class="c1">// Begin event loop. Generate event; skip if generation aborted.</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iEvent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iEvent</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">;</span> <span class="o">++</span><span class="n">iEvent</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pythia</span><span class="p">.</span><span class="n">next</span><span class="p">())</span> <span class="k">continue</span><span class="p">;</span>
    <span class="c1">// Fill the pythia event into the TTree.</span>
    <span class="c1">// Warning: the files will rapidly become large if all events</span>
    <span class="c1">// are saved. In some cases it may be convenient to do some</span>
    <span class="c1">// processing of events and only save those that appear</span>
    <span class="c1">// interesting for future analyses.</span>
    <span class="n">T</span><span class="o">-&gt;</span><span class="n">Fill</span><span class="p">();</span>
  <span class="c1">// End event loop.</span>
  <span class="p">}</span>
  <span class="c1">// Statistics on event generation.</span>
  <span class="n">pythia</span><span class="p">.</span><span class="n">stat</span><span class="p">();</span>
  <span class="c1">//  Write tree.</span>
  <span class="n">T</span><span class="o">-&gt;</span><span class="n">Print</span><span class="p">();</span>
  <span class="n">T</span><span class="o">-&gt;</span><span class="n">Write</span><span class="p">();</span>
  <span class="k">delete</span> <span class="n">file</span><span class="p">;</span>
  <span class="c1">// Done.</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
    </div>
  </div>
</div>
                        
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

	
		
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.5/js/bootstrap.min.js"></script>
		<!-- <script src="../static/mp/js/getServerTime.js"></script> -->
		<script src="../static/mp/js/getClientTime.js"></script>
		<!-- <script src='https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script> -->
		<script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML"></script>
        <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          config: ["MMLorHTML.js"],
          jax: ["input/TeX", "output/HTML-CSS", "output/NativeMML"],
          extensions: ["MathMenu.js", "MathZoom.js"]
        });
        </script>
		<script>
		window.twttr = (function (d,s,id) {
			var t, js, fjs = d.getElementsByTagName(s)[0];
			if (d.getElementById(id)) return; js=d.createElement(s); js.id=id; js.async=1;
			js.src="https://platform.twitter.com/widgets.js"; fjs.parentNode.insertBefore(js, fjs);
			return window.twttr || (t = { _e: [], ready: function(f){ t._e.push(f) } });
		}(document, "script", "twitter-wjs"));
		</script>
		<!-- script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script -->
	
	

      <footer class="bs-docs-footer text-muted" role="contentinfo" id="foot">
      <p> E-mail: mploskon @ lbl.gov </p>
      <p> Mail: 1 Cyclotron Road, Berkeley, CA, USA </p>
      <span class="label label-default" id="clientTime">not loaded</span>
      </footer>



  </body>
</html>
